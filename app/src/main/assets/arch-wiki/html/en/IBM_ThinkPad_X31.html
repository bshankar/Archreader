<!DOCTYPE html>
<html lang="en" dir="ltr" class="client-nojs">
<head>
<meta charset="UTF-8">
<title>IBM ThinkPad X31 - ArchWiki</title>
<link rel="stylesheet" href="../ArchWikiOffline.css">
<meta name="ResourceLoaderDynamicStyles" content="">
<style></style>
<meta name="generator" content="MediaWiki 1.26.4">
<meta name="robots" content="noindex,follow">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="search" type="application/opensearchdescription+xml" href="/opensearch_desc.php" title="ArchWiki (en)">
<link rel="EditURI" type="application/rsd+xml" href="https://wiki.archlinux.org/api.php?action=rsd">
<link rel="copyright" href="http://www.gnu.org/copyleft/fdl.html">
<link rel="alternate" type="application/atom+xml" title="ArchWiki Atom feed" href="/index.php?title=Special:RecentChanges&amp;feed=atom">
</head>
<body class="mediawiki ltr sitedir-ltr ns-0 ns-subject page-IBM_ThinkPad_X31 skin-archlinux action-view">

		<div id="globalWrapper" style="width: 100%">
		<div id="column-content">
			<div id="content" class="mw-body" role="main" style="margin: 0.5em; margin-bottom:0; margin-top:0">
				<a id="top"></a>
				
				<div class="mw-indicators">
</div>
				<h1 id="firstHeading" class="firstHeading" lang="en">IBM ThinkPad X31</h1>
				
				<div id="bodyContent" class="mw-body-content">
					<div id="contentSub"></div>
										<div id="mw-content-text" lang="en" dir="ltr" class="mw-content-ltr">
<p>The IBM Thinkpad X31 is a wonderful little laptop which contains everything you need for your everyday work, and even some gaming, if you tweak things a little. The X31 is rock solid, light (3.7 lbs), and nowadays very cheap. The only drawback is the lack of internal optical drive. You can see the specs of the X31 on <a rel="nofollow" class="external text" href="http://www.thinkwiki.org/wiki/Category:X31">ThinkWiki</a>, a wonderful resource with additional information.
</p>
<div id="toc" class="toc">
<div id="toctitle"><h2>Contents</h2></div>
<ul>
<li class="toclevel-1 tocsection-1"><a href="#Installation"><span class="tocnumber">1</span> <span class="toctext">Installation</span></a></li>
<li class="toclevel-1 tocsection-2"><a href="#Hibernation"><span class="tocnumber">2</span> <span class="toctext">Hibernation</span></a></li>
<li class="toclevel-1 tocsection-3">
<a href="#Xorg_and_direct_rendering"><span class="tocnumber">3</span> <span class="toctext">Xorg and direct rendering</span></a>
<ul>
<li class="toclevel-2 tocsection-4"><a href="#Rovclock"><span class="tocnumber">3.1</span> <span class="toctext">Rovclock</span></a></li>
<li class="toclevel-2 tocsection-5"><a href="#Dual_Screen"><span class="tocnumber">3.2</span> <span class="toctext">Dual Screen</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-6">
<a href="#Powersaving"><span class="tocnumber">4</span> <span class="toctext">Powersaving</span></a>
<ul>
<li class="toclevel-2 tocsection-7"><a href="#Laptop-mode"><span class="tocnumber">4.1</span> <span class="toctext">Laptop-mode</span></a></li>
<li class="toclevel-2 tocsection-8"><a href="#Undervolting"><span class="tocnumber">4.2</span> <span class="toctext">Undervolting</span></a></li>
<li class="toclevel-2 tocsection-9"><a href="#Modprobe"><span class="tocnumber">4.3</span> <span class="toctext">Modprobe</span></a></li>
<li class="toclevel-2 tocsection-10"><a href="#Hard_drive_dilemma"><span class="tocnumber">4.4</span> <span class="toctext">Hard drive dilemma</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-11">
<a href="#ACPI_and_Hardware-related"><span class="tocnumber">5</span> <span class="toctext">ACPI and Hardware-related</span></a>
<ul>
<li class="toclevel-2 tocsection-12"><a href="#Fan-control"><span class="tocnumber">5.1</span> <span class="toctext">Fan-control</span></a></li>
<li class="toclevel-2 tocsection-13"><a href="#thinkpad_acpi_and_tp_smapi_kernel_modules"><span class="tocnumber">5.2</span> <span class="toctext">thinkpad_acpi and tp_smapi kernel modules</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-14"><a href="#Wireless"><span class="tocnumber">6</span> <span class="toctext">Wireless</span></a></li>
<li class="toclevel-1 tocsection-15"><a href="#Audio_keys"><span class="tocnumber">7</span> <span class="toctext">Audio keys</span></a></li>
</ul>
</div>

<h2><span class="mw-headline" id="Installation">Installation</span></h2>
<p>A basic Arch Linux installation will do just fine for about everything, so I won't talk about sound or other basic stuff. No custom kernel needed. However, you will need the following particular packages:
</p>
<ul>
<li> <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://www.archlinux.org/packages/?name=ipw2100-fw">ipw2100-fw</a></span> and <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://www.archlinux.org/packages/?name=wireless_tools">wireless_tools</a></span> for wireless</li>
<li> <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://www.archlinux.org/packages/?name=xf86-video-ati">xf86-video-ati</a></span> for direct rendering (see above)</li>
<li> <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/uswsusp-git/">uswsusp-git</a></span><sup><small>AUR</small></sup> for hibernation (see above)</li>
</ul>
<p>The following useful packages are in the <a href="../en/Arch_User_Repository.html" title="AUR" class="mw-redirect">AUR</a>.
</p>
<ul><li> <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/rovclock/">rovclock</a></span><sup><small>AUR</small></sup><sup>[<a href="../en/ArchWiki:Requests.html#Broken_package_links" title="ArchWiki:Requests">broken link</a>: archived in <a rel="nofollow" class="external text" href="https://github.com/felixonmars/aur3-mirror/tree/master/rovclock">aur-mirror</a>]</sup> for boosting direct rendering (see above)</li></ul>
<h2><span class="mw-headline" id="Hibernation">Hibernation</span></h2>
<div class="noprint archwiki-template-message">
<p><a href="../File:Tango-view-refresh-red.png" class="image"><img alt="Tango-view-refresh-red.png" src="../File:Tango-view-refresh-red.png" width="48" height="48"></a><b>This article or section is out of date.</b><a href="../File:Tango-view-refresh-red.png" class="image"><img alt="Tango-view-refresh-red.png" src="../File:Tango-view-refresh-red.png" width="48" height="48"></a></p>
<div>
<b>Reason:</b> tested with very old kernel (Discuss in <a rel="nofollow" class="external text" href="https://wiki.archlinux.org/index.php/Talk:IBM_ThinkPad_X31">Talk:IBM ThinkPad X31#</a>)</div>
</div>
<p>To hibernate using <a href="../en/Pm-utils.html" title="Pm-utils">pm-utils</a> (tested with kernel 2.6.37), you have to adjust some screws of the default setup. Doing this, hibernation works flawlessly. You have to setup <a href="../en/Pm-utils.html" title="Pm-utils">pm-utils</a> first. If it's working out of the box, do not read further.
</p>
<p>Don't forget to install <i>radeontool</i> from the AUR, as it's needed to turn off the lcd backlight.
</p>
<p>If your X31 freezes during hibernation or just reboots instead of resume, when you power on again, this might help you:
</p>
<p>Append the following to your <b>kernel</b> line in grub's config:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/boot/grub/menu.lst</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">
nomodeset acpi_sleep=nonvs 
</pre>
<ul>
<li>nomodeset will turn off kernel modesetting, which tries to automatically handle the resolution during boot. Take a look at <a rel="nofollow" class="external autonumber" href="http://wiki.sugarlabs.org/go/Nomodeset">[1]</a>.</li>
<li>acpi_sleep=nonvs is a workaround, see <a href="../en/Pm-utils.html#Reboot_instead_of_resume_from_suspend" title="Pm-utils">Pm-utils#Reboot instead of resume from suspend</a> for detailed information.</li>
</ul>
<h2><span class="mw-headline" id="Xorg_and_direct_rendering">Xorg and direct rendering</span></h2>
<p>This section assumes the ATI Radeon Mobility M6 LY video card. This can be verified using:
</p>
<pre>$ lspci | grep Mobility
</pre>
<p>Here is a minimal <code>xorg.conf</code>, optimized for performance:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/X11/xorg.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">
Section "ServerFlags"
	Option "AutoAddDevices" "False"
EndSection

Section "Device"
	Identifier	"Card0"
	Driver		"ati"
	BusID		"PCI:1:0:0"
	Option		"AGPMode" "4"
	Option		"AGPFastWrite" "on" #Faster than default (off)
	Option		"SWcursor" "off" #Faster than default (on)
	Option		"EnablePageFlip" "on" #Faster than default (off)
	Option		"AccelMethod" "EXA" # or XAA, EXA, XAA more stable, XAA is deafult
	Option		"DynamicClocks" "on"
	Option		"BIOSHotkeys"   "on"
	Option		"AGPSize" "32" # default: 8
	Option		"EnableDepthMoves" "true"
EndSection

Section "Extensions"
  Option "Composite" "Disable"
EndSection
</pre>
<div style="padding: 5px; margin: 0.50em 0; background-color: #DDDDFF; border: thin solid #BBBBDD; overflow: hidden;">
<strong> Note: </strong>This configuration disables compositing to improve performance. If you need this feature, set <code>Composite</code> to <code>Enable</code>. Also, if you want to use <a href="../en/Xorg.html" title="Xorg Input Hotplugging" class="mw-redirect">Xorg Input Hotplugging</a>, set <code>AutoAddDevices</code> to <code>true</code>.</div>
<h3><span class="mw-headline" id="Rovclock">Rovclock</span></h3>
<p>You can also overclock your graphic card. As far as I know, there is no real drawback, but you can play it safe and only use it while running a game or compiz or any application using your graphic card:
</p>
<pre>rovclock -c 220 -m 210
</pre>
<p>Use this command to get back to default settings:
</p>
<pre>rovclock -c 144 -m 144
</pre>
<p>If you want to enable it permanently, add the first command in <a href="../en/Xprofile.html" title="Xprofile">xprofile</a>.
</p>
<p>If, on the contrary, you barely use your graphic card, you can lower both power usage and temperature slightly by underclocking your graphic card at boot by adding this command to <a href="../en/Xprofile.html" title="Xprofile">xprofile</a>:
</p>
<pre>rovclock -c 90 -m 100
</pre>
<h3><span class="mw-headline" id="Dual_Screen">Dual Screen</span></h3>
<p>If you want to use an external screen for a presentation or as an extended desktop, you can use <a href="../en/Xrandr.html" title="Xrandr">xrandr</a>.
For an extended desktop, you should first add one line in your <code>/etc/x11/xorg.conf</code> configuration file in the <code>SubSection "Display"</code> area:
</p>
<p>Before:
</p>
<pre>SubSection "Display"
 		Depth     24
 		Modes "1024x768" "800x600" "640x480"
EndSubSection
</pre>
<p>After:
</p>
<pre>SubSection "Display"
		Depth     24
		Modes "1024x768" "800x600" "640x480"
		Virtual 2304 1024
EndSubSection
</pre>
<p>The numbers are the total rectangular resolution that you need to use. In this case, I'm using the internal 1024x768 screen and an external 1280x1024 screen on the right. The total resolution is 1024+1280=2304 pixels large and 1024&gt;768=1024 pixels height.
</p>
<p>Note that in 24 bits with this option, the performance is affected for 3D drawing, so you may need to comment it and use only one screen when you need the graphical power.
</p>
<p>Then restart your X server. You can issue this command in a shell:
</p>
<pre>xrandr --output VGA-0 --right-of LVDS
</pre>
<p>To find the exact name of the monitors and the maximum resolution that you set up in the configuration file, you can type just <code>xrandr</code> without arguments.
</p>
<h2><span class="mw-headline" id="Powersaving">Powersaving</span></h2>
<h3><span class="mw-headline" id="Laptop-mode">Laptop-mode</span></h3>
<p>This will put your screen brightness to the minimum level when on battery and restore it to maximum when on ac power:
</p>
<pre>echo -e '#!/bin/bash\necho 0 &gt; /sys/class/backlight/thinkpad_screen/brightness' &gt; /etc/laptop-mode/batt-start/battscript
chmod 0755 /etc/laptop-mode/batt-start/battscript
echo -e '#!/bin/bash\necho 7 &gt; /sys/class/backlight/thinkpad_screen/brightness' &gt; /etc/laptop-mode/lm-ac-start/acscript
chmod 0755 /etc/laptop-mode/lm-ac-start/acscript
ln -s /etc/laptop-mode/lm-ac-start/acscript /etc/laptop-mode/onlm-ac-start/acscript
</pre>
<p>It will create scripts, executed by the laptop-mode daemon when switching the power source, that change the brightness of your screen using the thinkpad_acpi module.
</p>
<h3><span class="mw-headline" id="Undervolting">Undervolting</span></h3>
<p>The X31 CPUs can be undervolted, which means they will offer you the same performance, but with more battery life and a cooler laptop. From personal experience, my CPU temperature,during 100% activity, dropped by 15-20°C just by using this patch. This is extremely easy using the linux-phc patch, but only if you know the proper values to give the CPU. Informations on how to find them is available <a rel="nofollow" class="external text" href="http://gentoo-wiki.com/HOWTO_Undervolt_a_Pentium_M_CPU">here</a> or <a rel="nofollow" class="external text" href="http://www.thinkwiki.org/wiki/Pentium_M_undervolting_and_underclocking">here</a>. I know it can be hard to find your own values, so here is a table were you can indicate what are the good values for each of the X31 CPUs:
</p>
<ul><li> Pentium-m 1600MHz : 34 26 18 12 8 5</li></ul>
<div style="padding: 5px; margin: 0.50em 0; background-color: #FFDDDD; border: thin solid #DDBBBB; overflow: hidden;">
<strong> Warning: </strong>Your computer may freeze once a month because of those values. If you find more stable ones, please indicate them.</div>
<p>Once you have your values, just run:
</p>
<pre># echo VALUES &gt; /sys/devices/system/cpu/cpu0/cpufreq/phc_vids
</pre>
<p>For example:
</p>
<pre># echo 34 26 18 12 8 5 &gt; /sys/devices/system/cpu/cpu0/cpufreq/phc_vids
</pre>
<p>You can add this command to your <code>/etc/rc.local</code> to make the undervolting permanent.
</p>
<h3><span class="mw-headline" id="Modprobe">Modprobe</span></h3>
<p>Create the following file:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/modprobe.d/powersave.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">
 options usbcore autosuspend=1
 options ipw2100 associate=0
 options thinkpad-acpi experimental=1 fan_control=1
</pre>
<p>The three first lines put some of your devices in power-saving mode, respectively the USB ports, and the wireless card. Note that you need the last line in order to control your fan speed (see above).
</p>
<p>See <a href="../en/Power_management.html" title="Power saving" class="mw-redirect">power saving</a> for more details.
</p>
<h3><span class="mw-headline" id="Hard_drive_dilemma">Hard drive dilemma</span></h3>
<p>As set earlier, the hard drive is on a power-saving mode that can make it spin off and on often. It may reduce its lifetime. You can install the <b>smartmontools</b> package and issue this command:
</p>
<pre># smartctl -A /dev/sda | grep Load_Cycle_Count
</pre>
<p>If the number is growing too fast, you might want to set off the powersaving mode by issuing: 
</p>
<pre># hdparm -B 254 /dev/sda
</pre>
<p>Put it in <code>/etc/rc.local</code> to modify it at boot time.
</p>
<h2><span class="mw-headline" id="ACPI_and_Hardware-related">ACPI and Hardware-related</span></h2>
<h3><span class="mw-headline" id="Fan-control">Fan-control</span></h3>
<p>You can use a script from <a rel="nofollow" class="external text" href="http://www.thinkwiki.org/wiki/ThinkWiki">ThinkWiki</a> to considerably lower your CPU temperature. Simply download it from <a rel="nofollow" class="external text" href="http://www.thinkwiki.org/index.php?title=Code/tp-fancontrol&amp;action=raw&amp;ctype=application/octet-stream">here</a>, rename it to <code>tp-fancontrol</code>, and run:
</p>
<pre># chmod 0755 tp-fancontrol
# mv tp-fancontrol /usr/bin
</pre>
<p>To run the script at each boot, add this line to your <code>/etc/rc.local</code>:
</p>
<pre>tp-fancontrol -d
</pre>
<p>Also, I suggest changing the first maximum temperature threshold (the CPU one) to 55. Just edit <code>/usr/bin/tp-fancontrol</code>, the file is self-explanatory.
</p>
<h3><span class="mw-headline" id="thinkpad_acpi_and_tp_smapi_kernel_modules">thinkpad_acpi and tp_smapi kernel modules</span></h3>
<p>To make use of all hardware, use <a href="../en/Tp_smapi.html" title="Tp smapi">tp_smapi</a> and thinkpad_acpi. The former is in the <a href="../en/Arch_User_Repository.html" title="AUR" class="mw-redirect">AUR</a>, thinkpad_acpi is merged into the kernel and has just to be loaded.
</p>
<p>Have a look at Thinkwiki for scripts and tweaks:
</p>
<ul>
<li><a rel="nofollow" class="external text" href="http://www.thinkwiki.org/wiki/Thinkpad-acpi">Thinkpad_acpi</a></li>
<li><a rel="nofollow" class="external text" href="http://www.thinkwiki.org/wiki/Thinkpad-acpi">Tp_smapi</a></li>
</ul>
<h2><span class="mw-headline" id="Wireless">Wireless</span></h2>
<p>If you have the Cisco neta504 wifi card, it's a bit tricky to use the wpa encryption with it. 
First, unload the airo and the airo_cs modules.
remove the module airo from the kernel
</p>
<pre># rmmod airo
# rmmod airo_cs
</pre>
<p>Next, <a href="../en/Kernel_modules.html#Blacklisting" title="Blacklist" class="mw-redirect">blacklist</a> the modules in <code>/etc/modprobe.d/</code>.
</p>
<p>then install <a href="../en/Wireless_network_configuration.html#ndiswrapper" title="Ndiswrapper" class="mw-redirect">ndiswrapper</a>.
</p>
<p>download the neta504 driver for windows and unpack it (Be sure that you have unpacked the whole driver !) Then run :
</p>
<pre># ndiswrapper -i /path/to/your/dir/netA504.inf
</pre>
<p>Save the ndiswrapper conf file :
</p>
<pre># ndiswrapper -m
# ndiswrapper -ma
# ndiswrapper -mi
</pre>
<p>Now you can add to your kernel the module :
</p>
<pre># modprobe ndiswrapper
</pre>
<p>and voilà ! I've tried this with wicd and it works flawlessly !
</p>
<h2><span class="mw-headline" id="Audio_keys">Audio keys</span></h2>
<p>To have an on-screen Display for volume change or thinklight activation you can use Tpb: <a href="../en/ThinkPad_OSD.html" title="ThinkPad OSD">ThinkPad OSD</a>. The audio volume up/down keys will change audio volume independently from ALSA/OSS mixer. This works quite well, so try it out.
</p>
<p>To enable the audio keys interfacing with ALSA, add:
</p>
<pre>event=ibm/hotkey HKEY 00000080 *
action=/etc/acpi/soundkey.sh %e
</pre>
<p>to <code>/etc/acpi/events/soundkey</code>, create the following file and make it executable:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/acpi/soundkey.sh</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">
#!/bin/bash

echo here &gt; /tmp/fish
echo $4 &gt;&gt; /tmp/fish
case "$4" in
	00001015)
		amixer -c 0 set Master playback unmute
		amixer -c 0 set Master playback 3%+
		;;
	00001016)
		amixer -c 0 set Master playback unmute
		amixer -c 0 set Master playback 3%-
		;;
	00001017)
		amixer -c 0 set Master playback mute
		;;
esac
</pre>
<p>You'll also need to add:
</p>
<pre>echo enable,0xffffffff &gt;/proc/acpi/ibm/hotkey
</pre>
<p>to <code>/etc/rc.local</code> or somewhere similar for the events to be recognized.
</p>
</div>
<div id="catlinks" class="catlinks">
<div id="mw-normal-catlinks" class="mw-normal-catlinks">
<a href="../Special:Categories.html" title="Special:Categories">Category</a>: <ul><li><a href="../en/Category:IBM.html" title="Category:IBM">IBM</a></li></ul>
</div>
<div id="mw-hidden-catlinks" class="mw-hidden-catlinks mw-hidden-cats-hidden">Hidden categories: <ul>
<li><a href="../en/Category:Pages_with_broken_package_links.html" title="Category:Pages with broken package links">Pages with broken package links</a></li>
<li><a href="../en/Category:Pages_or_sections_flagged_with_Template:Out_of_date.html" title="Category:Pages or sections flagged with Template:Out of date">Pages or sections flagged with Template:Out of date</a></li>
</ul>
</div>
</div>					<div class="visualClear"></div>
				</div>
			</div>
		</div>
		<div class="visualClear"></div>
					<div id="footer" role="contentinfo">
Extracted from <a href="https://wiki.archlinux.org"> ArchWiki </a> and licensed under <a href="http://www.gnu.org/copyleft/fdl.html"> GDL >= 1.3</a>
		</div>
		</div>
		</body>
</html>
