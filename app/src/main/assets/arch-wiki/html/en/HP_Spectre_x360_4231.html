<!DOCTYPE html>
<html lang="en" dir="ltr" class="client-nojs">
<head>
<meta charset="UTF-8">
<title>HP Spectre x360 4231 - ArchWiki</title>
<link rel="stylesheet" href="../ArchWikiOffline.css">
<meta name="ResourceLoaderDynamicStyles" content="">
<style></style>
<meta name="generator" content="MediaWiki 1.26.4">
<meta name="robots" content="noindex,follow">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="search" type="application/opensearchdescription+xml" href="/opensearch_desc.php" title="ArchWiki (en)">
<link rel="EditURI" type="application/rsd+xml" href="https://wiki.archlinux.org/api.php?action=rsd">
<link rel="copyright" href="http://www.gnu.org/copyleft/fdl.html">
<link rel="alternate" type="application/atom+xml" title="ArchWiki Atom feed" href="/index.php?title=Special:RecentChanges&amp;feed=atom">
</head>
<body class="mediawiki ltr sitedir-ltr ns-0 ns-subject page-HP_Spectre_x360_4231 skin-archlinux action-view">

		<div id="globalWrapper" style="width: 100%">
		<div id="column-content">
			<div id="content" class="mw-body" role="main" style="margin: 0.5em; margin-bottom:0; margin-top:0">
				<a id="top"></a>
				
				<div class="mw-indicators">
</div>
				<h1 id="firstHeading" class="firstHeading" lang="en">HP Spectre x360 4231</h1>
				
				<div id="bodyContent" class="mw-body-content">
					<div id="contentSub"></div>
										<div id="mw-content-text" lang="en" dir="ltr" class="mw-content-ltr">
<table class="wikitable" style="float: right;">
<tr>
<td> <b>Device</b> </td>
<td> <b>Status</b> </td>
<td> <b>Modules</b>
</td>
</tr>
<tr>
<td> Video </td>
<td style="background: #afa; color: inherit; vertical-align: middle; text-align: center;">Working, see tweaks </td>
<td> i915
</td>
</tr>
<tr>
<td> Wireless </td>
<td style="background: #afa; color: inherit; vertical-align: middle; text-align: center;">Working, see issues </td>
<td> iwlwifi
</td>
</tr>
<tr>
<td> Bluetooth </td>
<td style="background: #faa; color: inherit; vertical-align: middle; text-align: center;">not working</td>
<td> unknown
</td>
</tr>
<tr>
<td> Audio </td>
<td style="background: #afa; color: inherit; vertical-align: middle; text-align: center;">Working </td>
<td> snd_hda_intel
</td>
</tr>
<tr>
<td> Touchpad </td>
<td style="background: #afa; color: inherit; vertical-align: middle; text-align: center;">Working </td>
<td> ?
</td>
</tr>
<tr>
<td> Webcam </td>
<td style="background: #afa; color: inherit; vertical-align: middle; text-align: center;">working </td>
<td> uvcvideo
</td>
</tr>
<tr>
<td> Card Reader </td>
<td style="background: #ffa; color: inherit; vertical-align: middle; text-align: center;">not tested </td>
<td> rtsx_pci
</td>
</tr>
<tr>
<td> Wireless switch </td>
<td style="background: #afa; color: inherit; vertical-align: middle; text-align: center;">Working, see issues </td>
<td> intel-hid
</td>
</tr>
<tr>
<td> Function/Multimedia Keys </td>
<td style="background: #afa; color: inherit; vertical-align: middle; text-align: center;">Working </td>
<td> ?
</td>
</tr>
</table>
<p>This article covers hardware specific configuration of this laptop, some minor issues remain after customization. These can be performed after an installation of Arch Linux has been finished and the machine rebooted into it. 
</p>
<p>For a general overview of laptop-related articles and recommendations, see <a href="../en/Laptop.html" title="Laptop">Laptop</a>.
</p>
<div id="toc" class="toc">
<div id="toctitle"><h2>Contents</h2></div>
<ul>
<li class="toclevel-1 tocsection-1">
<a href="#Hardware_info"><span class="tocnumber">1</span> <span class="toctext">Hardware info</span></a>
<ul>
<li class="toclevel-2 tocsection-2"><a href="#Hardware_options"><span class="tocnumber">1.1</span> <span class="toctext">Hardware options</span></a></li>
<li class="toclevel-2 tocsection-3"><a href="#lspci_on_a_4231"><span class="tocnumber">1.2</span> <span class="toctext">lspci on a 4231</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-4"><a href="#Installation"><span class="tocnumber">2</span> <span class="toctext">Installation</span></a></li>
<li class="toclevel-1 tocsection-5">
<a href="#Tweaks"><span class="tocnumber">3</span> <span class="toctext">Tweaks</span></a>
<ul>
<li class="toclevel-2 tocsection-6"><a href="#Brightness_.2F_backlight"><span class="tocnumber">3.1</span> <span class="toctext">Brightness / backlight</span></a></li>
<li class="toclevel-2 tocsection-7"><a href="#Gnome_scaling"><span class="tocnumber">3.2</span> <span class="toctext">Gnome scaling</span></a></li>
<li class="toclevel-2 tocsection-8"><a href="#Video_driver"><span class="tocnumber">3.3</span> <span class="toctext">Video driver</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-9"><a href="#Issues"><span class="tocnumber">4</span> <span class="toctext">Issues</span></a></li>
</ul>
</div>

<h2><span class="mw-headline" id="Hardware_info">Hardware info</span></h2>
<h3><span class="mw-headline" id="Hardware_options">Hardware options</span></h3>
<p>The HP Spectre x360 is shipped for some years already. While the overall look &amp; feel of the brick hasn't changed, some hardware configuration changed a lot. It is important to keep in mind that the article focuses on the year 2016 model packed with Intel Iris graphics. The main hardware components are
</p>
<ul>
<li> Intel i7 Skylake 6560U with Intel Iris 540 graphics (compared to i7 6500 with Intel HD 520 graphics on a 4100)</li>
<li> OLED touch screen running at 2560x1440 (compared to LED 1920x1080 on a 4100)</li>
<li> 500 GB M.2 SDD</li>
<li> 8 GB RAM</li>
</ul>
<h3><span class="mw-headline" id="lspci_on_a_4231">lspci on a 4231</span></h3>
<pre>00:00.0 Host bridge: Intel Corporation Skylake Host Bridge/DRAM Registers (rev 09)
00:02.0 VGA compatible controller: Intel Corporation Skylake Integrated Graphics (rev 0a)
00:13.0 Non-VGA unclassified device: Intel Corporation Device 9d35 (rev 21)
00:14.0 USB controller: Intel Corporation Sunrise Point-LP USB 3.0 xHCI Controller (rev 21)
00:14.2 Signal processing controller: Intel Corporation Sunrise Point-LP Thermal subsystem (rev 21)
00:16.0 Communication controller: Intel Corporation Sunrise Point-LP CSME HECI #1 (rev 21)
00:1c.0 PCI bridge: Intel Corporation Device 9d10 (rev f1)
00:1c.1 PCI bridge: Intel Corporation Device 9d11 (rev f1)
00:1c.4 PCI bridge: Intel Corporation Sunrise Point-LP PCI Express Root Port #5 (rev f1)
00:1f.0 ISA bridge: Intel Corporation Sunrise Point-LP LPC Controller (rev 21)
00:1f.2 Memory controller: Intel Corporation Sunrise Point-LP PMC (rev 21)
00:1f.3 Multimedia audio controller: Intel Corporation Sunrise Point-LP HD Audio (rev 21)
00:1f.4 SMBus: Intel Corporation Sunrise Point-LP SMBus (rev 21)
01:00.0 Unassigned class [ff00]: Realtek Semiconductor Co., Ltd. RTS5227 PCI Express Card Reader (rev 01)
02:00.0 Network controller: Intel Corporation Wireless 7265 (rev 61)
03:00.0 Non-Volatile memory controller: Samsung Electronics Co Ltd NVMe SSD Controller (rev 01)
</pre>
<h2><span class="mw-headline" id="Installation">Installation</span></h2>
<p>Installing arch is straight forward for everything (disable secure boot, F10 for BIOS, F9 for boot options) but one thing: you may have to disable a BIOS option called "fast boot". While this option is activated in BIOS the machine may boot into Windows no matter what you select. If you make to boot into the latest arch ISO (June 2016) on a USB, arch EFI boot menu hangs. After you installed arch on HDD and moved all of M$ Windows to /dev/null, you may activate that option again. Although no difference in boot performance could be observed with the option activated or deactivated.
</p>
<h2><span class="mw-headline" id="Tweaks">Tweaks</span></h2>
<h3><span class="mw-headline" id="Brightness_.2F_backlight">Brightness / backlight</span></h3>
<p><code>/sys/class/backlight/intel_backlight</code> exists but is not working as of kernel 4.6 and 4.7rc6. Proposed kernel parameters (such as <code>acpi_os</code>) do not remedy the issue. It may be helpful to know that OLED displays by their nature do not have backlight. xrandr offers some neat feature to change brightness of your screen. Depending on your driver (modesetting driver included in Xorg or xf86-video-intel, see <a href="../en/Intel_graphics.html" title="Intel graphics">Intel graphics</a>) your screen is named eDP-1 or eDP1. Use <code>xrandr</code> to determine the correct name if in doubt. The following statement changes brightness to 50%.
</p>
<pre>$ xrandr --output eDP1 --brightness .5
</pre>
<p>While this may probably work on non-OLED displays as well, it won't reduce power consumption on non-OLED displays at all. Without in-depth tests and measurements done, it seems like lowering brightness from the default 100% to something more regular 50% extends battery life by some hours.
<br>
Since the hotkeys are performing updates on <code>/sys/class/backlight/intel_backlight</code> you may use <code>inotify</code> to enable brightness adjustment using the hotkeys (see <a href="../en/Backlight.html#sysfs_modified_but_no_brightness_change" title="Backlight">Backlight#sysfs modified but no brightness change</a>). The following script does the job:
</p>
<pre>
#!/bin/sh

path=/sys/class/backlight/intel_backlight

luminance() {
    read -r level &lt; "$path"/actual_brightness
    bc &lt;&lt;&lt; "scale=10;$level/$max"
}

read -r max &lt; "$path"/max_brightness
xrandr --output eDP1 --brightness "$(luminance)"

inotifywait -me modify --format '' "$path"/actual_brightness | while read; do
    echo $(luminance)
    xrandr --output eDP1 --brightness "$(luminance)"
done
</pre>
<p>The script requires package <code>bc</code> to actually calculate the brightness factor. If you store the script at <code>/usr/share/bin/brightness</code> (see <a href="../en/Frequently_asked_questions.html#Does_Arch_follow_the_FHS.3F" title="Arch filesystem hierarchy" class="mw-redirect">Arch filesystem hierarchy</a>), you may use the following file at <code>~/.config/autostart/brightness.desktop</code> to run the script at login to gnome:
</p>
<pre>
[Desktop Entry]
Name=brightness
GenericName=brightness
Comment=adjust brightness using hotkeys 
Exec=/usr/local/bin/brightness
Terminal=false
Type=Application
X-GNOME-Autostart-enabled=true
</pre>
<p>While all this fixes brightness issues on the brick quite well, there are still some issues to be solved:
</p>
<ul>
<li> Chromium and some other programs reset brightness to 100% upon their first start since reboot.</li>
<li> Hotkeys aren't working prior to login.</li>
</ul>
<h3><span class="mw-headline" id="Gnome_scaling">Gnome scaling</span></h3>
<p>The screen natively runs at 2560x1440. Gnome by default assumes a scaling factor of 2 since the screen resolution at y-axis is greater than 1200 <a rel="nofollow" class="external text" href="https://wiki.gnome.org/HowDoI/HiDpi">1</a>. With this, at first glance all controls are quite over sized. xrandr offers some nice workaround:
</p>
<pre>
xrandr --output eDP1 --scale 1.25x1.25
xrandr --output eDP1 --panning 3200x1800
</pre>
<p>Those commands should be executed in two steps tho. Gnome doesn't adjust size for sure each time. Setting those changes in an autostart script after login is not very reliable if some other programs are started at the same time. Even adding some sleep does not improve reliability to an acceptable level. Testing will be continued since this is a perfect resolution.
</p>
<h3><span class="mw-headline" id="Video_driver">Video driver</span></h3>
<p>As mentioned in <a href="../en/Intel_graphics.html" title="Intel graphics">Intel graphics</a> some people recommend to stay with the modesetting driver included in Xorg. As of Xorg 1.18.2, Mesa before 12.0 the performance of this driver is inacceptable when it comes to simple tasks like web browsing, scrolling documents or anything alike. On this machine installing <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://www.archlinux.org/packages/?name=xf86-video-intel">xf86-video-intel</a></span> improves performance a lot.
</p>
<h2><span class="mw-headline" id="Issues">Issues</span></h2>
<p>Issues for which no resolution could be found:
</p>
<ul>
<li> Wifi is working. The hotkey for the airplane mode works. Although something strange is going on with the hotkey:
<ul>
<li> Booting to console leads to some spam of ^@ for like 10 seconds. After this it suddenly stops and you can log in.</li>
<li> Booting to GDM makes the hotkey for airplane mode work. Nothing special. You can login immediately.</li>
<li> Right after login to Gnome the hotkey is spammed and thus airplane mode turned off and on for like 7 seconds. <code>dmesg</code> shows some hard faults caused by wifi module being unexpectedly unavailable but nothing else suspicious.</li>
<li> If you wait in GDM for a while, the spam hotkey spam won't happen after login. I.e. the timer is running already while you are in GDM.</li>
</ul>
</li>
<li> Bluetooth not working. This has not been investigated at all yet. Maybe just a missing driver.</li>
</ul>

</div>
<div id="catlinks" class="catlinks"><div id="mw-normal-catlinks" class="mw-normal-catlinks">
<a href="../Special:Categories.html" title="Special:Categories">Categories</a>: <ul>
<li><a href="../en/Category:Laptops.html" title="Category:Laptops">Laptops</a></li>
<li><a href="../en/Category:HP.html" title="Category:HP">HP</a></li>
</ul>
</div></div>					<div class="visualClear"></div>
				</div>
			</div>
		</div>
		<div class="visualClear"></div>
					<div id="footer" role="contentinfo">
Extracted from <a href="https://wiki.archlinux.org"> ArchWiki </a> and licensed under <a href="http://www.gnu.org/copyleft/fdl.html"> GDL >= 1.3</a>
		</div>
		</div>
		</body>
</html>
