<!DOCTYPE html>
<html lang="en" dir="ltr" class="client-nojs">
<head>
<meta charset="UTF-8">
<title>Gitlab - ArchWiki</title>
<link rel="stylesheet" href="../ArchWikiOffline.css">
<meta name="ResourceLoaderDynamicStyles" content="">
<style></style>
<meta name="generator" content="MediaWiki 1.26.4">
<meta name="robots" content="noindex,follow">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="search" type="application/opensearchdescription+xml" href="/opensearch_desc.php" title="ArchWiki (en)">
<link rel="EditURI" type="application/rsd+xml" href="https://wiki.archlinux.org/api.php?action=rsd">
<link rel="copyright" href="http://www.gnu.org/copyleft/fdl.html">
<link rel="alternate" type="application/atom+xml" title="ArchWiki Atom feed" href="/index.php?title=Special:RecentChanges&amp;feed=atom">
</head>
<body class="mediawiki ltr sitedir-ltr ns-0 ns-subject page-Gitlab skin-archlinux action-view">

		<div id="globalWrapper" style="width: 100%">
		<div id="column-content">
			<div id="content" class="mw-body" role="main" style="margin: 0.5em; margin-bottom:0; margin-top:0">
				<a id="top"></a>
				
				<div class="mw-indicators">
</div>
				<h1 id="firstHeading" class="firstHeading" lang="en">Gitlab</h1>
				
				<div id="bodyContent" class="mw-body-content">
					<div id="contentSub"></div>
										<div id="mw-content-text" lang="en" dir="ltr" class="mw-content-ltr">
<div style="width:45%; margin: 0 0 0.5em 0.5em;">
<p style="background:#333; color:white; padding:0.2em; border-bottom:5px #08c solid; margin:0; text-align:center; font-weight:bold;">Related articles</p>
<ul style="list-style-type:none; margin:0; padding:0.3em;">
<li style="padding:0.4em 0; line-height:1;"><a href="../en/Gitolite.html" title="Gitolite">Gitolite</a></li>
<li style="padding:0.4em 0; line-height:1;"><a href="../en/Ruby_on_Rails.html" title="Ruby on Rails">Ruby on Rails</a></li>
</ul>
</div>
<div class="noprint archwiki-template-message">
<p><a href="../File:Tango-inaccurate.png" class="image"><img alt="Tango-inaccurate.png" src="../File:Tango-inaccurate.png" width="48" height="48"></a><b>The factual accuracy of this article or section is disputed.</b><a href="../File:Tango-inaccurate.png" class="image"><img alt="Tango-inaccurate.png" src="../File:Tango-inaccurate.png" width="48" height="48"></a></p>
<div>
<b>Reason:</b> Commands are incomplete/incorrect, reported upgrade issues (Discuss in <a rel="nofollow" class="external text" href="https://wiki.archlinux.org/index.php/Talk:Gitlab">Talk:Gitlab#</a>)</div>
</div>
<p>From <a rel="nofollow" class="external text" href="https://about.gitlab.com/">GitLab's homepage:</a>
</p>
<dl><dd>GitLab offers git repository management, code reviews, issue tracking, activity feeds and wikis. Enterprises install GitLab on-premise and connect it with LDAP and Active Directory servers for secure authentication and authorization. A single GitLab server can handle more than 25,000 users but it is also possible to create a high availability setup with multiple active servers.</dd></dl>
<p>An example live version can be found at <a rel="nofollow" class="external text" href="https://gitlab.com/">GitLab.com</a>.
</p>
<div id="toc" class="toc">
<div id="toctitle"><h2>Contents</h2></div>
<ul>
<li class="toclevel-1 tocsection-1"><a href="#Installation"><span class="tocnumber">1</span> <span class="toctext">Installation</span></a></li>
<li class="toclevel-1 tocsection-2">
<a href="#Configuration"><span class="tocnumber">2</span> <span class="toctext">Configuration</span></a>
<ul>
<li class="toclevel-2 tocsection-3"><a href="#Notes_Before_Configuring"><span class="tocnumber">2.1</span> <span class="toctext">Notes Before Configuring</span></a></li>
<li class="toclevel-2 tocsection-4">
<a href="#Basic_configuration"><span class="tocnumber">2.2</span> <span class="toctext">Basic configuration</span></a>
<ul>
<li class="toclevel-3 tocsection-5"><a href="#GitLab_Shell"><span class="tocnumber">2.2.1</span> <span class="toctext">GitLab Shell</span></a></li>
<li class="toclevel-3 tocsection-6"><a href="#GitLab"><span class="tocnumber">2.2.2</span> <span class="toctext">GitLab</span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-7">
<a href="#Further_configuration"><span class="tocnumber">2.3</span> <span class="toctext">Further configuration</span></a>
<ul>
<li class="toclevel-3 tocsection-8"><a href="#Database_backend"><span class="tocnumber">2.3.1</span> <span class="toctext">Database backend</span></a></li>
<li class="toclevel-3 tocsection-9"><a href="#MariaDB"><span class="tocnumber">2.3.2</span> <span class="toctext">MariaDB</span></a></li>
<li class="toclevel-3 tocsection-10"><a href="#PostgreSQL"><span class="tocnumber">2.3.3</span> <span class="toctext">PostgreSQL</span></a></li>
<li class="toclevel-3 tocsection-11"><a href="#Firewall"><span class="tocnumber">2.3.4</span> <span class="toctext">Firewall</span></a></li>
<li class="toclevel-3 tocsection-12"><a href="#Initialize_Gitlab_database"><span class="tocnumber">2.3.5</span> <span class="toctext">Initialize Gitlab database</span></a></li>
<li class="toclevel-3 tocsection-13"><a href="#Configure_Git_User"><span class="tocnumber">2.3.6</span> <span class="toctext">Configure Git User</span></a></li>
<li class="toclevel-3 tocsection-14"><a href="#Adjust_modifier_bits"><span class="tocnumber">2.3.7</span> <span class="toctext">Adjust modifier bits</span></a></li>
</ul>
</li>
</ul>
</li>
<li class="toclevel-1 tocsection-15"><a href="#Start_and_test_GitLab"><span class="tocnumber">3</span> <span class="toctext">Start and test GitLab</span></a></li>
<li class="toclevel-1 tocsection-16">
<a href="#Advanced_Configuration"><span class="tocnumber">4</span> <span class="toctext">Advanced Configuration</span></a>
<ul>
<li class="toclevel-2 tocsection-17"><a href="#Custom_SSH_Connection"><span class="tocnumber">4.1</span> <span class="toctext">Custom SSH Connection</span></a></li>
<li class="toclevel-2 tocsection-18">
<a href="#HTTPS.2FSSL"><span class="tocnumber">4.2</span> <span class="toctext">HTTPS/SSL</span></a>
<ul>
<li class="toclevel-3 tocsection-19"><a href="#Change_GitLab_configs"><span class="tocnumber">4.2.1</span> <span class="toctext">Change GitLab configs</span></a></li>
<li class="toclevel-3 tocsection-20"><a href="#Let.27s_Encrypt"><span class="tocnumber">4.2.2</span> <span class="toctext">Let's Encrypt</span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-21">
<a href="#Web_server_configuration"><span class="tocnumber">4.3</span> <span class="toctext">Web server configuration</span></a>
<ul>
<li class="toclevel-3 tocsection-22"><a href="#Node.js"><span class="tocnumber">4.3.1</span> <span class="toctext">Node.js</span></a></li>
<li class="toclevel-3 tocsection-23">
<a href="#Nginx_and_unicorn"><span class="tocnumber">4.3.2</span> <span class="toctext">Nginx and unicorn</span></a>
<ul>
<li class="toclevel-4 tocsection-24"><a href="#AUR_Installation"><span class="tocnumber">4.3.2.1</span> <span class="toctext">AUR Installation</span></a></li>
<li class="toclevel-4 tocsection-25"><a href="#Manual_Installation"><span class="tocnumber">4.3.2.2</span> <span class="toctext">Manual Installation</span></a></li>
</ul>
</li>
<li class="toclevel-3 tocsection-26">
<a href="#Apache_and_unicorn"><span class="tocnumber">4.3.3</span> <span class="toctext">Apache and unicorn</span></a>
<ul>
<li class="toclevel-4 tocsection-27"><a href="#Configure_Unicorn"><span class="tocnumber">4.3.3.1</span> <span class="toctext">Configure Unicorn</span></a></li>
<li class="toclevel-4 tocsection-28"><a href="#Create_a_virtual_host_for_Gitlab"><span class="tocnumber">4.3.3.2</span> <span class="toctext">Create a virtual host for Gitlab</span></a></li>
<li class="toclevel-4 tocsection-29"><a href="#Enable_host_and_start_unicorn"><span class="tocnumber">4.3.3.3</span> <span class="toctext">Enable host and start unicorn</span></a></li>
</ul>
</li>
</ul>
</li>
<li class="toclevel-2 tocsection-30">
<a href="#Redis"><span class="tocnumber">4.4</span> <span class="toctext">Redis</span></a>
<ul>
<li class="toclevel-3 tocsection-31"><a href="#Redis_Over_Unix_Socket"><span class="tocnumber">4.4.1</span> <span class="toctext">Redis Over Unix Socket</span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-32"><a href="#Gitlab-workhorse"><span class="tocnumber">4.5</span> <span class="toctext">Gitlab-workhorse</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-33">
<a href="#Useful_Tips"><span class="tocnumber">5</span> <span class="toctext">Useful Tips</span></a>
<ul>
<li class="toclevel-2 tocsection-34"><a href="#Fix_Rake_Warning"><span class="tocnumber">5.1</span> <span class="toctext">Fix Rake Warning</span></a></li>
<li class="toclevel-2 tocsection-35"><a href="#Hook_into_.2Fvar"><span class="tocnumber">5.2</span> <span class="toctext">Hook into /var</span></a></li>
<li class="toclevel-2 tocsection-36"><a href="#Hidden_options"><span class="tocnumber">5.3</span> <span class="toctext">Hidden options</span></a></li>
<li class="toclevel-2 tocsection-37"><a href="#Backup_and_restore"><span class="tocnumber">5.4</span> <span class="toctext">Backup and restore</span></a></li>
<li class="toclevel-2 tocsection-38"><a href="#Migrate_from_sqlite_to_mysql"><span class="tocnumber">5.5</span> <span class="toctext">Migrate from sqlite to mysql</span></a></li>
<li class="toclevel-2 tocsection-39"><a href="#Running_GitLab_with_rvm"><span class="tocnumber">5.6</span> <span class="toctext">Running GitLab with rvm</span></a></li>
<li class="toclevel-2 tocsection-40"><a href="#Sending_mails_from_Gitlab_via_SMTP"><span class="tocnumber">5.7</span> <span class="toctext">Sending mails from Gitlab via SMTP</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-41">
<a href="#Troubleshooting"><span class="tocnumber">6</span> <span class="toctext">Troubleshooting</span></a>
<ul>
<li class="toclevel-2 tocsection-42"><a href="#HTTPS_is_not_green_.28gravatar_not_using_https.29"><span class="tocnumber">6.1</span> <span class="toctext">HTTPS is not green (gravatar not using https)</span></a></li>
<li class="toclevel-2 tocsection-43"><a href="#401_Unauthorized_on_all_API_access"><span class="tocnumber">6.2</span> <span class="toctext">401 Unauthorized on all API access</span></a></li>
<li class="toclevel-2 tocsection-44"><a href="#Error_at_push_bad_line_length_character:_API"><span class="tocnumber">6.3</span> <span class="toctext">Error at push bad line length character: API</span></a></li>
<li class="toclevel-2 tocsection-45"><a href="#Errors_after_updating"><span class="tocnumber">6.4</span> <span class="toctext">Errors after updating</span></a></li>
<li class="toclevel-2 tocsection-46"><a href="#.2Fetc.2Fwebapps.2Fgitlab.2Fsecret_is_empty"><span class="tocnumber">6.5</span> <span class="toctext">/etc/webapps/gitlab/secret is empty</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-47"><a href="#See_also"><span class="tocnumber">7</span> <span class="toctext">See also</span></a></li>
</ul>
</div>

<h2><span class="mw-headline" id="Installation">Installation</span></h2>
<div style="padding: 5px; margin: 0.50em 0; background-color: #DDDDFF; border: thin solid #BBBBDD; overflow: hidden;">
<strong> Note: </strong>If you want to use RVM refer to the article <a href="#Running_GitLab_with_rvm">#Running GitLab with rvm</a> before starting with the installation</div>
<div style="padding: 5px; margin: 0.50em 0; background-color: #DDDDFF; border: thin solid #BBBBDD; overflow: hidden;">
<strong> Note: </strong>This article covers installing and configuring GitLab without HTTPS at first. If needed, see <a href="#Advanced_Configuration">#Advanced Configuration</a> to set up SSL</div>
<p>GitLab requires a database backend. If you plan to run it on the same machine, first install either <a href="../en/MySQL.html" title="MySQL">MySQL</a> or <a href="../en/PostgreSQL.html" title="PostgreSQL">PostgreSQL</a>.
</p>
<p><a href="../en/Help:Reading.html#Installation_of_packages" title="Install" class="mw-redirect">Install</a> the <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://www.archlinux.org/packages/?name=gitlab">gitlab</a></span> package.
</p>
<p>In order to receive mail notifications, a mail server must be installed and configured. See the following for more information: <a href="../en/Category:Mail_server.html" title="Category:Mail server">Category:Mail server</a>
</p>
<h2><span class="mw-headline" id="Configuration">Configuration</span></h2>
<h3><span class="mw-headline" id="Notes_Before_Configuring">Notes Before Configuring</span></h3>
<p>The <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://www.archlinux.org/packages/?name=gitlab">gitlab</a></span> package installs GitLab's files in a manner that more closely follows standard Linux conventions:
</p>
<table class="wikitable">
<tr>
<th> Description
</th>
<th> <a rel="nofollow" class="external text" href="https://github.com/gitlabhq/gitlabhq/blob/6-5-stable/doc/install/installation.md">GitLab's Official</a>
</th>
<th> <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://www.archlinux.org/packages/?name=gitlab">gitlab</a></span>
</th>
</tr>
<tr>
<td> Configuration File GitShell
</td>
<td> <code>/home/git/gitlab-shell/config.yml</code>
</td>
<td> <code>/etc/webapps/gitlab-shell/config.yml</code>
</td>
</tr>
<tr>
<td> Configuration File GitLab
</td>
<td> <code>/home/git/gitlab/config/gitlab.yml</code>
</td>
<td> <code>/etc/webapps/gitlab/gitlab.yml</code>
</td>
</tr>
<tr>
<td> User (Home Directory)
</td>
<td> <code>git</code> (<code>/home/git</code>)
</td>
<td> <code>gitlab</code> (<code>/var/lib/gitlab</code>)
</td>
</tr>
</table>
<div style="padding: 5px; margin: 0.50em 0; background-color: #DDFFDD; border: thin solid #BBDDBB; overflow: hidden;">
<strong> Tip: </strong>If you are familiar with the <a href="../en/Arch_Build_System.html" title="Arch Build System">Arch Build System</a> you can edit the PKGBUILD and relevant files to change gitlab's home directory to a place of your liking.</div>
<h3><span class="mw-headline" id="Basic_configuration">Basic configuration</span></h3>
<h4><span class="mw-headline" id="GitLab_Shell">GitLab Shell</span></h4>
<div style="padding: 5px; margin: 0.50em 0; background-color: #DDDDFF; border: thin solid #BBBBDD; overflow: hidden;">
<strong> Note: </strong>You can leave the <code>gitlab_url</code> with default value if you intend to host GitLab on the same host.</div> 
<p>Edit <code>/etc/webapps/gitlab-shell/config.yml</code> and set <code>gitlab_url:</code> to the prefer url and port:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/webapps/gitlab-shell/config.yml</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;"># GitLab user. git by default
user: gitlab

# Url to gitlab instance. Used for api calls. Should end with a slash.
# Default: <a rel="nofollow" class="external free" href="http://localhost:8080/">http://localhost:8080/</a>
# You only have to change the default if you have configured Unicorn
# to listen on a custom port, or if you have configured Unicorn to
# only listen on a Unix domain socket.
gitlab_url: "<a rel="nofollow" class="external free" href="http://localhost:8080/">http://localhost:8080/</a>" # &lt;&lt;-- right here

http_settings:
#  user: someone
#  password: somepass
...</pre>
<p>Update the <code>/etc/webapps/gitlab/unicorn.rb</code> configuration if the port and/or hostname is different from the default:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/webapps/gitlab/unicorn.rb</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">listen "127.0.0.1:8080", :tcp_nopush =&gt; true # &lt;&lt;-- right here</pre>
<h4><span class="mw-headline" id="GitLab">GitLab</span></h4>
<p>Edit <code>/etc/webapps/gitlab/gitlab.yml</code> and setup at least the following parameters:
</p>
<div style="padding: 5px; margin: 0.50em 0; background-color: #DDFFDD; border: thin solid #BBDDBB; overflow: hidden;">
<strong> Tip: </strong>The hostname and port are used for the <code>git clone <a rel="nofollow" class="external free" href="http://hostname:port">http://hostname:port</a></code> as example.</div>
<p><b>Hostname:</b> In the <code>gitlab:</code> section set <code>host:</code> - replacing <code>localhost</code> to <code>yourdomain.com</code> (<b>note:</b> no '<a rel="nofollow" class="external free" href="http://'">http://'</a> or trailing slash) - into your fully qualified domain name.
</p>
<p><b>Port:</b> <code>port:</code> can be confusing. This is not the port that the gitlab server (unicorn) runs on; it's the port that users will initially access through in their browser. Basically, if you intend for users to visit 'yourdomain.com' in their browser, without appending a port number to the domain name, leave <code>port:</code> as <code>80</code>. If you intend your users to type something like 'yourdomain.com:3425' into their browsers, then you'd set <code>port:</code> to <code>3425</code>. You will also have to <b>configure your webserver</b> to listen on that port.
</p>
<p><b>Timezone (optional):</b> The <code>time_zone:</code> parameter is optional, but may be useful to force the zone of GitLab applications.
</p>
<p>Those are the minimal changes needed for a working GitLab install. The adventurous may read on in the comment and customize as needed.
</p>
<h3><span class="mw-headline" id="Further_configuration">Further configuration</span></h3>
<h4><span class="mw-headline" id="Database_backend">Database backend</span></h4>
<p>A Database backend will be required before Gitlab can be run. Currently GitLab supports <a href="../en/MySQL.html" title="MariaDB" class="mw-redirect">MariaDB</a> and <a href="../en/PostgreSQL.html" title="PostgreSQL">PostgreSQL</a>. By default, GitLab assumes you will use MySQL. Extra work is needed if you plan to use PostgreSQL.
</p>
<h4><span class="mw-headline" id="MariaDB">MariaDB</span></h4>
<p>To set up MySQL (MariaDB) you need to create a database called <code>gitlabhq_production</code> along with a user (default: <code>gitlab</code>) who has full privileges to the database:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">$ mysql -u root -p</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">mysql&gt; CREATE DATABASE `gitlabhq_production` DEFAULT CHARACTER SET `utf8` COLLATE `utf8_unicode_ci`;
mysql&gt; CREATE USER 'gitlab'@'localhost' IDENTIFIED BY 'password';
mysql&gt; GRANT ALL ON `gitlabhq_production`.* TO 'gitlab'@'localhost';
mysql&gt; \q</pre>
<p>Try connecting to the new database with the new user:
</p>
<pre>$ mysql -u <b>gitlab</b> -p -D gitlabhq_production
</pre>
<p>Copy the MySQL template file before configuring it:
</p>
<pre># cp /usr/share/doc/gitlab/database.yml.mysql /etc/webapps/gitlab/database.yml
</pre>
<p>Next you will need to open <code>/etc/webapps/gitlab/database.yml</code> and set <code>username:</code> and <code>password:</code> for the <code>gitlabhq_production</code>:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/webapps/gitlab/database.yml</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">
#
# PRODUCTION
#
production:
  adapter: mysql2
  encoding: utf8
  collation: utf8_general_ci
  reconnect: false
  database: gitlabhq_production
  pool: 10
  username: <b>username</b>
  password: <b>"password"</b>
  # host: localhost
  # socket: /run/mysqld/mysqld.sock # If running MariaDB as socket
...
</pre>
<p>It should not be set as world readable, e.g. only processes running under the <code>gitlab</code> user should have read/write access:
</p>
<pre># chmod 600 /etc/webapps/gitlab/database.yml
# chown gitlab:gitlab /etc/webapps/gitlab/database.yml
</pre>
<p>For more info and other ways to create/manage MySQL databases, see the <a rel="nofollow" class="external text" href="https://mariadb.org/docs/">MariaDB documentation</a> and the <a rel="nofollow" class="external text" href="https://github.com/gitlabhq/gitlabhq/blob/6-5-stable/doc/install/installation.md">GitLab official (generic) install guide</a>.
</p>
<h4><span class="mw-headline" id="PostgreSQL">PostgreSQL</span></h4>
<p>Login to PostgreSQL and create the <code>gitlabhq_production</code> database with along with it's user. Remember to change <code>your_username_here</code> and <code>your_password_here</code> to the real values:
</p>
<pre># psql -d template1
</pre>
<pre>template1=# CREATE USER your_username_here WITH PASSWORD 'your_password_here';
template1=# ALTER USER your_username_here SUPERUSER;
template1=# CREATE DATABASE gitlabhq_production OWNER your_username_here;
template1=# \q</pre>
<div style="padding: 5px; margin: 0.50em 0; background-color: #DDDDFF; border: thin solid #BBBBDD; overflow: hidden;">
<strong> Note: </strong>The reason for creating the user as a superuser is that GitLab is trying to be "smart" and install extensions (not just create them in it's own userspace). And this is only allowed by superusers in Postgresql.</div>
<p>Try connecting to the new database with the new user to verify it works:
</p>
<pre># psql -d gitlabhq_production
</pre>
<p>Copy the PostgreSQL template file before configuring it (overwriting the default MySQL configuration file):
</p>
<pre># cp /usr/share/doc/gitlab/database.yml.postgresql /etc/webapps/gitlab/database.yml
</pre>
<p>Open the new <code>/etc/webapps/gitlab/database.yml</code> and set the values for <code>username:</code> and <code>password:</code>. For example:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/webapps/gitlab/database.yml</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">
#
# PRODUCTION
#
production:
  adapter: postgresql
  encoding: unicode
  database: gitlabhq_production
  pool: 10
  username: your_username_here
  password: "your_password_here"
  # host: localhost
  # port: 5432
  # socket: /tmp/postgresql.sock
...
</pre>
<p>For our purposes (unless you know what you are doing), you do not need to worry about configuring the other databases listed in <code>/etc/webapps/gitlab/database.yml</code>. We only need to set up the production database to get GitLab working.
</p>
<p>Finally, open <code>/usr/lib/systemd/system/gitlab.target</code> and <code>/usr/lib/systemd/system/gitlab-unicorn.service</code> change all instances of <code>mysql.service</code> to <code>postgresql.service</code>.
</p>
<h4><span class="mw-headline" id="Firewall">Firewall</span></h4>
<p>If you want to give direct access to your Gitlab installation through an <a href="../en/Iptables.html" title="Iptables">iptables</a> firewall, you may need to adjust the port and the network address:
</p>
<pre># iptables -A tcp_inbound -p TCP -s <b>192.168.1.0/24</b> --destination-port <b>80</b> -j ACCEPT
</pre>
<p>To enable API-access:
</p>
<pre># iptables -A tcp_inbound -p TCP -s <b>192.168.1.0/24</b> --destination-port <b>8080</b> -j ACCEPT
</pre>
<p>If you are behind a router, do not forget to forward this port to the running GitLab server host, if you want to allow WAN-access.
</p>
<h4><span class="mw-headline" id="Initialize_Gitlab_database">Initialize Gitlab database</span></h4>
<p>Start the Redis server before we create the database <a href="../en/Systemd.html#Using_units" title="Start/enable" class="mw-redirect">start/enable</a> the <code>redis</code> systemd unit.
</p>
<p>Now you have to install bundler and the required gems with:
</p>
<pre># export PATH=$PATH:/var/lib/gitlab/.gem/ruby/2.3.0/bin
# sudo -u gitlab -H gem install bundler --no-document
# cd /usr/share/webapps/gitlab
# sudo -u gitlab -H bundle install
</pre>
<div style="padding: 5px; margin: 0.50em 0; background-color: #FFDDDD; border: thin solid #DDBBBB; overflow: hidden;">
<strong> Warning: </strong>GitLab requires <code>bundle</code> command, not <code>bundle-2.1</code>, don't forget to install it.</div>
<div style="padding: 5px; margin: 0.50em 0; background-color: #DDDDFF; border: thin solid #BBBBDD; overflow: hidden;">
<strong> Note: </strong>If you're getting errors later on saying bundle is missing for the user 'gitlab', then this is most likely because ruby is installed in a non-readable folder such as /usr/lib or something similar and this solves that issue:
<pre>
su - gitlab -s /bin/sh -c "export PATH=$PATH:/var/lib/gitlab/.gem/ruby/2.3.0/bin; gem install bundler --no-document"
su - gitlab -s /bin/sh -c "export PATH=$PATH:/var/lib/gitlab/.gem/ruby/2.3.0/bin; cd /usr/share/webapps/gitlab; bundle install"
su - gitlab -s /bin/sh -c "export PATH=$PATH:/var/lib/gitlab/.gem/ruby/2.3.0/bin; cd /usr/share/webapps/gitlab; bundle exec rake gitlab:setup RAILS_ENV=production"
su - gitlab -s /bin/sh -c "export PATH=$PATH:/var/lib/gitlab/.gem/ruby/2.3.0/bin; cd /usr/share/webapps/gitlab; bundle exec rake assets:precompile RAILS_ENV=production"
</pre>
</div>
<p>Initialize the database and activate advanced features:
</p>
<pre># cd /usr/share/webapps/gitlab
# su - gitlab -s /bin/sh -c "cd '/usr/share/webapps/gitlab'; bundle exec rake gitlab:setup RAILS_ENV=production"
</pre>
<pre>
Missing `db_key_base` for 'production' environment. The secrets will be generated and stored in `config/secrets.yml`
This will create the necessary database tables and seed the database.
You will lose any previous data stored in the database.
Do you want to continue (yes/no)? yes

gitlabhq_production already exists
-- enable_extension("plpgsql")
   -&gt; 0.0009s
-- create_table("abuse_reports", {:force=&gt;true})
   -&gt; 0.0300s
-- create_table("application_settings", {:force=&gt;true})
   -&gt; 0.0116s

...

Administrator account created:

login.........root
password......5iveL!fe
</pre>
<p>Now compile the assets:
</p>
<pre># su - gitlab -s /bin/sh -c "cd '/usr/share/webapps/gitlab'; bundle exec rake assets:precompile RAILS_ENV=production"
</pre>
<p>Finally, check that <code>/etc/webapps/gitlab/secret</code> contains a random hex string.
</p>
<h4><span class="mw-headline" id="Configure_Git_User">Configure Git User</span></h4>
<div style="padding: 5px; margin: 0.50em 0; background-color: #DDDDFF; border: thin solid #BBBBDD; overflow: hidden;">
<strong> Note: </strong>This must match the <code>user</code> and <code>email_from</code> defined in <code>/usr/share/webapps/gitlab/config/gitlab.yml</code>.</div>
<pre># cd /usr/share/webapps/gitlab
# sudo -u gitlab -H git config --global user.name  "GitLab"
# sudo -u gitlab -H git config --global user.email "example@example.com"
# sudo -u gitlab -H git config --global core.autocrlf "input"
</pre>
<h4><span class="mw-headline" id="Adjust_modifier_bits">Adjust modifier bits</span></h4>
<p>(The gitlab check won't pass if the user and group ownership isn't configured properly)
</p>
<pre># chmod -R ug+rwX,o-rwx /var/lib/gitlab/repositories/
# chmod -R ug-s /var/lib/gitlab/repositories
# find /var/lib/gitlab/repositories/ -type d -print0 | xargs -0 chmod g+s
</pre>
<h2><span class="mw-headline" id="Start_and_test_GitLab">Start and test GitLab</span></h2>
<div style="padding: 5px; margin: 0.50em 0; background-color: #DDDDFF; border: thin solid #BBBBDD; overflow: hidden;">
<strong> Note: </strong>See <a href="#Troubleshooting">#Troubleshooting</a> and log files inside the <code>/usr/share/webapps/gitlab/log</code> directory for troubleshooting.</div>
<p>Make systemd see your new daemon unit files:
</p>
<pre># systemctl daemon-reload
</pre>
<p>Make sure <a href="../en/MySQL.html" title="MySQL">MySQL</a> or <a href="../en/PostgreSQL.html" title="PostgreSQL">PostgreSQL</a> and Redis are running and setup correctly.
</p>
<p>If needed see <a href="#Redis_Over_Unix_Socket">#Redis Over Unix Socket</a> example if GitLab cannot load <code>redis</code> correctly.
</p>
<p>After starting the database backends, we can start GitLab with its webserver (Unicorn) by <a href="../en/Systemd.html#Using_units" title="Start" class="mw-redirect">starting</a> both the <code>gitlab-sidekiq</code> and <code>gitlab-unicorn</code> systemd units.
</p>
<p>With the following commands we check if the steps we followed so far are configured properly:
</p>
<pre># cd /usr/share/webapps/gitlab
# sudo -u gitlab bundle exec rake gitlab:env:info RAILS_ENV=production
# sudo -u gitlab bundle exec rake gitlab:check RAILS_ENV=production
</pre>
<div style="padding: 5px; margin: 0.50em 0; background-color: #DDDDFF; border: thin solid #BBBBDD; overflow: hidden;">
<strong> Note: </strong>These gitlab:env:info and gitlab:check commands will show a fatal error related to git. This is OK.</div>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">$ sudo -u gitlab bundle exec rake gitlab:env:info RAILS_ENV=production</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">
fatal: Not a git repository (or any of the parent directories): .git

System information
System:		Arch rolling
Current User:	gitlab
Using RVM:	no
Ruby Version:	2.2.3p173
Gem Version:	2.4.5.1
Bundler Version:1.10.6
Rake Version:	10.4.2
Sidekiq Version:3.3.0

GitLab information
Version:	7.14.0
Revision:	fatal: Not a git repository (or any of the parent directories): .git
Directory:	/usr/share/webapps/gitlab
DB Adapter:	mysql2
URL:		http://gitlab.arch
HTTP Clone URL:	http://gitlab.arch/some-project.git
SSH Clone URL:	git@gitlab.arch:some-project.git
Using LDAP:	no
Using Omniauth:	no

GitLab Shell
Version:	2.6.4
Repositories:	/var/lib/gitlab/repositories/
Hooks:		/usr/share/webapps/gitlab-shell/hooks/
Git:		/usr/bin/git
</pre>
<div style="padding: 5px; margin: 0.50em 0; background-color: #DDDDFF; border: thin solid #BBBBDD; overflow: hidden;">
<strong> Note: </strong> <code>gitlab:check</code> will complain about missing initscripts. This is nothing to worry about, as <a href="../en/Systemd.html" title="Systemd">systemd</a> service files are used instead (which GitLab does not recognize).</div>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">$ sudo -u gitlab bundle exec rake gitlab:check RAILS_ENV=production</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">
fatal: Not a git repository (or any of the parent directories): .git
Checking Environment ...

Git configured for gitlab user? ... yes
Has python2? ... yes
python2 is supported version? ... yes

Checking Environment ... Finished

Checking GitLab Shell ...

GitLab Shell version &gt;= 1.7.9 ? ... OK (1.8.0)
Repo base directory exists? ... yes
Repo base directory is a symlink? ... no
Repo base owned by gitlab:gitlab? ... yes
Repo base access is drwxrws---? ... yes
update hook up-to-date? ... yes
update hooks in repos are links: ... can't check, you have no projects
Running /srv/gitlab/gitlab-shell/bin/check
Check GitLab API access: OK
Check directories and files:
        /srv/gitlab/repositories: OK
        /srv/gitlab/.ssh/authorized_keys: OK
Test redis-cli executable: redis-cli 2.8.4
Send ping to redis server: PONG
gitlab-shell self-check successful

Checking GitLab Shell ... Finished

Checking Sidekiq ...

Running? ... yes
Number of Sidekiq processes ... 1

Checking Sidekiq ... Finished

Checking LDAP ...

LDAP is disabled in config/gitlab.yml

Checking LDAP ... Finished

Checking GitLab ...

Database config exists? ... yes
Database is SQLite ... no
All migrations up? ... fatal: Not a git repository (or any of the parent directories): .git
yes
GitLab config exists? ... yes
GitLab config outdated? ... no
Log directory writable? ... yes
Tmp directory writable? ... yes
Init script exists? ... no
  Try fixing it:
  Install the init script
  For more information see:
  doc/install/installation.md in section "Install Init Script"
  Please fix the error above and rerun the checks.
Init script up-to-date? ... can't check because of previous errors
projects have namespace: ... can't check, you have no projects
Projects have satellites? ... can't check, you have no projects
Redis version &gt;= 2.0.0? ... yes
Your git bin path is "/usr/bin/git"
Git version &gt;= 1.7.10 ? ... yes (1.8.5)

Checking GitLab ... Finished
</pre>
<p>To automatically launch GitLab at startup, enable the <code>gitlab.target</code>, <code>gitlab-sidekiq</code> and <code>gitlab-unicorn</code> services.
</p>
<p>Now test your GitLab instance by visiting <a rel="nofollow" class="external free" href="http://localhost:8080">http://localhost:8080</a> or <a rel="nofollow" class="external free" href="http://yourdomain.com">http://yourdomain.com</a> and login with the default credentials:
</p>
<pre>
username: root
password: 5iveL!fe
</pre>
<div style="padding: 5px; margin: 0.50em 0; background-color: #DDDDFF; border: thin solid #BBBBDD; overflow: hidden;">
<strong> Note: </strong>If your browser runs not on the machine where gitlab is running, modify your unicorn.rb in order to be able to test your setup without the use of a proxy. The corresponding line looks like this:
<pre>listen "127.0.0.1:8080, :tcp_nopush =&gt; true</pre>
<p>you should replace that with:
</p>
<pre>listen "example.yourhost.com:8080, :tcp_nopush =&gt; true</pre>
</div>
<h2><span class="mw-headline" id="Advanced_Configuration">Advanced Configuration</span></h2>
<h3><span class="mw-headline" id="Custom_SSH_Connection">Custom SSH Connection</span></h3>
<p>If you are running SSH on a non-standard port, you must change the GitLab user's SSH config:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/var/lib/gitlab/.ssh/config</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">host localhost      # Give your setup a name (here: override localhost)
user gitlab         # Your remote git user
port 2222           # Your port number
hostname 127.0.0.1; # Your server name or IP</pre>
<p>You also need to change the corresponding options (e.g. ssh_user, ssh_host, admin_uri) in the <code>/etc/webapps/gitlab/gitlab.yml</code> file.
</p>
<h3><span class="mw-headline" id="HTTPS.2FSSL">HTTPS/SSL</span></h3>
<h4><span class="mw-headline" id="Change_GitLab_configs">Change GitLab configs</span></h4>
<p>Modify <code>/etc/webapps/gitlab/shell.yml</code> so the url to your GitLab site starts with <code>https://</code>.
Modify <code>/etc/webapps/gitlab/gitlab.yml</code> so that <code>https:</code> setting is set to <code>true</code>.
</p>
<p>See also <a href="../en/Apache_HTTP_Server.html#TLS.2FSSL" title="Apache HTTP Server">Apache HTTP Server#TLS/SSL</a> and <a href="../en/b9f6f965120480bf1d159235e57f636c.html" title="Let’s Encrypt">Let’s Encrypt</a>.
</p>
<h4><span class="mw-headline" id="Let.27s_Encrypt">Let's Encrypt</span></h4>
<p>To validate your URL, the Let's Encrypt process will try to access your gitlab server with something like <code>https://gitlab.<i>YOUR_SERVER_FQDN</i>/.well-known/acme-challenge/<i>A_LONG_ID</i></code>. But, due to gitlab configuration, every request to <code>gitlab.<i>YOUR_SERVER_FQDN</i></code> will be redirected to a proxy (gitlab-workhorse) that will not be able to deal with this URL.
</p>
<p>To bypass this issue, you can use the Let's Encrypt webroot configuration, setting the webroot at <code>/srv/http/letsencrypt/</code>.
</p>
<p>Additionally, force the Let's Encrypt request for gitlab to be redirected to this webroot by adding the following:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/http/conf/extra/gitlab.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">
Alias "/.well-known"  "/srv/http/letsencrypt/.well-known"
RewriteCond   %{REQUEST_URI}  !/\.well-known/.*
</pre>
<h3><span class="mw-headline" id="Web_server_configuration">Web server configuration</span></h3>
<p>If you want to integrate Gitlab into a running web server instead of using its build-in http server Unicorn, then follow these instructions.
</p>
<h5><span class="mw-headline" id="Node.js">Node.js</span></h5>
<p>You can easily set up an http proxy on port 443 to proxy traffic to the GitLab application on port 8080 using http-master for Node.js. After you have creates your domain's OpenSSL keys and have gotten you CA certificate (or self signed it), then go to <a rel="nofollow" class="external free" href="https://github.com/CodeCharmLtd/http-master">https://github.com/CodeCharmLtd/http-master</a> to learn how easy it is to proxy requests to GitLab using HTTPS. http-master is built on top of <a rel="nofollow" class="external text" href="https://github.com/nodejitsu/node-http-proxy">node-http-proxy</a>.
</p>
<h4><span class="mw-headline" id="Nginx_and_unicorn">Nginx and unicorn</span></h4>
<h5><span class="mw-headline" id="AUR_Installation">AUR Installation</span></h5>
<p>Setup <a href="../en/Nginx.html" title="Nginx">Nginx</a>, and create the following directories (if not exist already):
</p>
<pre># mkdir /etc/nginx/servers-available
# mkdir /etc/nginx/servers-enabled
</pre>
<div style="padding: 5px; margin: 0.50em 0; background-color: #DDDDFF; border: thin solid #BBBBDD; overflow: hidden;">
<strong> Note: </strong>You may need to change <code>localhost:8080</code> with the correct gitlab address and <code>example.com</code> to your desired server name.</div>
<div style="padding: 5px; margin: 0.50em 0; background-color: #DDFFDD; border: thin solid #BBDDBB; overflow: hidden;">
<strong> Tip: </strong>See <a href="../en/Nginx.html#TLS.2FSSL" title="Nginx">Nginx#TLS/SSL</a> before enabling SSL.</div>
<p>Create a file <code>/etc/nginx/servers-available/gitlab</code> with the following content:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/nginx/servers-available/gitlab</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;"># Created by: Sameer Naik
# Contributor: francoism90
# Source: <a rel="nofollow" class="external free" href="https://gist.github.com/sameersbn/becd1c976c3dc4866ef8">https://gist.github.com/sameersbn/becd1c976c3dc4866ef8</a>
upstream gitlab {
  server localhost:8080 fail_timeout=0;
}

server {
  listen 80;
  #listen 443 ssl; # uncomment to enable ssl
  keepalive_timeout 70;
  server_name example.com
  server_tokens off;
  #ssl_certificate ssl/example.com.crt;
  #ssl_certificate_key ssl/example.com.key;
  charset utf-8;
  root /dev/null;
  
  # Increase this if you want to upload larger attachments
  client_max_body_size 20m;
  
  location / {
      proxy_read_timeout 300;
      proxy_connect_timeout 300;
      proxy_redirect off;
      
      proxy_set_header X-Forwarded-Proto $scheme;
      proxy_set_header Host $http_host;
      proxy_set_header X-Real-IP $remote_addr;
      proxy_set_header X-Forwarded-Ssl on;
      proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
      proxy_set_header X-Forwarded-Proto $scheme;
      proxy_set_header X-Frame-Options SAMEORIGIN;
      
      proxy_pass <a rel="nofollow" class="external free" href="http://localhost:8080">http://localhost:8080</a>;
  }  
}</pre>
<p>Make sure the following line exists at the end of the <code>http</code> block in <code>/etc/nginx/nginx.conf</code>:
</p>
<pre>include servers-enabled/*;
</pre>
<p>Enable the <code>github</code> configuration:
</p>
<pre># ln -s /etc/nginx/servers-available/gitlab /etc/nginx/servers-enabled/gitlab
</pre>
<p>Verify the new configuration:
</p>
<pre># nginx -t
</pre>
<p>Finally, (re)start the <code>gitlab.target</code>, <code>resque.target</code> and <code>nginx.service</code>.
</p>
<h5><span class="mw-headline" id="Manual_Installation">Manual Installation</span></h5>
<p>If you did not use AUR, you need to copy <code>/usr/lib/support/nginx/gitlab</code> to <code>/etc/nginx/sites-available/</code>.
</p>
<p>Run these commands to setup nginx:
</p>
<pre># ln -s /etc/nginx/sites-available/gitlab /etc/nginx/sites-enabled/gitlab
</pre>
<p>Edit <code>/etc/nginx/sites-enabled/gitlab</code> and change YOUR_SERVER_IP and YOUR_SERVER_FQDN to the IP address and fully-qualified domain name of the host serving Gitlab.
</p>
<p>Make sure the following line exists at the end of the <code>http</code> block in <code>/etc/nginx/nginx.conf</code>:
</p>
<pre>include sites-enabled/*;
</pre>
<p>Enable the <code>github</code> configuration:
</p>
<pre># ln -s /etc/nginx/sites-available/gitlab /etc/nginx/sites-enabled/gitlab
</pre>
<p>Verify the new configuration:
</p>
<pre># nginx -t
</pre>
<p>Finally, (re)start the <code>gitlab.target</code>, <code>resque.target</code> and <code>nginx.service</code>.
</p>
<h4><span class="mw-headline" id="Apache_and_unicorn">Apache and unicorn</span></h4>
<p><a href="../en/Help:Reading.html#Installation_of_packages" title="Install" class="mw-redirect">Install</a> <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://www.archlinux.org/packages/?name=apache">apache</a></span> from the <a href="../en/Official_repositories.html" title="Official repositories">official repositories</a>.
</p>
<h5><span class="mw-headline" id="Configure_Unicorn">Configure Unicorn</span></h5>
<p>As the official installation guide instructs, copy the unicorn configuration file:
</p>
<pre># sudo -u git -H cp /usr/share/webapps/gitlab/config/unicorn.rb.example /usr/share/webapps/gitlab/config/unicorn.rb
</pre>
<p>Now edit <code>config/unicorn.rb</code> and add a listening port by uncommenting the following line:
</p>
<pre>listen "127.0.0.1:8080"
</pre>
<div style="padding: 5px; margin: 0.50em 0; background-color: #DDFFDD; border: thin solid #BBDDBB; overflow: hidden;">
<strong> Tip: </strong> You can set a custom port if you want. Just remember to also include it in Apache's virtual host. See below.</div>
<h5><span class="mw-headline" id="Create_a_virtual_host_for_Gitlab">Create a virtual host for Gitlab</span></h5>
<p>Create a configuration file for Gitlab’s virtual host and insert the lines below adjusted accordingly. For the ssl section see <a href="../en/Apache_HTTP_Server.html#SSL" title="LAMP" class="mw-redirect">LAMP#SSL</a><sup>[<a href="../en/ArchWiki:Requests.html#Broken_section_links" title="ArchWiki:Requests">broken link</a>: invalid section]</sup>. If you do not need it, remove it. Notice that the SSL virtual host needs a specific IP instead of generic. Also if you set a custom port for Unicorn, do not forget to set it at the BalanceMember line.
</p>
<p>You can use these <a rel="nofollow" class="external text" href="https://gitlab.com/gitlab-org/gitlab-recipes/blob/079f70dd2c091434a8dd04ed5b1a0d0e937cd361/web-server/apache/gitlab-ssl-apache2.4.conf">examples</a> to get you started.
</p>
<h5><span class="mw-headline" id="Enable_host_and_start_unicorn">Enable host and start unicorn</span></h5>
<p>Enable your Gitlab virtual host and reload <a href="../en/Apache_HTTP_Server.html" title="Apache" class="mw-redirect">Apache</a>:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/httpd/conf/httpd.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;"> Include /etc/httpd/conf/extra/gitlab.conf</pre>
<p>Copy the Apache  gitlab.conf file
</p>
<pre># cp /usr/share/doc/gitlab/apache.conf.example /etc/httpd/conf/extra/gitlab.conf
</pre>
<p>Finally <a href="../en/Systemd.html#Using_units" title="Start" class="mw-redirect">start</a> <code>gitlab-unicorn.service</code>.
</p>
<h3><span class="mw-headline" id="Redis">Redis</span></h3>
<p>Using a Redis setup different from default (e.g. different address, port, unix socket) requires the environment variable <i>REDIS_URL</i> to be set accordingly for unicorn. This can be achieved by extending the systemd service file. Create a file <i>/etc/systemd/system/gitlab-unicorn.service.d/redis.conf</i> that injects the <i>REDIS_URL</i> environment variable:
</p>
<pre>[Service]
Environment=REDIS_URL=unix:///run/gitlab/redis.sock
</pre>
<h4><span class="mw-headline" id="Redis_Over_Unix_Socket">Redis Over Unix Socket</span></h4>
<p>If Redis is set to listen on socket, you may want to adjust the default configuration:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/redis.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">...
# Accept connections on the specified port, default is 6379.
# If port 0 is specified Redis will not listen on a TCP socket.
port 0
...
# By default Redis listens for connections from all the network interfaces
# available on the server. It is possible to listen to just one or multiple
# interfaces using the "bind" configuration directive, followed by one or
# more IP addresses.
#
# Examples:
#
# bind 192.168.1.100 10.0.0.1
bind 127.0.0.1

# Specify the path for the Unix socket that will be used to listen for
# incoming connections. There is no default, so Redis will not listen
# on a unix socket when not specified.
#
unixsocket /var/run/redis/redis.sock
unixsocketperm 770</pre>
<p>Create the directory <code>/var/run/redis</code> and set the correct permissions:
</p>
<pre># mkdir /var/run/redis
# chown redis:redis /var/run/redis
# chmod 755 /var/run/redis
</pre>
<p>Add the user <code>git</code> and <code>gitlab</code> to the <code>redis</code> group:
</p>
<pre># usermod -a -G redis git
# usermod -a -G redis gitlab
</pre>
<p>Update <code>/etc/webapps/gitlab-shell/config.yml</code> and <code>/etc/webapps/gitlab/resque.yml</code> files:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/webapps/gitlab/resque.yml</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">development: unix:/var/run/redis/redis.sock
test: unix:/run/redis/redis.sock
production: unix:/run/redis/redis.sock</pre>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/webapps/gitlab-shell/config.yml</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">...
# Redis settings used for pushing commit notices to gitlab
redis:
  bin: /usr/bin/redis-cli
  host: 127.0.0.1
  port: 6379
  # pass: redispass # Allows you to specify the password for Redis
  database: 5 # Use different database, default up to 16
  socket: /var/run/redis/redis.sock # uncomment this line
  namespace: resque:gitlab
...</pre>
<p>Finally restart the <code>redis</code>, <code>gitlab-sidekiq</code> and <code>gitlab-unicorn</code> services.
</p>
<p>For more information, please see issue <a rel="nofollow" class="external text" href="https://github.com/gitlabhq/gitlabhq/issues/6100">#6100</a>.
</p>
<h3><span class="mw-headline" id="Gitlab-workhorse">Gitlab-workhorse</span></h3>
<div class="noprint archwiki-template-message">
<p><a href="../File:Tango-view-fullscreen.png" class="image"><img alt="Tango-view-fullscreen.png" src="../File:Tango-view-fullscreen.png" width="48" height="48"></a><b>This article or section needs expansion.</b><a href="../File:Tango-view-fullscreen.png" class="image"><img alt="Tango-view-fullscreen.png" src="../File:Tango-view-fullscreen.png" width="48" height="48"></a></p>
<div>
<b>Reason:</b> This section needs configuration instructions. (Discuss in <a rel="nofollow" class="external text" href="https://wiki.archlinux.org/index.php/Talk:Gitlab">Talk:Gitlab#</a>)</div>
</div>
<p>Since 8.0 GitLab uses separate HTTP server <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://www.archlinux.org/packages/?name=gitlab-workhorse">gitlab-workhorse</a></span> for large HTTP requests like Git push/pull. If you want to use this instead of SSH, install the <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://www.archlinux.org/packages/?name=gitlab-workhorse">gitlab-workhorse</a></span> package, enable <code>gitlab-workhorse.service</code> and configure web server for this.
</p>
<p>Please note that <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://www.archlinux.org/packages/?name=gitlab-workhorse">gitlab-workhorse</a></span> should now be preferred over <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://www.archlinux.org/packages/?name=gitlab-unicorn">gitlab-unicorn</a></span><sup>[<a href="../en/ArchWiki:Requests.html#Broken_package_links" title="ArchWiki:Requests">broken link</a>: package not found]</sup> according to the GitLab team: <a rel="nofollow" class="external free" href="https://gitlab.com/gitlab-org/gitlab-ce/issues/22528#note_16036216">https://gitlab.com/gitlab-org/gitlab-ce/issues/22528#note_16036216</a>
</p>
<p>GitLab v8.12 somehow broke <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://www.archlinux.org/packages/?name=gitlab-unicorn">gitlab-unicorn</a></span><sup>[<a href="../en/ArchWiki:Requests.html#Broken_package_links" title="ArchWiki:Requests">broken link</a>: package not found]</sup> web server. Using <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://www.archlinux.org/packages/?name=gitlab-workhorse">gitlab-workhorse</a></span> instead fixes issues about unreachable assets and consequently broken display/broken CSS.
</p>
<p>By default <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://www.archlinux.org/packages/?name=gitlab-workhorse">gitlab-workhorse</a></span> listens on <code>127.0.0.1:8181</code>. You should consider <a href="../en/Systemd.html#Editing_provided_units" title="Edit" class="mw-redirect">editing</a> <code>gitlab-workhorse.service</code> and change the parameter <code>-listenAddr</code> according to your LAN IP address, for example <code>-listenAddr 192.168.0.1:8181</code>.
</p>
<p>---
</p>
<p>When using nginx remember to verify your nginx configuration file. To switch from gitlab-unicorn to gitlab-workhorse please see configuration in /etc/webapps/gitlab/nginx.conf.example. To fix not working broken CSS you probably will need to change your upstream to point to workhorse socket.
</p>
<h2><span class="mw-headline" id="Useful_Tips">Useful Tips</span></h2>
<h3><span class="mw-headline" id="Fix_Rake_Warning">Fix Rake Warning</span></h3>
<p>When running rake tasks for the gitlab project, this error will occur: <code>fatal: Not a git repository (or any of the parent directories): .git</code>. This is a bug in bundler, and it can be safely ignored. However, if you want to git rid of the error, the following method can be used:
</p>
<pre># cd /usr/share/webapps/gitlab
# sudo -u gitlab git init
# sudo -u gitlab git commit -m "initial commit" --allow-empty</pre>
<h3><span class="mw-headline" id="Hook_into_.2Fvar">Hook into /var</span></h3>
<pre># mkdir -m700 /var/log/gitlab /var/tmp/gitlab
# chown gitlab:gitlab /var/log/gitlab /var/tmp/gitlab
# sudo -u gitlab -i
# cd ~/gitlab
# d=log; mv $d/* /var/$d/gitlab; rm -f $d/.gitkeep; rm -r $d &amp;&amp; ln -s /var/$d/gitlab $d
# d=tmp; mv $d/* /var/$d/gitlab; rm -f $d/.gitkeep; rm -r $d &amp;&amp; ln -s /var/$d/gitlab $d</pre>
<h3><span class="mw-headline" id="Hidden_options">Hidden options</span></h3>
<p>Go to Gitlab's home directory:
</p>
<pre># cd /usr/share/webapps/gitlab
</pre>
<p>and run:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;"># rake -T | grep gitlab</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">
rake gitlab:app:check                         # GITLAB | Check the configuration of the GitLab Rails app
rake gitlab:backup:create                     # GITLAB | Create a backup of the GitLab system
rake gitlab:backup:restore                    # GITLAB | Restore a previously created backup
rake gitlab:check                             # GITLAB | Check the configuration of GitLab and its environment
rake gitlab:cleanup:block_removed_ldap_users  # GITLAB | Cleanup | Block users that have been removed in LDAP
rake gitlab:cleanup:dirs                      # GITLAB | Cleanup | Clean namespaces
rake gitlab:cleanup:repos                     # GITLAB | Cleanup | Clean repositories
rake gitlab:env:check                         # GITLAB | Check the configuration of the environment
rake gitlab:env:info                          # GITLAB | Show information about GitLab and its environment
rake gitlab:generate_docs                     # GITLAB | Generate sdocs for project
rake gitlab:gitlab_shell:check                # GITLAB | Check the configuration of GitLab Shell
rake gitlab:import:all_users_to_all_groups    # GITLAB | Add all users to all groups (admin users are added as owners)
rake gitlab:import:all_users_to_all_projects  # GITLAB | Add all users to all projects (admin users are added as masters)
rake gitlab:import:repos                      # GITLAB | Import bare repositories from gitlab_shell -&gt; repos_path into GitLab project instance
rake gitlab:import:user_to_groups[email]      # GITLAB | Add a specific user to all groups (as a developer)
rake gitlab:import:user_to_projects[email]    # GITLAB | Add a specific user to all projects (as a developer)
rake gitlab:satellites:create                 # GITLAB | Create satellite repos
rake gitlab:setup                             # GITLAB | Setup production application
rake gitlab:shell:build_missing_projects      # GITLAB | Build missing projects
rake gitlab:shell:install[tag,repo]           # GITLAB | Install or upgrade gitlab-shell
rake gitlab:shell:setup                       # GITLAB | Setup gitlab-shell
rake gitlab:sidekiq:check                     # GITLAB | Check the configuration of Sidekiq
rake gitlab:test                              # GITLAB | Run all tests
rake gitlab:web_hook:add                      # GITLAB | Adds a web hook to the projects
rake gitlab:web_hook:list                     # GITLAB | List web hooks
rake gitlab:web_hook:rm                       # GITLAB | Remove a web hook from the projects
rake setup                                    # GITLAB | Setup gitlab db
</pre>
<h3><span class="mw-headline" id="Backup_and_restore">Backup and restore</span></h3>
<p>Create a backup of the gitlab system:
</p>
<pre># sudo -u gitlab -H rake RAILS_ENV=production gitlab:backup:create
</pre>
<p>Restore the previously created backup file <code>/home/gitlab/gitlab/tmp/backups/20130125_11h35_1359131740_gitlab_backup.tar</code>:
</p>
<pre># sudo -u gitlab -H rake RAILS_ENV=production gitlab:backup:restore BACKUP=/home/gitlab/gitlab/tmp/backups/20130125_11h35_1359131740
</pre>
<div style="padding: 5px; margin: 0.50em 0; background-color: #DDDDFF; border: thin solid #BBBBDD; overflow: hidden;">
<strong> Note: </strong> Backup folder is set in <code>config/gitlab.yml</code>. GitLab backup and restore is documented <a rel="nofollow" class="external text" href="https://github.com/gitlabhq/gitlabhq/blob/master/doc/raketasks/backup_restore.md">here</a>.</div>
<h3><span class="mw-headline" id="Migrate_from_sqlite_to_mysql">Migrate from sqlite to mysql</span></h3>
<p>Get latest code as described in <a href="#Update_Gitlab">#Update Gitlab</a><sup>[<a href="../en/ArchWiki:Requests.html#Broken_section_links" title="ArchWiki:Requests">broken link</a>: invalid section]</sup>.
Save data.
</p>
<pre># cd /home/gitlab/gitlab
# sudo -u gitlab bundle exec rake db:data:dump RAILS_ENV=production
</pre>
<p>Follow <a href="#Mysql">#Mysql</a><sup>[<a href="../en/ArchWiki:Requests.html#Broken_section_links" title="ArchWiki:Requests">broken link</a>: invalid section]</sup> instructions and then setup the database.
</p>
<pre># sudo -u gitlab bundle exec rake db:setup RAILS_ENV=production
</pre>
<p>Finally restore old data.
</p>
<pre># sudo -u gitlab bundle exec rake db:data:load RAILS_ENV=production
</pre>
<h3><span class="mw-headline" id="Running_GitLab_with_rvm">Running GitLab with rvm</span></h3>
<p>To run gitlab with rvm first you have to set up an rvm:
</p>
<pre> curl -L <a rel="nofollow" class="external free" href="https://get.rvm.io">https://get.rvm.io</a> | bash -s stable --ruby=1.9.3
</pre>
<div style="padding: 5px; margin: 0.50em 0; background-color: #DDDDFF; border: thin solid #BBBBDD; overflow: hidden;">
<strong> Note: </strong>Version 1.9.3 is currently recommended to avoid some compatibility issues.</div>
<p>For the complete installation you will want to be the final user (e.g. <code>git</code>) so make sure to switch to this user and activate your rvm:
</p>
<pre> su - git
 source "$HOME/.rvm/scripts/rvm"
</pre>
<p>Then continue with the installation instructions from above. However, the systemd scripts will not work this way, because the environment for the rvm is not activated. The recommendation here is to create to separate shell scripts for <code>unicorn</code> and <code>sidekiq</code> to activate the environment and then start the service:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">gitlab.sh</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">
#!/bin/sh
source `/home/git/.rvm/bin/rvm 1.9.3 do rvm env --path`
bundle exec "unicorn_rails -c /usr/share/webapps/gitlab/config/unicorn.rb -E production"
</pre>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">sidekiq.sh</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">
#!/bin/sh
source `/home/git/.rvm/bin/rvm 1.9.3 do rvm env --path`
case $1 in
    start)
        bundle exec rake sidekiq:start RAILS_ENV=production
        ;;
    stop)
        bundle exec rake sidekiq:stop RAILS_ENV=production
        ;;
    *)
        echo "Usage $0 {start|stop}"
esac
</pre>
<p>Then modify the above systemd files so they use these scripts. Modify the given lines:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">gitlab.service</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">
ExecStart=/home/git/bin/gitlab.sh
</pre>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">sidekiq.service</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">
ExecStart=/home/git/bin/sidekiq.sh start
ExecStop=/home/git/bin/sidekiq.sh stop
</pre>
<h3><span class="mw-headline" id="Sending_mails_from_Gitlab_via_SMTP">Sending mails from Gitlab via SMTP</span></h3>
<p>You might want to use a gmail (or other mail service) to send mails from your gitlab server. This avoids the need to install a mail daemon on the gitlab server.
</p>
<p>Adjust <code>smtp_settings.rb</code> according to your mail server settings:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/usr/share/webapps/gitlab/config/initializers/smtp_settings.rb</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">
if Rails.env.production?
  Gitlab::Application.config.action_mailer.delivery_method = :smtp

  Gitlab::Application.config.action_mailer.smtp_settings = {
    address:              'smtp.gmail.com',
    port:                 587,
    domain:               'gmail.com',
    user_name:            'username@gmail.com',
    password:             'application password',
    authentication:       'plain',
    enable_starttls_auto: true
  }
end</pre>
<p>Gmail will reject mails received this way (and send you a mail that it did). You will need to disable secure authentication (follow the link in the rejection mail) to work around this. The more secure approach is to enable two-factor authentication for username@gmail.com and to set up an application password for this configuration file.
</p>
<h2><span class="mw-headline" id="Troubleshooting">Troubleshooting</span></h2>
<p>Sometimes things may not work as expected. Be sure to visit the <a rel="nofollow" class="external text" href="https://github.com/gitlabhq/gitlab-public-wiki/wiki/Trouble-Shooting-Guide">Trouble Shooting Guide</a>.
</p>
<h3><span class="mw-headline" id="HTTPS_is_not_green_.28gravatar_not_using_https.29">HTTPS is not green (gravatar not using https)</span></h3>
<p>Redis caches gravatar images, so if you have visited your GitLab with http, then enabled https, gravatar will load up the non-secure images. You can clear the cache by doing
</p>
<pre>cd /usr/share/webapps/gitlab
RAILS_ENV=production bundle exec rake cache:clear
</pre>
<p>as the gitlab user.
</p>
<h3><span class="mw-headline" id="401_Unauthorized_on_all_API_access">401 Unauthorized on all API access</span></h3>
<p>Make 100% sure, that the files <code>/etc/webapps/gitlab/secret</code> and <code>/etc/webapps/gitlab-shell/secret</code> files contain something!
</p>
<h3><span class="mw-headline" id="Error_at_push_bad_line_length_character:_API">Error at push bad line length character: API</span></h3>
<p>If you get the following error while trying to push
</p>
<pre>fatal: protocol error: bad line length character: API
</pre>
<p>Check that your <code>/etc/webapps/gitlab-shell/secret</code> matches <code>/usr/share/webapps/gitlab/.gitlab_shell_secret</code>
</p>
<p>If it is not the same, recreate the file with the following command
</p>
<pre>ln -s /etc/webapps/gitlab-shell/secret /usr/share/webapps/gitlab/.gitlab_shell_secret
</pre>
<h3><span class="mw-headline" id="Errors_after_updating">Errors after updating</span></h3>
<p>After updating the package from the AUR, the database migrations and asset updates will sometimes fail. These steps may resolve the issue, if a simple reboot does not.
</p>
<p>First, move to the gitlab installation directory.
</p>
<pre># cd /usr/share/webapps/gitlab
</pre>
<p>If every gitlab page gives a 500 error, then the database migrations and the assets are probably stale. If not, skip this step.
</p>
<pre># sudo -u gitlab -H bundle exec rake db:migrate RAILS_ENV=production
</pre>
<p>If gitlab is constantly waiting for the deployment to finish, then the assets have probably not been recompiled.
</p>
<pre># sudo -u gitlab -H bundle exec rake assets:clean assets:precompile cache:clear RAILS_ENV=production
</pre>
<p>Finally, restart the gitlab services and test your site.
</p>
<pre># systemctl restart gitlab-unicorn gitlab-sidekiq gitlab-workhorse
</pre>
<h3><span class="mw-headline" id=".2Fetc.2Fwebapps.2Fgitlab.2Fsecret_is_empty">/etc/webapps/gitlab/secret is empty</span></h3>
<p>This file is usually generated while installing the <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://www.archlinux.org/packages/?name=gitlab-shell">gitlab-shell</a></span> and the <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://www.archlinux.org/packages/?name=gitlab">gitlab</a></span> packages, but in some cases it may need to be generated manually.
</p>
<pre># hexdump -v -n 64 -e '1/1 "%02x"' /dev/urandom &gt; /etc/webapps/gitlab-shell/secret
# chown root:gitlab /etc/webapps/gitlab-shell/secret
# chmod 640 /etc/webapps/gitlab-shell/secret
</pre>
<pre># hexdump -v -n 64 -e '1/1 "%02x"' /dev/urandom &gt; /etc/webapps/gitlab/secret
# chown root:gitlab /etc/webapps/gitlab/secret
# chmod 640 /etc/webapps/gitlab/secret
</pre>
<h2><span class="mw-headline" id="See_also">See also</span></h2>
<ul>
<li><a rel="nofollow" class="external text" href="https://gitlab.com/gitlab-org/gitlab-ce/blob/master/doc/install/installation.md">Official Documentation</a></li>
<li><a rel="nofollow" class="external text" href="https://gitlab.com/gitlab-org/gitlab-recipes">Gitlab recipes with further documentation on running it with several webservers</a></li>
<li><a rel="nofollow" class="external text" href="https://github.com/gitlabhq/gitlabhq">GitLab source code</a></li>
</ul>

</div>
<div id="catlinks" class="catlinks">
<div id="mw-normal-catlinks" class="mw-normal-catlinks">
<a href="../Special:Categories.html" title="Special:Categories">Category</a>: <ul><li><a href="../en/Category:Version_Control_System.html" title="Category:Version Control System">Version Control System</a></li></ul>
</div>
<div id="mw-hidden-catlinks" class="mw-hidden-catlinks mw-hidden-cats-hidden">Hidden categories: <ul>
<li><a href="../en/Category:Pages_or_sections_flagged_with_Template:Accuracy.html" title="Category:Pages or sections flagged with Template:Accuracy">Pages or sections flagged with Template:Accuracy</a></li>
<li><a href="../en/Category:Pages_with_broken_section_links.html" title="Category:Pages with broken section links">Pages with broken section links</a></li>
<li><a href="../en/Category:Pages_or_sections_flagged_with_Template:Expansion.html" title="Category:Pages or sections flagged with Template:Expansion">Pages or sections flagged with Template:Expansion</a></li>
<li><a href="../en/Category:Pages_with_broken_package_links.html" title="Category:Pages with broken package links">Pages with broken package links</a></li>
</ul>
</div>
</div>					<div class="visualClear"></div>
				</div>
			</div>
		</div>
		<div class="visualClear"></div>
					<div id="footer" role="contentinfo">
Extracted from <a href="https://wiki.archlinux.org"> ArchWiki </a> and licensed under <a href="http://www.gnu.org/copyleft/fdl.html"> GDL >= 1.3</a>
		</div>
		</div>
		</body>
</html>
