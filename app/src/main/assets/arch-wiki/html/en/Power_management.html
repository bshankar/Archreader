<!DOCTYPE html>
<html lang="en" dir="ltr" class="client-nojs">
<head>
<meta charset="UTF-8">
<title>Power management - ArchWiki</title>
<link rel="stylesheet" href="../ArchWikiOffline.css">
<meta name="ResourceLoaderDynamicStyles" content="">
<style></style>
<meta name="generator" content="MediaWiki 1.26.4">
<meta name="robots" content="noindex,follow">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="search" type="application/opensearchdescription+xml" href="/opensearch_desc.php" title="ArchWiki (en)">
<link rel="EditURI" type="application/rsd+xml" href="https://wiki.archlinux.org/api.php?action=rsd">
<link rel="copyright" href="http://www.gnu.org/copyleft/fdl.html">
<link rel="alternate" type="application/atom+xml" title="ArchWiki Atom feed" href="/index.php?title=Special:RecentChanges&amp;feed=atom">
</head>
<body class="mediawiki ltr sitedir-ltr ns-0 ns-subject page-Power_management skin-archlinux action-view">

		<div id="globalWrapper" style="width: 100%">
		<div id="column-content">
			<div id="content" class="mw-body" role="main" style="margin: 0.5em; margin-bottom:0; margin-top:0">
				<a id="top"></a>
				
				<div class="mw-indicators">
</div>
				<h1 id="firstHeading" class="firstHeading" lang="en">Power management</h1>
				
				<div id="bodyContent" class="mw-body-content">
					<div id="contentSub"></div>
										<div id="mw-content-text" lang="en" dir="ltr" class="mw-content-ltr">
<div style="width:45%; margin: 0 0 0.5em 0.5em;">
<p style="background:#333; color:white; padding:0.2em; border-bottom:5px #08c solid; margin:0; text-align:center; font-weight:bold;">Related articles</p>
<ul style="list-style-type:none; margin:0; padding:0.3em;">
<li style="padding:0.4em 0; line-height:1;"><a href="../en/Power_management/Suspend_and_hibernate.html" title="Power management/Suspend and hibernate">Power management/Suspend and hibernate</a></li>
<li style="padding:0.4em 0; line-height:1;"><a href="../en/Display_Power_Management_Signaling.html" title="Display Power Management Signaling">Display Power Management Signaling</a></li>
<li style="padding:0.4em 0; line-height:1;"><a href="../en/CPU_frequency_scaling.html" title="CPU frequency scaling">CPU frequency scaling</a></li>
<li style="padding:0.4em 0; line-height:1;"><a href="../en/Hybrid_graphics.html" title="Hybrid graphics">Hybrid graphics</a></li>
<li style="padding:0.4em 0; line-height:1;"><a href="../en/Kernel_modules.html" title="Kernel modules">Kernel modules</a></li>
<li style="padding:0.4em 0; line-height:1;"><a href="../en/Sysctl.html" title="Sysctl">sysctl</a></li>
<li style="padding:0.4em 0; line-height:1;"><a href="../en/Udev.html" title="Udev">udev</a></li>
</ul>
</div>
<p><a href="https://en.wikipedia.org/wiki/Power_management" class="extiw" title="wikipedia:Power management">Power management</a> is a feature that turns off the power or switches system's components to a low-power state when inactive.
</p>
<p>In Arch linux, power management consists of two main parts:
</p>
<ol>
<li> Configuration of the Linux kernel, which interacts with the hardware.
<ul>
<li> <a href="../en/Kernel_parameters.html" title="Kernel parameters">Kernel parameters</a>
</li>
<li> <a href="../en/Kernel_modules.html" title="Kernel modules">Kernel modules</a>
</li>
<li> <a href="../en/Udev.html" title="Udev">udev</a> rules</li>
</ul>
</li>
<li> Configuration of userspace tools, which interact with the kernel and react to its events. Many userspace tools also allow to modify kernel configuration in a "user-friendly" way. See <a href="#Userspace_tools">#Userspace tools</a> for the options.</li>
</ol>
<div id="toc" class="toc">
<div id="toctitle"><h2>Contents</h2></div>
<ul>
<li class="toclevel-1 tocsection-1"><a href="#Userspace_tools"><span class="tocnumber">1</span> <span class="toctext">Userspace tools</span></a></li>
<li class="toclevel-1 tocsection-2">
<a href="#Power_management_with_systemd"><span class="tocnumber">2</span> <span class="toctext">Power management with systemd</span></a>
<ul>
<li class="toclevel-2 tocsection-3">
<a href="#ACPI_events"><span class="tocnumber">2.1</span> <span class="toctext">ACPI events</span></a>
<ul>
<li class="toclevel-3 tocsection-4"><a href="#Power_managers"><span class="tocnumber">2.1.1</span> <span class="toctext">Power managers</span></a></li>
<li class="toclevel-3 tocsection-5"><a href="#xss-lock"><span class="tocnumber">2.1.2</span> <span class="toctext">xss-lock</span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-6">
<a href="#Suspend_and_hibernate"><span class="tocnumber">2.2</span> <span class="toctext">Suspend and hibernate</span></a>
<ul>
<li class="toclevel-3 tocsection-7"><a href="#Hybrid_sleep"><span class="tocnumber">2.2.1</span> <span class="toctext">Hybrid sleep</span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-8">
<a href="#Sleep_hooks"><span class="tocnumber">2.3</span> <span class="toctext">Sleep hooks</span></a>
<ul>
<li class="toclevel-3 tocsection-9"><a href="#Suspend.2Fresume_service_files"><span class="tocnumber">2.3.1</span> <span class="toctext">Suspend/resume service files</span></a></li>
<li class="toclevel-3 tocsection-10"><a href="#Combined_Suspend.2Fresume_service_file"><span class="tocnumber">2.3.2</span> <span class="toctext">Combined Suspend/resume service file</span></a></li>
<li class="toclevel-3 tocsection-11"><a href="#Delayed_hibernation_service_file"><span class="tocnumber">2.3.3</span> <span class="toctext">Delayed hibernation service file</span></a></li>
<li class="toclevel-3 tocsection-12"><a href="#Hooks_in_.2Fusr.2Flib.2Fsystemd.2Fsystem-sleep"><span class="tocnumber">2.3.4</span> <span class="toctext">Hooks in /usr/lib/systemd/system-sleep</span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-13">
<a href="#Troubleshooting"><span class="tocnumber">2.4</span> <span class="toctext">Troubleshooting</span></a>
<ul>
<li class="toclevel-3 tocsection-14"><a href="#Delayed_lid_switch_action"><span class="tocnumber">2.4.1</span> <span class="toctext">Delayed lid switch action</span></a></li>
<li class="toclevel-3 tocsection-15"><a href="#Suspend_from_corresponding_laptop_Fn_key_not_working"><span class="tocnumber">2.4.2</span> <span class="toctext">Suspend from corresponding laptop Fn key not working</span></a></li>
</ul>
</li>
</ul>
</li>
<li class="toclevel-1 tocsection-16">
<a href="#Power_saving"><span class="tocnumber">3</span> <span class="toctext">Power saving</span></a>
<ul>
<li class="toclevel-2 tocsection-17"><a href="#Audio"><span class="tocnumber">3.1</span> <span class="toctext">Audio</span></a></li>
<li class="toclevel-2 tocsection-18"><a href="#Backlight"><span class="tocnumber">3.2</span> <span class="toctext">Backlight</span></a></li>
<li class="toclevel-2 tocsection-19"><a href="#Bluetooth"><span class="tocnumber">3.3</span> <span class="toctext">Bluetooth</span></a></li>
<li class="toclevel-2 tocsection-20"><a href="#Web_camera"><span class="tocnumber">3.4</span> <span class="toctext">Web camera</span></a></li>
<li class="toclevel-2 tocsection-21">
<a href="#Kernel_parameters"><span class="tocnumber">3.5</span> <span class="toctext">Kernel parameters</span></a>
<ul>
<li class="toclevel-3 tocsection-22"><a href="#Disabling_NMI_watchdog"><span class="tocnumber">3.5.1</span> <span class="toctext">Disabling NMI watchdog</span></a></li>
<li class="toclevel-3 tocsection-23"><a href="#Writeback_Time"><span class="tocnumber">3.5.2</span> <span class="toctext">Writeback Time</span></a></li>
<li class="toclevel-3 tocsection-24"><a href="#Laptop_Mode"><span class="tocnumber">3.5.3</span> <span class="toctext">Laptop Mode</span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-25">
<a href="#Network_interfaces"><span class="tocnumber">3.6</span> <span class="toctext">Network interfaces</span></a>
<ul>
<li class="toclevel-3 tocsection-26"><a href="#Intel_wireless_cards_.28iwlwifi.29"><span class="tocnumber">3.6.1</span> <span class="toctext">Intel wireless cards (iwlwifi)</span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-27">
<a href="#Bus_power_management"><span class="tocnumber">3.7</span> <span class="toctext">Bus power management</span></a>
<ul>
<li class="toclevel-3 tocsection-28"><a href="#Active_State_Power_Management"><span class="tocnumber">3.7.1</span> <span class="toctext">Active State Power Management</span></a></li>
<li class="toclevel-3 tocsection-29"><a href="#PCI_Runtime_Power_Management"><span class="tocnumber">3.7.2</span> <span class="toctext">PCI Runtime Power Management</span></a></li>
<li class="toclevel-3 tocsection-30"><a href="#USB_autosuspend"><span class="tocnumber">3.7.3</span> <span class="toctext">USB autosuspend</span></a></li>
<li class="toclevel-3 tocsection-31"><a href="#SATA_Active_Link_Power_Management"><span class="tocnumber">3.7.4</span> <span class="toctext">SATA Active Link Power Management</span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-32"><a href="#Hard_disk_drive"><span class="tocnumber">3.8</span> <span class="toctext">Hard disk drive</span></a></li>
<li class="toclevel-2 tocsection-33"><a href="#CD-ROM_or_DVD_drive"><span class="tocnumber">3.9</span> <span class="toctext">CD-ROM or DVD drive</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-34">
<a href="#Tools_and_scripts"><span class="tocnumber">4</span> <span class="toctext">Tools and scripts</span></a>
<ul>
<li class="toclevel-2 tocsection-35"><a href="#Using_a_script_and_an_udev_rule"><span class="tocnumber">4.1</span> <span class="toctext">Using a script and an udev rule</span></a></li>
<li class="toclevel-2 tocsection-36"><a href="#Print_power_settings"><span class="tocnumber">4.2</span> <span class="toctext">Print power settings</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-37"><a href="#See_also"><span class="tocnumber">5</span> <span class="toctext">See also</span></a></li>
</ul>
</div>

<h2><span class="mw-headline" id="Userspace_tools">Userspace tools</span></h2>
<p>Using these tools can replace setting a lot of settings by hand.  Only run <b>one</b> of these tools to avoid possible conflicts as they all work more or less similar.  Have a look at the <a href="../en/Category:Power_management.html" title="Category:Power management">power management category</a> to get an overview on what power management options exist in Archlinux.
</p>
<p>These are the more popular scripts and tools designed to help power saving:
</p>
<ul><li> <b>aclidswitch</b> —  Simple Power Management tool to define custom lid, brightness and low battery actions depending on the laptop's AC state.</li></ul>
<dl><dd>
<a rel="nofollow" class="external free" href="https://github.com/orschiro/aclidswitch">https://github.com/orschiro/aclidswitch</a> || <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/aclidswitch-git/">aclidswitch-git</a></span><sup><small>AUR</small></sup>
</dd></dl>
<ul><li> <b><a href="../en/Acpid.html" title="Acpid">acpid</a></b> —  A daemon for delivering ACPI power management events with netlink support.</li></ul>
<dl><dd>
<a rel="nofollow" class="external free" href="http://sourceforge.net/projects/acpid2/">http://sourceforge.net/projects/acpid2/</a> || <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://www.archlinux.org/packages/?name=acpid">acpid</a></span>
</dd></dl>
<ul><li> <b><a href="../en/Laptop_Mode_Tools.html" title="Laptop Mode Tools">Laptop Mode Tools</a></b> — Utility to configure laptop power saving settings, considered by many to be the de facto utility for power saving though may take a bit of configuration.</li></ul>
<dl><dd>
<a rel="nofollow" class="external free" href="https://github.com/rickysarraf/laptop-mode-tools">https://github.com/rickysarraf/laptop-mode-tools</a> || <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/laptop-mode-tools/">laptop-mode-tools</a></span><sup><small>AUR</small></sup>
</dd></dl>
<ul><li> <b><a href="../en/Pm-utils.html" title="Pm-utils">pm-utils</a></b> — Suspend and powerstate setting framework (largely undeveloped now).</li></ul>
<dl><dd>
<a rel="nofollow" class="external free" href="http://pm-utils.freedesktop.org/">http://pm-utils.freedesktop.org/</a> || <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://www.archlinux.org/packages/?name=pm-utils">pm-utils</a></span>
</dd></dl>
<ul><li> <b><a href="../en/Powertop.html" title="Powertop">powertop</a></b> — A tool to diagnose issues with power consumption and power management to help set power saving settings.</li></ul>
<dl><dd>
<a rel="nofollow" class="external free" href="https://01.org/powertop/">https://01.org/powertop/</a> || <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://www.archlinux.org/packages/?name=powertop">powertop</a></span>
</dd></dl>
<ul>
<li> <a href="../en/Systemd.html" title="Systemd">systemd</a>
</li>
<li> <b><a href="../en/TLP.html" title="TLP">TLP</a></b> — Advanced power management for Linux.</li>
</ul>
<dl><dd>
<a rel="nofollow" class="external free" href="http://linrunner.de/tlp">http://linrunner.de/tlp</a> || <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://www.archlinux.org/packages/?name=tlp">tlp</a></span>
</dd></dl>
<h2><span class="mw-headline" id="Power_management_with_systemd">Power management with systemd</span></h2>
<h3><span class="mw-headline" id="ACPI_events">ACPI events</span></h3>
<p><i>systemd</i> handles some power-related <a href="https://en.wikipedia.org/wiki/Advanced_Configuration_and_Power_Interface" class="extiw" title="wikipedia:Advanced Configuration and Power Interface">ACPI</a> events, whose actions can be configured in <code>/etc/systemd/logind.conf</code> or <code>/etc/systemd/logind.conf.d/*.conf</code> — see <code>man logind.conf</code>. On systems with no dedicated power manager, this may replace the <a href="../en/Acpid.html" title="Acpid">acpid</a> daemon which is usually used to react to these ACPI events.
</p>
<p>The specified action for each event can be one of <code>ignore</code>, <code>poweroff</code>, <code>reboot</code>, <code>halt</code>, <code>suspend</code>, <code>hibernate</code>, <code>hybrid-sleep</code>, <code>lock</code> or <code>kexec</code>. In case of hibernation and suspension, they must be properly <a href="../en/Power_management/Suspend_and_hibernate.html" title="Power management/Suspend and hibernate">set up</a>. If an event is not configured, <i>systemd</i> will use a default action.
</p>
<table class="wikitable sortable" border="1">
<tr>
<th>Event handler
</th>
<th>Description
</th>
<th>Default action
</th>
</tr>
<tr>
<td>
<code>HandlePowerKey</code>
</td>
<td>Triggered when the power key/button is pressed.
</td>
<td>
<code>poweroff</code>
</td>
</tr>
<tr>
<td>
<code>HandleSuspendKey</code>
</td>
<td>Triggered when the suspend key/button is pressed.
</td>
<td>
<code>suspend</code>
</td>
</tr>
<tr>
<td>
<code>HandleHibernateKey</code>
</td>
<td>Triggered when the hibernate key/button is pressed.
</td>
<td>
<code>hibernate</code>
</td>
</tr>
<tr>
<td>
<code>HandleLidSwitch</code>
</td>
<td>Triggered when the lid is closed, except in the cases below.
</td>
<td>
<code>suspend</code>
</td>
</tr>
<tr>
<td>
<code>HandleLidSwitchDocked</code>
</td>
<td>Triggered when the lid is closed if the system is inserted in a docking station, or more than one display is connected.
</td>
<td>
<code>ignore</code>
</td>
</tr>
</table>
<p>To apply any changes, <a href="../en/Systemd.html#Using_units" title="Restart" class="mw-redirect">restart</a> the <code>systemd-logind</code> daemon (be warned that this will terminate all login sessions that might still be open).
</p>
<div style="padding: 5px; margin: 0.50em 0; background-color: #DDDDFF; border: thin solid #BBBBDD; overflow: hidden;">
<strong> Note: </strong><i>systemd</i> cannot handle AC and Battery ACPI events, so if you use <a href="../en/Laptop_Mode_Tools.html" title="Laptop Mode Tools">Laptop Mode Tools</a> or other similar tools <a href="../en/Acpid.html" title="Acpid">acpid</a> is still required.</div>
<h4><span class="mw-headline" id="Power_managers">Power managers</span></h4>
<p>Some <a href="../en/Desktop_environment.html" title="Desktop environment">desktop environments</a> include power managers which <a rel="nofollow" class="external text" href="http://www.freedesktop.org/wiki/Software/systemd/inhibit/">inhibit</a> (temporarily turn off) some or all of the <i>systemd</i> ACPI settings. If such a power manager is running, then the actions for ACPI events can be configured in the power manager alone. Changes to <code>/etc/systemd/logind.conf</code> or <code>/etc/systemd/logind.conf.d/*.conf</code> need be made only if you wish to configure behaviour for a particular event that is not inhibited by the power manager. 
</p>
<p>Note that if the power manager does not inhibit <i>systemd</i> for the appropriate events you can end up with a situation where <i>systemd</i> suspends your system and then when the system is woken up the other power manager suspends it again. Currently, only the power managers of <a href="../en/KDE.html" title="KDE">KDE</a>, <a href="../en/GNOME.html" title="GNOME">GNOME</a> and <a href="../en/Xfce.html" title="Xfce">Xfce</a> issue the necessary <i>inhibited</i> commands. If the <i>inhibited</i> commands are not being issued, such as when using <a href="../en/Acpid.html" title="Acpid">acpid</a> or others to handle ACPI events, set the <code>Handle</code> options to <code>ignore</code>. See also <code>man systemd-inhibit</code>.
</p>
<h4><span class="mw-headline" id="xss-lock">xss-lock</span></h4>
<p><span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/xss-lock-git/">xss-lock-git</a></span><sup><small>AUR</small></sup> subscribes to the systemd-events <code>suspend</code>, <code>hibernate</code>, <code>lock-session</code>, and <code>unlock-session</code> with appropriate actions (run locker and wait for user to unlock or kill locker). <i>xss-lock</i> also reacts to <a href="../en/Display_Power_Management_Signaling.html" title="DPMS" class="mw-redirect">DPMS</a> events and runs or kills the locker in response.
</p>
<p>Start xss-lock in your <a href="../en/Autostarting.html" title="Autostart" class="mw-redirect">autostart</a>, for example
</p>
<pre>xss-lock -- i3lock -n -i <i>background_image.png</i> &amp;
</pre>
<h3><span class="mw-headline" id="Suspend_and_hibernate">Suspend and hibernate</span></h3>
<p><i>systemd</i> provides commands for suspend to RAM, hibernate and a hybrid suspend using the kernel's native suspend/resume functionality. There are also mechanisms to add hooks to customize pre- and post-suspend actions.
</p>
<div style="padding: 5px; margin: 0.50em 0; background-color: #DDDDFF; border: thin solid #BBBBDD; overflow: hidden;">
<strong> Note: </strong><i>systemd</i> can also use other suspend backends (such as <a href="../en/Uswsusp.html" title="Uswsusp">Uswsusp</a> or <a href="../en/TuxOnIce.html" title="TuxOnIce">TuxOnIce</a>), in addition to the default <i>kernel</i> backend, in order to put the computer to sleep or hibernate. See <a href="../en/Uswsusp.html#With_systemd" title="Uswsusp">Uswsusp#With systemd</a> for an example.</div>
<p><code>systemctl suspend</code> should work out of the box, for <code>systemctl hibernate</code> to work on your system you need to follow the instructions at <a href="../en/Power_management/Suspend_and_hibernate.html#Hibernation" title="Suspend and hibernate" class="mw-redirect">Suspend and hibernate#Hibernation</a>.
</p>
<h4><span class="mw-headline" id="Hybrid_sleep">Hybrid sleep</span></h4>
<p><code>systemctl hybrid-sleep</code> both hibernates and suspends at the same time. This combines some of the benefits and drawbacks of suspension and hibernation. This is useful in case a computer were to suddenly lose power (AC disconnection or battery depletion) since upon powerup it will resume from hibernation. If there is no power loss, then it will resume from suspension, which is much faster than resuming from hibernation. However, since "hybrid-sleep" has to dump memory to swap in order for hibernation to work, it is slower to enter sleep than a plain <code>systemctl suspend</code>. An alternative is a <a href="#Delayed_hibernation_service_file">delayed hibernation service file</a>.
</p>
<h3><span class="mw-headline" id="Sleep_hooks">Sleep hooks</span></h3>
<p><i>systemd</i> does not use <a href="../en/Pm-utils.html" title="Pm-utils">pm-utils</a> to put the machine to sleep when using <code>systemctl suspend</code>, <code>systemctl hibernate</code> or <code>systemctl hybrid-sleep</code>; <i>pm-utils</i> hooks, including any <a href="../en/Pm-utils.html#Creating_your_own_hooks" title="Pm-utils">custom hooks</a>, will not be run. However, <i>systemd</i> provides two similar mechanisms to run custom scripts on these events.
</p>
<h4><span class="mw-headline" id="Suspend.2Fresume_service_files">Suspend/resume service files</span></h4>
<p>Service files can be hooked into <i>suspend.target</i>, <i>hibernate.target</i> and <i>sleep.target</i> to execute actions before or after suspend/hibernate. Separate files should be created for user actions and root/system actions. <a href="../en/Systemd.html#Using_units" title="Enable" class="mw-redirect">Enable</a> the <code>suspend@<i>user</i></code> and <code>resume@<i>user</i></code> services to have them started at boot. Examples:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/systemd/system/suspend@.service</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">
[Unit]
Description=User suspend actions
Before=sleep.target

[Service]
User=%I
Type=simple
Environment=DISPLAY=:0
ExecStartPre= -/usr/bin/pkill -u %u unison ; /usr/local/bin/music.sh stop ; /usr/bin/mysql -e 'slave stop'
ExecStart=/usr/bin/sflock
ExecStartPost=/usr/bin/sleep 1

[Install]
WantedBy=sleep.target</pre>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/systemd/system/resume@.service</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">
[Unit]
Description=User resume actions
After=suspend.target

[Service]
User=%I
Type=simple
ExecStartPre=/usr/local/bin/ssh-connect.sh
ExecStart=/usr/bin/mysql -e 'slave start'

[Install]
WantedBy=suspend.target</pre>
<div style="padding: 5px; margin: 0.50em 0; background-color: #DDDDFF; border: thin solid #BBBBDD; overflow: hidden;">
<strong> Note: </strong>As screen lockers may return before the screen is "locked", the screen may flash on resuming from suspend. Adding a small delay via <code>ExecStartPost=/usr/bin/sleep 1</code> helps prevent this.</div>
<p>For root/system actions (<a href="../en/Systemd.html#Using_units" title="Enable" class="mw-redirect">enable</a> the <code>root-resume</code> and <code>root-suspend</code> services to have them started at boot):
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/systemd/system/root-resume.service</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">
[Unit]
Description=Local system resume actions
After=suspend.target

[Service]
Type=simple
ExecStart=/usr/bin/systemctl restart mnt-media.automount

[Install]
WantedBy=suspend.target</pre>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/systemd/system/root-suspend.service</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">
[Unit]
Description=Local system suspend actions
Before=sleep.target

[Service]
Type=simple
ExecStart=-/usr/bin/pkill sshfs

[Install]
WantedBy=sleep.target</pre>
<p>A couple of handy hints about these service files (more in <code>man systemd.service</code>):
</p>
<ul>
<li> If <code>Type=oneshot</code> then you can use multiple <code>ExecStart=</code> lines. Otherwise only one <code>ExecStart</code> line is allowed. You can add more commands with either <code>ExecStartPre</code> or by separating commands with a semicolon (see the first example above; note the spaces before and after the semicolon, as they are <i>required</i>).</li>
<li> A command prefixed with <code>-</code> will cause a non-zero exit status to be ignored and treated as a successful command. </li>
<li> The best place to find errors when troubleshooting these service files is of course with <a href="../en/Systemd.html#Journal" title="Journalctl" class="mw-redirect">journalctl</a>.</li>
</ul>
<h4><span class="mw-headline" id="Combined_Suspend.2Fresume_service_file">Combined Suspend/resume service file</span></h4>
<p>With the combined suspend/resume service file, a single hook does all the work for different phases (sleep/resume) and for different targets (suspend/hibernate/hybrid-sleep).
</p>
<p>Example and explanation:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/systemd/system/wicd-sleep.service</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">
[Unit]
Description=Wicd sleep hook
Before=sleep.target
StopWhenUnneeded=yes

[Service]
Type=oneshot
RemainAfterExit=yes
ExecStart=-/usr/share/wicd/daemon/suspend.py
ExecStop=-/usr/share/wicd/daemon/autoconnect.py

[Install]
WantedBy=sleep.target</pre>
<ul>
<li> <code>RemainAfterExit=yes</code>: After started, the service is considered active until it is explicitly stopped.</li>
<li> <code>StopWhenUnneeded=yes</code>: When active, the service will be stopped if no other active service requires it. In this specific example, it will be stopped after <i>sleep.target</i> is stopped.</li>
<li> Because <i>sleep.target</i> is pulled in by <i>suspend.target</i>, <i>hibernate.target</i> and <i>hybrid-sleep.target</i> and because <i>sleep.target</i> itself is a <i>StopWhenUnneeded</i> service, the hook is guaranteed to start/stop properly for different tasks.</li>
</ul>
<h4><span class="mw-headline" id="Delayed_hibernation_service_file">Delayed hibernation service file</span></h4>
<p>An alternative approach is delayed hibernation. This makes use of sleep hooks to suspend as usual but sets a timer to wake up later to perform hibernation. Here, entering sleep is faster than <code>systemctl hybrid-sleep</code> since no hibernation is performed initially. However, unlike "hybrid-sleep", at this point there is no protection against power loss via hibernation while in suspension. This caveat makes this approach more suitable for laptops than desktops. Since hibernation is delayed, the laptop battery is only used during suspension and to trigger the eventual hibernation. This uses less power over the long-term than a "hybrid-sleep" which will remain suspended until the battery is drained. Note that if your laptop has a spinning hard disk, when it wakes up from suspend in order to hibernate, you may not want to be moving or carrying the laptop for these few seconds. Delayed hibernation may be desirable both to reduce power use as well as for security reasons (e.g. when using full disk encryption). An example script is located <a rel="nofollow" class="external text" href="http://superuser.com/questions/298672/linuxhow-to-hibernate-after-a-period-of-sleep">here</a>. See also <a rel="nofollow" class="external text" href="https://bbs.archlinux.org/viewtopic.php?pid=1420279#p1420279">this post</a> for an updated systemd sleep hook. 
</p>
<p>A slightly updated version of the service is:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/systemd/system/suspend-to-hibernate.service</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">
[Unit]
Description=Delayed hibernation trigger
Documentation=https://bbs.archlinux.org/viewtopic.php?pid=1420279#p1420279
Documentation=https://wiki.archlinux.org/index.php/Power_management
Before=suspend.target
Conflicts=hibernate.target hybrid-suspend.target
StopWhenUnneeded=true

[Service]
Type=oneshot
RemainAfterExit=yes
Environment="WAKEALARM=/sys/class/rtc/rtc0/wakealarm"
Environment="SLEEPLENGTH=+2hour"
ExecStart=-/usr/bin/sh -c 'echo -n "alarm set for "; date +%%s -d$SLEEPLENGTH | tee $WAKEALARM'
ExecStop=-/usr/bin/sh -c '\
  alarm=$(cat $WAKEALARM); \
  now=$(date +%%s); \
  if [ -z "$alarm" ] || [ "$now" -ge "$alarm" ]; then \
     echo "hibernate triggered"; \
     systemctl hibernate; \
  else \
     echo "normal wakeup"; \
  fi; \
  echo 0 &gt; $WAKEALARM; \
'

[Install]
WantedBy=sleep.target

</pre>
<p>The <code>Before</code> and <code>Conflicts</code> options ensure it only is run for suspension and not hibernation--otherwise the service will run twice if delayed hibernation is triggered. The <code>WantedBy</code> and <code>StopWhenUnneeded</code> options are so it is started before sleep and stops upon resume. (Note that the <code>suspend.target</code> and <code>hibernate.target</code> targets do not stop when unneeded, but <code>sleep.target</code> does). <a href="../en/Systemd.html#Using_units" title="Enable" class="mw-redirect">Enable</a> the service.
</p>
<div style="padding: 5px; margin: 0.50em 0; background-color: #DDDDFF; border: thin solid #BBBBDD; overflow: hidden;">
<strong> Note: </strong>See <a rel="nofollow" class="external text" href="https://bbs.archlinux.org/viewtopic.php?id=204346">suspend-to-hibernate broken since systemd-update</a> if you encounter problems with hibernating after an RTC wake up.</div>
<h4><span class="mw-headline" id="Hooks_in_.2Fusr.2Flib.2Fsystemd.2Fsystem-sleep">Hooks in /usr/lib/systemd/system-sleep</span></h4>
<p><i>systemd</i> runs all executables in <code>/usr/lib/systemd/system-sleep/</code>, passing two arguments to each of them:
</p>
<ul>
<li> Argument 1: either <code>pre</code> or <code>post</code>, depending on whether the machine is going to sleep or waking up</li>
<li> Argument 2: <code>suspend</code>, <code>hibernate</code> or <code>hybrid-sleep</code>, depending on which is being invoked</li>
</ul>
<p>In contrast to <a href="../en/Pm-utils.html" title="Pm-utils">pm-utils</a>, <i>systemd</i> will run these scripts concurrently and not one after another.
</p>
<p>The output of any custom script will be logged by <i>systemd-suspend.service</i>, <i>systemd-hibernate.service</i> or <i>systemd-hybrid-sleep.service</i>. You can see its output in <i>systemd</i>'s <a href="../en/Systemd.html#Journal" title="Systemd">journal</a>:
</p>
<pre># journalctl -b -u systemd-suspend
</pre>
<div style="padding: 5px; margin: 0.50em 0; background-color: #DDDDFF; border: thin solid #BBBBDD; overflow: hidden;">
<strong> Note: </strong>You can also use <i>sleep.target</i>, <i>suspend.target</i>, <i>hibernate.target</i> or <i>hybrid-sleep.target</i> to hook units into the sleep state logic instead of using custom scripts.</div>
<p>An example of a custom sleep script:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/usr/lib/systemd/system-sleep/example.sh</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">
#!/bin/sh
case $1/$2 in
  pre/*)
    echo "Going to $2..."
    ;;
  post/*)
    echo "Waking up from $2..."
    ;;
esac</pre>
<p>Do not forget to make your script executable:
</p>
<pre># chmod a+x /usr/lib/systemd/system-sleep/example.sh
</pre>
<p>See <code>man 7 systemd.special</code> and <code>man 8 systemd-sleep</code> for more details.
</p>
<h3><span class="mw-headline" id="Troubleshooting">Troubleshooting</span></h3>
<h4><span class="mw-headline" id="Delayed_lid_switch_action">Delayed lid switch action</span></h4>
<p>When performing lid switches in short succession, <i>logind</i> will delay the suspend action for up to 90s to detect possible docks. <a rel="nofollow" class="external autonumber" href="http://lists.freedesktop.org/archives/systemd-devel/2015-January/027131.html">[1]</a> This delay was made configurable with systemd v220:<a rel="nofollow" class="external autonumber" href="https://github.com/systemd/systemd/commit/9d10cbee89ca7f82d29b9cb27bef11e23e3803ba">[2]</a>
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/systemd/logind.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">
...
HoldoffTimeoutSec=30s
...
</pre>
<h4><span class="mw-headline" id="Suspend_from_corresponding_laptop_Fn_key_not_working">Suspend from corresponding laptop Fn key not working</span></h4>
<p>If, regardless of the setting in logind.conf, the sleep button does not work (pressing it does not even produce a message in syslog), then logind is probably not watching the keyboard device. <a rel="nofollow" class="external autonumber" href="http://lists.freedesktop.org/archives/systemd-devel/2015-February/028325.html">[3]</a> Do:
</p>
<pre># journalctl | grep "Watching system buttons"
</pre>
<p>You might see something like this:
</p>
<pre>May 25 21:28:19 vmarch.lan systemd-logind[210]: Watching system buttons on /dev/input/event2 (Power Button)
May 25 21:28:19 vmarch.lan systemd-logind[210]: Watching system buttons on /dev/input/event3 (Sleep Button)
May 25 21:28:19 vmarch.lan systemd-logind[210]: Watching system buttons on /dev/input/event4 (Video Bus)
</pre>
<p>Notice no keyboard device. Now obtain ATTRS{name} for the parent keyboard device <a rel="nofollow" class="external autonumber" href="http://systemd-devel.freedesktop.narkive.com/Rbi3rjNN/patch-1-2-logind-add-support-for-tps65217-power-button">[4]</a> :
</p>
<pre># udevadm info -a /dev/input/by-path/*-kbd
...
KERNEL=="event0"
...
ATTRS{name}=="AT Translated Set 2 keyboard"
</pre>
<p>Now write a custom udev rule to add the "power-switch" tag:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/udev/rules.d/70-power-switch-my.rules</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">
ACTION=="remove", GOTO="power_switch_my_end"
SUBSYSTEM=="input", KERNEL=="event*", ATTRS{name}=="AT Translated Set 2 keyboard", TAG+="power-switch"
LABEL="power_switch_my_end"
</pre>
<p>Restart services and reload rules:
</p>
<pre># systemctl restart systemd-udevd
# udevadm trigger
# systemctl restart systemd-logind
</pre>
<p>Now you should see "Watching system buttons on /dev/input/event0" in syslog
</p>
<h2><span class="mw-headline" id="Power_saving">Power saving</span></h2>
<div style="padding: 5px; margin: 0.50em 0; background-color: #DDDDFF; border: thin solid #BBBBDD; overflow: hidden;">
<strong> Note: </strong>See <a href="../en/Laptop.html#Power_management" title="Laptop">Laptop#Power management</a> for power management specific to laptops, such as battery monitoring.</div>
<p>This section is a reference for creating custom scripts and power saving settings such as by udev rules. Make sure that the settings are not managed by some <a href="#Userspace_tools">other utility</a> to avoid conflicts.
</p>
<p>Almost all of the features listed here are worth using whether or not the computer is on AC or battery power. Most have negligible performance impact and are just not enabled by default because of commonly broken hardware/drivers. Reducing power usage means reducing heat, which can even lead to higher performance on a modern Intel or AMD CPU, thanks to <a href="https://en.wikipedia.org/wiki/Intel_Turbo_Boost" class="extiw" title="wikipedia:Intel Turbo Boost">dynamic overclocking</a>.
</p>
<h3><span class="mw-headline" id="Audio">Audio</span></h3>
<p>By default, audio power saving is turned off by most drivers. It can be enabled by setting the <code>power_save</code> parameter; a time (in seconds) to go into idle mode. To idle the audio card after one second, create the following file for Intel soundcards.
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/modprobe.d/audio_powersave.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">options snd_hda_intel power_save=1</pre>
<p>Alternatively, use the following for ac97:
</p>
<pre>options snd_ac97_codec power_save=1
</pre>
<div style="padding: 5px; margin: 0.50em 0; background-color: #DDDDFF; border: thin solid #BBBBDD; overflow: hidden;">
<strong> Note: </strong>
<ul>
<li> To retrieve the manufacturer and the corresponding kernel driver which is used for your sound card, run <code>lspci -k</code>.</li>
<li> Toggling the audio card's power state can cause a popping sound or noticeable latency on some broken hardware.</li>
</ul>
</div>
<p>It is also possible to further reduce the audio power requirements by disabling the HDMI audio output, which can done by <a href="../en/Kernel_modules.html#Blacklisting" title="Blacklisting" class="mw-redirect">blacklisting</a> the appropriate kernel modules (e.g. <code>snd_hda_codec_hdmi</code> in case of Intel hardware).
</p>
<h3><span class="mw-headline" id="Backlight">Backlight</span></h3>
<p>See <a href="../en/Backlight.html" title="Backlight">Backlight</a>.
</p>
<h3><span class="mw-headline" id="Bluetooth">Bluetooth</span></h3>
<div class="noprint archwiki-template-message">
<p><a href="../File:Tango-view-fullscreen.png" class="image"><img alt="Tango-view-fullscreen.png" src="../File:Tango-view-fullscreen.png" width="48" height="48"></a><b>This article or section needs expansion.</b><a href="../File:Tango-view-fullscreen.png" class="image"><img alt="Tango-view-fullscreen.png" src="../File:Tango-view-fullscreen.png" width="48" height="48"></a></p>
<div>
<b>Reason:</b> The device should likely be disabled with hciconfig first. (Discuss in <a rel="nofollow" class="external text" href="https://wiki.archlinux.org/index.php/Talk:Power_management">Talk:Power management#</a>)</div>
</div>
<p>To disable bluetooth completely, <a href="../en/Kernel_modules.html#Blacklisting" title="Blacklist" class="mw-redirect">blacklist</a> the <code>btusb</code> and <code>bluetooth</code> modules.
</p>
<p>To turn off bluetooth only temporarily, use <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://www.archlinux.org/packages/?name=rfkill">rfkill</a></span>:
</p>
<pre># rfkill block bluetooth
</pre>
<p>Or with udev rule:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/udev/rules.d/50-bluetooth.rules</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">
# disable bluetooth
SUBSYSTEM=="rfkill", ATTR{type}=="bluetooth", ATTR{state}="0"
</pre>
<p>Or just <a href="../en/Systemd.html#Using_units" title="Enable" class="mw-redirect">enable</a> the instantiated <code>rfkill-block@bluetooth.service</code> provided by the <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://www.archlinux.org/packages/?name=rfkill">rfkill</a></span> package.
</p>
<h3><span class="mw-headline" id="Web_camera">Web camera</span></h3>
<p>If you will not use integrated web camera then <a href="../en/Kernel_modules.html#Blacklisting" title="Blacklist" class="mw-redirect">blacklist</a> the <code>uvcvideo</code> module.
</p>
<h3><span class="mw-headline" id="Kernel_parameters">Kernel parameters</span></h3>
<p>This section uses configs in <code>/etc/sysctl.d/</code>, which is <i>"a drop-in directory for kernel sysctl parameters."</i>  See <a rel="nofollow" class="external text" href="http://0pointer.de/blog/projects/the-new-configuration-files">The New Configuration Files</a> and more specifically <a rel="nofollow" class="external text" href="http://0pointer.de/public/systemd-man/sysctl.d.html">systemd's sysctl.d man page</a> for more information.
</p>
<h4><span class="mw-headline" id="Disabling_NMI_watchdog">Disabling NMI watchdog</span></h4>
<p>The <a href="https://en.wikipedia.org/wiki/Non-maskable_interrupt" class="extiw" title="wikipedia:Non-maskable interrupt">NMI</a> watchdog is a debugging feature to catch hardware hangs that cause a kernel panic. On some systems it can generate a lot of interrupts, causing a noticeable increase in power usage:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/sysctl.d/disable_watchdog.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">kernel.nmi_watchdog = 0</pre>
<p>or add <code>nmi_watchdog=0</code> to the <a href="../en/Kernel_parameters.html" title="Kernel line" class="mw-redirect">kernel line</a> to disable it completely from early boot.
</p>
<h4><span class="mw-headline" id="Writeback_Time">Writeback Time</span></h4>
<p>Increasing the virtual memory dirty writeback time helps to aggregate disk I/O together, thus reducing spanned disk writes, and increasing power saving. To set the value to 60 seconds (default is 5 seconds):
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/sysctl.d/dirty.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">vm.dirty_writeback_centisecs = 6000</pre>
<p>To do the same for journal commits on supported filesystems (e.g. ext4, btrfs...), use <code>commit=60</code> as a option in <a href="../en/Fstab.html" title="Fstab">fstab</a>.
</p>
<p>See also <a href="../en/Sysctl.html#Virtual_memory" title="Sysctl">sysctl#Virtual memory</a> for other parameters affecting I/O performance and power saving.
</p>
<h4><span class="mw-headline" id="Laptop_Mode">Laptop Mode</span></h4>
<p>See the <a rel="nofollow" class="external text" href="https://www.kernel.org/doc/Documentation/laptops/laptop-mode.txt">kernel documentation</a> on the laptop mode 'knob.' <i>"A sensible value for the knob is 5 seconds."</i>
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/sysctl.d/laptop.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">vm.laptop_mode = 5</pre>
<h3><span class="mw-headline" id="Network_interfaces">Network interfaces</span></h3>
<p><a href="https://en.wikipedia.org/wiki/Wake-on-LAN" class="extiw" title="wikipedia:Wake-on-LAN">Wake-on-LAN</a> can be a useful feature, but if you are not making use of it then it is simply draining extra power waiting for a magic packet while in suspend. Disabling for all Ethernet interfaces:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/udev/rules.d/70-disable_wol.rules</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">ACTION=="add", SUBSYSTEM=="net", KERNEL=="eth*", RUN+="/usr/bin/ethtool -s %k wol d"</pre>
<p>To enable powersaving on all wireless interfaces:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/udev/rules.d/70-wifi-powersave.rules</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">ACTION=="add", SUBSYSTEM=="net", KERNEL=="wlan*", RUN+="/usr/bin/iw dev %k set power_save on"</pre>
<p>In these examples, <code>%k</code> is a specifier for the kernel name of the matched device.  For example, if it finds that the rule is applicable to <code>wlan0</code>, the <code>%k</code> specifier will be replaced with <code>wlan0</code>. To apply the rules to only a particular interface, just replace the pattern <code>eth*</code> and specifier <code>%k</code> with the desired interface name. For more information, see <a rel="nofollow" class="external text" href="http://www.reactivated.net/writing_udev_rules.html">Writing udev rules</a>.
</p>
<div style="padding: 5px; margin: 0.50em 0; background-color: #DDDDFF; border: thin solid #BBBBDD; overflow: hidden;">
<strong> Note: </strong>In this case, the name of the configuration file is important. Due to the introduction of <a href="../en/Network_configuration.html#Device_names" title="Network configuration">persistent device names</a> via <code>80-net-setup-link.rules</code> in systemd, it is important that the network powersave rules are named lexicographically before <code>80-net-setup-link.rules</code> so that they are applied before the devices are named e.g. <code>enp2s0</code>.
However, be advised that commands ran with <code>RUN</code> are executed <b>after</b> all rules have been processed -- in which case the naming of the rules file is irrelevant and the persistent device names should be used (the persistent device name can be referenced by replacing <code>%k</code> with <code>$name</code>).</div>
<h4><span class="mw-headline" id="Intel_wireless_cards_.28iwlwifi.29">Intel wireless cards (iwlwifi)</span></h4>
<p>Additional power saving functions of Intel wireless cards with <code>iwlwifi</code> driver can be enabled by passing the correct parameters to the kernel module. Making it persistent can be achieved by adding the line below to <code>/etc/modprobe.d/iwlwifi.conf</code> file:
</p>
<pre> options iwlwifi power_save=1 d0i3_disable=0 uapsd_disable=0
</pre>
<p>And another one to the <code>/etc/modprobe.d/iwldvm.conf</code> file:
</p>
<pre> options iwldvm force_cam=0
</pre>
<p>Keep in mind that these power saving options are experimental and can cause an unstable system.
</p>
<h3><span class="mw-headline" id="Bus_power_management">Bus power management</span></h3>
<h4><span class="mw-headline" id="Active_State_Power_Management">Active State Power Management</span></h4>
<p>If the computer is believed not to support <a href="https://en.wikipedia.org/wiki/Active_State_Power_Management" class="extiw" title="wikipedia:Active State Power Management">ASPM</a> it and will be disabled on boot:
</p>
<pre># lspci -vv | grep ASPM.*abled\;
</pre>
<p>ASPM is handled by the BIOS, if ASPM is disabled it will be because <a rel="nofollow" class="external text" href="http://wireless.kernel.org/en/users/Documentation/ASPM">ref</a>:
</p>
<ol>
<li> The BIOS disabled it for some reason (for conflicts?).</li>
<li> PCIE requires ASPM but L0s are optional (so L0s might be disabled and only L1 enabled).</li>
<li> The BIOS might not have been programmed for it.</li>
<li> The BIOS is buggy.</li>
</ol>
<p>If believing the computer has support for ASPM it can be forced on for the kernel to handle with the <code>pcie_aspm=force</code> <a href="../en/Kernel_parameters.html" title="Kernel parameter" class="mw-redirect">kernel parameter</a>.
</p>
<div style="padding: 5px; margin: 0.50em 0; background-color: #FFDDDD; border: thin solid #DDBBBB; overflow: hidden;">
<strong> Warning: </strong>
<ul>
<li> Forcing on ASPM can cause a freeze/panic, so make sure you have a way to undo the option if it does not work.</li>
<li> On systems that do not support it forcing on ASPM can even increase power consumption.</li>
<li> This forces ASPM in kernel while it can still remain disabled in hardware and not work. To check whether this is the case the <code>dmesg | grep ASPM</code> command can be used and if that is the case, hardware-specific Wiki article should be consulted.</li>
</ul>
</div>
<p>To adjust to <code>powersave</code> do (the following command will not work unless enabled):
</p>
<pre>echo powersave | tee /sys/module/pcie_aspm/parameters/policy
</pre>
<p>By default it looks like this:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">$ cat /sys/module/pcie_aspm/parameters/policy</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[default] performance powersave</pre>
<h4><span class="mw-headline" id="PCI_Runtime_Power_Management">PCI Runtime Power Management</span></h4>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/udev/rules.d/pci_pm.rules</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">ACTION=="add", SUBSYSTEM=="pci", ATTR{power/control}="auto"</pre>
<h4><span class="mw-headline" id="USB_autosuspend">USB autosuspend</span></h4>
<p>The linux kernel can automatically suspend USB devices when they are not in use. This can sometimes save quite a bit of power, however some USB devices are not compatible with USB power saving and start to misbehave (common for USB mice/keyboards). <a href="../en/Udev.html" title="Udev">udev</a> rules based on whitelist or blacklist filtering can help to mitigate the problem.
</p>
<p>The most simple and likely useless example is enabling autosuspend for all USB devices:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/udev/rules.d/50-usb_power_save.rules</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">
ACTION=="add", SUBSYSTEM=="usb", TEST=="power/control", ATTR{power/control}="auto"
</pre>
<p>To allow autosuspend only for devices that are known to work, use simple matching against vendor and product IDs (use <i>lsusb</i> to get these values):
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/udev/rules.d/50-usb_power_save.rules</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">
# whitelist for usb autosuspend
ACTION=="add", SUBSYSTEM=="usb", TEST=="power/control", ATTR{idVendor}=="05c6", ATTR{idProduct}=="9205", ATTR{power/control}="auto"
</pre>
<p>Alternatively, to blacklist devices that are not working with USB autosuspend and enable it for all other devices:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/udev/rules.d/50-usb_power_save.rules</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">
# blacklist for usb autosuspend
ACTION=="add", SUBSYSTEM=="usb", ATTR{idVendor}=="05c6", ATTR{idProduct}=="9205", GOTO="power_usb_rules_end"

ACTION=="add", SUBSYSTEM=="usb", TEST=="power/control", ATTR{power/control}="auto"
LABEL="power_usb_rules_end"
</pre>
<p>The default autosuspend idle delay time is controlled by the <code>autosuspend</code> parameter of the <code>usbcore</code> <a href="../en/Kernel_modules.html" title="Kernel module" class="mw-redirect">kernel module</a>. To set the delay to 5 seconds instead of the default 2 seconds:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/modprobe.d/usb-autosuspend.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">
options usbcore autosuspend=5
</pre>
<p>Similarly to <code>power/control</code>, the delay time can be fine-tuned per device by setting the <code>power/autosuspend</code> attribute.
</p>
<p>See the <a rel="nofollow" class="external text" href="https://www.kernel.org/doc/Documentation/usb/power-management.txt">Linux kernel documentation</a> for more information on USB power management.
</p>
<h4><span class="mw-headline" id="SATA_Active_Link_Power_Management">SATA Active Link Power Management</span></h4>
<div style="padding: 5px; margin: 0.50em 0; background-color: #DDDDFF; border: thin solid #BBBBDD; overflow: hidden;">
<strong> Note: </strong>This adds latency when accessing a drive that has been idle, so it is one of the few settings that may be worth toggling based on whether you are on AC power.</div>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/udev/rules.d/hd_power_save.rules</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">ACTION=="add", SUBSYSTEM=="scsi_host", KERNEL=="host*", ATTR{link_power_management_policy}="min_power"</pre>
<div style="padding: 5px; margin: 0.50em 0; background-color: #FFDDDD; border: thin solid #DDBBBB; overflow: hidden;">
<strong> Warning: </strong>SATA Active Link Power Management can lead to data loss on some devices (e.g. Lenovo T440s <a rel="nofollow" class="external text" href="http://lkml.indiana.edu/hypermail/linux/kernel/1401.2/02171.html">is known to suffer</a> this problem. Issue is still verified to occur on Linux kernel version 4.5.1. Do not enable this setting unless you have frequent backups.)</div>
<h3><span class="mw-headline" id="Hard_disk_drive">Hard disk drive</span></h3>
<p>See <a href="../en/Hdparm.html#Power_management_configuration" title="Hdparm">hdparm#Power management configuration</a> for drive parameters that can be set.
</p>
<p>Power saving is not effective when too many programs are frequently writing to the disk. Tracking all programs, and how and when they write to disk is the way to limit disk usage. Use <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://www.archlinux.org/packages/?name=iotop">iotop</a></span> to see which programs use the disk frequently. See <a href="../en/Improving_performance.html#Storage_devices" title="Improving performance">Improving performance#Storage devices</a> for other tips.
</p>
<p>Also little things like setting the <a href="../en/Fstab.html#atime_options" title="Fstab">noatime</a> option can help. If enough RAM is available, consider disabling or limiting <a href="../en/Swap.html#Swappiness" title="Swappiness" class="mw-redirect">swappiness</a> as it has the possibility to limit a good number of disk writes.
</p>
<h3><span class="mw-headline" id="CD-ROM_or_DVD_drive">CD-ROM or DVD drive</span></h3>
<p>See <a href="../en/Udisks.html#Devices_do_not_remain_unmounted_.28udisks.29" title="Udisks">Udisks#Devices do not remain unmounted (udisks)</a>.
</p>
<h2><span class="mw-headline" id="Tools_and_scripts">Tools and scripts</span></h2>
<div class="noprint archwiki-template-message">
<p><a href="../File:Tango-edit-clear.png" class="image"><img alt="Tango-edit-clear.png" src="../File:Tango-edit-clear.png" width="48" height="48"></a><b>This article or section needs language, wiki syntax or style improvements.</b><a href="../File:Tango-edit-clear.png" class="image"><img alt="Tango-edit-clear.png" src="../File:Tango-edit-clear.png" width="48" height="48"></a></p>
<div>
<b>Reason:</b> Merged from <a href="../en/Power_management.html" title="Power saving" class="mw-redirect">Power saving</a>, needs reorganization to fit into this page. (Discuss in <a rel="nofollow" class="external text" href="https://wiki.archlinux.org/index.php/Talk:Power_management">Talk:Power management#</a>)</div>
</div>
<h3><span class="mw-headline" id="Using_a_script_and_an_udev_rule">Using a script and an udev rule</span></h3>
<p>Since systemd users can suspend and hibernate through <code>systemctl suspend</code> or <code>systemctl hibernate</code> and handle acpi events with <code>/etc/systemd/logind.conf</code>, it might be interesting to remove <a href="../en/Pm-utils.html" title="Pm-utils">pm-utils</a> and <a href="../en/Acpid.html" title="Acpid">acpid</a>. There is just one thing systemd cannot do (as of systemd-204): power management depending on whether the system is running on AC or battery. To fill this gap, you can create a single <a href="../en/Udev.html" title="Udev">udev</a> rule that runs a script when the AC adapter is plugged and unplugged:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/udev/rules.d/powersave.rules</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">
SUBSYSTEM=="power_supply", ATTR{online}=="0", RUN+="/path/to/your/script true"
SUBSYSTEM=="power_supply", ATTR{online}=="1", RUN+="/path/to/your/script false"
</pre>
<div style="padding: 5px; margin: 0.50em 0; background-color: #DDDDFF; border: thin solid #BBBBDD; overflow: hidden;">
<strong> Note: </strong>You can use the same script that <i>pm-powersave</i> uses. You just have to make it executable and place it somewhere else (for example <code>/usr/local/bin/</code>).</div>
<p>Examples of powersave scripts:
</p>
<ul>
<li> <a rel="nofollow" class="external text" href="https://github.com/supplantr/ftw">ftw</a>, package: <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/ftw-git/">ftw-git</a></span><sup><small>AUR</small></sup><sup>[<a href="../en/ArchWiki:Requests.html#Broken_package_links" title="ArchWiki:Requests">broken link</a>: archived in <a rel="nofollow" class="external text" href="https://github.com/felixonmars/aur3-mirror/tree/master/ftw-git">aur-mirror</a>]</sup>
</li>
<li> <a rel="nofollow" class="external text" href="https://github.com/Unia/powersave">powersave</a>
</li>
</ul>
<p>The above udev rule should work as expected, but if your power settings are not updated after a suspend or hibernate cycle, you should add a script in <code>/usr/lib/systemd/system-sleep/</code> with the following contents:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/usr/lib/systemd/system-sleep/00powersave</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">
#!/bin/sh

case $1 in
    pre) /path/to/your/script false ;;
    post)       
	if cat /sys/class/power_supply/AC0/online | grep 0 &gt; /dev/null 2&gt;&amp;1
	then
    		/path/to/your/script true	
	else
    		/path/to/your/script false
	fi
    ;;
esac
exit 0
</pre>
<p>Do not forget to make it executable!
</p>
<div style="padding: 5px; margin: 0.50em 0; background-color: #DDDDFF; border: thin solid #BBBBDD; overflow: hidden;">
<strong> Note: </strong>Be aware that AC0 may be different for your laptop, change it if that is the case.</div>
<p>Now you do not need pm-utils anymore. Depending on your configuration, it may be a dependency of some other package. If you wish to remove it anyway, run <code>pacman -Rdd pm-utils</code>.
</p>
<h3><span class="mw-headline" id="Print_power_settings">Print power settings</span></h3>
<p>This script prints power settings and a variety of other properties for USB and PCI devices.  Note that root permissions are needed to see all settings.
</p>
<pre>
#!/bin/bash

for i in $(find /sys/devices -name "bMaxPower")
do
	busdir=${i%/*}
	busnum=$(&lt;$busdir/busnum)
	devnum=$(&lt;$busdir/devnum)
	title=$(lsusb -s $busnum:$devnum)

	printf "\n\n+++ %s\n  -%s\n" "$title" "$busdir"

	for ff in $(find $busdir/power -type f ! -empty 2&gt;/dev/null)
	do
		v=$(cat $ff 2&gt;/dev/null|tr -d "\n")
		[[ ${#v} -gt 0 ]] &amp;&amp; echo -e " ${ff##*/}=$v";
		v=;
	done | sort -g;
done;

printf "\n\n\n+++ %s\n" "Kernel Modules"
for mod in $(lspci -k | sed -n '/in use:/s,^.*: ,,p' | sort -u)
do
	echo "+ $mod";
	systool -v -m $mod 2&gt; /dev/null | sed -n "/Parameters:/,/^$/p";
done
</pre>
<h2><span class="mw-headline" id="See_also">See also</span></h2>
<ul>
<li> <a rel="nofollow" class="external text" href="http://www.thinkwiki.org/wiki/How_to_reduce_power_consumption">ThinkWiki:How to reduce power consumption</a>
</li>
<li> <a rel="nofollow" class="external text" href="https://wiki.ubuntu.com/Kernel/PowerManagement/PowerSavingTweaks">Ubuntu Wiki's Power Saving Tweaks</a>
</li>
<li> <a rel="nofollow" class="external text" href="http://ivanvojtko.blogspot.sk/2016/04/how-to-get-longer-battery-life-on-linux.html">How to get longer battery life on Linux</a>
</li>
</ul>

</div>
<div id="catlinks" class="catlinks">
<div id="mw-normal-catlinks" class="mw-normal-catlinks">
<a href="../Special:Categories.html" title="Special:Categories">Category</a>: <ul><li><a href="../en/Category:Power_management.html" title="Category:Power management">Power management</a></li></ul>
</div>
<div id="mw-hidden-catlinks" class="mw-hidden-catlinks mw-hidden-cats-hidden">Hidden categories: <ul>
<li><a href="../en/Category:Pages_or_sections_flagged_with_Template:Expansion.html" title="Category:Pages or sections flagged with Template:Expansion">Pages or sections flagged with Template:Expansion</a></li>
<li><a href="../en/Category:Pages_or_sections_flagged_with_Template:Style.html" title="Category:Pages or sections flagged with Template:Style">Pages or sections flagged with Template:Style</a></li>
<li><a href="../en/Category:Pages_with_broken_package_links.html" title="Category:Pages with broken package links">Pages with broken package links</a></li>
</ul>
</div>
</div>					<div class="visualClear"></div>
				</div>
			</div>
		</div>
		<div class="visualClear"></div>
					<div id="footer" role="contentinfo">
Extracted from <a href="https://wiki.archlinux.org"> ArchWiki </a> and licensed under <a href="http://www.gnu.org/copyleft/fdl.html"> GDL >= 1.3</a>
		</div>
		</div>
		</body>
</html>
