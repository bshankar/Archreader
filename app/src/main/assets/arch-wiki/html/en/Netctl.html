<!DOCTYPE html>
<html lang="en" dir="ltr" class="client-nojs">
<head>
<meta charset="UTF-8">
<title>netctl - ArchWiki</title>
<link rel="stylesheet" href="../ArchWikiOffline.css">
<meta name="ResourceLoaderDynamicStyles" content="">
<style></style>
<meta name="generator" content="MediaWiki 1.26.4">
<meta name="robots" content="noindex,follow">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="search" type="application/opensearchdescription+xml" href="/opensearch_desc.php" title="ArchWiki (en)">
<link rel="EditURI" type="application/rsd+xml" href="https://wiki.archlinux.org/api.php?action=rsd">
<link rel="copyright" href="http://www.gnu.org/copyleft/fdl.html">
<link rel="alternate" type="application/atom+xml" title="ArchWiki Atom feed" href="/index.php?title=Special:RecentChanges&amp;feed=atom">
</head>
<body class="mediawiki ltr sitedir-ltr ns-0 ns-subject page-Netctl skin-archlinux action-view">

		<div id="globalWrapper" style="width: 100%">
		<div id="column-content">
			<div id="content" class="mw-body" role="main" style="margin: 0.5em; margin-bottom:0; margin-top:0">
				<a id="top"></a>
				
				<div class="mw-indicators">
</div>
				<h1 id="firstHeading" class="firstHeading" lang="en">netctl</h1>
				
				<div id="bodyContent" class="mw-body-content">
					<div id="contentSub"></div>
										<div id="mw-content-text" lang="en" dir="ltr" class="mw-content-ltr">
<p><span></span>
</p>
<div style="width:45%; margin: 0 0 0.5em 0.5em;">
<p style="background:#333; color:white; padding:0.2em; border-bottom:5px #08c solid; margin:0; text-align:center; font-weight:bold;">Related articles</p>
<ul style="list-style-type:none; margin:0; padding:0.3em;">
<li style="padding:0.4em 0; line-height:1;"><a href="../en/Bridge_with_netctl.html" title="Bridge with netctl">Bridge with netctl</a></li>
<li style="padding:0.4em 0; line-height:1;"><a href="../en/Network_configuration.html" title="Network configuration">Network configuration</a></li>
<li style="padding:0.4em 0; line-height:1;"><a href="../en/Wireless_network_configuration.html" title="Wireless network configuration">Wireless network configuration</a></li>
<li style="padding:0.4em 0; line-height:1;"><a href="../en/Category:Network_configuration.html" title="Category:Network configuration">Category:Network configuration</a></li>
</ul>
</div>
<p><a rel="nofollow" class="external text" href="https://projects.archlinux.org/netctl.git/">netctl</a> is a CLI-based tool used to configure and manage network connections via profiles.
</p>
<div id="toc" class="toc">
<div id="toctitle"><h2>Contents</h2></div>
<ul>
<li class="toclevel-1 tocsection-1"><a href="#Installation"><span class="tocnumber">1</span> <span class="toctext">Installation</span></a></li>
<li class="toclevel-1 tocsection-2"><a href="#Usage"><span class="tocnumber">2</span> <span class="toctext">Usage</span></a></li>
<li class="toclevel-1 tocsection-3">
<a href="#Configuration"><span class="tocnumber">3</span> <span class="toctext">Configuration</span></a>
<ul>
<li class="toclevel-2 tocsection-4"><a href="#Profile_configuration"><span class="tocnumber">3.1</span> <span class="toctext">Profile configuration</span></a></li>
<li class="toclevel-2 tocsection-5">
<a href="#Automatic_operation"><span class="tocnumber">3.2</span> <span class="toctext">Automatic operation</span></a>
<ul>
<li class="toclevel-3 tocsection-6"><a href="#Basic_method"><span class="tocnumber">3.2.1</span> <span class="toctext">Basic method</span></a></li>
<li class="toclevel-3 tocsection-7"><a href="#Automatic_switching_of_profiles"><span class="tocnumber">3.2.2</span> <span class="toctext">Automatic switching of profiles</span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-8">
<a href="#Example_profiles"><span class="tocnumber">3.3</span> <span class="toctext">Example profiles</span></a>
<ul>
<li class="toclevel-3 tocsection-9"><a href="#Wired"><span class="tocnumber">3.3.1</span> <span class="toctext">Wired</span></a></li>
<li class="toclevel-3 tocsection-10"><a href="#Wireless_.28WPA-PSK.29"><span class="tocnumber">3.3.2</span> <span class="toctext">Wireless (WPA-PSK)</span></a></li>
</ul>
</li>
</ul>
</li>
<li class="toclevel-1 tocsection-11">
<a href="#Tips_and_tricks"><span class="tocnumber">4</span> <span class="toctext">Tips and tricks</span></a>
<ul>
<li class="toclevel-2 tocsection-12"><a href="#Using_an_Experimental_GUI"><span class="tocnumber">4.1</span> <span class="toctext">Using an Experimental GUI</span></a></li>
<li class="toclevel-2 tocsection-13"><a href="#Eduroam"><span class="tocnumber">4.2</span> <span class="toctext">Eduroam</span></a></li>
<li class="toclevel-2 tocsection-14">
<a href="#Bonding"><span class="tocnumber">4.3</span> <span class="toctext">Bonding</span></a>
<ul>
<li class="toclevel-3 tocsection-15"><a href="#Load_balancing"><span class="tocnumber">4.3.1</span> <span class="toctext">Load balancing</span></a></li>
<li class="toclevel-3 tocsection-16"><a href="#Wired_to_wireless_failover"><span class="tocnumber">4.3.2</span> <span class="toctext">Wired to wireless failover</span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-17"><a href="#Using_any_interface"><span class="tocnumber">4.4</span> <span class="toctext">Using any interface</span></a></li>
<li class="toclevel-2 tocsection-18">
<a href="#Using_hooks"><span class="tocnumber">4.5</span> <span class="toctext">Using hooks</span></a>
<ul>
<li class="toclevel-3 tocsection-19">
<a href="#Examples"><span class="tocnumber">4.5.1</span> <span class="toctext">Examples</span></a>
<ul>
<li class="toclevel-4 tocsection-20"><a href="#Execute_commands_on_established_connection"><span class="tocnumber">4.5.1.1</span> <span class="toctext">Execute commands on established connection</span></a></li>
<li class="toclevel-4 tocsection-21"><a href="#Activate_network-online.target"><span class="tocnumber">4.5.1.2</span> <span class="toctext">Activate network-online.target</span></a></li>
<li class="toclevel-4 tocsection-22"><a href="#Set_default_DHCP_client"><span class="tocnumber">4.5.1.3</span> <span class="toctext">Set default DHCP client</span></a></li>
</ul>
</li>
</ul>
</li>
<li class="toclevel-2 tocsection-23"><a href="#Minimal_WPAConfigSection"><span class="tocnumber">4.6</span> <span class="toctext">Minimal WPAConfigSection</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-24">
<a href="#Troubleshooting"><span class="tocnumber">5</span> <span class="toctext">Troubleshooting</span></a>
<ul>
<li class="toclevel-2 tocsection-25"><a href="#Job_for_netctl.40wlan.28....29.service_failed"><span class="tocnumber">5.1</span> <span class="toctext">Job for netctl@wlan(...).service failed</span></a></li>
<li class="toclevel-2 tocsection-26"><a href="#dhcpcd:_ipv4_addroute:_File_exists"><span class="tocnumber">5.2</span> <span class="toctext">dhcpcd: ipv4_addroute: File exists</span></a></li>
<li class="toclevel-2 tocsection-27"><a href="#DHCP_timeout_issues"><span class="tocnumber">5.3</span> <span class="toctext">DHCP timeout issues</span></a></li>
<li class="toclevel-2 tocsection-28"><a href="#Connection_timeout_issues"><span class="tocnumber">5.4</span> <span class="toctext">Connection timeout issues</span></a></li>
<li class="toclevel-2 tocsection-29"><a href="#Problems_with_netctl-auto_on_resume"><span class="tocnumber">5.5</span> <span class="toctext">Problems with netctl-auto on resume</span></a></li>
<li class="toclevel-2 tocsection-30"><a href="#netctl-auto_suddenly_stopped_working_for_WiFi_adapters"><span class="tocnumber">5.6</span> <span class="toctext">netctl-auto suddenly stopped working for WiFi adapters</span></a></li>
<li class="toclevel-2 tocsection-31"><a href="#netctl-auto_does_not_automatically_unblock_a_wireless_card_to_use_an_interface"><span class="tocnumber">5.7</span> <span class="toctext">netctl-auto does not automatically unblock a wireless card to use an interface</span></a></li>
<li class="toclevel-2 tocsection-32"><a href="#RTNETLINK_answers:_File_exists_.28with_multiple_NICs.29"><span class="tocnumber">5.8</span> <span class="toctext">RTNETLINK answers: File exists (with multiple NICs)</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-33"><a href="#See_also"><span class="tocnumber">6</span> <span class="toctext">See also</span></a></li>
</ul>
</div>

<h2><span class="mw-headline" id="Installation">Installation</span></h2>
<p><span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://www.archlinux.org/packages/?name=netctl">netctl</a></span> is part of the <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://www.archlinux.org/groups/x86_64/base/">base</a></span> group, so it should already be installed on your system. Otherwise <a href="../en/Help:Reading.html#Installation_of_packages" title="Install" class="mw-redirect">install</a> it as usual.
</p>
<p>Optional dependencies are shown in the table below.
</p>
<table class="wikitable">
<tr>
<th> Feature
</th>
<th> Dependency
</th>
<th> netctl program <br> (if relevant)
</th>
</tr>
<tr>
<td> Automatic wireless connections </td>
<td> <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://www.archlinux.org/packages/?name=wpa_actiond">wpa_actiond</a></span> </td>
<td> <code>netctl-auto</code>
</td>
</tr>
<tr>
<td> Automatic wired connections </td>
<td> <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://www.archlinux.org/packages/?name=ifplugd">ifplugd</a></span> </td>
<td> <code>netctl-ifplugd</code>
</td>
</tr>
<tr>
<td> WPA </td>
<td> <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://www.archlinux.org/packages/?name=wpa_supplicant">wpa_supplicant</a></span> </td>
<td>
</td>
</tr>
<tr>
<td> DHCP </td>
<td> <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://www.archlinux.org/packages/?name=dhcpcd">dhcpcd</a></span> or <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://www.archlinux.org/packages/?name=dhclient">dhclient</a></span> </td>
<td>
</td>
</tr>
<tr>
<td> Wifi menus </td>
<td> <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://www.archlinux.org/packages/?name=dialog">dialog</a></span> </td>
<td>
</td>
</tr>
<tr>
<td> PPPoE </td>
<td> <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://www.archlinux.org/packages/?name=ppp">ppp</a></span> </td>
<td>
</td>
</tr>
</table>
<div style="padding: 5px; margin: 0.50em 0; background-color: #FFDDDD; border: thin solid #DDBBBB; overflow: hidden;">
<strong> Warning: </strong>Do not enable concurrent, conflicting network service. Use <code>systemctl --type=service</code> to ensure that no other network service is running before enabling a <i>netctl</i> profile/service.</div>
<h2><span class="mw-headline" id="Usage">Usage</span></h2>
<p>It is advisable to read the following man pages before using netctl:
</p>
<ul>
<li> <a rel="nofollow" class="external text" href="https://github.com/joukewitteveen/netctl/blob/master/docs/netctl.1.txt">netctl</a>
</li>
<li> <a rel="nofollow" class="external text" href="https://github.com/joukewitteveen/netctl/blob/master/docs/netctl.profile.5.txt">netctl.profile</a>
</li>
<li> <a rel="nofollow" class="external text" href="https://github.com/joukewitteveen/netctl/blob/master/docs/netctl.special.7.txt">netctl.special</a>
</li>
</ul>
<h2><span class="mw-headline" id="Configuration">Configuration</span></h2>
<p><i>netctl</i> uses profiles to manage network connections and different modes of operation to start profiles automatically or manually on demand. 
</p>
<h3><span class="mw-headline" id="Profile_configuration">Profile configuration</span></h3>
<p>The <i>netctl</i> profile files are stored in <code>/etc/netctl/</code> and example configuration files are available in <code>/etc/netctl/examples/</code>. Common configurations include:
</p>
<ul>
<li> ethernet-dhcp</li>
<li> ethernet-static</li>
<li> wireless-wpa</li>
<li> wireless-wpa-static</li>
</ul>
<p>To use an example profile, simply copy it from <code>/etc/netctl/examples/</code> to <code>/etc/netctl/</code> and configure it to your needs; see basic <a href="#Example_profiles">#Example profiles</a> below. The first parameter you need to create a profile is the network <code>Interface</code>, see <a href="../en/Network_configuration.html#Device_names" title="Network configuration">Network configuration#Device names</a> for details.
</p>
<div style="padding: 5px; margin: 0.50em 0; background-color: #DDFFDD; border: thin solid #BBDDBB; overflow: hidden;">
<strong> Tip: </strong>
<ul>
<li> For wireless settings, you can use <code>wifi-menu -o</code> as root to generate the profile file in <code>/etc/netctl/</code>.</li>
<li> To enable a static IP profile on wired interface no matter if the cable is connected or not, use <code>SkipNoCarrier=yes</code> in your profile.</li>
</ul>
</div>
<p>Once you have created your profile, attempt to establish a connection (use only the profile name, not the full path):
</p>
<pre># netctl start <i>profile</i>
</pre>
<p>If the above command results in a failure, then use <code>journalctl -xn</code> and <code>netctl status <i>profile</i></code> to obtain a more in depth explanation of the failure.
</p>
<h3><span class="mw-headline" id="Automatic_operation">Automatic operation</span></h3>
<p>If you use only one profile (per interface) or want to switch profiles manually, the <a href="#Basic_method">Basic method</a> will do. Most common examples are servers, workstations, routers etc.
</p>
<p>If you need to switch multiple profiles frequently, use <a href="#Automatic_switching_of_profiles">Automatic switching of profiles</a>. Most common examples are laptops.
</p>
<h4><span class="mw-headline" id="Basic_method">Basic method</span></h4>
<p>With this method, you can statically start only one profile per interface. First manually check that the profile can be started successfully with: 
</p>
<pre># netctl start <i>profile</i> 
</pre>
<p>then it can be enabled using:
</p>
<pre># netctl enable <i>profile</i>
</pre>
<p>This will create and enable a <a href="../en/Systemd.html" title="Systemd">systemd</a> service that will start when the computer boots. Changes to the profile file will not propagate to the service file automatically. After such changes, it is necessary to reenable the profile:
</p>
<pre># netctl reenable <i>profile</i>
</pre>
<p>After enabling a profile, it will be started at next boot. Obviously this can only be successful, if the network cable for a wired connection is plugged in, or the wireless access point used in a profile is in range respectively.
</p>
<h4><span class="mw-headline" id="Automatic_switching_of_profiles">Automatic switching of profiles</span></h4>
<p><i>netctl</i> provides special <a href="../en/Systemd.html" title="Systemd">systemd</a> services for automatically switching of profile for wired and wireless connections:
</p>
<ul><li> For wired interfaces, install package <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://www.archlinux.org/packages/?name=ifplugd">ifplugd</a></span>: After <a href="../en/Systemd.html#Using_units" title="Start" class="mw-redirect">starting and enabling</a> <code>netctl-ifplugd@<i>interface</i>.service</code> DHCP profiles are started/stopped when the network cable is plugged in/unplugged.
<ul>
<li> The <code>netctl-ifplugd@<i>interface</i>.service</code> will prefer profiles which use <a href="https://en.wikipedia.org/wiki/DHCP" class="extiw" title="wikipedia:DHCP">DHCP</a>.</li>
<li> To automatically start a  static IP profile the option <code>ExcludeAuto=no</code> needs to be set in it.</li>
<li> To prioritize a profile with a static IP over DHCP profiles, you can set <code>Priority=2</code>, which is higher than the default priority given to DHCP profiles of <code>Priority=1</code>.</li>
</ul>
</li></ul>
<ul><li> For wireless interfaces, install package <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://www.archlinux.org/packages/?name=wpa_actiond">wpa_actiond</a></span>: After <a href="../en/Systemd.html#Using_units" title="Start" class="mw-redirect">starting and enabling</a> <code>netctl-auto@<i>interface</i>.service</code> profiles are started/stopped automatically as you move from the range of one network into the range of another network (roaming).
<ul>
<li> Profiles must use <code>Security=wpa-configsection</code> or <code>Security=wpa</code> to work with <i>netctl-auto</i> rather than <code>Security=wpa-config</code>.</li>
<li> If you want some wireless profile <b>not</b> to be started automatically by <code>netctl-auto@<i>interface</i>.service</code>, you have to explicitly add <code>ExcludeAuto=yes</code> to that profile. </li>
<li> You can use <code>priority=</code> in the <i>WPAConfigSection</i> (see <code>/etc/netctl/examples/wireless-wpa-configsection</code>) to set priority of a profile when multiple wireless access points are available. </li>
</ul>
</li></ul>
<p>Note that <i>interface</i> is not literal, but to be substituted by the name of your device's interface, e.g. <code>netctl-auto@wlp4s0.service</code>. See <code>netctl.profile(5)</code> for details.
</p>
<div style="padding: 5px; margin: 0.50em 0; background-color: #FFDDDD; border: thin solid #DDBBBB; overflow: hidden;">
<strong> Warning: </strong>
<ul>
<li> If any of the profiles contain errors, such as an empty or misquoted <code>Key=</code> variable, the unit will fail to load with the message <code>"Failed to read or parse configuration '/run/network/wpa_supplicant_wlan0.conf'</code>, even when that profile is not being used.</li>
<li> This method conflicts with the <a href="#Basic_method">Basic method</a>. If you have previously enabled a profile through <i>netctl</i>, run <code>netctl disable <i>profile</i></code> to prevent the profile from starting twice at boot.</li>
</ul>
</div>
<p>Since netctl 1.3 it is possible to manually control an interface otherwise managed by <i>netctl-auto</i> without having to stop <code>netctl-auto.service</code>. This is done using the <i>netctl-auto</i> command. For a list of available actions run:
</p>
<pre> # netctl-auto --help
</pre>
<h3><span class="mw-headline" id="Example_profiles">Example profiles</span></h3>
<h4><span class="mw-headline" id="Wired">Wired</span></h4>
<p>For a DHCP connection, only the <code>Interface</code> has to be configured after copying the <code>/etc/netctl/examples/ethernet-dhcp</code> example profile to <code>/etc/netctl</code>. 
</p>
<p>For example:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/netctl/<i>my_dhcp_profile</i></pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">
Interface=enp1s0
Connection=ethernet
IP=dhcp
</pre>
<p>For a static IP configuration copy the <code>/etc/netctl/examples/ethernet-static</code> example profile to <code>/etc/netctl</code> and modify <code>Interface</code>, <code>Address</code>, <code>Gateway</code> and <code>DNS</code>) as needed. 
</p>
<p>For example:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/netctl/<i>my_static_profile</i></pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">
Interface=enp1s0
Connection=ethernet
IP=static
Address=('10.1.10.2/24')
Gateway=('10.1.10.1')
DNS=('10.1.10.1')
</pre>
<p>Take care to include the subnet notation of <code>/24</code>. It equates to a netmask of <code>255.255.255.0</code>) and without it the profile will fail to start. See also <a href="https://en.wikipedia.org/wiki/Classless_Inter-Domain_Routing#CIDR_notation" class="extiw" title="wikipedia:Classless Inter-Domain Routing">CIDR notation</a>. To alias more than one IP address per a NIC set <code>Address=('10.1.10.2/24' '192.168.1.2/24')</code>.
</p>
<h4><span class="mw-headline" id="Wireless_.28WPA-PSK.29">Wireless (WPA-PSK)</span></h4>
<div class="noprint archwiki-template-message">
<p><a href="../File:Tango-edit-clear.png" class="image"><img alt="Tango-edit-clear.png" src="../File:Tango-edit-clear.png" width="48" height="48"></a><b>This article or section needs language, wiki syntax or style improvements.</b><a href="../File:Tango-edit-clear.png" class="image"><img alt="Tango-edit-clear.png" src="../File:Tango-edit-clear.png" width="48" height="48"></a></p>
<div>
<b>Reason:</b> Split into multiple sections, keep here only the example at the bottom. <i>wifi-menu</i> related to WPA-PSK in any way. (Discuss in <a rel="nofollow" class="external text" href="https://wiki.archlinux.org/index.php/Talk:Netctl">Talk:Netctl#</a>)</div>
</div>
<p>The following applies for the standard wireless connections using a pre-shared key (WPA-PSK). See <a href="../en/WPA2_Enterprise.html#netctl" title="WPA2 Enterprise">WPA2 Enterprise#netctl</a> for example profiles with other authentication methods. 
</p>
<p>The standard <i>netctl</i> tool to connect to a wireless network (WPA-PSK, WEP) interactively is <i>wifi-menu</i>; used with the <code>-o</code> option: 
</p>
<pre>wifi-menu -o 
</pre>
<p>it generates the configuration file in <code>/etc/netctl/</code> for the network to use for <a href="#Automatic_operation">#Automatic operation</a> at the same time. 
</p>
<p>Alternatively, the profile may also be configured manually, as follows: 
</p>
<p>Copy the example file <code>wireless-wpa</code> from <code>/etc/netctl/examples</code> to <code>/etc/netctl</code> (name of your choice):
</p>
<pre># cp /etc/netctl/examples/wireless-wpa /etc/netctl/.
</pre>
<p>Edit the profile as needed (modifying <code>Interface</code>, <code>ESSID</code> and <code>Key</code>) and it is done. 
</p>
<p>At this step you may want to re-confirm the new profile you created is <code>chmod 600</code> and confirm it works by starting it: 
</p>
<pre>netctl start wireless-wpa
</pre>
<p>before configuring any <a href="#Automatic_operation">#Automatic operation</a>.
</p>
<p>Optionally you can also follow the following step to obfuscate the wireless passphrase (<i>wifi-menu</i> does it automatically): 
</p>
<p>Users <b>not</b> wishing to have the passphrase to their wireless network stored in <i>plain text</i> have the option of storing the corresponding 256-bit pre-shared key instead, which is calculated from the passphrase and the SSID using standard algorithms.
</p>
<p>Calculate your 256-bit PSK using <a href="../en/WPA_supplicant.html#Connecting_with_wpa_passphrase" title="WPA supplicant">wpa_passphrase</a>:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">$ wpa_passphrase <i>your_essid</i></pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">network={
  ssid="<i>your_essid</i>"
  #psk="<i>passphrase</i>"
  psk=64cf3ced850ecef39197bb7b7b301fc39437a6aa6c6a599d0534b16af578e04a
}</pre>
<p>The <i>pre-shared key</i> (psk) now needs to replace the plain text passphrase of the <code>Key</code> variable in the profile. Once completed your network profile <code>wireless-wpa</code> containing a 256-bit PSK should resemble:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/netctl/wireless-wpa</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">Description='A simple WPA encrypted wireless connection using 256-bit PSK'
Interface=wlp2s2
Connection=wireless
Security=wpa
IP=dhcp
ESSID=<i>your_essid</i>
Key=\"64cf3ced850ecef39197bb7b7b301fc39437a6aa6c6a599d0534b16af578e04a</pre>
<div style="padding: 5px; margin: 0.50em 0; background-color: #DDDDFF; border: thin solid #BBBBDD; overflow: hidden;">
<strong> Note: </strong>
<ul>
<li> Make sure to use the <b>special quoting rules</b> for the <code>Key</code> variable as explained at the end of <a rel="nofollow" class="external text" href="https://github.com/joukewitteveen/netctl/blob/master/docs/netctl.profile.5.txt">netctl.profile(5)</a>.</li>
<li> If the passphrase fails, try removing the <code>\"</code> in the <code>Key</code> variable.</li>
<li> Although "encrypted", the key that you put in the profile configuration is enough to connect to a WPA-PSK network. Therefore this process is only useful for hiding the human-readable version of the passphrase. This will not prevent anyone with read access to this file from connecting to the network.</li>
</ul>
</div>
<h2><span class="mw-headline" id="Tips_and_tricks">Tips and tricks</span></h2>
<h3><span class="mw-headline" id="Using_an_Experimental_GUI">Using an Experimental GUI</span></h3>
<p>If you want a graphical user interface to manage <i>netctl</i> and your connections and you are not afraid of highly experimental unofficial packages, there are some options available. <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/netctl-gui/">netctl-gui</a></span><sup><small>AUR</small></sup> provides a Qt-based graphical interface, DBus daemon and KDE widget. An alternative is <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/netmenu/">netmenu</a></span><sup><small>AUR</small></sup>, which uses <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://www.archlinux.org/packages/?name=dmenu">dmenu</a></span> as its graphical interface.
</p>
<h3><span class="mw-headline" id="Eduroam">Eduroam</span></h3>
<p>See <a href="../en/WPA2_Enterprise.html#netctl" title="WPA2 Enterprise">WPA2 Enterprise#netctl</a>.
</p>
<h3><span class="mw-headline" id="Bonding">Bonding</span></h3>
<p>From <a rel="nofollow" class="external text" href="https://www.kernel.org/doc/Documentation/networking/bonding.txt">kernel documentation</a>:
</p>
<dl><dd><i>The Linux bonding driver provides a method for aggregating multiple network interfaces into a single logical "bonded" interface. The behavior of the bonded interfaces depends on the mode. Generally speaking, modes provide either hot standby or load balancing services. Additionally, link integrity monitoring may be performed.</i></dd></dl>
<h4><span class="mw-headline" id="Load_balancing">Load balancing</span></h4>
<p>To use bonding with netctl, additional package from official repositories is required: <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://www.archlinux.org/packages/?name=ifenslave">ifenslave</a></span>.
</p>
<p>Copy <code>/etc/netctl/examples/bonding</code> to <code>/etc/netctl/bond0</code> and edit it, for example:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/netctl/bond0</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">Description='Bond Interface'
Interface='bond0'
Connection=bond
BindsToInterfaces=('eth0' 'eth1')
IP=dhcp
IP6=stateless</pre>
<p>Now you can disable your old configuration and set <i>bond0</i> to be started automatically. Switch to the new profile, for example:
</p>
<pre># netctl switch-to bond0
</pre>
<div style="padding: 5px; margin: 0.50em 0; background-color: #DDDDFF; border: thin solid #BBBBDD; overflow: hidden;">
<strong> Note: </strong>This uses the round-robin policy, which is the default for the <code>bonding</code> driver. See <a rel="nofollow" class="external text" href="https://www.kernel.org/doc/Documentation/networking/bonding.txt">official documentation</a> for details.</div>
<div style="padding: 5px; margin: 0.50em 0; background-color: #DDFFDD; border: thin solid #BBDDBB; overflow: hidden;">
<strong> Tip: </strong>To check the status and bonding mode: <pre>$ cat /proc/net/bonding/bond0</pre>
</div>
<h4><span class="mw-headline" id="Wired_to_wireless_failover">Wired to wireless failover</span></h4>
<p>This example describes how to use <i>bonding</i> to fallback to wireless when the wired ethernet goes down. This is most useful when both the wired and wireless interface will be connected to the same network. Your wireless router/access point must be configured in <i>bridge</i> mode.
</p>
<p>You will need additional packages from the official repositories: <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://www.archlinux.org/packages/?name=ifenslave">ifenslave</a></span> and <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://www.archlinux.org/packages/?name=wpa_supplicant">wpa_supplicant</a></span>.
</p>
<p>First enable the bonding module to be loaded upon boot time, as instructed on <a href="../en/Kernel_modules.html#Automatic_module_handling" title="Kernel modules">Kernel modules#Automatic module handling</a>:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/modules-load.d/bonding.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">bonding</pre>
<p>Then, configure the options of the <code>bonding</code> driver to use <code>active-backup</code> and configure the <code>primary</code> parameter to the device you want to be the active one (normally the wired interface). Also, be sure to use the same device name as returned when running <code>ip link</code>:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/modprobe.d/bonding.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">options bonding mode=active-backup miimon=100 primary=eth0 max_bonds=0</pre>
<p>The <code>miimon</code> option is needed, for the link failure detection. The <code>max_bonds</code> option avoids the <code>Interface bond0 already exists</code> error. More information can be obtained on the <a rel="nofollow" class="external text" href="https://www.kernel.org/doc/Documentation/networking/bonding.txt">kernel documentation</a>.
</p>
<p>Next, configure a netctl profile to enslave the two hardware interfaces. Use the name of all the devices you want to enslave. If you have more than two wired or wireless interfaces, you can enslave all of them on a bond interface. But, for most cases you will have only two devices, a wired and a wireless one:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/netctl/failover</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">Description='A wired connection with failover to wireless'
Interface='bond0'
Connection=bond
BindsToInterfaces=('eth0' 'wlan0')
IP='dhcp'</pre>
<p>Disable any other profiles (specially a wired or wireless) you had enabled before and then enable the failover profile on startup:
</p>
<pre># netctl enable failover
</pre>
<p>Now you need to configure <i>wpa_supplicant</i> to connect to any known network you wish. You should create a file for each interface and enable it on systemd. Create the following file with this content:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/wpa_supplicant/wpa_supplicant-wlan0.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">ctrl_interface=/run/wpa_supplicant
update_config=1</pre>
<p>And append to the end of this file any network you want to connect to: 
</p>
<pre>network={
    ssid="SSID"
    psk=PSK
}
</pre>
<p>To generate the obfuscated PSK you can run <i>wpa_passphrase</i> as on the <a href="../en/WPA_supplicant.html#Connecting_with_wpa_passphrase" title="WPA supplicant">WPA supplicant#Connecting with wpa_passphrase</a> page.
</p>
<p>Now, <a href="../en/Systemd.html#Using_units" title="Enable" class="mw-redirect">enable</a> the <code>wpa_supplicant@</code> template service on the network interface, for example <code>wpa_supplicant@wlan0</code>.
</p>
<p>You can try now to reboot your machine and see if your configuration worked.
</p>
<div style="padding: 5px; margin: 0.50em 0; background-color: #DDDDFF; border: thin solid #BBBBDD; overflow: hidden;">
<strong> Note: </strong>If you get this error on boot bonding:
<pre>wlan0 is up - this may be due to an out of date ifenslave
</pre>
<p>Then this is happening because the <i>wpa_supplicant</i> is being run before the <code>failover</code> netctl profile. This happens because <a href="../en/Systemd.html" title="Systemd">systemd</a> runs everything in parallel, unless told otherwise. <i>ifenslave</i> need all the interfaces to be down before bonding them to the <code>bond0</code> interface. And, since the <i>wpa_supplicant</i> need to put the interface up to be able to scan for networks, this might cause the interface to not be enslaved and your bonding to only have the wired interface.
</p>
<p>If this is your case, then you will need to setup a custom dependency on the <code>wpa_supplicant@wlan0</code> service in relation with the <code>netctl@failover</code> profile. More specifically, the <i>wpa_supplicant</i> must be started <b>after</b> the netctl profile. To accomplish this, create a custom dependency file based on the instructions provided here: <a href="../en/Systemd.html#Handling_dependencies" title="Systemd">systemd#Handling dependencies</a>
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/systemd/system/wpa_supplicant@wlan0.service.d/customdependency.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[Unit]
After=netctl@failover.service</pre>
<p>After that you can try to reboot your system again and see if it works. You can check the status of your bonding by checking <a href="../en/Systemd.html#Journal" title="Journalctl" class="mw-redirect">journalctl</a> for the <code>netctl@failover.service</code> unit.
</p>
<p>And by checking:
</p>
<pre># ip link
</pre>
<p>You should see something like this:
</p>
<pre>1: eth0: &lt;BROADCAST,MULTICAST,SLAVE,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast master bond0 state UP mode DEFAULT group default qlen 1000
    link/ether xx:xx:xx:xx:xx:xx brd ff:ff:ff:ff:ff:ff
2: wlan0: &lt;BROADCAST,MULTICAST,SLAVE,UP,LOWER_UP&gt; mtu 1500 qdisc mq master bond0 state UP mode DORMANT group default qlen 1000
    link/ether xx:xx:xx:xx:xx:xx brd ff:ff:ff:ff:ff:ff
3: bond0: &lt;BROADCAST,MULTICAST,MASTER,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue state UP mode DEFAULT group default 
    link/ether xx:xx:xx:xx:xx:xx brd ff:ff:ff:ff:ff:ff
</pre>
</div>
<p>Now, you can test your failover setup, by initiating a big download. Unplug your wired interface. Your download should keep going over the wireless interface. Then, plug your wired interface again and it should keep working. You can debug by checking <a href="../en/Systemd.html#Journal" title="Journalctl" class="mw-redirect">journalctl</a> for the <code>netctl@failover.service</code> and <code>wpa_supplicant@wlan0.service</code> units.
</p>
<h3><span class="mw-headline" id="Using_any_interface">Using any interface</span></h3>
<p>In some cases it may be desirable to allow a profile to use any interface on the system. A common example use case is using a common disk image across many machines with differing hardware (this is especially useful if they are headless). If you use the kernel's naming scheme, and your machine has only one ethernet interface, you can probably guess that eth0 is the right interface. If you use udev's <a rel="nofollow" class="external text" href="http://www.freedesktop.org/wiki/Software/systemd/PredictableNetworkInterfaceNames/">Predictable Network Interface Names</a>, however, names will be assigned based on the specific hardware itself (e.g. enp1s0), rather than simply the order that the hardware was detected (e.g. eth0, eth1). This means that a netctl profile may work on one machine and not another, because they each have different interface names.
</p>
<p>A quick and dirty solution is to make use of the <code>/etc/netctl/interfaces/</code> directory. Choose a name for your interface alias (<code>en-any</code> in this example), and write the following to a file with that name (making sure it is executable).
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/netctl/interfaces/en-any</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">
#!/bin/bash
for interface in /sys/class/net/en*; do
        break;
done
Interface=$(basename $interface)
echo "en-any: using interface $Interface";
</pre>
<p>Then create a profile that uses the interface. Pay special attention to the <code>Interface</code> directive. The rest are only provided as examples.
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/netctl/wired</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">
Description='Wired'
Interface=en-any
Connection=ethernet
IP=static
Address=('192.168.1.15/24')
Gateway='192.168.1.1'
DNS=('192.168.1.1')
</pre>
<p>When the <code>wired</code> profile is started, any machine using the two files above will automatically bring up and configure the first ethernet interface found on the system, regardless of what name udev assigned to it. Note that this is not the most robust way to go about configuring interfaces. If you use multiple interfaces, netctl may try to assign the same interface to them, and will likely cause a disruption in connectivity. If you do not mind a more complicated solution, <code>netctl-auto</code> is likely to be more reliable.
</p>
<h3><span class="mw-headline" id="Using_hooks">Using hooks</span></h3>
<p>netctl supports hooks in <code>/etc/netctl/hooks/</code> and per interface hooks in <code>/etc/netctl/interfaces/</code>. You can set any option in a hook/interface that you can
in a profile. They are read the same way! Most importantly this includes <code>ExecUpPost</code> and <code>ExecDownPre</code>. 
</p>
<p>When a profile is read, netctl sources <b>all executable</b> scripts in <code>hooks</code>, then it reads the profile file for the connection and finally it sources an executable script with the name of the interface used in the profile from the <code>interfaces</code> directory. Therefore, declarations in an interface script override declarations in the profile, which override declarations in hooks. 
</p>
<p>The variables <code>$INTERFACE</code>, <code>$SSID</code>, <code>$ACTION</code> and <code>$Profile</code> are available in hooks/interfaces <b>only</b> when using <code>netctl-auto</code> 
</p>
<h4><span class="mw-headline" id="Examples">Examples</span></h4>
<h5><span class="mw-headline" id="Execute_commands_on_established_connection">Execute commands on established connection</span></h5>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/netctl/hooks/myservices</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">
#!/bin/sh
ExecUpPost="systemctl start crashplan.service; systemctl start dropbox@&lt;username&gt;.service"
ExecDownPre="systemctl stop crashplan.service; systemctl stop dropbox@&lt;username&gt;.service"
</pre>
<h5><span class="mw-headline" id="Activate_network-online.target">Activate network-online.target</span></h5>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/netctl/hooks/status</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">
#!/bin/sh
ExecUpPost="systemctl start network-online.target"
ExecDownPre="systemctl stop network-online.target"
</pre>	
<p>Using this, systemd services requiring an active network connection can be <a href="../en/Systemd.html#Handling_dependencies" title="Systemd">ordered</a> to start only after the <code>network-online.target</code> is reached, and can be stopped before the connection is brought down. 
</p>
<h5><span class="mw-headline" id="Set_default_DHCP_client">Set default DHCP client</span></h5>
<p>To set or change the DHCP client used for all profiles: 
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/netctl/hooks/dhcp</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">
#!/bin/sh
DHCPClient='dhclient'
</pre>
<p>Alternatively, it may also be specified for a specific network interface by creating an executable file <code>/etc/netctl/interfaces/&lt;interface&gt;</code> with the following line:
</p>
<pre>DHCPClient='dhclient'
</pre>
<div class="noprint archwiki-template-message">
<p><a href="../File:Tango-view-fullscreen.png" class="image"><img alt="Tango-view-fullscreen.png" src="../File:Tango-view-fullscreen.png" width="48" height="48"></a><b>This article or section needs expansion.</b><a href="../File:Tango-view-fullscreen.png" class="image"><img alt="Tango-view-fullscreen.png" src="../File:Tango-view-fullscreen.png" width="48" height="48"></a></p>
<div>
<b>Reason:</b> It would be useful to replace the example with a general hook that executes different actions depending on <code>$ACTION</code> being CONNECT and DISCONNECT. (Discuss in <a rel="nofollow" class="external text" href="https://wiki.archlinux.org/index.php/Talk:Netctl">Talk:Netctl#</a>)</div>
</div>
<h3><span class="mw-headline" id="Minimal_WPAConfigSection">Minimal WPAConfigSection</span></h3>
<p>As stated in the <a rel="nofollow" class="external text" href="https://projects.archlinux.org/netctl.git/tree/docs/netctl.profile.5.txt#n281">netctl.profile(5)</a> man page, the <code>WPAConfigSection</code> variable is an array of config lines passed to <a href="../en/WPA_supplicant.html" title="Wpa supplicant" class="mw-redirect">wpa_supplicant</a>. So, a minimal WPAConfigSection would contain:
</p>
<pre>Description='A wireless connection using a custom network block configuration'
Interface=wlan0
Connection=wireless
Security=wpa-configsection
IP=dhcp
WPAConfigSection=(
    'ssid="University"'
    'psk="very secret passphrase"'
)
</pre>
<div style="padding: 5px; margin: 0.50em 0; background-color: #DDDDFF; border: thin solid #BBBBDD; overflow: hidden;">
<strong> Note: </strong>If trying to connect to an SSID with non-ASCII characters (unicode, emoji, etc), you can specify the SSID as hex instead of as a string, e.g. <code>ssid=F09F90BA</code> for "🐺". When unsure on the hex encoding, run <i>wifi-menu</i> (be sure to remove the \ and x characters).</div>
<h2><span class="mw-headline" id="Troubleshooting">Troubleshooting</span></h2>
<h3><span class="mw-headline" id="Job_for_netctl.40wlan.28....29.service_failed">Job for netctl@wlan(...).service failed</span></h3>
<p>Some people have an issue when they connect to a network with <i>netctl</i>, for example:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;"># netctl start wlan0-ssid</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">
Job for netctl@wlan0\x2ssid.service failed. See 'systemctl status netctl@wlan0\x2ssid.service' and 'journalctl -xn' for details.
</pre>
<p>When then looking at <code>journalctl -xn</code>, either of the following are shown:
</p>
<p>1. If your device (<code>wlan0</code> in this case) is up:
</p>
<pre>network[2322]: The interface of network profile 'wlan0-ssid' is already up
</pre>
<p>Setting the interface down should resolve the problem:
</p>
<pre># ip link set wlan0 down
</pre>
<p>Then retry:
</p>
<pre># netctl start wlan0-ssid
</pre>
<div class="noprint archwiki-template-message">
<p><a href="../File:Tango-inaccurate.png" class="image"><img alt="Tango-inaccurate.png" src="../File:Tango-inaccurate.png" width="48" height="48"></a><b>The factual accuracy of this article or section is disputed.</b><a href="../File:Tango-inaccurate.png" class="image"><img alt="Tango-inaccurate.png" src="../File:Tango-inaccurate.png" width="48" height="48"></a></p>
<div>
<b>Reason:</b> The following is an unsolved issue, using different DHCP client is just a poor/unexplained workaround. (Discuss in <a rel="nofollow" class="external text" href="https://wiki.archlinux.org/index.php/Talk:Netctl">Talk:Netctl#</a>)</div>
</div>
<p>2. If it is down:
</p>
<pre>dhcpcd[261]: wlan0: ipv4_sendrawpacket: Network is down
</pre>
<p>One way to solve this is to use a different DHCP client, for example <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://www.archlinux.org/packages/?name=dhclient">dhclient</a></span>. After installing the package configure <i>netctl</i> to use it:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/netctl/wlan0-ssid</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">
...
DHCPClient='dhclient'
</pre>
<p>Adding the <code>ForceConnect</code> option may also be helpful:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/netctl/wlan0-ssid</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">

...

ForceConnect=yes
</pre>
<p>Save it and try to connect with the profile:
</p>
<pre># netctl start wlan0-ssid
</pre>
<h3><span class="mw-headline" id="dhcpcd:_ipv4_addroute:_File_exists">dhcpcd: ipv4_addroute: File exists</span></h3>
<p>On some systems dhcpcd in combination with netctl causes timeout issues on resume, particularly when having switched networks in the meantime. netctl will report that you are successfully connected but you still receive timeout issues. In this case, the old default route still exists and is not being renewed. A workaround to avoid this misbehaviour is to switch to <a href="#Set_default_DHCP_client">dhclient</a> as the default dhcp client. More information on the issue can be found <a rel="nofollow" class="external text" href="https://bbs.archlinux.org/viewtopic.php?pid=1399842#p1399842">here</a>.
</p>
<h3><span class="mw-headline" id="DHCP_timeout_issues">DHCP timeout issues</span></h3>
<p>If you are having timeout issues when requesting leases via DHCP you can set the timeout value higher than netctl's 30 seconds by default. Create a file in <code>/etc/netctl/hooks/</code> or <code>/etc/netctl/interfaces/</code>, add <code>TimeoutDHCP=40</code> to it for a timeout of 40 seconds and make the file executable.
</p>
<h3><span class="mw-headline" id="Connection_timeout_issues">Connection timeout issues</span></h3>
<p>If you are having timeout issues that are unrelated to DHCP (on a static ethernet connection for example), and are experiencing errors similar to the following when starting your profile:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;"># journalctl _SYSTEMD_UNIT=netctl@<i>profile</i>.service</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">
Starting network profile '<i>profile</i>'...
No connection found on interface 'eth0' (timeout)
Failed to bring the network up for profile '<i>profile</i>'
</pre>
<p>Then you should increase carrier and up timeouts by adding <code>TimeoutUp=</code> and <code>TimeoutCarrier=</code> to your profile file:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/netctl/<i>profile</i></pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">
...
TimeoutUp=300
TimeoutCarrier=300
</pre>
<p>Do not forget to reenable your profile:
</p>
<pre># netctl reenable <i>profile</i>
</pre>
<h3><span class="mw-headline" id="Problems_with_netctl-auto_on_resume">Problems with netctl-auto on resume</span></h3>
<p>Sometimes <i>netctl-auto</i> fails to reconnect when the system resumes from suspend, hibernate or hybrid-sleep. An easy solution is to restart the service for <i>netctl-auto</i>. 
This can be automated with an additional service like the following:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/systemd/system/netctl-auto-resume@.service</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">
[Unit]
Description=restart netctl-auto on resume.
Requisite=netctl-auto@%i.service
After=sleep.target

[Service]
Type=oneshot
ExecStart=/usr/bin/systemctl restart netctl-auto@%i.service

[Install]
WantedBy=sleep.target
</pre>
<p>To <a href="../en/Systemd.html#Using_units" title="Enable" class="mw-redirect">enable</a> this service for your wireless card, for example, enable <code>netctl-auto-resume@wlan0.service</code> as root. Change <code>wlan0</code> to the required network interface.
</p>
<p>If the device is not yet running on resume when the unit is started, this will fail. It can be fixed by adding the following dependency in the <i>After</i> line:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/systemd/system/netctl-auto-resume@.service</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">
...
After=sleep.target sys-subsystem-net-devices-%i.device
...
</pre>
<h3><span class="mw-headline" id="netctl-auto_suddenly_stopped_working_for_WiFi_adapters">netctl-auto suddenly stopped working for WiFi adapters</span></h3>
<p>This problem seems to be related to a recent wpa_supplicant update (see <a rel="nofollow" class="external text" href="https://bugs.archlinux.org/task/44731">FS#44731</a>), but a work-around is quite trivial. Just create a file for your interface (e.g. wlp3s0) in /etc/netctl/interfaces with the following content and make it executable:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/netctl/interfaces/wlp3s0</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">
WPAOptions="-m ''"
</pre>
<p>After that, try to restart your netctl-auto service and WiFi auto detection should work well again.
</p>
<h3><span class="mw-headline" id="netctl-auto_does_not_automatically_unblock_a_wireless_card_to_use_an_interface">netctl-auto does not automatically unblock a wireless card to use an interface</span></h3>
<p>Many laptops have a hardware button (or switch) to turn off wireless card, however, the card can also be blocked by the kernel. This can be handled by <a href="../en/Wireless_network_configuration.html#Rfkill_caveat" title="Rfkill" class="mw-redirect">rfkill</a>.
</p>
<p>If you want <i>netctl-auto</i> to automatically unblock your wireless card to connect to a particular network, set <code>RFKill=++auto++</code> option for the wireless connection of your choice, as specified in the <a rel="nofollow" class="external text" href="https://github.com/joukewitteveen/netctl/blob/master/docs/netctl.profile.5.txt">netctl.profile(5)</a> man page.
</p>
<h3><span class="mw-headline" id="RTNETLINK_answers:_File_exists_.28with_multiple_NICs.29">RTNETLINK answers: File exists (with multiple NICs)</span></h3>
<p>This is a very misleading response, it really means that you have assigned a default gateway in an earlier netctl control file. When netctl starts up the n-th NIC and goes to set its local route, it fails because there is already a default route from n-1.
</p>
<p>Remove it and everything works, except you no longer have a default route and so cannot access things such as the internet. <code>ExecUpPost</code> does not work as it gets executed for each network card.
</p>
<p>A possible solution is creating a new service.  Replace "FIRST_INTERFACE" and "SECOND_INTERFACE" with your interface names, and replace "192.168.xxx.yyy" with your default gateway.
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/systemd/system/defaultrouter.service</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">
[Unit]
Description="Configure default gateway"
Requires=netctl@FIRST_INTERFACE.service netctl@SECOND_INTERFACE.service
After=netctl@FIRST_INTERFACE.service netctl@SECOND_INTERFACE.service

[Service]
Type=oneshot
ExecStart=/usr/bin/ip route add default via 192.168.xxx.yyy

[Install]
WantedBy=network-online.target
</pre>
<h2><span class="mw-headline" id="See_also">See also</span></h2>
<ul>
<li> <a rel="nofollow" class="external text" href="https://lists.archlinux.org/pipermail/arch-projects/2012-December/003473.html">Initial mailing list announcement</a>
</li>
<li> <a rel="nofollow" class="external text" href="https://bbs.archlinux.org/viewtopic.php?id=157670">Official announcement thread</a>
</li>
<li> <a rel="nofollow" class="external text" href="https://www.archlinux.org/news/netctl-is-now-in-core/">Official news announcement</a>
</li>
</ul>

</div>
<div id="catlinks" class="catlinks">
<div id="mw-normal-catlinks" class="mw-normal-catlinks">
<a href="../Special:Categories.html" title="Special:Categories">Category</a>: <ul><li><a href="../en/Category:Network_configuration.html" title="Category:Network configuration">Network configuration</a></li></ul>
</div>
<div id="mw-hidden-catlinks" class="mw-hidden-catlinks mw-hidden-cats-hidden">Hidden categories: <ul>
<li><a href="../en/Category:Pages_or_sections_flagged_with_Template:Style.html" title="Category:Pages or sections flagged with Template:Style">Pages or sections flagged with Template:Style</a></li>
<li><a href="../en/Category:Pages_or_sections_flagged_with_Template:Expansion.html" title="Category:Pages or sections flagged with Template:Expansion">Pages or sections flagged with Template:Expansion</a></li>
<li><a href="../en/Category:Pages_or_sections_flagged_with_Template:Accuracy.html" title="Category:Pages or sections flagged with Template:Accuracy">Pages or sections flagged with Template:Accuracy</a></li>
</ul>
</div>
</div>					<div class="visualClear"></div>
				</div>
			</div>
		</div>
		<div class="visualClear"></div>
					<div id="footer" role="contentinfo">
Extracted from <a href="https://wiki.archlinux.org"> ArchWiki </a> and licensed under <a href="http://www.gnu.org/copyleft/fdl.html"> GDL >= 1.3</a>
		</div>
		</div>
		</body>
</html>
