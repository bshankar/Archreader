<!DOCTYPE html>
<html lang="en" dir="ltr" class="client-nojs">
<head>
<meta charset="UTF-8">
<title>Notmuch - ArchWiki</title>
<link rel="stylesheet" href="../ArchWikiOffline.css">
<meta name="ResourceLoaderDynamicStyles" content="">
<style></style>
<meta name="generator" content="MediaWiki 1.26.4">
<meta name="robots" content="noindex,follow">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="search" type="application/opensearchdescription+xml" href="/opensearch_desc.php" title="ArchWiki (en)">
<link rel="EditURI" type="application/rsd+xml" href="https://wiki.archlinux.org/api.php?action=rsd">
<link rel="copyright" href="http://www.gnu.org/copyleft/fdl.html">
<link rel="alternate" type="application/atom+xml" title="ArchWiki Atom feed" href="/index.php?title=Special:RecentChanges&amp;feed=atom">
</head>
<body class="mediawiki ltr sitedir-ltr ns-0 ns-subject page-Notmuch skin-archlinux action-view">

		<div id="globalWrapper" style="width: 100%">
		<div id="column-content">
			<div id="content" class="mw-body" role="main" style="margin: 0.5em; margin-bottom:0; margin-top:0">
				<a id="top"></a>
				
				<div class="mw-indicators">
</div>
				<h1 id="firstHeading" class="firstHeading" lang="en">Notmuch</h1>
				
				<div id="bodyContent" class="mw-body-content">
					<div id="contentSub"></div>
										<div id="mw-content-text" lang="en" dir="ltr" class="mw-content-ltr">
<div style="width:45%; margin: 0 0 0.5em 0.5em;">
<p style="background:#333; color:white; padding:0.2em; border-bottom:5px #08c solid; margin:0; text-align:center; font-weight:bold;">Related articles</p>
<ul style="list-style-type:none; margin:0; padding:0.3em;">
<li style="padding:0.4em 0; line-height:1;"><a href="../en/Mutt.html" title="Mutt">mutt</a></li>
</ul>
</div>
<p><a rel="nofollow" class="external text" href="http://notmuchmail.org/">Notmuch</a> is a mail indexer. Essentially, is a very thin front end on top of <i>xapian</i>.
Much like <a href="../en/Sup.html" title="Sup">Sup</a>, it focuses on one thing: indexing your email messages. Notmuch can be used as an email reader, or simply as an indexer and search tool for other MUAs, like <a href="../en/Mutt.html" title="Mutt">mutt</a>.
</p>
<div id="toc" class="toc">
<div id="toctitle"><h2>Contents</h2></div>
<ul>
<li class="toclevel-1 tocsection-1"><a href="#Overview"><span class="tocnumber">1</span> <span class="toctext">Overview</span></a></li>
<li class="toclevel-1 tocsection-2"><a href="#First_time_Usage"><span class="tocnumber">2</span> <span class="toctext">First time Usage</span></a></li>
<li class="toclevel-1 tocsection-3">
<a href="#Frontends"><span class="tocnumber">3</span> <span class="toctext">Frontends</span></a>
<ul>
<li class="toclevel-2 tocsection-4"><a href="#Emacs"><span class="tocnumber">3.1</span> <span class="toctext">Emacs</span></a></li>
<li class="toclevel-2 tocsection-5"><a href="#Vim"><span class="tocnumber">3.2</span> <span class="toctext">Vim</span></a></li>
<li class="toclevel-2 tocsection-6"><a href="#alot"><span class="tocnumber">3.3</span> <span class="toctext">alot</span></a></li>
<li class="toclevel-2 tocsection-7"><a href="#bower"><span class="tocnumber">3.4</span> <span class="toctext">bower</span></a></li>
<li class="toclevel-2 tocsection-8"><a href="#mutt-kz"><span class="tocnumber">3.5</span> <span class="toctext">mutt-kz</span></a></li>
<li class="toclevel-2 tocsection-9"><a href="#Neomutt"><span class="tocnumber">3.6</span> <span class="toctext">Neomutt</span></a></li>
<li class="toclevel-2 tocsection-10"><a href="#ner"><span class="tocnumber">3.7</span> <span class="toctext">ner</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-11">
<a href="#Integrating_with_mutt"><span class="tocnumber">4</span> <span class="toctext">Integrating with mutt</span></a>
<ul>
<li class="toclevel-2 tocsection-12"><a href="#notmuch-mutt_problems"><span class="tocnumber">4.1</span> <span class="toctext">notmuch-mutt problems</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-13"><a href="#Integrating_with_NeoMutt_.2F_mutt-kz"><span class="tocnumber">5</span> <span class="toctext">Integrating with NeoMutt / mutt-kz</span></a></li>
</ul>
</div>

<h2><span class="mw-headline" id="Overview">Overview</span></h2>
<p>Notmuch is written in C and an order of magnitude faster than sup-mail.
Notmuch can be terminated during the indexing process, on the next run it will continue where it left off.
Also like sup-mail, it does not provide a way to permanently delete unwanted email messages.
It doesn't fetch or send mails, nor does it store your email addresses, you'll need to use programs like <a href="../en/OfflineIMAP.html" title="OfflineIMAP">OfflineIMAP</a>, <a href="../en/Msmtp.html" title="Msmtp">msmtp</a> and <i>abook</i> for those tasks.
</p>
<p>Notmuch is available in the <a href="../en/Official_repositories.html" title="Official repositories">official repositories</a>: <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://www.archlinux.org/packages/?name=notmuch">notmuch</a></span> or <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/notmuch-git/">notmuch-git</a></span><sup><small>AUR</small></sup><sup>[<a href="../en/ArchWiki:Requests.html#Broken_package_links" title="ArchWiki:Requests">broken link</a>: archived in <a rel="nofollow" class="external text" href="https://github.com/felixonmars/aur3-mirror/tree/master/notmuch-git">aur-mirror</a>]</sup> from the <a href="../en/Arch_User_Repository.html" title="AUR" class="mw-redirect">AUR</a>
</p>
<p>It provides <a href="../en/Python.html" title="Python">python</a>, <a href="../en/Vim.html" title="Vim">vim</a>, and <a href="../en/Emacs.html" title="Emacs">emacs</a> bindings.
</p>
<h2><span class="mw-headline" id="First_time_Usage">First time Usage</span></h2>
<p>After installation, you enter an interactive setup by running:
</p>
<pre> notmuch setup
</pre>
<p>The program prompts you for the location of your maildir and your primary and secondary email addresses. You can also edit the config file directly which is created by default at <code>$HOME/.notmuch-config</code>.
</p>
<p>Subsequent re-indexing of the mail directories is done with:
</p>
<pre> notmuch new
</pre>
<h2><span class="mw-headline" id="Frontends">Frontends</span></h2>
<p>There are <a rel="nofollow" class="external text" href="http://notmuchmail.org/frontends/">a range of ways to use notmuch</a>, including cli, or with one of the Unix $EDITORS:
</p>
<h3><span class="mw-headline" id="Emacs">Emacs</span></h3>
<p>The default frontend for notmuch is Emacs. It is developed by the same people that develop notmuch.
</p>
<h3><span class="mw-headline" id="Vim">Vim</span></h3>
<p>There's a vim interface available and included in notmuch. To start it, type:
</p>
<pre>vim -c NotMuch
</pre>
<h3><span class="mw-headline" id="alot">alot</span></h3>
<p>alot is a standalone CLI interface for notmuch, written in python. It is available from <a href="../en/Arch_User_Repository.html" title="AUR" class="mw-redirect">AUR</a> as <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/alot/">alot</a></span><sup><small>AUR</small></sup> or <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/alot-git/">alot-git</a></span><sup><small>AUR</small></sup>.
</p>
<p>Alot uses <a href="https://en.wikipedia.org/wiki/Mailcap" class="extiw" title="wikipedia:Mailcap">mailcap</a> for handling different kinds of files. This currently includes html mails, which means that you need to configure a <code>~/.mailcap</code> file in order to view html mails. As minimum, put this line into your <code>~/.mailcap</code>:
</p>
<pre> text/html; w3m -dump -o -document_charset=%{charset}Â %s; nametemplate=%s.html; copiousoutput
</pre>
<p>This uses <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://www.archlinux.org/packages/?name=w3m">w3m</a></span>, some other text based clients such as <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://www.archlinux.org/packages/?name=links">links</a></span> or <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://www.archlinux.org/packages/?name=lynx">lynx</a></span> can be used instead, although their arguments might differ.
</p>
<p>More file handlers can be configured of course.
</p>
<h3><span class="mw-headline" id="bower">bower</span></h3>
<p><a rel="nofollow" class="external text" href="https://github.com/wangp/bower">bower</a> is another CLI interface, this one is written in <a rel="nofollow" class="external text" href="https://mercurylang.org/">Mercury</a>.
</p>
<h3><span class="mw-headline" id="mutt-kz">mutt-kz</span></h3>
<p><a rel="nofollow" class="external text" href="http://kzak.redcrew.org/doku.php?id=mutt:start">mutt-kz</a> - A fork of mutt with integrated notmuch. It has a virtual folder support and talks directly to libnotmuch, avoiding hacks with symbolic links. It is available from <a href="../en/Arch_User_Repository.html" title="AUR" class="mw-redirect">AUR</a> as <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/mutt-kz/">mutt-kz</a></span><sup><small>AUR</small></sup> or <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/mutt-kz-git/">mutt-kz-git</a></span><sup><small>AUR</small></sup>.
</p>
<h3><span class="mw-headline" id="Neomutt">Neomutt</span></h3>
<p><a rel="nofollow" class="external text" href="http://www.neomutt.org/">Neomutt</a> - Another mutt fork which includes many feature patches, among them the <a rel="nofollow" class="external text" href="http://www.neomutt.org/feature/notmuch/">Notmuch</a> integration patch. Install from the <a href="../en/Arch_User_Repository.html" title="AUR" class="mw-redirect">AUR</a> as <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/neomutt/">neomutt</a></span><sup><small>AUR</small></sup> or <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/neomutt-git/">neomutt-git</a></span><sup><small>AUR</small></sup>.
</p>
<h3><span class="mw-headline" id="ner">ner</span></h3>
<p><a rel="nofollow" class="external text" href="http://the-ner.org/">ner</a> - notmuch email reader - is yet another CLI interface, apparently written in C++.
</p>
<p><span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/ner-git/">ner-git</a></span><sup><small>AUR</small></sup><sup>[<a href="../en/ArchWiki:Requests.html#Broken_package_links" title="ArchWiki:Requests">broken link</a>: archived in <a rel="nofollow" class="external text" href="https://github.com/felixonmars/aur3-mirror/tree/master/ner-git">aur-mirror</a>]</sup> is available from the <a href="../en/Arch_User_Repository.html" title="AUR" class="mw-redirect">AUR</a>.
</p>
<h2><span class="mw-headline" id="Integrating_with_mutt">Integrating with mutt</span></h2>
<p>If you use <a href="../en/Mutt.html" title="Mutt">mutt</a> as your MUA, then notmuch is an excellent complementary tool to index and search your mail. The <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://www.archlinux.org/packages/?name=notmuch-mutt">notmuch-mutt</a></span> package provides a script to integrate notmuch with mutt.
</p>
<p>After installing the <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://www.archlinux.org/packages/?name=notmuch-mutt">notmuch-mutt</a></span> package and configuring notmuch, the only thing left before using notmuch to search from mutt is adding keybindings to call the <code>notmuch-mutt</code> perl script from mutt. Adding the following to your <code>.muttrc</code> is what is recommended in notmuch contrib source:
</p>
<pre>macro index &lt;F8&gt; \
     "&lt;enter-command&gt;unset wait_key&lt;enter&gt;&lt;shell-escape&gt;notmuch-mutt --prompt search&lt;enter&gt;&lt;change-folder-readonly&gt;`echo ${XDG_CACHE_HOME:-$HOME/.cache}/notmuch/mutt/results`&lt;enter&gt;" \
     "notmuch: search mail"
macro index &lt;F9&gt; \
     "&lt;enter-command&gt;unset wait_key&lt;enter&gt;&lt;pipe-message&gt;notmuch-mutt thread&lt;enter&gt;&lt;change-folder-readonly&gt;`echo ${XDG_CACHE_HOME:-$HOME/.cache}/notmuch/mutt/results`&lt;enter&gt;&lt;enter-command&gt;set wait_key&lt;enter&gt;" \
     "notmuch: reconstruct thread"
macro index &lt;F6&gt; \
     "&lt;enter-command&gt;unset wait_key&lt;enter&gt;&lt;pipe-message&gt;notmuch-mutt tag -inbox&lt;enter&gt;" \
     "notmuch: remove message from inbox"
</pre>
<p>The above uses <code>F8</code> to search your inbox using notmuch, <code>F9</code> to create threads from search results, and <code>F6</code> to tag search results.
</p>
<h3><span class="mw-headline" id="notmuch-mutt_problems">notmuch-mutt problems</span></h3>
<p>There can sometimes be disagreement between pacman-installed and managed perl modules and perl modules installed via cpan/cpanm. An error message of the format:
</p>
<pre>Gnu.c: loadable library and perl binaries are mismatched (got handshake key 0xdb00080, needed 0xdb80080)
</pre>
<p>can indicate that some of the notmuch-mutt dependencies are installed via cpan while some are installed and managed via pacman, and that you should install all dependencies via one or the other method.
</p>
<h2><span class="mw-headline" id="Integrating_with_NeoMutt_.2F_mutt-kz">Integrating with NeoMutt / mutt-kz</span></h2>
<p>If you use either <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/neomutt/">neomutt</a></span><sup><small>AUR</small></sup>, <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/mutt-kz/">mutt-kz</a></span><sup><small>AUR</small></sup> or mutt with notmuch-patches, the <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://www.archlinux.org/packages/?name=notmuch-mutt">notmuch-mutt</a></span> package is not needed. Instead, create a <code>~/.mailboxes</code> with some basic (virtual) mailboxes. A virtual mailbox is not an actual folder, but the result of a notmuch query for a specific tag:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">~/.mailboxes</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">virtual-mailboxes "inbox" "notmuch://?query=tag:inbox"
virtual-mailboxes "archive" "notmuch://?query=tag:archive"
virtual-mailboxes "sent" "notmuch://?query=tag:sent"
virtual-mailboxes "newsletters" "notmuch://?query=tag:newsletters"</pre>
<p>Next, make mutt aware of your virtual mailboxes by enabling virtual spoolfile and sourcing the latter:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">~/.muttrc</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">set virtual_spoolfile=yes
source ~/.mailboxes</pre>
<p>At this point, mutt will still list your mailboxes as empty, because your mails are not yet tagged and thus, notmuch querys are empty. To fill your vitual mailboxes, you need to initially tag the messages in your maildir. A very simple approach is to create a shell script like the following:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">~/.scripts/notmuch-hook.sh</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">#!/bin/sh
notmuch new
# retag all "new" messages "inbox" and "unread"
notmuch tag +inbox +unread -new -- tag:new
# tag all messages from "me" as sent and remove tags inbox and unread
notmuch tag -new -inbox +sent -- from:me@example.org or from:me@myself.com
# tag newsletters, but dont show them in inbox
notmuch tag +newsletters +unread -new -- from:newsletter@example.org or subject:'newsletter*'</pre>
<p>Make the shell script executable and run it:
</p>
<pre> chmod +x ~/.scripts/notmuch-hook.sh
 ~/.scripts/notmuch-hook.sh
</pre>
<p>For the above example to work, make sure that notmuch tags new messages as 'new':
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">~/.notmuch-config</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[new]
tags=new</pre>
<p>Finally, your hook script needs to rerun on new mail arrival. If you use <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://www.archlinux.org/packages/?name=offlineimap">offlineimap</a></span> to sync IMAP to a local maildir, create a post sync hook:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">~/.offlineimaprc</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[Account myaccount]
postsynchook = ~/.scripts/notmuch-hook.sh</pre>
<p>Some useful key bindings:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">~/.muttrc</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">macro index A "&lt;modify-labels&gt;+archive -unread -inbox\\n" "Archive message"
macro index c "&lt;change-vfolder&gt;?" "Change to vfolder overview"
macro index \\\\ "&lt;vfolder-from-query&gt;" "Search mailbox"</pre>

</div>
<div id="catlinks" class="catlinks">
<div id="mw-normal-catlinks" class="mw-normal-catlinks">
<a href="../Special:Categories.html" title="Special:Categories">Category</a>: <ul><li><a href="../en/Category:Email_clients.html" title="Category:Email clients">Email clients</a></li></ul>
</div>
<div id="mw-hidden-catlinks" class="mw-hidden-catlinks mw-hidden-cats-hidden">Hidden category: <ul><li><a href="../en/Category:Pages_with_broken_package_links.html" title="Category:Pages with broken package links">Pages with broken package links</a></li></ul>
</div>
</div>					<div class="visualClear"></div>
				</div>
			</div>
		</div>
		<div class="visualClear"></div>
					<div id="footer" role="contentinfo">
Extracted from <a href="https://wiki.archlinux.org"> ArchWiki </a> and licensed under <a href="http://www.gnu.org/copyleft/fdl.html"> GDL >= 1.3</a>
		</div>
		</div>
		</body>
</html>
