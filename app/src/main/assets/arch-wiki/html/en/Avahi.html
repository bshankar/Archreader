<!DOCTYPE html>
<html lang="en" dir="ltr" class="client-nojs">
<head>
<meta charset="UTF-8">
<title>Avahi - ArchWiki</title>
<link rel="stylesheet" href="../ArchWikiOffline.css">
<meta name="ResourceLoaderDynamicStyles" content="">
<style></style>
<meta name="generator" content="MediaWiki 1.26.4">
<meta name="robots" content="noindex,follow">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="search" type="application/opensearchdescription+xml" href="/opensearch_desc.php" title="ArchWiki (en)">
<link rel="EditURI" type="application/rsd+xml" href="https://wiki.archlinux.org/api.php?action=rsd">
<link rel="copyright" href="http://www.gnu.org/copyleft/fdl.html">
<link rel="alternate" type="application/atom+xml" title="ArchWiki Atom feed" href="/index.php?title=Special:RecentChanges&amp;feed=atom">
</head>
<body class="mediawiki ltr sitedir-ltr ns-0 ns-subject page-Avahi skin-archlinux action-view">

		<div id="globalWrapper" style="width: 100%">
		<div id="column-content">
			<div id="content" class="mw-body" role="main" style="margin: 0.5em; margin-bottom:0; margin-top:0">
				<a id="top"></a>
				
				<div class="mw-indicators">
</div>
				<h1 id="firstHeading" class="firstHeading" lang="en">Avahi</h1>
				
				<div id="bodyContent" class="mw-body-content">
					<div id="contentSub"></div>
										<div id="mw-content-text" lang="en" dir="ltr" class="mw-content-ltr">
<p>From <a href="https://en.wikipedia.org/wiki/Avahi_(software)" class="extiw" title="wikipedia:Avahi (software)">Wikipedia:Avahi (software)</a>:
</p>
<dl><dd>
<a rel="nofollow" class="external text" href="http://avahi.org/">Avahi</a> is a free <a href="https://en.wikipedia.org/wiki/Zero-configuration_networking" class="extiw" title="wikipedia:Zero-configuration networking">Zero-configuration networking</a> (zeroconf) implementation, including a system for multicast DNS/DNS-SD service discovery. It allows programs to publish and discover services and hosts running on a local network with no specific configuration. For example you can plug into a network and instantly find printers to print to, files to look at and people to talk to. It is licensed under the GNU Lesser General Public License (LGPL).</dd></dl>
<div id="toc" class="toc">
<div id="toctitle"><h2>Contents</h2></div>
<ul>
<li class="toclevel-1 tocsection-1"><a href="#Installation"><span class="tocnumber">1</span> <span class="toctext">Installation</span></a></li>
<li class="toclevel-1 tocsection-2">
<a href="#Using_Avahi"><span class="tocnumber">2</span> <span class="toctext">Using Avahi</span></a>
<ul>
<li class="toclevel-2 tocsection-3">
<a href="#Hostname_resolution"><span class="tocnumber">2.1</span> <span class="toctext">Hostname resolution</span></a>
<ul>
<li class="toclevel-3 tocsection-4"><a href="#Configuring_mDNS_for_custom_TLD"><span class="tocnumber">2.1.1</span> <span class="toctext">Configuring mDNS for custom TLD</span></a></li>
<li class="toclevel-3 tocsection-5"><a href="#Tools"><span class="tocnumber">2.1.2</span> <span class="toctext">Tools</span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-6"><a href="#Firewall"><span class="tocnumber">2.2</span> <span class="toctext">Firewall</span></a></li>
<li class="toclevel-2 tocsection-7"><a href="#Link-Local_.28Bonjour.2FZeroconf.29_chat"><span class="tocnumber">2.3</span> <span class="toctext">Link-Local (Bonjour/Zeroconf) chat</span></a></li>
<li class="toclevel-2 tocsection-8"><a href="#Obtaining_IPv4LL_IP_address"><span class="tocnumber">2.4</span> <span class="toctext">Obtaining IPv4LL IP address</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-9">
<a href="#Adding_services"><span class="tocnumber">3</span> <span class="toctext">Adding services</span></a>
<ul>
<li class="toclevel-2 tocsection-10"><a href="#SSH"><span class="tocnumber">3.1</span> <span class="toctext">SSH</span></a></li>
<li class="toclevel-2 tocsection-11">
<a href="#File_sharing"><span class="tocnumber">3.2</span> <span class="toctext">File sharing</span></a>
<ul>
<li class="toclevel-3 tocsection-12"><a href="#NFS"><span class="tocnumber">3.2.1</span> <span class="toctext">NFS</span></a></li>
<li class="toclevel-3 tocsection-13"><a href="#Samba"><span class="tocnumber">3.2.2</span> <span class="toctext">Samba</span></a></li>
<li class="toclevel-3 tocsection-14"><a href="#Vsftpd"><span class="tocnumber">3.2.3</span> <span class="toctext">Vsftpd</span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-15"><a href="#Airprint_from_Mobile_Devices"><span class="tocnumber">3.3</span> <span class="toctext">Airprint from Mobile Devices</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-16">
<a href="#Modifying_the_service-types_database"><span class="tocnumber">4</span> <span class="toctext">Modifying the service-types database</span></a>
<ul>
<li class="toclevel-2 tocsection-17"><a href="#Getting_the_sources"><span class="tocnumber">4.1</span> <span class="toctext">Getting the sources</span></a></li>
<li class="toclevel-2 tocsection-18">
<a href="#Modify_the_sources"><span class="tocnumber">4.2</span> <span class="toctext">Modify the sources</span></a>
<ul>
<li class="toclevel-3 tocsection-19"><a href="#Build_and_install_the_new_database"><span class="tocnumber">4.2.1</span> <span class="toctext">Build and install the new database</span></a></li>
</ul>
</li>
</ul>
</li>
<li class="toclevel-1 tocsection-20"><a href="#See_also"><span class="tocnumber">5</span> <span class="toctext">See also</span></a></li>
</ul>
</div>

<h2><span class="mw-headline" id="Installation">Installation</span></h2>
<p><a href="../en/Help:Reading.html#Installation_of_packages" title="Install" class="mw-redirect">Install</a> the <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://www.archlinux.org/packages/?name=avahi">avahi</a></span> package.
</p>
<p>You can manage the Avahi daemon with <code>avahi-daemon.service</code> <a href="../en/Systemd.html#Using_units" title="Systemd">using systemd</a>.
</p>
<h2><span class="mw-headline" id="Using_Avahi">Using Avahi</span></h2>
<h3><span class="mw-headline" id="Hostname_resolution">Hostname resolution</span></h3>
<p>Avahi provides local hostname resolution using a "<i>hostname</i>.local" naming scheme. To enable it, install the <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://www.archlinux.org/packages/?name=nss-mdns">nss-mdns</a></span> package and start <code>avahi-daemon.service</code>.
</p>
<p>Then, edit the file <code>/etc/nsswitch.conf</code> and change the line:
</p>
<pre>hosts: files dns myhostname
</pre>
<p>to:
</p>
<pre>hosts: files mdns_minimal [NOTFOUND=return] dns myhostname
</pre>
<div style="padding: 5px; margin: 0.50em 0; background-color: #DDDDFF; border: thin solid #BBBBDD; overflow: hidden;">
<strong> Note: </strong>If you experience slowdowns in resolving <code>.local</code> hosts try to use <code>mdns4_minimal</code> instead of <code>mdns_minimal</code>.</div>
<h4><span class="mw-headline" id="Configuring_mDNS_for_custom_TLD">Configuring mDNS for custom TLD</span></h4>
<p>The <code>mdns_minimal</code> module handles queries for the <code>.local</code> TLD only. Note the <code>[NOTFOUND=return]</code>, which specifies that if <code>mdns_minimal</code> cannot find <code>*.local</code>, it will not continue to search for it in <code>dns</code>, <code>myhostname</code>, etc.
</p>
<p>In case you want Avahi to support other TLDs, you should:
</p>
<ul>
<li> replace <code>mdns_minimal [NOTFOUND=return]</code> with the full <code>mdns</code> module. There also are IPv4-only and IPv6-only modules <code>mdns[46](_minimal)</code>
</li>
<li> customize <code>/etc/avahi/avahi-daemon.conf</code> with the <code>domain-name</code> of your choice</li>
<li> whitelist Avahi custom TLDs in <code>/etc/mdns.allow</code>
</li>
</ul>
<h4><span class="mw-headline" id="Tools">Tools</span></h4>
<p>Avahi includes several utilities which help you discover the services running on a network. For example, run
</p>
<pre>$ avahi-browse -alr
</pre>
<p>to discover services in your network.
</p>
<p>The Avahi Zeroconf Browser (<code>avahi-discover</code> â€“ note that it needs avahi's optional dependencies <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://www.archlinux.org/packages/?name=pygtk">pygtk</a></span> and <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://www.archlinux.org/packages/?name=python2-dbus">python2-dbus</a></span>) shows the various services on your network. You can also browse SSH and VNC Servers using <code>bssh</code> and <code>bvnc</code> respectively.
</p>
<p>There's a good list of software with Avahi support at their website: <a rel="nofollow" class="external free" href="http://avahi.org/wiki/Avah4users">http://avahi.org/wiki/Avah4users</a>
</p>
<h3><span class="mw-headline" id="Firewall">Firewall</span></h3>
<p>Be sure to open UDP port 5353 if you're using iptables:
</p>
<pre> # iptables -A INPUT -p udp -m udp --dport 5353 -j ACCEPT
</pre>
<p>If you're following the more-than-useful <a href="../en/Simple_stateful_firewall.html" title="Simple stateful firewall">Simple stateful firewall</a> format for your firewall:
</p>
<pre> # iptables -A UDP -p udp -m udp --dport 5353 -j ACCEPT
</pre>
<h3><span class="mw-headline" id="Link-Local_.28Bonjour.2FZeroconf.29_chat">Link-Local (Bonjour/Zeroconf) chat</span></h3>
<p>Avahi can be used for bonjour protocol support under linux. Check <a href="https://en.wikipedia.org/wiki/Comparison_of_instant_messaging_clients" class="extiw" title="wikipedia:Comparison of instant messaging clients">Wikipedia:Comparison of instant messaging clients</a> or <a href="../en/List_of_applications.html#Instant_messaging" title="List of applications">List of applications#Instant messaging</a> for a list of clients supporting the bonjour protocol.
</p>
<h3><span class="mw-headline" id="Obtaining_IPv4LL_IP_address">Obtaining IPv4LL IP address</span></h3>
<div class="noprint archwiki-template-message">
<p><a href="../File:Merge-arrows-2.png" class="image"><img alt="Merge-arrows-2.png" src="../File:Merge-arrows-2.png" width="48" height="48"></a><b>This article or section is a candidate for merging with <a href="../en/Dhcpcd.html" title="Dhcpcd">dhcpcd</a>.</b><a href="../File:Merge-arrows-2.png" class="image"><img alt="Merge-arrows-2.png" src="../File:Merge-arrows-2.png" width="48" height="48"></a></p>
<div>
<b>Notes:</b> should be merged into the main page (Discuss in <a rel="nofollow" class="external text" href="https://wiki.archlinux.org/index.php/Talk:Avahi">Talk:Avahi#</a>)</div>
</div>
<p>By default, if you are getting IP using DHCP, you are using the <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://www.archlinux.org/packages/?name=dhcpcd">dhcpcd</a></span> package. It can attempt to obtain an IPv4LL address if it failed to get one via DHCP. By default this option is disabled. To enable it, comment noipv4ll string:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/dhcpcd.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">
...
#noipv4ll
...</pre>
<p>Alternatively, run <code>avahi-autoipd</code>:
</p>
<pre># avahi-autoipd -D
</pre>
<h2><span class="mw-headline" id="Adding_services">Adding services</span></h2>
<p>Avahi advertises the services whose <code>*.service</code> files are found in <code>/etc/avahi/services</code>. If you want to advertise a service for which there is no <code>*.service</code> file, it is very easy to create your own.
</p>
<p>As an example, let's say you wanted to advertise a quote of the day (QOTD) service operating per <a rel="nofollow" class="external text" href="http://tools.ietf.org/html/rfc865">RFC865</a> on TCP port 17 which you are running on your machine
</p>
<p>The first thing to do is to determine the <code>&lt;type&gt;</code>. <code>man avahi.service</code> indicates that the 
type should be "the DNS-SD service type for this service. e.g. '_http._tcp'". Since the <a rel="nofollow" class="external text" href="http://www.dns-sd.org/ServiceTypes.html">DNS-SD register was merged into the IANA register in 2010</a>, we look for the service name on the <a rel="nofollow" class="external text" href="http://www.iana.org/assignments/service-names-port-numbers/service-names-port-numbers.xhtml">IANA register</a> or in <code>/etc/services</code> file. The service name shown there is <code>qotd</code>. Since we're running QOTD on tcp, we now know the service is <code>_qotd._tcp</code> and the port (per IANA and RFC865) is 17.
</p>
<p>Our service file is thus:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">qotd.service</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">
&lt;?xml version="1.0" standalone='no'?&gt;&lt;!--*-nxml-*--&gt;
&lt;!DOCTYPE service-group SYSTEM "avahi-service.dtd"&gt;

&lt;service-group&gt;

  &lt;name replace-wildcards="yes"&gt;%h&lt;/name&gt;

  &lt;service&gt;
    &lt;type&gt;_qotd._tcp&lt;/type&gt;
    &lt;port&gt;17&lt;/port&gt;
  &lt;/service&gt;

&lt;/service-group&gt;
</pre>
<p>For more complicated scenarios, such as advertising services running on a different server, DNS sub-types and so on, consult <code>man avahi.service</code>.
</p>
<h3><span class="mw-headline" id="SSH">SSH</span></h3>
<p>Avahi comes with an example service file to advertise a SSH server. To enable it:
</p>
<pre># cp /usr/share/doc/avahi/ssh.service /etc/avahi/services/
</pre>
<h3><span class="mw-headline" id="File_sharing">File sharing</span></h3>
<h4><span class="mw-headline" id="NFS">NFS</span></h4>
<p>If you have an <a href="../en/NFS.html" title="NFS">NFS</a> share set up, you can use Avahi to be able to automount them in Zeroconf-enabled browsers (such as Konqueror on KDE and Finder on macOS).
</p>
<p>Create a <code>.service</code> file in <code>/etc/avahi/services</code> with the following contents:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/avahi/services/nfs_Zephyrus_Music.service</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">
&lt;?xml version="1.0" standalone='no'?&gt;
&lt;!DOCTYPE service-group SYSTEM "avahi-service.dtd"&gt;
&lt;service-group&gt;
  &lt;name replace-wildcards="yes"&gt;NFS Music Share on %h&lt;/name&gt;
  &lt;service&gt;
    &lt;type&gt;_nfs._tcp&lt;/type&gt;
    &lt;port&gt;2049&lt;/port&gt;
    &lt;txt-record&gt;path=/data/shared/Music&lt;/txt-record&gt;
  &lt;/service&gt;
&lt;/service-group&gt;</pre>
<p>The port is correct if you have <i>insecure</i> as an option in your <code>/etc/exports</code>; otherwise, it needs to be changed (note that <i>insecure</i> is needed for macOS clients). The path is the path to your export, or a subdirectory of it. For some reason the automount functionality has been removed from Leopard, however <a rel="nofollow" class="external text" href="http://www.macosxhints.com/article.php?story=20071116042238744">a script is available</a>. This was based upon <a rel="nofollow" class="external text" href="http://ubuntuforums.org/showthread.php?p=4387032#post4387032">this post</a>.
</p>
<h4><span class="mw-headline" id="Samba">Samba</span></h4>
<p>With the Avahi daemon running on both the server and client, the file manager on the client should automatically find the server.
</p>
<h4><span class="mw-headline" id="Vsftpd">Vsftpd</span></h4>
<p>You can also auto-discover regular FTP servers, such as vsftpd. Install the <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://www.archlinux.org/packages/?name=vsftpd">vsftpd</a></span> package and change the settings of vsftpd according to your own personal preferences (see <a rel="nofollow" class="external text" href="http://ubuntuforums.org/showthread.php?t=218630">this thread on ubuntuforums.org</a> or <code>man vsftpd.conf</code>).
</p>
<p>Create a <code>.service</code> file in <code>/etc/avahi/services</code> with the following contents:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/avahi/services/ftp.service</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">
&lt;?xml version="1.0" standalone='no'?&gt;
&lt;!DOCTYPE service-group SYSTEM "avahi-service.dtd"&gt;
&lt;service-group&gt;
  &lt;name&gt;FTP file sharing&lt;/name&gt;
  &lt;service&gt;
    &lt;type&gt;_ftp._tcp&lt;/type&gt;
    &lt;port&gt;21&lt;/port&gt;
  &lt;/service&gt;
&lt;/service-group&gt;
</pre>
<p>The FTP server should now be advertised by Avahi. You should now be able to find the FTP server from a file manager on another computer in your network. You might need to enable <a href="#Hostname_resolution">#Hostname resolution</a> on the client.
</p>
<h3><span class="mw-headline" id="Airprint_from_Mobile_Devices">Airprint from Mobile Devices</span></h3>
<p>Avahi along with CUPS also provides the capability to print to just about any printer from airprint compatible mobile devices. In order to enable print capability from your device, simply create an Avahi service file for your printer in <code>/etc/avahi/services/</code>. An example of a generic services file for an HP-Laserjet printer would be similar to the following with the <code>name</code>, <code>rp</code>, <code>ty</code>, <code>adminurl</code> and <code>note</code> fields changed.
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/avahi/services/airprint.service</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">
&lt;?xml version="1.0" standalone='no'?&gt;&lt;!--*-nxml-*--&gt;
&lt;!DOCTYPE service-group SYSTEM "avahi-service.dtd"&gt;
&lt;service-group&gt;
  &lt;name&gt;yourPrnterName&lt;/name&gt;
  &lt;service&gt;
    &lt;type&gt;_ipp._tcp&lt;/type&gt;
    &lt;subtype&gt;_universal._sub._ipp._tcp&lt;/subtype&gt;
    &lt;port&gt;631&lt;/port&gt;
    &lt;txt-record&gt;txtver=1&lt;/txt-record&gt;
    &lt;txt-record&gt;qtotal=1&lt;/txt-record&gt;
    &lt;txt-record&gt;rp=printers/yourPrnterName&lt;/txt-record&gt;
    &lt;txt-record&gt;ty=yourPrnterName&lt;/txt-record&gt;
    &lt;txt-record&gt;adminurl=http://198.168.7.15:631/printers/yourPrnterName&lt;/txt-record&gt;
    &lt;txt-record&gt;note=Office Laserjet 4100n&lt;/txt-record&gt;
    &lt;txt-record&gt;priority=0&lt;/txt-record&gt;
    &lt;txt-record&gt;product=(GPL Ghostscript)&lt;/txt-record&gt;
    &lt;txt-record&gt;printer-state=3&lt;/txt-record&gt;
    &lt;txt-record&gt;printer-type=0x801046&lt;/txt-record&gt;
    &lt;txt-record&gt;Transparent=T&lt;/txt-record&gt;
    &lt;txt-record&gt;Binary=T&lt;/txt-record&gt;
    &lt;txt-record&gt;Fax=F&lt;/txt-record&gt;
    &lt;txt-record&gt;Color=T&lt;/txt-record&gt;
    &lt;txt-record&gt;Duplex=T&lt;/txt-record&gt;
    &lt;txt-record&gt;Staple=F&lt;/txt-record&gt;
    &lt;txt-record&gt;Copies=T&lt;/txt-record&gt;
    &lt;txt-record&gt;Collate=F&lt;/txt-record&gt;
    &lt;txt-record&gt;Punch=F&lt;/txt-record&gt;
    &lt;txt-record&gt;Bind=F&lt;/txt-record&gt;
    &lt;txt-record&gt;Sort=F&lt;/txt-record&gt;
    &lt;txt-record&gt;Scan=F&lt;/txt-record&gt;
    &lt;txt-record&gt;pdl=application/octet-stream,application/pdf,application/postscript,image/jpeg,image/png,image/urf&lt;/txt-record&gt;
    &lt;txt-record&gt;URF=W8,SRGB24,CP1,RS600&lt;/txt-record&gt;
  &lt;/service&gt;
&lt;/service-group&gt;
</pre>
<p>Alternatively, <a rel="nofollow" class="external free" href="https://raw.github.com/tjfontaine/airprint-generate/master/airprint-generate.py">https://raw.github.com/tjfontaine/airprint-generate/master/airprint-generate.py</a> can be used to generate Avahi service files. It depends on <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://www.archlinux.org/packages/?name=python2">python2</a></span> and <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://www.archlinux.org/packages/?name=python2-pycups">python2-pycups</a></span>. The script can be run using:
</p>
<pre># python2 airprint-generate.py -d /etc/avahi/services
</pre>
<div style="padding: 5px; margin: 0.50em 0; background-color: #DDDDFF; border: thin solid #BBBBDD; overflow: hidden;">
<strong> Note: </strong>If your printer under <a rel="nofollow" class="external free" href="http://localhost:631/printers">http://localhost:631/printers</a> is "Not Shared", this python script won't output any file to /etc/avahi/services; in that case, you'll need to "Modify Printer" under one of the CUPS drop-down menus to turn sharing on.  If that doesn't work, check out the ArchWiki on <a href="../en/CUPS/Printer_sharing.html" title="CUPS printer sharing" class="mw-redirect">CUPS printer sharing</a>.</div>
<h2><span class="mw-headline" id="Modifying_the_service-types_database">Modifying the service-types database</span></h2>
<p>As noted above, avahi comes with tools to browse advertised services. Both <code>avahi-browse</code> and <code>avahi-discover</code> use a database file to furnish descriptions of the relevant service. That database contains the names of many, but not all, services.
</p>
<p>Sadly, it doesn't contain the QOTD service we just created. Thus <code>avahi-browse -a</code> would show the following ugly entry
</p>
<pre>+ wlp2s0 IPv4 MyServer                                        _qotd._tcp local
</pre>
<h3><span class="mw-headline" id="Getting_the_sources">Getting the sources</span></h3>
<p>First, download the files <code>build-db.in</code> and <code>service-types</code> files from the <code>service-type-database</code> subdirectory in the <a rel="nofollow" class="external text" href="https://github.com/lathiat/avahi">the avahi github mirror</a> to a build directory.
</p>
<pre>wget <a rel="nofollow" class="external free" href="https://raw.githubusercontent.com/lathiat/avahi/master/service-type-database/build-db.in">https://raw.githubusercontent.com/lathiat/avahi/master/service-type-database/build-db.in</a>
wget <a rel="nofollow" class="external free" href="https://raw.githubusercontent.com/lathiat/avahi/master/service-type-database/service-types">https://raw.githubusercontent.com/lathiat/avahi/master/service-type-database/service-types</a>
</pre>
<h3><span class="mw-headline" id="Modify_the_sources">Modify the sources</span></h3>
<p>Second, create the following script:
</p>
<pre>#!/bin/bash
sed -e 's,@PYTHON\@,/usr/bin/python2.7,g' \
    -e 's,@DBM\@,gdbm,g' &lt; build-db.in &gt; build-db
chmod +x build-db
</pre>
<p>This mimics what the Makefile would do if one were building all of avahi. It creates a file named build-db.
</p>
<pre>$./whatever_you_named_the_script.sh
$ ls
build-db build-db.in service-types whatever_you_named_the_script.sh
</pre>
<p>Third, make the changes needed to add your new QOTD service to the <code>service-types</code> file. This file has one entry per line, with the entries in the format <code>type:Human Readable Description</code>. Note that the human readable description can contain spaces.
</p>
<p>In our example, we add the following entry to the end of the file:
</p>
<pre>_qotd._tcp:Quote of the Day (QOTD) Server
</pre>
<h4><span class="mw-headline" id="Build_and_install_the_new_database">Build and install the new database</span></h4>
<p>Now run the <code>build-db</code> python script (be sure to use python2 not python3). This will build the <code>service-types.db</code> file. Check to make sure it's been built and use <code>gdbmtools</code> to make sure the new database is loadable and contains the new entry: 
</p>
<pre>$/usr/bin/python2.7 build-db
$ls
build-db build-db.in service-types service-types.db whatever_you_named_the_script.sh
$gdbmtool service-types.db

Welcome to the gdbm tool.  TypeÂ ? for help.

gdbmtool&gt;fetch _qotd._tcp
Quote of the Day (QOTD) Server
gdbmtool&gt;quit
</pre>
<p>Now copy the old database to a backup location, move the new database to the live directory and use <code>avahi-browse</code> database dump command to make sure avahi sees the new entry:
</p>
<pre>$cp /usr/lib/avahi/service-types.db /backup-directory
$sudo cp /build-directory/service-types.db /usr/lib/avahi/service-types.db
$avahi-browse -b | grep QOTD
Quote of the Day (QOTD) Server
</pre>
<p>The entry in <code>avahi-browse</code> should now be:
</p>
<pre>+ wlp2s0 IPv4 MyServer                                        Quote of the Day (QOTD) Server local
</pre>
<h2><span class="mw-headline" id="See_also">See also</span></h2>
<ul>
<li> <a rel="nofollow" class="external text" href="http://avahi.org/">Avahi</a> - Official project website</li>
<li> <a href="https://en.wikipedia.org/wiki/Avahi_(software)" class="extiw" title="wikipedia:Avahi (software)">Wikipedia entry</a>
</li>
<li> <a rel="nofollow" class="external text" href="http://www.apple.com/support/downloads/bonjourforwindows.html">Bonjour for Windows</a> - Enable Zeroconf on Windows</li>
<li> <a rel="nofollow" class="external free" href="http://www.zeroconf.org/">http://www.zeroconf.org/</a>
</li>
</ul>

</div>
<div id="catlinks" class="catlinks">
<div id="mw-normal-catlinks" class="mw-normal-catlinks">
<a href="../Special:Categories.html" title="Special:Categories">Category</a>: <ul><li><a href="../en/Category:Networking.html" title="Category:Networking">Networking</a></li></ul>
</div>
<div id="mw-hidden-catlinks" class="mw-hidden-catlinks mw-hidden-cats-hidden">Hidden category: <ul><li><a href="../en/Category:Pages_or_sections_flagged_with_Template:Merge.html" title="Category:Pages or sections flagged with Template:Merge">Pages or sections flagged with Template:Merge</a></li></ul>
</div>
</div>					<div class="visualClear"></div>
				</div>
			</div>
		</div>
		<div class="visualClear"></div>
					<div id="footer" role="contentinfo">
Extracted from <a href="https://wiki.archlinux.org"> ArchWiki </a> and licensed under <a href="http://www.gnu.org/copyleft/fdl.html"> GDL >= 1.3</a>
		</div>
		</div>
		</body>
</html>
