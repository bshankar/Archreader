<!DOCTYPE html>
<html lang="en" dir="ltr" class="client-nojs">
<head>
<meta charset="UTF-8">
<title>LVM - ArchWiki</title>
<link rel="stylesheet" href="../ArchWikiOffline.css">
<meta name="ResourceLoaderDynamicStyles" content="">
<style></style>
<meta name="generator" content="MediaWiki 1.26.4">
<meta name="robots" content="noindex,follow">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="search" type="application/opensearchdescription+xml" href="/opensearch_desc.php" title="ArchWiki (en)">
<link rel="EditURI" type="application/rsd+xml" href="https://wiki.archlinux.org/api.php?action=rsd">
<link rel="copyright" href="http://www.gnu.org/copyleft/fdl.html">
<link rel="alternate" type="application/atom+xml" title="ArchWiki Atom feed" href="/index.php?title=Special:RecentChanges&amp;feed=atom">
</head>
<body class="mediawiki ltr sitedir-ltr ns-0 ns-subject page-LVM skin-archlinux action-view">

		<div id="globalWrapper" style="width: 100%">
		<div id="column-content">
			<div id="content" class="mw-body" role="main" style="margin: 0.5em; margin-bottom:0; margin-top:0">
				<a id="top"></a>
				
				<div class="mw-indicators">
</div>
				<h1 id="firstHeading" class="firstHeading" lang="en">LVM</h1>
				
				<div id="bodyContent" class="mw-body-content">
					<div id="contentSub"></div>
										<div id="mw-content-text" lang="en" dir="ltr" class="mw-content-ltr">
<div style="width:45%; margin: 0 0 0.5em 0.5em;">
<p style="background:#333; color:white; padding:0.2em; border-bottom:5px #08c solid; margin:0; text-align:center; font-weight:bold;">Related articles</p>
<ul style="list-style-type:none; margin:0; padding:0.3em;">
<li style="padding:0.4em 0; line-height:1;"><a href="../en/Software_RAID_and_LVM.html" title="Software RAID and LVM">Software RAID and LVM</a></li>
<li style="padding:0.4em 0; line-height:1;"><a href="../en/Dm-crypt/Encrypting_an_entire_system.html#LVM_on_LUKS" title="Dm-crypt/Encrypting an entire system">dm-crypt/Encrypting an entire system#LVM on LUKS</a></li>
<li style="padding:0.4em 0; line-height:1;"><a href="../en/Dm-crypt/Encrypting_an_entire_system.html#LUKS_on_LVM" title="Dm-crypt/Encrypting an entire system">dm-crypt/Encrypting an entire system#LUKS on LVM</a></li>
<li style="padding:0.4em 0; line-height:1;"><a href="../en/Resizing_LVM-on-LUKS.html" title="Resizing LVM-on-LUKS">Resizing LVM-on-LUKS</a></li>
</ul>
</div>
<p>From <a href="https://en.wikipedia.org/wiki/Logical_Volume_Manager_(Linux)" class="extiw" title="wikipedia:Logical Volume Manager (Linux)">Wikipedia:Logical Volume Manager (Linux)</a>:
</p>
<dl><dd>LVM is a <a href="https://en.wikipedia.org/wiki/logical_volume_management" class="extiw" title="wikipedia:logical volume management">logical volume manager</a> for the <a href="https://en.wikipedia.org/wiki/Linux_kernel" class="extiw" title="wikipedia:Linux kernel">Linux kernel</a>; it manages disk drives and similar mass-storage devices.</dd></dl>
<div id="toc" class="toc">
<div id="toctitle"><h2>Contents</h2></div>
<ul>
<li class="toclevel-1 tocsection-1"><a href="#LVM_Building_Blocks"><span class="tocnumber">1</span> <span class="toctext">LVM Building Blocks</span></a></li>
<li class="toclevel-1 tocsection-2"><a href="#Advantages"><span class="tocnumber">2</span> <span class="toctext">Advantages</span></a></li>
<li class="toclevel-1 tocsection-3"><a href="#Disadvantages"><span class="tocnumber">3</span> <span class="toctext">Disadvantages</span></a></li>
<li class="toclevel-1 tocsection-4">
<a href="#Installing_Arch_Linux_on_LVM"><span class="tocnumber">4</span> <span class="toctext">Installing Arch Linux on LVM</span></a>
<ul>
<li class="toclevel-2 tocsection-5"><a href="#Create_partitions"><span class="tocnumber">4.1</span> <span class="toctext">Create partitions</span></a></li>
<li class="toclevel-2 tocsection-6"><a href="#Create_physical_volumes"><span class="tocnumber">4.2</span> <span class="toctext">Create physical volumes</span></a></li>
<li class="toclevel-2 tocsection-7"><a href="#Create_volume_group"><span class="tocnumber">4.3</span> <span class="toctext">Create volume group</span></a></li>
<li class="toclevel-2 tocsection-8"><a href="#Create_in_one_step"><span class="tocnumber">4.4</span> <span class="toctext">Create in one step</span></a></li>
<li class="toclevel-2 tocsection-9"><a href="#Create_logical_volumes"><span class="tocnumber">4.5</span> <span class="toctext">Create logical volumes</span></a></li>
<li class="toclevel-2 tocsection-10"><a href="#Create_file_systems_and_mount_logical_volumes"><span class="tocnumber">4.6</span> <span class="toctext">Create file systems and mount logical volumes</span></a></li>
<li class="toclevel-2 tocsection-11"><a href="#Add_lvm2_hook_to_mkinitcpio.conf_for_root_on_LVM"><span class="tocnumber">4.7</span> <span class="toctext">Add lvm2 hook to mkinitcpio.conf for root on LVM</span></a></li>
<li class="toclevel-2 tocsection-12"><a href="#Kernel_options"><span class="tocnumber">4.8</span> <span class="toctext">Kernel options</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-13">
<a href="#Volume_operations"><span class="tocnumber">5</span> <span class="toctext">Volume operations</span></a>
<ul>
<li class="toclevel-2 tocsection-14"><a href="#Advanced_options"><span class="tocnumber">5.1</span> <span class="toctext">Advanced options</span></a></li>
<li class="toclevel-2 tocsection-15">
<a href="#Resizing_volumes"><span class="tocnumber">5.2</span> <span class="toctext">Resizing volumes</span></a>
<ul>
<li class="toclevel-3 tocsection-16">
<a href="#Physical_volumes"><span class="tocnumber">5.2.1</span> <span class="toctext">Physical volumes</span></a>
<ul>
<li class="toclevel-4 tocsection-17"><a href="#Growing"><span class="tocnumber">5.2.1.1</span> <span class="toctext">Growing</span></a></li>
<li class="toclevel-4 tocsection-18">
<a href="#Shrinking"><span class="tocnumber">5.2.1.2</span> <span class="toctext">Shrinking</span></a>
<ul>
<li class="toclevel-5 tocsection-19"><a href="#Move_physical_extents"><span class="tocnumber">5.2.1.2.1</span> <span class="toctext">Move physical extents</span></a></li>
<li class="toclevel-5 tocsection-20"><a href="#Resize_physical_volume"><span class="tocnumber">5.2.1.2.2</span> <span class="toctext">Resize physical volume</span></a></li>
<li class="toclevel-5 tocsection-21"><a href="#Resize_partition"><span class="tocnumber">5.2.1.2.3</span> <span class="toctext">Resize partition</span></a></li>
</ul>
</li>
</ul>
</li>
<li class="toclevel-3 tocsection-22">
<a href="#Logical_volumes"><span class="tocnumber">5.2.2</span> <span class="toctext">Logical volumes</span></a>
<ul>
<li class="toclevel-4 tocsection-23"><a href="#Growing_or_shrinking_with_lvresize"><span class="tocnumber">5.2.2.1</span> <span class="toctext">Growing or shrinking with lvresize</span></a></li>
<li class="toclevel-4 tocsection-24"><a href="#Resizing_the_file_system_separately"><span class="tocnumber">5.2.2.2</span> <span class="toctext">Resizing the file system separately</span></a></li>
</ul>
</li>
</ul>
</li>
<li class="toclevel-2 tocsection-25"><a href="#Remove_logical_volume"><span class="tocnumber">5.3</span> <span class="toctext">Remove logical volume</span></a></li>
<li class="toclevel-2 tocsection-26"><a href="#Add_physical_volume_to_a_volume_group"><span class="tocnumber">5.4</span> <span class="toctext">Add physical volume to a volume group</span></a></li>
<li class="toclevel-2 tocsection-27"><a href="#Remove_partition_from_a_volume_group"><span class="tocnumber">5.5</span> <span class="toctext">Remove partition from a volume group</span></a></li>
<li class="toclevel-2 tocsection-28"><a href="#Deactivate_volume_group"><span class="tocnumber">5.6</span> <span class="toctext">Deactivate volume group</span></a></li>
<li class="toclevel-2 tocsection-29">
<a href="#Snapshots"><span class="tocnumber">5.7</span> <span class="toctext">Snapshots</span></a>
<ul>
<li class="toclevel-3 tocsection-30"><a href="#Configuration"><span class="tocnumber">5.7.1</span> <span class="toctext">Configuration</span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-31">
<a href="#LVM_Cache_.28lvmcache.29"><span class="tocnumber">5.8</span> <span class="toctext">LVM Cache (lvmcache)</span></a>
<ul>
<li class="toclevel-3 tocsection-32"><a href="#Create"><span class="tocnumber">5.8.1</span> <span class="toctext">Create</span></a></li>
<li class="toclevel-3 tocsection-33"><a href="#Remove"><span class="tocnumber">5.8.2</span> <span class="toctext">Remove</span></a></li>
</ul>
</li>
</ul>
</li>
<li class="toclevel-1 tocsection-34"><a href="#Graphical_configuration"><span class="tocnumber">6</span> <span class="toctext">Graphical configuration</span></a></li>
<li class="toclevel-1 tocsection-35">
<a href="#Troubleshooting"><span class="tocnumber">7</span> <span class="toctext">Troubleshooting</span></a>
<ul>
<li class="toclevel-2 tocsection-36"><a href="#Changes_that_could_be_required_due_to_changes_in_the_Arch-Linux_defaults"><span class="tocnumber">7.1</span> <span class="toctext">Changes that could be required due to changes in the Arch-Linux defaults</span></a></li>
<li class="toclevel-2 tocsection-37"><a href="#LVM_commands_do_not_work"><span class="tocnumber">7.2</span> <span class="toctext">LVM commands do not work</span></a></li>
<li class="toclevel-2 tocsection-38"><a href="#Logical_Volumes_do_not_show_up"><span class="tocnumber">7.3</span> <span class="toctext">Logical Volumes do not show up</span></a></li>
<li class="toclevel-2 tocsection-39"><a href="#LVM_on_removable_media"><span class="tocnumber">7.4</span> <span class="toctext">LVM on removable media</span></a></li>
<li class="toclevel-2 tocsection-40"><a href="#Resizing_a_contiguous_logical_volume_fails"><span class="tocnumber">7.5</span> <span class="toctext">Resizing a contiguous logical volume fails</span></a></li>
<li class="toclevel-2 tocsection-41"><a href="#Command_.22grub-mkconfig.22_reports_.22unknown_filesystem.22_errors"><span class="tocnumber">7.6</span> <span class="toctext">Command "grub-mkconfig" reports "unknown filesystem" errors</span></a></li>
<li class="toclevel-2 tocsection-42"><a href="#Thinly-provisioned_root_volume_device_times_out"><span class="tocnumber">7.7</span> <span class="toctext">Thinly-provisioned root volume device times out</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-43"><a href="#See_also"><span class="tocnumber">8</span> <span class="toctext">See also</span></a></li>
</ul>
</div>

<h3><span class="mw-headline" id="LVM_Building_Blocks">LVM Building Blocks</span></h3>
<p>Logical Volume Management utilizes the kernel's <a rel="nofollow" class="external text" href="http://sources.redhat.com/dm/">device-mapper</a> feature to provide a system of partitions independent of underlying disk layout. With LVM you abstract your storage and have "virtual partitions", making <a href="#Resizing_volumes">extending/shrinking</a> easier (subject to potential filesystem limitations).
</p>
<p>Virtual partitions allow addition and removal without worry of whether you have enough contiguous space on a particular disk, getting caught up fdisking a disk in use (and wondering whether the kernel is using the old or new partition table), or, having to move other partitions out of the way. This is strictly an ease-of-management solution: LVM adds no security.
</p>
<p>Basic building blocks of LVM:
</p>
<ul>
<li> <b>Physical volume (PV)</b>: Partition on hard disk (or even the disk itself or loopback file) on which you can have volume groups. It has a special header and is divided into physical extents. Think of physical volumes as big building blocks used to build your hard drive.</li>
<li> <b>Volume group (VG)</b>: Group of physical volumes used as a storage volume (as one disk). They contain logical volumes. Think of volume groups as hard drives.</li>
<li> <b>Logical volume (LV)</b>: A "virtual/logical partition" that resides in a volume group and is composed of physical extents. Think of logical volumes as normal partitions.</li>
<li> <b>Physical extent (PE)</b>: The smallest size in the physical volume that can be assigned to a logical volume (default 4MiB). Think of physical extents as parts of disks that can be allocated to any partition.</li>
</ul>
<p>Example:
</p>
<pre><b>Physical disks</b>
                
  Disk1 (/dev/sda):
     _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
    |Partition1 50GB (Physical volume) |Partition2 80GB (Physical volume)     |
    |/dev/sda1                         |/dev/sda2                             |
    |_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ |_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ |
                                  
  Disk2 (/dev/sdb):
     _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
    |Partition1 120GB (Physical volume)                 |
    |/dev/sdb1                                          |
    | _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ __ _ _|
</pre>
<pre><b>LVM logical volumes</b>

  Volume Group1 (/dev/MyStorage/ = /dev/sda1 + /dev/sda2 + /dev/sdb1):
     _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
    |Logical volume1 15GB  |Logical volume2 35GB      |Logical volume3 200GB               |
    |/dev/MyStorage/rootvol|/dev/MyStorage/homevol    |/dev/MyStorage/mediavol             |
    |_ _ _ _ _ _ _ _ _ _ _ |_ _ _ _ _ _ _ _ _ _ _ _ _ |_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ |
</pre>
<h3><span class="mw-headline" id="Advantages">Advantages</span></h3>
<p>LVM gives you more flexibility than just using normal hard drive partitions:
</p>
<ul>
<li> Use any number of disks as one big disk.</li>
<li> Have logical volumes stretched over several disks.</li>
<li> Create small logical volumes and resize them "dynamically" as they get filled up.</li>
<li> Resize logical volumes regardless of their order on disk. It does not depend on the position of the LV within VG, there is no need to ensure surrounding available space.</li>
<li> Resize/create/delete logical and physical volumes online. File systems on them still need to be resized, but some (such as ext4) support online resizing.</li>
<li> Online/live migration of LV being used by services to different disks without having to restart services.</li>
<li> Snapshots allow you to backup a frozen copy of the file system, while keeping service downtime to a minimum.</li>
<li> Support for various device-mapper targets, including transparent filesystem encryption and caching of frequently used data.</li>
</ul>
<h3><span class="mw-headline" id="Disadvantages">Disadvantages</span></h3>
<ul>
<li> Additional steps in setting up the system, more complicated.</li>
<li> If dual-booting, note that Windows does not support LVM; you will be unable to access any LVM partitions from Windows.</li>
</ul>
<h2><span class="mw-headline" id="Installing_Arch_Linux_on_LVM">Installing Arch Linux on LVM</span></h2>
<p>You should create your LVM Volumes between the <a href="../en/Partitioning.html" title="Partitioning">partitioning</a> and <a href="../en/File_systems.html#Create_a_file_system" title="File systems">formatting</a> steps of the <a href="../en/Installation_guide.html" title="Installation guide">installation procedure</a>. Instead of directly formatting a partition to be your root file system, the file system will be created inside a logical volume (LV). 
</p>
<p>Make sure the <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://www.archlinux.org/packages/?name=lvm2">lvm2</a></span> package is <a href="../en/Pacman.html" title="Pacman">installed</a>.
</p>
<p>Quick overview: 
</p>
<ul>
<li> Create partition(s) where your PV(s) will reside. Set the partition type to 'Linux LVM', which is 8e if you use MBR, 8e00 for GPT.</li>
<li> Create your physical volumes (PVs). If you have one disk it is best to just create one PV in one large partition. If you have multiple disks you can create partitions on each of them and create a PV on each partition.</li>
<li> Create your volume group (VG) and add all PVs to it.</li>
<li> Create logical volumes (LVs) inside that VG.</li>
<li> Continue with <a href="../en/Installation_guide.html#Format_the_partitions" title="Installation guide">Installation guide#Format the partitions</a>.</li>
<li> When you reach the “Create initial ramdisk environment” step in the Installation guide, add the <code>lvm</code> hook to <code>/etc/mkinitcpio.conf</code> (see below for details).</li>
</ul>
<div style="padding: 5px; margin: 0.50em 0; background-color: #FFDDDD; border: thin solid #DDBBBB; overflow: hidden;">
<strong> Warning: </strong><code>/boot</code> cannot reside in LVM when using a boot loader, which does not support LVM, you must create a separate <code>/boot</code> partition and format it directly. Only <a href="../en/GRUB.html" title="GRUB">GRUB</a> is known to support LVM.</div>
<h3><span class="mw-headline" id="Create_partitions">Create partitions</span></h3>
<p>If LVM has to be set on the entire disk, there is no need to create any partitions.
</p>
<p>Otherwise, <a href="../en/Partitioning.html" title="Partition" class="mw-redirect">partition</a> the device as required before configuring LVM.
</p>
<h3><span class="mw-headline" id="Create_physical_volumes">Create physical volumes</span></h3>
<p>To list all your devices capable of being used as a physical volume:
</p>
<pre># lvmdiskscan
</pre>
<div style="padding: 5px; margin: 0.50em 0; background-color: #FFDDDD; border: thin solid #DDBBBB; overflow: hidden;">
<strong> Warning: </strong>Make sure you target the correct device, or below commands will result in data loss!</div>
<p>Create a physical volume on them:
</p>
<pre># pvcreate <i>DEVICE</i>
</pre>
<p>This command creates a header on each device so it can be used for LVM. As defined in <a href="#LVM_Building_Blocks">#LVM Building Blocks</a>, <i>DEVICE</i> can be a disk (e.g. <code>/dev/sda</code>), a partition (e.g. <code>/dev/sda2</code>) or a loop back device. For example: 
</p>
<pre># pvcreate /dev/sda2
</pre>
<p>You can track created physical volumes with:
</p>
<pre># pvdisplay
</pre>
<div style="padding: 5px; margin: 0.50em 0; background-color: #DDDDFF; border: thin solid #BBBBDD; overflow: hidden;">
<strong> Note: </strong>If using a SSD without partitioning it first, use <code>pvcreate --dataalignment 1m /dev/sda</code> (for erase block size &lt; 1MiB), see e.g. <a rel="nofollow" class="external text" href="http://serverfault.com/questions/356534/ssd-erase-block-size-lvm-pv-on-raw-device-alignment">here</a>
</div>
<h3><span class="mw-headline" id="Create_volume_group">Create volume group</span></h3>
<p>The next step is to create a volume group on this physical volume.
</p>
<p>First you need to create a volume group on one of the physical volumes:
</p>
<pre># vgcreate &lt;<i>volume_group</i>&gt; &lt;<i>physical_volume</i>&gt;
</pre>
<p>For example:
</p>
<pre># vgcreate VolGroup00 /dev/sda2
</pre>
<p>Then add to it all other physical volumes you want to have in it:
</p>
<pre># vgextend &lt;<i>volume_group</i>&gt; &lt;<i>physical_volume</i>&gt;
# vgextend &lt;<i>volume_group</i>&gt; &lt;<i>another_physical_volume</i>&gt;
# ...
</pre>
<p>For example:
</p>
<pre># vgextend VolGroup00 /dev/sdb1
# vgextend VolGroup00 /dev/sdc
</pre>
<p>You can track how your volume group grows with:
</p>
<pre># vgdisplay
</pre>
<div style="padding: 5px; margin: 0.50em 0; background-color: #DDDDFF; border: thin solid #BBBBDD; overflow: hidden;">
<strong> Note: </strong>You can create more than one volume group if you need to, but then you will not have all your storage presented as one disk.</div>
<h3><span class="mw-headline" id="Create_in_one_step">Create in one step</span></h3>
<p>LVM allows you to combine the creation of a volume group and the physical volumes in one easy step. For example, to create the group VolGroup00 with the three devices mentioned above, you can run:
</p>
<pre># vgcreate VolGroup00 /dev/sda2 /dev/sdb1 /dev/sdc
</pre>
<p>This command will first set up the three partitions as physical volumes (if necessary) and then create the volume group with the three volumes. The command will warn you it detects an existing filesystem on any of the devices.
</p>
<h3><span class="mw-headline" id="Create_logical_volumes">Create logical volumes</span></h3>
<p>Now we need to create logical volumes on this volume group. You create a logical volume with the next command by giving the name of a new logical volume, its size, and the volume group it will live on:
</p>
<pre># lvcreate -L &lt;<i>size</i>&gt; &lt;<i>volume_group</i>&gt; -n &lt;<i>logical_volume</i>&gt;
</pre>
<p>For example:
</p>
<pre># lvcreate -L 10G VolGroup00 -n lvolhome
</pre>
<p>This will create a logical volume that you can access later with <code>/dev/mapper/Volgroup00-lvolhome</code> or <code>/dev/VolGroup00/lvolhome</code>. Same as with the volume groups, you can use any name you want for your logical volume when creating it.
</p>
<p>You can also specify one or more physical volumes to restrict where LVM allocates the data. For example, you may wish to create a logical volume for the root filesystem on your small SSD, and your home volume on a slower mechanical drive. Simply add the physical volume devices to the command line, for example:
</p>
<pre># lvcreate -L 10G VolGroup00 -n lvolhome /dev/sdc1
</pre>
<p>If you want to fill all the free space left on a volume group, use the next command:
</p>
<pre># lvcreate -l 100%FREE  &lt;<i>volume_group</i>&gt; -n &lt;<i>logical_volume</i>&gt;
</pre>
<p>You can track created logical volumes with:
</p>
<pre># lvdisplay
</pre>
<div style="padding: 5px; margin: 0.50em 0; background-color: #DDDDFF; border: thin solid #BBBBDD; overflow: hidden;">
<strong> Note: </strong>You may need to load the <i>device-mapper</i> kernel module (<b>modprobe dm_mod</b>) for the above commands to succeed.</div>
<div style="padding: 5px; margin: 0.50em 0; background-color: #DDFFDD; border: thin solid #BBDDBB; overflow: hidden;">
<strong> Tip: </strong>You can start out with relatively small logical volumes and expand them later if needed. For simplicity, leave some free space in the volume group so there is room for expansion.</div>
<h3><span class="mw-headline" id="Create_file_systems_and_mount_logical_volumes">Create file systems and mount logical volumes</span></h3>
<p>Your logical volumes should now be located in <code>/dev/mapper/</code> and <code>/dev/<i>YourVolumeGroupName</i></code>. If you cannot find them, use the next commands to bring up the module for creating device nodes and to make volume groups available:
</p>
<pre># modprobe dm_mod
# vgscan
# vgchange -ay
</pre>
<p>Now you can create file systems on logical volumes and mount them as normal partitions (if you are installing Arch linux, refer to <a href="../en/File_systems.html#Mount_a_file_system" title="Mount" class="mw-redirect">mounting the partitions</a> for additional details):
</p>
<pre># mkfs.&lt;<i>fstype</i>&gt; /dev/mapper/&lt;<i>volume_group</i>&gt;-&lt;<i>logical_volume</i>&gt;
# mount /dev/mapper/&lt;<i>volume_group</i>&gt;-&lt;<i>logical_volume</i>&gt; /&lt;<i>mountpoint</i>&gt;
</pre>
<p>For example:
</p>
<pre># mkfs.ext4 /dev/mapper/VolGroup00-lvolhome
# mount /dev/mapper/VolGroup00-lvolhome /home
</pre>
<div style="padding: 5px; margin: 0.50em 0; background-color: #FFDDDD; border: thin solid #DDBBBB; overflow: hidden;">
<strong> Warning: </strong>When choosing mountpoints, just select your newly created logical volumes (use: <code>/dev/mapper/Volgroup00-lvolhome</code>). Do <b>not</b> select the actual partitions on which logical volumes were created (do not use: <code>/dev/sda2</code>).</div>
<h3><span class="mw-headline" id="Add_lvm2_hook_to_mkinitcpio.conf_for_root_on_LVM">Add lvm2 hook to mkinitcpio.conf for root on LVM</span></h3>
<p>In case your root filesystem is on LVM, you will need to enable the apropriate <a href="../en/Mkinitcpio.html" title="Mkinitcpio">mkinitcpio</a> hooks, otherwise your system might not boot. Enable:
</p>
<ul>
<li> <code>udev</code> and <code>lvm2</code> for the default busybox based initramfs</li>
<li> <code>systemd</code> and <code>sd-lvm2</code> for systemd based initramfs</li>
</ul>
<p><code>udev</code> is there by default. Edit the file and insert <code>lvm2</code> between <code>block</code> and <code>filesystems</code> like so:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/mkinitcpio.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">HOOKS="base udev ... block <b>lvm2</b> filesystems"</pre>
<p>For systemd based initramfs:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/mkinitcpio.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">HOOKS="base systemd ... block <b>sd-lvm2</b> filesystems"</pre>
<p>Afterwards, you can continue in normal installation instructions with the <a href="../en/Mkinitcpio.html#Image_creation_and_activation" title="Mkinitcpio">create an initial ramdisk</a> step.
</p>
<div style="padding: 5px; margin: 0.50em 0; background-color: #DDFFDD; border: thin solid #BBDDBB; overflow: hidden;">
<strong> Tip: </strong>The <code>lvm2</code> and <code>sd-lvm2</code> hooks are installed by <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://www.archlinux.org/packages/?name=lvm2">lvm2</a></span>, not <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://www.archlinux.org/packages/?name=mkinitcpio">mkinitcpio</a></span>. If you are running <i>mkinitcpio</i> in an <i>arch-chroot</i> for a new installation, <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://www.archlinux.org/packages/?name=lvm2">lvm2</a></span> must be installed inside the <i>arch-chroot</i> for <i>mkinitcpio</i> to find the <code>lvm2</code> or <code>sd-lvm2</code> hook. If <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://www.archlinux.org/packages/?name=lvm2">lvm2</a></span> only exists outside the <i>arch-chroot</i>, <i>mkinitcpio</i> will output <code>Error: Hook 'lvm2' cannot be found</code>.</div>
<div style="padding: 5px; margin: 0.50em 0; background-color: #DDFFDD; border: thin solid #BBDDBB; overflow: hidden;">
<strong> Tip: </strong>If your root filesystem is on a mirrored logical volume with type raid1, you will also need to add <code>dm_mod</code>, <code>dm_raid</code> and <code>raid1</code> to the MODULES section of mkinitcpio.conf.</div>
<h3><span class="mw-headline" id="Kernel_options">Kernel options</span></h3>
<p>If the root file system resides in a logical volume, the <code>root=</code> <a href="../en/Kernel_parameters.html" title="Kernel parameter" class="mw-redirect">kernel parameter</a> must be pointed to the mapped device, e.g <code>/dev/mapper/<i>vg-name</i>-<i>lv-name</i></code>.
</p>
<h2><span class="mw-headline" id="Volume_operations">Volume operations</span></h2>
<div class="noprint archwiki-template-message">
<p><a href="../File:Tango-view-fullscreen.png" class="image"><img alt="Tango-view-fullscreen.png" src="../File:Tango-view-fullscreen.png" width="48" height="48"></a><b>This article or section needs expansion.</b><a href="../File:Tango-view-fullscreen.png" class="image"><img alt="Tango-view-fullscreen.png" src="../File:Tango-view-fullscreen.png" width="48" height="48"></a></p>
<div>
<b>Reason:</b> Add instructions for thin-provisioned volume creation. (Discuss in <a rel="nofollow" class="external text" href="https://wiki.archlinux.org/index.php/Talk:LVM">Talk:LVM#</a>)</div>
</div>
<h3><span class="mw-headline" id="Advanced_options">Advanced options</span></h3>
<p>If you need monitoring (needed for snapshots) you can enable lvmetad. 
For this set <code>use_lvmetad = 1</code> in <code>/etc/lvm/lvm.conf</code>.
This is the default by now. 
</p>
<p>You can restrict the volumes that are activated automatically by setting the <code>auto_activation_volume_list</code> in <code>/etc/lvm/lvm.conf</code>. If in doubt, leave this option commented out.
</p>
<h3><span class="mw-headline" id="Resizing_volumes">Resizing volumes</span></h3>
<h4><span class="mw-headline" id="Physical_volumes">Physical volumes</span></h4>
<p>After extending or prior to reducing the size of a device that has a physical volume on it, you need to grow or shrink the PV using <code>pvresize</code>.
</p>
<h5><span class="mw-headline" id="Growing">Growing</span></h5>
<p>To expand the PV on <code>/dev/sda1</code> after enlarging the <a href="../en/Partitioning.html" title="Partition" class="mw-redirect">partition</a>, run:
</p>
<pre># pvresize /dev/sda1
</pre>
<p>This will automatically detect the new size of the device and extend the PV to its maximum.
</p>
<div style="padding: 5px; margin: 0.50em 0; background-color: #DDDDFF; border: thin solid #BBBBDD; overflow: hidden;">
<strong> Note: </strong>This command can be done while the volume is online.</div>
<h5><span class="mw-headline" id="Shrinking">Shrinking</span></h5>
<p>To shrink a physical volume prior to reducing its underlying device, add the <code>--setphysicalvolumesize <i>size</i></code> parameters to the command, <i>e.g.</i>:
</p>
<pre># pvresize --setphysicalvolumesize 40G /dev/sda1
</pre>
<p>The above command may leave you with this error:
</p>
<pre> /dev/sda1: cannot resize to 25599 extents as later ones are allocated.
 0 physical volume(s) resized / 1 physical volume(s) not resized
</pre>
<p>Indeed <code>pvresize</code> will refuse to shrink a PV if it has allocated extents after where its new end would be. One needs to run <a href="#Move_physical_extents">pvmove</a> beforehand to relocate these elsewhere in the volume group if there is sufficient free space.
</p>
<h6><span class="mw-headline" id="Move_physical_extents">Move physical extents</span></h6>
<p>Before moving free extents to the end of the volume, one must run <code># pvdisplay -v -m</code> to see physical segments. In the below example, there is one physical volume on <code>/dev/sdd1</code>, one volume group <code>vg1</code> and one logical volume <code>backup</code>.
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;"># pvdisplay -v -m</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">
    Finding all volume groups.
    Using physical volume(s) on command line.
  --- Physical volume ---
  PV Name               /dev/sdd1
  VG Name               vg1
  PV Size               1.52 TiB / not usable 1.97 MiB
  Allocatable           yes 
  PE Size               4.00 MiB
  Total PE              399669
  Free PE               153600
  Allocated PE          246069
  PV UUID               MR9J0X-zQB4-wi3k-EnaV-5ksf-hN1P-Jkm5mW
   
  --- Physical Segments ---
  Physical extent 0 to 153600:
    FREE
  Physical extent 153601 to 307199:
    Logical volume	/dev/vg1/backup
    Logical extents	1 to 153599
  Physical extent 307200 to 307200:
    FREE
  Physical extent 307201 to 399668:
    Logical volume	/dev/vg1/backup
    Logical extents	153601 to 246068</pre>
<p>One can observe FREE space are split across the volume. To shrink the physical volume, we must first move all used segments to the beginning.
</p>
<p>Here, the first free segment is from 0 to 153600 and leaves us with 153601 free extents. We can now move this segment number from the last physical extent to the first extent. The command will thus be:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;"># pvmove --alloc anywhere /dev/sdd1:307201-399668 /dev/sdd1:0-92466</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">
/dev/sdd1: Moved: 0.1 %
/dev/sdd1: Moved: 0.2 %
...
/dev/sdd1: Moved: 99.9 %
/dev/sdd1: Moved: 100,0%</pre>
<div style="padding: 5px; margin: 0.50em 0; background-color: #DDDDFF; border: thin solid #BBBBDD; overflow: hidden;">
<strong> Note: </strong>
<ul>
<li> this command tells to move 92468 (399668-307200) PE <b>from</b> the last segment <b>to</b> the first segment. This is possible as first segment enclosed FREE 153600 PE, which can contains the 92467 moved PE.</li>
<li> the <code>--alloc anywhere</code> option is used as we move PE inside the same partition. In case of different partitions, the command would look something like this: <code># pvmove /dev/sdb1:1000-1999 /dev/sdc1:0-999</code>
</li>
<li> the move can takes long (one/two hours) in case of large size. It can be a good idea to run this command in a <a href="../en/Tmux.html" title="Tmux">Tmux</a> or <a href="../en/GNU_Screen.html" title="GNU Screen">GNU Screen</a> session. Any unwanted stop of the process can be fatal.</li>
<li> once the operation is complete, run <a href="../en/Fsck.html" title="Fsck">Fsck</a> to make sure your file system is valid.</li>
</ul>
</div>
<h6><span class="mw-headline" id="Resize_physical_volume">Resize physical volume</span></h6>
<p>Once all your free physical segments are on the last physical extent, run <code># vgdisplay</code> and see your free PE.
</p>
<p>Then you can now run again the command:
</p>
<pre># pvresize --setphysicalvolumesize <i>size</i> <i>PhysicalVolume</i>
</pre>
<p>See the result:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;"># pvs</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">
  PV         VG   Fmt  Attr PSize    PFree 
  /dev/sdd1  vg1  lvm2 a--     1t     500g
</pre>
<h6><span class="mw-headline" id="Resize_partition">Resize partition</span></h6>
<p>Last, you need to shrink the partition with your favorite <a href="../en/Partitioning.html#Partitioning_tools" title="Partitioning">partitioning tool</a>.
</p>
<h4><span class="mw-headline" id="Logical_volumes">Logical volumes</span></h4>
<div style="padding: 5px; margin: 0.50em 0; background-color: #DDDDFF; border: thin solid #BBBBDD; overflow: hidden;">
<strong> Note: </strong><i>lvresize</i> provides more or less the same options as the specialized <code>lvextend</code> and <code>lvreduce</code> commands, while allowing to do both types of operation. Notwithstanding this, all those utilities offer a <code>-r, --resizefs</code> option which allows to resize the file system together with the LV using <span class="plainlinks archwiki-template-man" title="$ man 8 fsadm"><a rel="nofollow" class="external text" href="http://man7.org/linux/man-pages/man8/fsadm.8.html">fsadm(8)</a></span> (<i>ext2</i>, <a href="../en/Ext3.html" title="Ext3">ext3</a>, <a href="../en/Ext4.html" title="Ext4">ext4</a>, <i>ReiserFS</i> and <a href="../en/XFS.html" title="XFS">XFS</a> supported). Therefore it may be easier to simply use <code>lvresize</code> for both operations and use <code>--resizefs</code> to simplify things a bit, except if you have specific needs or want full control over the process.</div>
<h5><span class="mw-headline" id="Growing_or_shrinking_with_lvresize">Growing or shrinking with lvresize</span></h5>
<div style="padding: 5px; margin: 0.50em 0; background-color: #FFDDDD; border: thin solid #DDBBBB; overflow: hidden;">
<strong> Warning: </strong>While enlarging a file system can often be done on-line (<i>i.e.</i> while it is mounted), even for the root partition, shrinking will nearly always require to first unmount the file system so as to prevent data loss. Make sure your FS supports what you are trying to do.</div>
<p>Extend logical volume <i>lv1</i> within volume group <i>vg1</i> by 2GB <i>without</i> touching its file system:
</p>
<pre># lvresize -L +2G vg1/lv1
</pre>
<p>Reduce <code>vg1/lv1</code> of 500MB <i>without</i> resizing its file system (make sure it is <a href="#Resizing_the_file_system_separately">already shrunk</a> in that case):
</p>
<pre># lvresize -L -500M vg1/lv1
</pre>
<p>Set <code>vg1/lv1</code> to 15GB and resize its file sytem <i>all at once</i>:
</p>
<pre># lvresize -L 15G -r vg1/lv1
</pre>
<div style="padding: 5px; margin: 0.50em 0; background-color: #DDDDFF; border: thin solid #BBBBDD; overflow: hidden;">
<strong> Note: </strong>Only <i>ext2</i>, <a href="../en/Ext3.html" title="Ext3">ext3</a>, <a href="../en/Ext4.html" title="Ext4">ext4</a>, <i>ReiserFS</i> and <a href="../en/XFS.html" title="XFS">XFS</a> <a href="../en/File_systems.html" title="File systems">file systems</a> are supported. If different look for the <a href="../en/File_systems.html#Types_of_file_systems" title="File systems">appropriate utility</a>.</div>
<p>If you want to fill all the free space on a volume group, use the following command:
</p>
<pre># lvresize -l +100%FREE <i>vg</i>/<i>lv</i>
</pre>
<p>See <span class="plainlinks archwiki-template-man" title="$ man 8 lvresize"><a rel="nofollow" class="external text" href="http://man7.org/linux/man-pages/man8/lvresize.8.html">lvresize(8)</a></span> for more detailed options.
</p>
<h5><span class="mw-headline" id="Resizing_the_file_system_separately">Resizing the file system separately</span></h5>
<p>If not using the <code>-r, --resizefs</code> option to <code>lv{resize,extend,reduce}</code> or using a file system unspported by <span class="plainlinks archwiki-template-man" title="$ man 8 fsadm"><a rel="nofollow" class="external text" href="http://man7.org/linux/man-pages/man8/fsadm.8.html">fsadm(8)</a></span> (<a href="../en/Btrfs.html" title="Btrfs">Btrfs</a>, <a href="../en/ZFS.html" title="ZFS">ZFS</a>...), you need to manually resize the FS before shrinking the LV or after expanding it.
</p>
<div style="padding: 5px; margin: 0.50em 0; background-color: #FFDDDD; border: thin solid #DDBBBB; overflow: hidden;">
<strong> Warning: </strong>Not all file systems support resizing without loss of data and/or resizing online.</div>
<p>For example with and ext2/ext3/ext4 file system:
</p>
<pre># resize2fs <i>vg</i>/<i>lv</i>
</pre>
<p>will expand the FS to the maximum size of the underlying LV, while
</p>
<pre># resize2fs -M <i>vg</i>/<i>lv</i>
</pre>
<p>will shrink it to its minimum size. To resize it to a specified size, use:
</p>
<pre># resize2fs <i>vg</i>/<i>lv</i> <i>NewSize</i>
</pre>
<h3><span class="mw-headline" id="Remove_logical_volume">Remove logical volume</span></h3>
<div style="padding: 5px; margin: 0.50em 0; background-color: #FFDDDD; border: thin solid #DDBBBB; overflow: hidden;">
<strong> Warning: </strong>Before you remove a logical volume, make sure to move all data that you want to keep somewhere else; otherwise, it will be lost!</div>
<p>First, find out the name of the logical volume you want to remove. You can get a list of all logical volumes with:
</p>
<pre># lvs
</pre>
<p>Next, look up the mountpoint of the chosen logical volume:
</p>
<pre>$ lsblk
</pre>
<p>Then unmount the filesystem on the logical volume:
</p>
<pre># umount /&lt;<i>mountpoint</i>&gt;
</pre>
<p>Finally, remove the logical volume:
</p>
<pre># lvremove &lt;<i>volume_group</i>&gt;/&lt;<i>logical_volume</i>&gt;
</pre>
<p>For example:
</p>
<pre># lvremove VolGroup00/lvolhome
</pre>
<p>Confirm by typing in <code>y</code>.
</p>
<p>Update <code>/etc/fstab</code> as necessary.
</p>
<p>You can verify the removal of the logical volume by typing <code>lvs</code> as root again (see first step of this section).
</p>
<h3><span class="mw-headline" id="Add_physical_volume_to_a_volume_group">Add physical volume to a volume group</span></h3>
<p>You first create a new physical volume on the block device you wish to use, then extend your volume group
</p>
<pre># pvcreate /dev/sdb1
# vgextend VolGroup00 /dev/sdb1</pre>
<p>This of course will increase the total number of physical extents on your volume group, which can be allocated by logical volumes as you see fit.
</p>
<div style="padding: 5px; margin: 0.50em 0; background-color: #DDDDFF; border: thin solid #BBBBDD; overflow: hidden;">
<strong> Note: </strong>It is considered good form to have a <a href="../en/Partitioning.html" title="Partitioning">partition table</a> on your storage medium below LVM. Use the appropriate type code: <code>8e</code> for MBR, and <code>8e00</code> for GPT partitions.</div>
<h3><span class="mw-headline" id="Remove_partition_from_a_volume_group">Remove partition from a volume group</span></h3>
<p>If you created a logical volume on the partition, <a href="#Remove_logical_volume">remove</a> it first.
</p>
<p>All of the data on that partition needs to be moved to another partition. Fortunately, LVM makes this easy:
</p>
<pre># pvmove /dev/sdb1
</pre>
<p>If you want to have the data on a specific physical volume, specify that as the second argument to <code>pvmove</code>:
</p>
<pre># pvmove /dev/sdb1 /dev/sdf1
</pre>
<p>Then the physical volume needs to be removed from the volume group:
</p>
<pre># vgreduce myVg /dev/sdb1
</pre>
<p>Or remove all empty physical volumes:
</p>
<pre># vgreduce --all vg0
</pre>
<p>And lastly, if you want to use the partition for something else, and want to avoid LVM thinking that the partition is a physical volume:
</p>
<pre># pvremove /dev/sdb1
</pre>
<h3><span class="mw-headline" id="Deactivate_volume_group">Deactivate volume group</span></h3>
<p>Just invoke 
</p>
<pre># vgchange -a n my_volume_group
</pre>
<p>This will deactivate the volume group and allow you to unmount the container it is stored in.
</p>
<h3><span class="mw-headline" id="Snapshots">Snapshots</span></h3>
<p>LVM allows you to take a snapshot of your system in a much more efficient way than a traditional backup. It does this efficiently by using a COW (copy-on-write) policy. The initial snapshot you take simply contains hard-links to the inodes of your actual data. So long as your data remains unchanged, the snapshot merely contains its inode pointers and not the data itself. Whenever you modify a file or directory that the snapshot points to, LVM automatically clones the data, the old copy referenced by the snapshot, and the new copy referenced by your active system. Thus, you can snapshot a system with 35GB of data using just 2GB of free space so long as you modify less than 2GB (on both the original and snapshot).
</p>
<h4><span class="mw-headline" id="Configuration">Configuration</span></h4>
<p>You create snapshot logical volumes just like normal ones.
</p>
<pre># lvcreate --size 100M --snapshot --name snap01 /dev/mapper/vg0-pv
</pre>
<p>With that volume, you may modify less than 100M of data, before the snapshot volume fills up.
</p>
<p>Reverting the modified 'pv' logical volume to the state when the 'snap01' snapshot was taken can be done with
</p>
<pre># lvconvert --merge /dev/vg0/snap01
</pre>
<p>In case the origin logical volume is active, merging will occur on the next reboot.(Merging can be done even from a LiveCD)
</p>
<p>The snapshot will no longer exist after merging.
</p>
<p>Also multiple snapshots can be taken and each one can be merged with the origin logical volume at will.
</p>
<p>The snapshot can be mounted and backed up with <b>dd</b> or <b>tar</b>. The size of the backup file done with <b>dd</b> will be the size of the files residing on the snapshot volume. 
To restore just create a snapshot, mount it, and write or extract the backup to it. And then merge it with the origin.
</p>
<p>It is important to have the <i>dm_snapshot</i> module listed in the MODULES variable of <code>/etc/mkinitcpio.conf</code>, otherwise the system will not boot. If you do this on an already installed system, make sure to rebuild the image with
</p>
<pre># mkinitcpio -p linux
</pre>
<div class="noprint archwiki-template-message">
<p><a href="../File:Tango-view-fullscreen.png" class="image"><img alt="Tango-view-fullscreen.png" src="../File:Tango-view-fullscreen.png" width="48" height="48"></a><b>This article or section needs expansion.</b><a href="../File:Tango-view-fullscreen.png" class="image"><img alt="Tango-view-fullscreen.png" src="../File:Tango-view-fullscreen.png" width="48" height="48"></a></p>
<div>
<b>Reason:</b> scripts to automate snapshots of root before updates, to rollback... updating <code>menu.lst</code> to boot snapshots (separate article?) (Discuss in <a rel="nofollow" class="external text" href="https://wiki.archlinux.org/index.php/Talk:LVM">Talk:LVM#</a>)</div>
</div>
<p>Snapshots are primarily used to provide a frozen copy of a file system to make backups; a backup taking two hours provides a more consistent image of the file system than directly backing up the partition.
</p>
<p>See <a href="../en/Create_root_filesystem_snapshots_with_LVM.html" title="Create root filesystem snapshots with LVM">Create root filesystem snapshots with LVM</a> for automating the creation of clean root file system snapshots during system startup for backup and rollback.
</p>
<p><a href="../en/Dm-crypt/Encrypting_an_entire_system.html#LVM_on_LUKS" title="Dm-crypt/Encrypting an entire system">Dm-crypt/Encrypting an entire system#LVM on LUKS</a> and <a href="../en/Dm-crypt/Encrypting_an_entire_system.html#LUKS_on_LVM" title="Dm-crypt/Encrypting an entire system">Dm-crypt/Encrypting an entire system#LUKS on LVM</a>.
</p>
<p>If you have LVM volumes not activated via the <a href="../en/Mkinitcpio.html" title="Initramfs" class="mw-redirect">initramfs</a>, <a href="../en/Systemd.html#Using_units" title="Enable" class="mw-redirect">enable</a> <code>lvm-monitoring.service</code>, which is provided by the <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://www.archlinux.org/packages/?name=lvm2">lvm2</a></span> package.
</p>
<h3><span class="mw-headline" id="LVM_Cache_.28lvmcache.29">LVM Cache (lvmcache)</span></h3>
<p>From <span class="plainlinks archwiki-template-man" title="$ man 7 lvmcache"><a rel="nofollow" class="external text" href="http://man7.org/linux/man-pages/man7/lvmcache.7.html">lvmcache(7)</a></span>:
</p>
<dl><dd> <i>The cache logical volume type uses a small and fast LV to improve the performance of a large and slow LV. It does this by storing the frequently used blocks on the faster LV. LVM refers to the small fast LV as a cache pool LV. The large slow LV is called the origin LV. Due to requirements from dm-cache (the kernel driver), LVM further splits the cache pool LV into two devices - the cache data LV and cache metadata LV. The cache data LV is where copies of data blocks are kept from the origin LV to increase speed. The cache metadata LV holds the accounting information that specifies where data blocks are stored (e.g. on the origin LV or on the cache data LV).  Users should be familiar with these LVs if they wish to create the best and most robust cached logical volumes. All of these associated LVs must be in the same VG.</i>
</dd></dl>
<h4><span class="mw-headline" id="Create">Create</span></h4>
<p>The fast method is creating a PV (if necessary) on the fast disk and add it to the existing volume group:
</p>
<pre># vgextend dataVG /dev/sdx
</pre>
<p>Create a cache pool with automatic meta data on sdb, and convert the existing logical volume (dataLV) to a cached volume, all in one step:
</p>
<pre># lvcreate --type cache --cachemode writethrough -L 20G -n dataLV_cachepool dataVG/dataLV /dev/sdx
</pre>
<p>Obviously, if you want your cache to be bigger, you can change the <code>-L</code> parameter to a different size.
</p>
<div style="padding: 5px; margin: 0.50em 0; background-color: #DDDDFF; border: thin solid #BBBBDD; overflow: hidden;">
<strong> Note: </strong>Cachemode has two possible options:
<ul>
<li> <code>writethrough</code> ensures that any data written will be stored both in the cache pool LV and on the origin LV.  The loss of a device associated with the cache pool LV in this case would not mean the loss of any data;</li>
<li> <code>writeback</code> ensures better performance, but at the cost of a higher risk of data loss in case the drive used for cache fails.</li>
</ul>
If a specific <code>--cachemode</code> is not indicated, the system will assume <code>writetrough</code> as default.</div>
<h4><span class="mw-headline" id="Remove">Remove</span></h4>
<p>If you ever need to undo the one step creation operation above:
</p>
<pre># lvconvert --uncache dataVG/dataLV
</pre>
<p>This commits any pending writes still in the cache back to the origin LV, then deletes the cache. Other options are available and described in <a rel="nofollow" class="external text" href="http://man7.org/linux/man-pages/man7/lvmcache.7.html">man</a>.
</p>
<h2><span class="mw-headline" id="Graphical_configuration">Graphical configuration</span></h2>
<p>There is no "official" GUI tool for managing LVM volumes, but <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/system-config-lvm/">system-config-lvm</a></span><sup><small>AUR</small></sup> covers most of the common operations, and provides simple visualizations of volume state. It can automatically resize many file systems when resizing logical volumes.
</p>
<h2><span class="mw-headline" id="Troubleshooting">Troubleshooting</span></h2>
<h3><span class="mw-headline" id="Changes_that_could_be_required_due_to_changes_in_the_Arch-Linux_defaults">Changes that could be required due to changes in the Arch-Linux defaults</span></h3>
<p>The <code>use_lvmetad = 1</code> must be set in <code>/etc/lvm/lvm.conf</code>. This is the default now - if you have a <code>lvm.conf.pacnew</code> file, you must merge this change.
</p>
<h3><span class="mw-headline" id="LVM_commands_do_not_work">LVM commands do not work</span></h3>
<ul><li> Load proper module:</li></ul>
<pre># modprobe dm_mod
</pre>
<p>The <code>dm_mod</code> module should be automatically loaded. In case it does not, you can try:
</p>
<div class="noprint archwiki-template-message">
<p><a href="../File:Tango-inaccurate.png" class="image"><img alt="Tango-inaccurate.png" src="../File:Tango-inaccurate.png" width="48" height="48"></a><b>The factual accuracy of this article or section is disputed.</b><a href="../File:Tango-inaccurate.png" class="image"><img alt="Tango-inaccurate.png" src="../File:Tango-inaccurate.png" width="48" height="48"></a></p>
<div>
<b>Reason:</b> Should module loading at boot be done using "/etc/modules-load.d" instead? (Discuss in <a rel="nofollow" class="external text" href="https://wiki.archlinux.org/index.php/Talk:LVM">Talk:LVM#</a>)</div>
</div>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/mkinitcpio.conf:</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">MODULES="dm_mod ..."</pre>
<p>You will need to <a href="../en/Mkinitcpio.html#Image_creation_and_activation" title="Mkinitcpio">rebuild</a> the initramfs to commit any changes you made.
</p>
<ul><li> Try preceding commands with <i>lvm</i> like this:</li></ul>
<pre># lvm pvdisplay
</pre>
<h3><span class="mw-headline" id="Logical_Volumes_do_not_show_up">Logical Volumes do not show up</span></h3>
<p>If you are trying to mount existing logical volumes, but they do not show up in <code>lvscan</code>, you can use the following commands to activate them:
</p>
<pre># vgscan
# vgchange -ay
</pre>
<h3><span class="mw-headline" id="LVM_on_removable_media">LVM on removable media</span></h3>
<p>Symptoms:
</p>
<pre># vgscan
 Reading all physical volumes.  This may take a while...
 /dev/backupdrive1/backup: read failed after 0 of 4096 at 319836585984: Input/output error
 /dev/backupdrive1/backup: read failed after 0 of 4096 at 319836643328: Input/output error
 /dev/backupdrive1/backup: read failed after 0 of 4096 at 0: Input/output error
 /dev/backupdrive1/backup: read failed after 0 of 4096 at 4096: Input/output error
 Found volume group "backupdrive1" using metadata type lvm2
 Found volume group "networkdrive" using metadata type lvm2
</pre>
<p>Cause:
</p>
<dl><dd>Removing an external LVM drive without deactivating the volume group(s) first. Before you disconnect, make sure to:</dd></dl>
<pre># vgchange -an <i>volume group name</i>
</pre>
<p>Fix: assuming you already tried to activate the volume group with <code># vgchange -ay <i>vg</i></code>, and are receiving the Input/output errors:
</p>
<pre># vgchange -an <i>volume group name</i>
</pre>
<p>Unplug the external drive and wait a few minutes:
</p>
<pre># vgscan
# vgchange -ay <i>volume group name</i>
</pre>
<h3><span class="mw-headline" id="Resizing_a_contiguous_logical_volume_fails">Resizing a contiguous logical volume fails</span></h3>
<p>If trying to extend a logical volume errors with:
</p>
<pre>" Insufficient suitable contiguous allocatable extents for logical volume "
</pre>
<p>The reason is that the logical volume was created with an explicit contiguous allocation policy (options <code>-C y</code> or <code>--alloc contiguous</code>) and no further adjacent contiguous extents are available (see also <a rel="nofollow" class="external text" href="http://www.hostatic.ro/2010/02/15/lvm-inherit-and-contiguous-policies/">reference</a>).
</p>
<p>To fix this, prior to extending the logical volume, change its allocation policy with <code>lvchange --alloc inherit &lt;logical_volume&gt;</code>. If you need to keep the contiguous allocation policy, an alternative approach is to move the volume to a disk area with sufficient free extents (see <a rel="nofollow" class="external autonumber" href="http://superuser.com/questions/435075/how-to-align-logical-volumes-on-contiguous-physical-extents">[1]</a>).
</p>
<h3><span class="mw-headline" id="Command_.22grub-mkconfig.22_reports_.22unknown_filesystem.22_errors">Command "grub-mkconfig" reports "unknown filesystem" errors</span></h3>
<p>Make sure to remove snapshot volumes before <a href="../en/GRUB.html#Generate_the_main_configuration_file" title="GRUB">generating grub.cfg</a>.
</p>
<h3><span class="mw-headline" id="Thinly-provisioned_root_volume_device_times_out">Thinly-provisioned root volume device times out</span></h3>
<p>With a large number of snapshots, <code>thin_check</code> runs for a long enough time so that waiting for the root device times out. To compensate, add the <code>rootdelay=60</code> kernel boot parameter to your boot loader configuration.
</p>
<h2><span class="mw-headline" id="See_also">See also</span></h2>
<ul>
<li> <a rel="nofollow" class="external text" href="http://sourceware.org/lvm2/">LVM2 Resource Page</a> on SourceWare.org</li>
<li> <a rel="nofollow" class="external text" href="http://wiki.gentoo.org/wiki/LVM">LVM</a> article at Gentoo wiki</li>
<li> <a rel="nofollow" class="external text" href="http://www.tutonics.com/2012/11/ubuntu-lvm-guide-part-1.html">Ubuntu LVM Guide Part 1</a><a rel="nofollow" class="external text" href="http://www.tutonics.com/2012/12/lvm-guide-part-2-snapshots.html">Part 2 detals snapshots</a>
</li>
<li> <a rel="nofollow" class="external text" href="https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/Logical_Volume_Manager_Administration/index.html">Red Hat: Logical Volume Manager Administration</a>
</li>
</ul>

</div>
<div id="catlinks" class="catlinks">
<div id="mw-normal-catlinks" class="mw-normal-catlinks">
<a href="../Special:Categories.html" title="Special:Categories">Category</a>: <ul><li><a href="../en/Category:File_systems.html" title="Category:File systems">File systems</a></li></ul>
</div>
<div id="mw-hidden-catlinks" class="mw-hidden-catlinks mw-hidden-cats-hidden">Hidden categories: <ul>
<li><a href="../en/Category:Pages_or_sections_flagged_with_Template:Expansion.html" title="Category:Pages or sections flagged with Template:Expansion">Pages or sections flagged with Template:Expansion</a></li>
<li><a href="../en/Category:Pages_or_sections_flagged_with_Template:Accuracy.html" title="Category:Pages or sections flagged with Template:Accuracy">Pages or sections flagged with Template:Accuracy</a></li>
</ul>
</div>
</div>					<div class="visualClear"></div>
				</div>
			</div>
		</div>
		<div class="visualClear"></div>
					<div id="footer" role="contentinfo">
Extracted from <a href="https://wiki.archlinux.org"> ArchWiki </a> and licensed under <a href="http://www.gnu.org/copyleft/fdl.html"> GDL >= 1.3</a>
		</div>
		</div>
		</body>
</html>
