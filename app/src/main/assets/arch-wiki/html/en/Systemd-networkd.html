<!DOCTYPE html>
<html lang="en" dir="ltr" class="client-nojs">
<head>
<meta charset="UTF-8">
<title>systemd-networkd - ArchWiki</title>
<link rel="stylesheet" href="../ArchWikiOffline.css">
<meta name="ResourceLoaderDynamicStyles" content="">
<style></style>
<meta name="generator" content="MediaWiki 1.26.4">
<meta name="robots" content="noindex,follow">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="search" type="application/opensearchdescription+xml" href="/opensearch_desc.php" title="ArchWiki (en)">
<link rel="EditURI" type="application/rsd+xml" href="https://wiki.archlinux.org/api.php?action=rsd">
<link rel="copyright" href="http://www.gnu.org/copyleft/fdl.html">
<link rel="alternate" type="application/atom+xml" title="ArchWiki Atom feed" href="/index.php?title=Special:RecentChanges&amp;feed=atom">
</head>
<body class="mediawiki ltr sitedir-ltr ns-0 ns-subject page-Systemd-networkd skin-archlinux action-view">

		<div id="globalWrapper" style="width: 100%">
		<div id="column-content">
			<div id="content" class="mw-body" role="main" style="margin: 0.5em; margin-bottom:0; margin-top:0">
				<a id="top"></a>
				
				<div class="mw-indicators">
</div>
				<h1 id="firstHeading" class="firstHeading" lang="en">systemd-networkd</h1>
				
				<div id="bodyContent" class="mw-body-content">
					<div id="contentSub"></div>
										<div id="mw-content-text" lang="en" dir="ltr" class="mw-content-ltr">
<p><span></span>
</p>
<div style="width:45%; margin: 0 0 0.5em 0.5em;">
<p style="background:#333; color:white; padding:0.2em; border-bottom:5px #08c solid; margin:0; text-align:center; font-weight:bold;">Related articles</p>
<ul style="list-style-type:none; margin:0; padding:0.3em;">
<li style="padding:0.4em 0; line-height:1;"><a href="../en/Systemd.html" title="Systemd">systemd</a></li>
<li style="padding:0.4em 0; line-height:1;"><a href="../en/Systemd-nspawn.html" title="Systemd-nspawn">systemd-nspawn</a></li>
<li style="padding:0.4em 0; line-height:1;"><a href="../en/Network_bridge.html" title="Network bridge">Network bridge</a></li>
<li style="padding:0.4em 0; line-height:1;"><a href="../en/Network_configuration.html" title="Network configuration">Network configuration</a></li>
<li style="padding:0.4em 0; line-height:1;"><a href="../en/Wireless_network_configuration.html" title="Wireless network configuration">Wireless network configuration</a></li>
<li style="padding:0.4em 0; line-height:1;"><a href="../en/Category:Network_configuration.html" title="Category:Network configuration">Category:Network configuration</a></li>
</ul>
</div>
<p><i>systemd-networkd</i> is a system daemon that manages network configurations. It detects and configures network devices as they appear; it can also create virtual network devices. This service can be especially useful to set up complex network configurations for a container managed by <a href="../en/Systemd-nspawn.html" title="Systemd-nspawn">systemd-nspawn</a> or for virtual machines. It also works fine on simple connections.
</p>
<div id="toc" class="toc">
<div id="toctitle"><h2>Contents</h2></div>
<ul>
<li class="toclevel-1 tocsection-1">
<a href="#Basic_usage"><span class="tocnumber">1</span> <span class="toctext">Basic usage</span></a>
<ul>
<li class="toclevel-2 tocsection-2"><a href="#Required_services_and_setup"><span class="tocnumber">1.1</span> <span class="toctext">Required services and setup</span></a></li>
<li class="toclevel-2 tocsection-3">
<a href="#Configuration_examples"><span class="tocnumber">1.2</span> <span class="toctext">Configuration examples</span></a>
<ul>
<li class="toclevel-3 tocsection-4"><a href="#Wired_adapter_using_DHCP"><span class="tocnumber">1.2.1</span> <span class="toctext">Wired adapter using DHCP</span></a></li>
<li class="toclevel-3 tocsection-5"><a href="#Wired_adapter_using_a_static_IP"><span class="tocnumber">1.2.2</span> <span class="toctext">Wired adapter using a static IP</span></a></li>
<li class="toclevel-3 tocsection-6"><a href="#Wireless_adapter"><span class="tocnumber">1.2.3</span> <span class="toctext">Wireless adapter</span></a></li>
<li class="toclevel-3 tocsection-7"><a href="#Wired_and_wireless_adapters_on_the_same_machine"><span class="tocnumber">1.2.4</span> <span class="toctext">Wired and wireless adapters on the same machine</span></a></li>
</ul>
</li>
</ul>
</li>
<li class="toclevel-1 tocsection-8">
<a href="#Configuration_files"><span class="tocnumber">2</span> <span class="toctext">Configuration files</span></a>
<ul>
<li class="toclevel-2 tocsection-9">
<a href="#network_files"><span class="tocnumber">2.1</span> <span class="toctext">network files</span></a>
<ul>
<li class="toclevel-3 tocsection-10"><a href="#.5BMatch.5D_section"><span class="tocnumber">2.1.1</span> <span class="toctext">[Match] section</span></a></li>
<li class="toclevel-3 tocsection-11"><a href="#.5BLink.5D_section"><span class="tocnumber">2.1.2</span> <span class="toctext">[Link] section</span></a></li>
<li class="toclevel-3 tocsection-12"><a href="#.5BNetwork.5D_section"><span class="tocnumber">2.1.3</span> <span class="toctext">[Network] section</span></a></li>
<li class="toclevel-3 tocsection-13"><a href="#.5BAddress.5D_section"><span class="tocnumber">2.1.4</span> <span class="toctext">[Address] section</span></a></li>
<li class="toclevel-3 tocsection-14"><a href="#.5BRoute.5D_section"><span class="tocnumber">2.1.5</span> <span class="toctext">[Route] section</span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-15">
<a href="#netdev_files"><span class="tocnumber">2.2</span> <span class="toctext">netdev files</span></a>
<ul>
<li class="toclevel-3 tocsection-16"><a href="#.5BMatch.5D_section_2"><span class="tocnumber">2.2.1</span> <span class="toctext">[Match] section</span></a></li>
<li class="toclevel-3 tocsection-17"><a href="#.5BNetDev.5D_section"><span class="tocnumber">2.2.2</span> <span class="toctext">[NetDev] section</span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-18">
<a href="#link_files"><span class="tocnumber">2.3</span> <span class="toctext">link files</span></a>
<ul>
<li class="toclevel-3 tocsection-19"><a href="#.5BMatch.5D_section_3"><span class="tocnumber">2.3.1</span> <span class="toctext">[Match] section</span></a></li>
<li class="toclevel-3 tocsection-20"><a href="#.5BLink.5D_section_2"><span class="tocnumber">2.3.2</span> <span class="toctext">[Link] section</span></a></li>
<li class="toclevel-3 tocsection-21"><a href="#Renaming_an_interface"><span class="tocnumber">2.3.3</span> <span class="toctext">Renaming an interface</span></a></li>
</ul>
</li>
</ul>
</li>
<li class="toclevel-1 tocsection-22">
<a href="#Usage_with_containers"><span class="tocnumber">3</span> <span class="toctext">Usage with containers</span></a>
<ul>
<li class="toclevel-2 tocsection-23"><a href="#Basic_DHCP_network"><span class="tocnumber">3.1</span> <span class="toctext">Basic DHCP network</span></a></li>
<li class="toclevel-2 tocsection-24">
<a href="#DHCP_with_two_distinct_IP"><span class="tocnumber">3.2</span> <span class="toctext">DHCP with two distinct IP</span></a>
<ul>
<li class="toclevel-3 tocsection-25"><a href="#Bridge_interface"><span class="tocnumber">3.2.1</span> <span class="toctext">Bridge interface</span></a></li>
<li class="toclevel-3 tocsection-26"><a href="#Bind_ethernet_to_bridge"><span class="tocnumber">3.2.2</span> <span class="toctext">Bind ethernet to bridge</span></a></li>
<li class="toclevel-3 tocsection-27"><a href="#Bridge_network"><span class="tocnumber">3.2.3</span> <span class="toctext">Bridge network</span></a></li>
<li class="toclevel-3 tocsection-28"><a href="#Add_option_to_boot_the_container"><span class="tocnumber">3.2.4</span> <span class="toctext">Add option to boot the container</span></a></li>
<li class="toclevel-3 tocsection-29"><a href="#Result"><span class="tocnumber">3.2.5</span> <span class="toctext">Result</span></a></li>
<li class="toclevel-3 tocsection-30"><a href="#Notice"><span class="tocnumber">3.2.6</span> <span class="toctext">Notice</span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-31"><a href="#Static_IP_network"><span class="tocnumber">3.3</span> <span class="toctext">Static IP network</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-32"><a href="#Management_and_desktop_integration"><span class="tocnumber">4</span> <span class="toctext">Management and desktop integration</span></a></li>
<li class="toclevel-1 tocsection-33"><a href="#See_also"><span class="tocnumber">5</span> <span class="toctext">See also</span></a></li>
</ul>
</div>

<h2><span class="mw-headline" id="Basic_usage">Basic usage</span></h2>
<p>The <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://www.archlinux.org/packages/?name=systemd">systemd</a></span> package is part of the default Arch installation and contains all needed files to operate a wired network.  Wireless adapters can be setup by other services, such as <a href="../en/WPA_supplicant.html" title="Wpa supplicant" class="mw-redirect">wpa_supplicant</a>, which are covered later in this article.
</p>
<h3><span class="mw-headline" id="Required_services_and_setup">Required services and setup</span></h3>
<p>To use <i>systemd-networkd</i>, <a href="../en/Systemd.html#Using_units" title="Start" class="mw-redirect">start</a> the following two services and <a href="../en/Systemd.html#Using_units" title="Enable" class="mw-redirect">enable</a> them to run on system boot:
</p>
<ul>
<li> <code>systemd-networkd.service</code>
</li>
<li> <code>systemd-resolved.service</code>
</li>
</ul>
<div style="padding: 5px; margin: 0.50em 0; background-color: #DDDDFF; border: thin solid #BBBBDD; overflow: hidden;">
<strong> Note: </strong><i>systemd-resolved</i> is actually required only if you are specifying DNS entries in <i>.network</i> files or if you want to obtain DNS addresses from networkd's DHCP client.</div>
<p>For compatibility with <a href="../en/Resolv.conf.html" title="Resolv.conf">resolv.conf</a>, delete or rename the existing file and create the following symbolic link:
</p>
<pre># ln -s /run/systemd/resolve/resolv.conf /etc/resolv.conf
</pre>
<p>Optionally, if you wish to use the local DNS stub resolver of <i>systemd-resolved</i> (and thus use LLMNR and DNS merging per interface), replace <code>dns</code> with <code>resolve</code> in <code>/etc/nsswitch.conf</code>:
</p>
<pre>hosts: files <b>resolve</b> myhostname
</pre>
<p>See <code>man systemd-resolved</code> and <code>man resolved.conf</code> and <a rel="nofollow" class="external text" href="https://github.com/systemd/systemd/blob/master/README#L205">Systemd README</a>.
</p>
<div style="padding: 5px; margin: 0.50em 0; background-color: #DDDDFF; border: thin solid #BBBBDD; overflow: hidden;">
<strong> Note: </strong>Systemd's <code>resolve</code> may not search the local domain when given just the hostname, even when <code>UseDomains=yes</code> or <code>Domains=[domain-list]</code> is present in the appropriate <code>.network</code> file, and that file produces the expected <code>search [domain-list]</code> in <code>resolv.conf</code>.  If you run into this problem:
<ul>
<li> Switch to using fully-qualified domain names</li>
<li> Use <code>/etc/hosts</code> to resolve hostnames</li>
<li> Fall back to using glibc's <code>dns</code> instead of using systemd's <code>resolve</code>
</li>
</ul>
</div>
<h3><span class="mw-headline" id="Configuration_examples">Configuration examples</span></h3>
<p>All configurations in this section are stored as <code>foo.network</code> in <code>/etc/systemd/network</code>. For a full listing of options and processing order, see <a href="#Configuration_files">#Configuration files</a> and <span class="plainlinks archwiki-template-man" title="$ man 5 systemd.network"><a rel="nofollow" class="external text" href="http://man7.org/linux/man-pages/man5/systemd.network.5.html">systemd.network(5)</a></span>.
</p>
<p>Systemd/udev automatically assigns predictable, stable network interface names for all local Ethernet, WLAN, and WWAN interfaces. Use <code>networkctl list</code> to list the devices on the system.
</p>
<p>After making changes to a configuration file, <a href="../en/Systemd.html#Using_units" title="Restart" class="mw-redirect">restart</a> <code>systemd-networkd.service</code>.
</p>
<div style="padding: 5px; margin: 0.50em 0; background-color: #DDDDFF; border: thin solid #BBBBDD; overflow: hidden;">
<strong> Note: </strong>In the examples below, <code>enp1s0</code> is the wired adapter and <code>wlp2s0</code> is the wireless adapter. These names can be different on different systems.</div>
<div style="padding: 5px; margin: 0.50em 0; background-color: #DDDDFF; border: thin solid #BBBBDD; overflow: hidden;">
<strong> Note: </strong>If you want to disable IPv6, and your router advertises IPv6, you might need to add <code>IPv6AcceptRA=false</code> to the <code>[Network]</code> section</div>
<h4><span class="mw-headline" id="Wired_adapter_using_DHCP">Wired adapter using DHCP</span></h4>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/systemd/network/<i>wired</i>.network</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">
[Match]
Name=enp1s0

[Network]
DHCP=ipv4
</pre>
<h4><span class="mw-headline" id="Wired_adapter_using_a_static_IP">Wired adapter using a static IP</span></h4>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/systemd/network/<i>wired</i>.network</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">
[Match]
Name=enp1s0

[Network]
Address=10.1.10.9/24
Gateway=10.1.10.1
</pre>
<p>You may specify multiple IP addresses. Add an IPv6 address with another Address= line. See the <code>systemd.network(5)</code> man page for more network options such as specifying DNS servers and a broadcast address.
</p>
<h4><span class="mw-headline" id="Wireless_adapter">Wireless adapter</span></h4>
<p>In order to connect to a wireless network with <i>systemd-networkd</i>, a wireless adapter configured with another service such as <a href="../en/WPA_supplicant.html" title="Wpa supplicant" class="mw-redirect">wpa_supplicant</a> is required.  In this example, the corresponding systemd service file that needs to be enabled is <code>wpa_supplicant@wlp2s0.service</code>. This service will run <i>wpa_supplicant</i> with the configuration file <code>/etc/wpa_supplicant/wpa_supplicant-wlp2s0.conf</code>. If this file does not exist, the service will not start.
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/systemd/network/<i>wireless</i>.network</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">
[Match]
Name=wlp2s0

[Network]
DHCP=ipv4
</pre>
<p>If the wireless adapter has a static IP address, the configuration is the same (except for the interface name) as in a <a href="#Wired_adapter_using_a_static_IP">wired adapter</a>.
</p>
<h4><span class="mw-headline" id="Wired_and_wireless_adapters_on_the_same_machine">Wired and wireless adapters on the same machine</span></h4>
<p>This setup will enable a DHCP IP for both a wired and wireless connection making use of the metric directive to allow the kernel the decide on-the-fly which one to use.  This way, no connection downtime is observed when the wired connection is unplugged.
</p>
<p>The kernel's route metric (same as configured with <i>ip</i>) decides which route to use for outgoing packets, in cases when several match. This will be the case when both wireless and wired devices on the system have active connections. To break the tie, the kernel uses the metric. If one of the connections is terminated, the other automatically wins without there being a gap with nothing configured (ongoing transfers may still not deal with this nicely but that is at a different OSI layer).
</p>
<div style="padding: 5px; margin: 0.50em 0; background-color: #DDDDFF; border: thin solid #BBBBDD; overflow: hidden;">
<strong> Note: </strong>The <b>Metric</b> option is for static routes while the <b>RouteMetric</b> option is for setups not using static routes.</div>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/systemd/network/<i>wired</i>.network</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">
[Match]
Name=enp1s0

[Network]
DHCP=ipv4

[DHCP]
RouteMetric=10
</pre>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/systemd/network/<i>wireless</i>.network</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">
[Match]
Name=wlp2s0

[Network]
DHCP=ipv4

[DHCP]
RouteMetric=20
</pre>
<h2><span class="mw-headline" id="Configuration_files">Configuration files</span></h2>
<p>Configuration files are located in <code>/usr/lib/systemd/network</code>, the volatile runtime network directory <code>/run/systemd/network</code> and, the local administration network directory <code>/etc/systemd/network</code>. Files in <code>/etc/systemd/network</code> have the highest priority.
</p>
<p>There are three types of configuration files. 
</p>
<ul>
<li> <b>.network</b> files. They will apply a network configuration for a <i>matching</i> device</li>
<li> <b>.netdev</b> files. They will create a <i>virtual network device</i> for a <i>matching</i> environment</li>
<li> <b>.link</b> files. When a network device appears, <a href="../en/Udev.html" title="Udev">udev</a> will look for the first <i>matching</i> <b>.link</b> file</li>
</ul>
<p>They all follow the same rules: 
</p>
<ul>
<li> If <b>all</b> conditions in the <code>[Match]</code> section are matched, the profile will be activated</li>
<li> an empty <code>[Match]</code> section means the profile will apply in any case (can be compared to the <code>*</code> joker)</li>
<li> each entry is a key with the <code>NAME=VALUE</code> syntax </li>
<li> all configuration files are collectively sorted and processed in lexical order, regardless of the directory in which they live</li>
<li> files with identical name replace each other</li>
</ul>
<div style="padding: 5px; margin: 0.50em 0; background-color: #DDFFDD; border: thin solid #BBDDBB; overflow: hidden;">
<strong> Tip: </strong>
<ul>
<li> to override a system-supplied file in <code>/usr/lib/systemd/network</code> in a permanent manner (i.e even after upgrade), place a file with same name in <code>/etc/systemd/network</code> and symlink it to <code>/dev/null</code>
</li>
<li> the <code>*</code> joker can be used in <code>VALUE</code> (e.g <code>en*</code> will match any Ethernet device)</li>
<li> following this <a rel="nofollow" class="external text" href="https://mailman.archlinux.org/pipermail/arch-general/2014-March/035381.html">Arch-general thread</a>, the best practice is to setup specific container network settings <i>inside the container</i> with <b>networkd</b> configuration files.</li>
</ul>
</div>
<h3><span class="mw-headline" id="network_files">network files</span></h3>
<p>These files are aimed at setting network configuration variables, especially for servers and containers.
</p>
<p>Below is a basic structure of a <code><i>MyProfile</i>.network</code> file:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/systemd/network/<i>MyProfile</i>.network</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">
[Match]
<i>a vertical list of keys</i>

[Network]
<i>a vertical list of keys</i>

[Address]
<i>a vertical list of keys</i>

[Route]
<i>a vertical list of keys</i>
</pre>
<h4><span class="mw-headline" id=".5BMatch.5D_section">[Match] section</span></h4>
<p>Most common keys are:
</p>
<ul>
<li> <code>Name=</code> the device name (e.g Br0, enp4s0, en*)</li>
<li> <code>Host=</code> the machine hostname</li>
<li> <code>Virtualization=</code> check whether the system is executed in a virtualized environment or not. A <code>Virtualization=no</code> key will only apply on your host machine, while <code>Virtualization=yes</code> apply to any container or VM.</li>
</ul>
<h4><span class="mw-headline" id=".5BLink.5D_section">[Link] section</span></h4>
<p>Most common keys are:
</p>
<ul>
<li> <code>MACAddress=</code> useful for <a href="../en/MAC_address_spoofing.html#Method_1:_systemd-networkd" title="MAC address spoofing">MAC address spoofing</a>
</li>
<li> <code>MTUBytes=</code> the maximum transmission unit in bytes (suffixes K, M, G, are supported and are understood to the base of 1024). Using a larger MTU value (<a href="../en/Jumbo_frames.html" title="Jumbo frames">Jumbo frames</a>) can significantly speed up your network transfers.</li>
</ul>
<h4><span class="mw-headline" id=".5BNetwork.5D_section">[Network] section</span></h4>
<p>Most common keys are:
</p>
<ul>
<li> <code>DHCP=</code> enables <a href="https://en.wikipedia.org/wiki/Dynamic_Host_Configuration_Protocol" class="extiw" title="wikipedia:Dynamic Host Configuration Protocol">DHCPv4</a> and/or DHCPv6 support. Accepts <code>yes</code>, <code>no</code>, <code>ipv4</code> or <code>ipv6</code>
</li>
<li> <code>DNS=</code> is a <a href="https://en.wikipedia.org/wiki/Domain_Name_System" class="extiw" title="wikipedia:Domain Name System">DNS</a> server address. You can specify this option more than once</li>
<li> <code>Bridge=</code> is the name of the bridge to add the link to</li>
<li> <code>IPForward=</code> defaults to <code>no</code>. It enables IP forwarding, performing the forwarding according to the routing table and is required for setting up <a href="../en/Internet_sharing.html" title="Internet sharing">Internet sharing</a>. Note that turning <code>IPForward=</code> on applies to <i>all</i> network interfaces. </li>
<li> <code>Domains=</code> a list of the domains used for DNS host name resolution.</li>
</ul>
<p>Please see <code>systemd.network(5)</code> for details.
</p>
<h4><span class="mw-headline" id=".5BAddress.5D_section">[Address] section</span></h4>
<p>Most common key in the <code>[Address]</code> section is:
</p>
<ul><li> <code>Address=</code> is a static <b>IPv4</b> or <b>IPv6</b> address and its prefix length, separated by a <code>/</code> character (e.g <code>192.168.1.90/24</code>). This option is <b>mandatory</b> unless DHCP is used.</li></ul>
<h4><span class="mw-headline" id=".5BRoute.5D_section">[Route] section</span></h4>
<p>Most common key in the <code>[Route]</code> section is:
</p>
<ul><li> <code>Gateway=</code> is the address of your machine gateway. This option is <b>mandatory</b> unless DHCP is used.</li></ul>
<p>For an exhaustive key list, please refer to <code>systemd.network(5)</code>
</p>
<div style="padding: 5px; margin: 0.50em 0; background-color: #DDFFDD; border: thin solid #BBDDBB; overflow: hidden;">
<strong> Tip: </strong>you can put the <code>Address=</code> and <code>Gateway=</code> keys in the <code>[Network]</code> section as a short-hand if <code>Address=</code> contains only an Address key and <code>Gateway=</code> section contains only a Gateway key
</div>
<h3><span class="mw-headline" id="netdev_files">netdev files</span></h3>
<p>These files will create virtual network devices.
</p>
<p>Below is a basic structure of a <i>Mydevice</i>.netdev file:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/systemd/network/<i>MyDevice</i>.netdev</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">
[Match]
<i>a vertical list of keys</i>

[NetDev]
<i>a vertical list of keys</i>
</pre>
<h4><span class="mw-headline" id=".5BMatch.5D_section_2">[Match] section</span></h4>
<p>Most common keys are <code>Host=</code> and <code>Virtualization=</code>
</p>
<h4><span class="mw-headline" id=".5BNetDev.5D_section">[NetDev] section</span></h4>
<p>Most common keys are:
</p>
<ul>
<li> <code>Name=</code> is the interface name used when creating the netdev. This option is <b>compulsory</b>
</li>
<li> <code>Kind=</code> is the netdev kind. For example, <i>bridge</i>, <i>bond</i>, <i>vlan</i>, <i>veth</i>, <i>sit</i>, etc. are supported. This option is <b>compulsory</b>
</li>
</ul>
<p>For an exhaustive key list, please refer to <code>systemd.netdev(5)</code>
</p>
<h3><span class="mw-headline" id="link_files">link files</span></h3>
<p>These files are an alternative to custom udev rules and will be applied by <a href="../en/Udev.html" title="Udev">udev</a> as the device appears.
</p>
<p>Below is a basic structure of a <i>Mydevice</i>.link file:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/systemd/network/<i>MyDevice</i>.link</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">
[Match]
<i>a vertical list of keys</i>

[Link]
<i>a vertical list of keys</i>
</pre>
<p>The <code>[Match]</code> section will determine if a given link file may be applied to a given device, when the <code>[Link]</code> section specifies the device configuration.
</p>
<div style="padding: 5px; margin: 0.50em 0; background-color: #DDFFDD; border: thin solid #BBDDBB; overflow: hidden;">
<strong> Tip: </strong>Use <code>udevadm test-builtin net_setup_link /sys/path/to/network/device</code> to diagnose problems with <code>.link</code> files.</div>
<h4><span class="mw-headline" id=".5BMatch.5D_section_3">[Match] section</span></h4>
<p>Most common keys are <code>MACAddress=</code>, <code>Host=</code> and <code>Virtualization=</code>.
</p>
<p><code>Type=</code> is the device type (e.g. vlan)
</p>
<h4><span class="mw-headline" id=".5BLink.5D_section_2">[Link] section</span></h4>
<p>Most common keys are:
</p>
<p><code>MACAddressPolicy=</code> is either <i>persistent</i> when the hardware has a persistent MAC address (as most hardware should) or <i>random</i> , which allows to give a random MAC address when the device appears.
</p>
<p><code>MACAddress=</code> shall be used when no <code>MACAddressPolicy=</code> is specified.
</p>
<div style="padding: 5px; margin: 0.50em 0; background-color: #DDDDFF; border: thin solid #BBBBDD; overflow: hidden;">
<strong> Note: </strong>the system <code>/usr/lib/systemd/network/99-default.link</code> is generally sufficient for most of the basic cases.</div>
<h4><span class="mw-headline" id="Renaming_an_interface">Renaming an interface</span></h4>
<p>Instead of <a href="../en/Network_configuration.html#Change_device_name" title="Network configuration">editing udev rules</a>, a .link file can be used to rename an interface. A useful example is to set a predictable interface name for a USB-to-Ethernet adapter based on its MAC address, as those adapters are usually given different names depending on which USB port they are plugged into.
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/systemd/network/10-ethusb0.link</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[Match]
MACAddress=12:34:56:78:90:ab

[Link]
Description=USB to Ethernet Adapter
Name=ethusb0</pre>
<div style="padding: 5px; margin: 0.50em 0; background-color: #DDDDFF; border: thin solid #BBBBDD; overflow: hidden;">
<strong> Note: </strong>The default link file <code>/usr/lib/systemd/network/99-default.link</code> is shipped by the system. Any user-supplied .link <b>should</b> have a lexically earlier file name to be considered at all. For example, name the file <code>10-ethusb0.link </code> and not <code>ethusb0.link</code>.</div>
<h2><span class="mw-headline" id="Usage_with_containers">Usage with containers</span></h2>
<p>The service is available with <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://www.archlinux.org/packages/?name=systemd">systemd</a></span>. You will want to <a href="../en/Systemd.html#Using_units" title="Enable" class="mw-redirect">enable</a> and <a href="../en/Systemd.html#Using_units" title="Start" class="mw-redirect">start</a> the <code>systemd-networkd.service</code> unit on the host and container.
</p>
<p>For debugging purposes, it is strongly advised to <a href="../en/Help:Reading.html#Installation_of_packages" title="Install" class="mw-redirect">install</a> the <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://www.archlinux.org/packages/?name=bridge-utils">bridge-utils</a></span>, <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://www.archlinux.org/packages/?name=net-tools">net-tools</a></span>, and <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://www.archlinux.org/packages/?name=iproute2">iproute2</a></span> packages.
</p>
<p>If you are using <i>systemd-nspawn</i>, you may need to modify the <code>systemd-nspawn@.service</code> and append boot options to the <code>ExecStart</code> line. Please refer to <code>man 1 systemd-nspawn</code> for an exhaustive list of options.
</p>
<p>Note that if you want to take advantage of automatic DNS configuration from DHCP, you need to enable <code>systemd-resolved</code> and symlink <code>/run/systemd/resolve/resolv.conf</code> to <code>/etc/resolv.conf</code>. See <code>systemd-resolved.service(8)</code> for more details.
</p>
<div class="noprint archwiki-template-message">
<p><a href="../File:Tango-edit-clear.png" class="image"><img alt="Tango-edit-clear.png" src="../File:Tango-edit-clear.png" width="48" height="48"></a><b>This article or section needs language, wiki syntax or style improvements.</b><a href="../File:Tango-edit-clear.png" class="image"><img alt="Tango-edit-clear.png" src="../File:Tango-edit-clear.png" width="48" height="48"></a></p>
<div>
<b>Reason:</b> Too many points for a tip, some of them are very similar so they could be merged. (Discuss in <a rel="nofollow" class="external text" href="https://wiki.archlinux.org/index.php/Talk:Systemd-networkd">Talk:Systemd-networkd#</a>)</div>
</div>
<div style="padding: 5px; margin: 0.50em 0; background-color: #DDFFDD; border: thin solid #BBDDBB; overflow: hidden;">
<strong> Tip: </strong>Before you start to configure your container network, it is useful to:
<ul>
<li> disable all your <a href="../en/Netctl.html" title="Netctl">netctl</a> services. This will avoid any potential conflicts with <code>systemd-networkd</code> and make all your configurations easier to test. Furthermore, odds are high you will end with few or even no <a href="../en/Netctl.html" title="Netctl">netctl</a> activated profiles. The <code>netctl list</code> command will output a list of all your profiles, with the activated one being starred.</li>
<li> disable the <code>systemd-nspawn@.service</code> and use the <code>systemd-nspawn -bnD /path_to/your_container/</code> command as root to boot the container. To log off and shutdown inside the container <code>systemctl poweroff</code> is used as root. Once the network setting meets your requirements, <a href="../en/Systemd.html#Basic_systemctl_usage" title="Systemd">enable and start</a> <code>systemd-nspawn@.service</code>
</li>
<li> disable the <code>dhcpcd.service</code> if enabled on your system, since it activates <i>dhcpcd</i> on <b>all</b> interfaces</li>
<li> make sure you have no <a href="../en/Netctl.html" title="Netctl">netctl</a> profiles activated in the container, and ensure that <code>systemd-networkd.service</code> is neither enabled nor started</li>
<li> make sure you do not have any <a href="../en/Iptables.html" title="Iptables">iptables</a> rules which can block traffic</li>
<li> make sure <i>packet forwarding</i> is <a href="../en/Internet_sharing.html#Enable_packet_forwarding" title="Internet sharing">enabled</a> if you want to let containers access the internet. Make sure that your <code>.network</code> file does not accidentally turn off forwarding because if you do not have a <code>IPForward=1</code> setting in it, <code>systemd-networkd</code> will turn off forwarding on this interface, even if you have it enabled globally.</li>
<li> when the daemon is started the systemd <code>networkctl</code> command displays the status of network interfaces.</li>
</ul>
</div>
<div style="padding: 5px; margin: 0.50em 0; background-color: #DDDDFF; border: thin solid #BBBBDD; overflow: hidden;">
<strong> Note: </strong>For the set-up described below, 
<ul>
<li> we will limit the output of the <code>ip a</code> command to the concerned interfaces</li>
<li> we assume the <i>host</i> is your main OS you are booting to and the <i>container</i> is your guest virtual machine</li>
<li> all interface names and IP addresses are only examples</li>
</ul>
</div>
<h3><span class="mw-headline" id="Basic_DHCP_network">Basic DHCP network</span></h3>
<p>This setup will enable a DHCP IP for host and container. In this case, both systems will share the same IP as they share the same interfaces.
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/systemd/network/<i>MyDhcp</i>.network</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">
[Match]
Name=en*

[Network]
DHCP=ipv4
</pre>
<p>Then, <a href="../en/Systemd.html#Using_units" title="Enable" class="mw-redirect">enable</a> and start <code>systemd-networkd.service</code> on your container.
</p>
<p>You can of course replace <code>en*</code> by the full name of your ethernet device given by the output of the <code>ip link</code> command.
</p>
<ul><li> on host and container:</li></ul>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">$ ip a</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">
2: enp7s0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UP group default qlen 1000
    link/ether 14:da:e9:b5:7a:88 brd ff:ff:ff:ff:ff:ff
    inet 192.168.1.72/24 brd 192.168.1.255 scope global enp7s0
       valid_lft forever preferred_lft forever
    inet6 fe80::16da:e9ff:feb5:7a88/64 scope link 
       valid_lft forever preferred_lft forever
</pre>
<p>By default, hostname received from the DHCP server will be used as the transient hostname.
</p>
<p>To change it add <code>UseHostname=false</code> in section <code>[DHCPv4]</code>
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/systemd/network/<i>MyDhcp</i>.network</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">
[DHCPv4]
UseHostname=false
</pre>
<p>If you did not want to configure a DNS in <code>/etc/resolv.conf</code> and want to rely on DHCP for setting it up, you need to <a href="../en/Systemd.html#Using_units" title="Enable" class="mw-redirect">enable</a> <code>systemd-resolved.service</code> and symlink <code>/run/systemd/resolve/resolv.conf</code> to <code>/etc/resolv.conf</code>
</p>
<pre># ln -sf /run/systemd/resolve/resolv.conf /etc/resolv.conf
</pre>
<p>See <code>systemd-resolved.service(8)</code> for more details.
</p>
<h3><span class="mw-headline" id="DHCP_with_two_distinct_IP">DHCP with two distinct IP</span></h3>
<h4><span class="mw-headline" id="Bridge_interface">Bridge interface</span></h4>
<p>Create a virtual bridge interface 
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/systemd/network/<i>MyBridge</i>.netdev</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">
[NetDev]
Name=br0
Kind=bridge
</pre>
<p><a href="../en/Systemd.html#Using_units" title="Restart" class="mw-redirect">Restart</a> <code>systemd-networkd.service</code> to have systemd create the bridge.
</p>
<p>On host and container:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">$ ip a</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">
3: br0: &lt;BROADCAST,MULTICAST&gt; mtu 1500 qdisc noop state DOWN group default 
    link/ether ae:bd:35:ea:0c:c9 brd ff:ff:ff:ff:ff:ff
</pre>
<p>Note that the interface br0 is listed but is DOWN.
</p>
<h4><span class="mw-headline" id="Bind_ethernet_to_bridge">Bind ethernet to bridge</span></h4>
<p>Modify the <code>/etc/systemd/network/<i>MyDhcp</i>.network</code> to remove the DHCP, as the bridge requires an interface to bind to with no IP, and add a key to bind this device to br0. Let us change its name to a more relevant one.
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/systemd/network/<i>MyEth</i>.network</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">
[Match]
Name=en*

[Network]
Bridge=br0
</pre>
<h4><span class="mw-headline" id="Bridge_network">Bridge network</span></h4>
<p>Create a network profile for the Bridge
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/systemd/network/<i>MyBridge</i>.network</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">
[Match]
Name=br0

[Network]
DHCP=ipv4
</pre>
<h4><span class="mw-headline" id="Add_option_to_boot_the_container">Add option to boot the container</span></h4>
<p>As we want to give a separate IP for host and container, we need to <i>Disconnect</i> networking of the container from the host. To do this, add this option <code>--network-bridge=br0</code> to your container boot command.
</p>
<pre># systemd-nspawn --network-bridge=br0 -bD /path_to/my_container
</pre>
<h4><span class="mw-headline" id="Result">Result</span></h4>
<ul><li> on host</li></ul>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">$ ip a</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">
3: br0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue state UP group default 
    link/ether 14:da:e9:b5:7a:88 brd ff:ff:ff:ff:ff:ff
    inet 192.168.1.87/24 brd 192.168.1.255 scope global br0
       valid_lft forever preferred_lft forever
    inet6 fe80::16da:e9ff:feb5:7a88/64 scope link 
       valid_lft forever preferred_lft forever
6: vb-<i>MyContainer</i>: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast master br0 state UP group default qlen 1000
    link/ether d2:7c:97:97:37:25 brd ff:ff:ff:ff:ff:ff
    inet6 fe80::d07c:97ff:fe97:3725/64 scope link 
       valid_lft forever preferred_lft forever
</pre>
<ul><li> on container</li></ul>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">$ ip a</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">
2: host0: &lt;BROADCAST,MULTICAST,ALLMULTI,AUTOMEDIA,NOTRAILERS,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UP group default qlen 1000
    link/ether 5e:96:85:83:a8:5d brd ff:ff:ff:ff:ff:ff
    inet 192.168.1.73/24 brd 192.168.1.255 scope global host0
       valid_lft forever preferred_lft forever
    inet6 fe80::5c96:85ff:fe83:a85d/64 scope link 
       valid_lft forever preferred_lft forever
</pre>
<h4><span class="mw-headline" id="Notice">Notice</span></h4>
<ul>
<li> we have now one IP address for Br0 on the host, and one for host0 in the container</li>
<li> two new interfaces have appeared: <code>vb-<i>MyContainer</i></code> in the host and <code>host0</code> in the container. This comes as a result of the <code>--network-bridge=br0</code> option. This option <i>implies</i> another option, <code>--network-veth</code>. This means a <i>virtual Ethernet link</i> has been created between host and container.</li>
<li> the DHCP address on <code>host0</code> comes from the system <code>/usr/lib/systemd/network/80-container-host0.network</code> file.</li>
<li> on host</li>
</ul>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">$ brctl show</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">
bridge name	bridge id		STP enabled	interfaces
br0		8000.14dae9b57a88	no		enp7s0
							vb-<i>MyContainer</i>
</pre>
<p>the above command output confirms we have a bridge with two interfaces binded to.
</p>
<ul><li> on host</li></ul>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">$ ip route</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">
default via 192.168.1.254 dev br0 
192.168.1.0/24 dev br0  proto kernel  scope link  src 192.168.1.87
</pre>
<ul><li> on container</li></ul>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">$ ip route</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">
default via 192.168.1.254 dev host0 
192.168.1.0/24 dev host0  proto kernel  scope link  src 192.168.1.73
</pre>
<p>the above command outputs confirm we have activated <code>br0</code> and <code>host0</code> interfaces with an IP address and Gateway 192.168.1.254. The gateway address has been automatically grabbed by <i>systemd-networkd</i>
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">$ cat /run/systemd/resolve/resolv.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">
nameserver 192.168.1.254
</pre>
<h3><span class="mw-headline" id="Static_IP_network">Static IP network</span></h3>
<p>Setting a static IP for each device can be helpful in case of deployed web services (e.g FTP, http, SSH). Each device will keep the same MAC address across reboots if your system <code>/usr/lib/systemd/network/99-default.link</code> file has the <code>MACAddressPolicy=persistent</code> option (it has by default). Thus, you will easily route any service on your Gateway to the desired device.
First, we shall get rid of the system <code>/usr/lib/systemd/network/80-container-host0.network</code> file. To do it in a permanent way (e.g even after upgrades), do the following on container.  This will mask the file <code>/usr/lib/systemd/network/80-container-host0.network</code> since files of the same name in <code>/etc/systemd/network</code> take priority over <code>/usr/lib/systemd/network</code>.
</p>
<pre># ln -sf /dev/null /etc/systemd/network/80-container-host0.network
</pre>
<p>Then, <a href="../en/Systemd.html#Basic_systemctl_usage" title="Systemd">enable and start</a> <code>systemd-networkd</code> on your container.
</p>
<p>The needed configuration files:
</p>
<ul><li> on host </li></ul>
<div class="noprint archwiki-template-message">
<p><a href="../File:Tango-inaccurate.png" class="image"><img alt="Tango-inaccurate.png" src="../File:Tango-inaccurate.png" width="48" height="48"></a><b>The factual accuracy of this article or section is disputed.</b><a href="../File:Tango-inaccurate.png" class="image"><img alt="Tango-inaccurate.png" src="../File:Tango-inaccurate.png" width="48" height="48"></a></p>
<div>
<b>Reason:</b> In the listing of configuration files, /etc/systemd/network/MyBridge.netdev has the .netdev extension.  But, the MyBridge.network example file has the .network extension. (Discuss in <a rel="nofollow" class="external text" href="https://wiki.archlinux.org/index.php/Talk:Systemd-networkd">Talk:Systemd-networkd#</a>)</div>
</div>
<pre>/etc/systemd/network/<i>MyBridge</i>.netdev
/etc/systemd/network/<i>MyEth</i>.network
</pre>
<p>A modified <i>MyBridge</i>.network
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/systemd/network/<i>MyBridge</i>.network</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">
[Match]
Name=br0

[Network]
DNS=192.168.1.254
Address=192.168.1.87/24
Gateway=192.168.1.254
</pre>
<ul><li> on container</li></ul>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/systemd/network/<i>MyVeth</i>.network</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">
[Match]
Name=host0

[Network]
DNS=192.168.1.254
Address=192.168.1.94/24
Gateway=192.168.1.254
</pre>
<h2><span class="mw-headline" id="Management_and_desktop_integration">Management and desktop integration</span></h2>
<p><i>systemd-networkd</i> doesn't have a proper interactive management interface via either command-line or GUI. <i>networkctl</i> (via CLI) just offers a simple dump of the network interface states.
</p>
<p>When <i>networkd</i> is configured with <a href="../en/WPA_supplicant.html" title="Wpa supplicant" class="mw-redirect">wpa_supplicant</a>, both <i>wpa_cli</i> and <i>wpa_gui</i> offer the ability to associate and reconfigure WLAN interfaces dynamically.
</p>
<p><a rel="nofollow" class="external text" href="https://github.com/wavexx/networkd-notify">networkd-notify</a> can generate simple notifications in response to network interface state changes (such as connection/disconnection and re-association).
</p>
<h2><span class="mw-headline" id="See_also">See also</span></h2>
<ul>
<li> <a rel="nofollow" class="external text" href="http://www.freedesktop.org/software/systemd/man/systemd-networkd.service.html">systemd.networkd man page</a>
</li>
<li> <a rel="nofollow" class="external text" href="https://plus.google.com/u/0/+TomGundersen/posts">Tom Gundersen, main systemd-networkd developer, G+ home page</a>
</li>
<li> <a rel="nofollow" class="external text" href="https://coreos.com/blog/intro-to-systemd-networkd/">Tom Gundersen posts on Core OS blog</a>
</li>
<li> <a rel="nofollow" class="external text" href="https://bbs.archlinux.org/viewtopic.php?pid=1393759#p1393759">How to set up systemd-networkd with wpa_supplicant</a> (WonderWoofy's walkthrough on Arch forums)</li>
</ul>

</div>
<div id="catlinks" class="catlinks">
<div id="mw-normal-catlinks" class="mw-normal-catlinks">
<a href="../Special:Categories.html" title="Special:Categories">Categories</a>: <ul>
<li><a href="../en/Category:Network_configuration.html" title="Category:Network configuration">Network configuration</a></li>
<li><a href="../en/Category:Virtualization.html" title="Category:Virtualization">Virtualization</a></li>
</ul>
</div>
<div id="mw-hidden-catlinks" class="mw-hidden-catlinks mw-hidden-cats-hidden">Hidden categories: <ul>
<li><a href="../en/Category:Pages_or_sections_flagged_with_Template:Style.html" title="Category:Pages or sections flagged with Template:Style">Pages or sections flagged with Template:Style</a></li>
<li><a href="../en/Category:Pages_or_sections_flagged_with_Template:Accuracy.html" title="Category:Pages or sections flagged with Template:Accuracy">Pages or sections flagged with Template:Accuracy</a></li>
</ul>
</div>
</div>					<div class="visualClear"></div>
				</div>
			</div>
		</div>
		<div class="visualClear"></div>
					<div id="footer" role="contentinfo">
Extracted from <a href="https://wiki.archlinux.org"> ArchWiki </a> and licensed under <a href="http://www.gnu.org/copyleft/fdl.html"> GDL >= 1.3</a>
		</div>
		</div>
		</body>
</html>
