<!DOCTYPE html>
<html lang="en" dir="ltr" class="client-nojs">
<head>
<meta charset="UTF-8">
<title>VirtualBox/Tips and tricks - ArchWiki</title>
<link rel="stylesheet" href="../../ArchWikiOffline.css">
<meta name="ResourceLoaderDynamicStyles" content="">
<style></style>
<meta name="generator" content="MediaWiki 1.26.4">
<meta name="robots" content="noindex,follow">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="search" type="application/opensearchdescription+xml" href="/opensearch_desc.php" title="ArchWiki (en)">
<link rel="EditURI" type="application/rsd+xml" href="https://wiki.archlinux.org/api.php?action=rsd">
<link rel="copyright" href="http://www.gnu.org/copyleft/fdl.html">
<link rel="alternate" type="application/atom+xml" title="ArchWiki Atom feed" href="/index.php?title=Special:RecentChanges&amp;feed=atom">
</head>
<body class="mediawiki ltr sitedir-ltr ns-0 ns-subject page-VirtualBox_Tips_and_tricks skin-archlinux action-view">

		<div id="globalWrapper" style="width: 100%">
		<div id="column-content">
			<div id="content" class="mw-body" role="main" style="margin: 2em; margin-bottom: 0">
				<a id="top"></a>
				
				<div class="mw-indicators">
</div>
				<h1 id="firstHeading" class="firstHeading" lang="en">VirtualBox/Tips and tricks</h1>
				
				<div id="bodyContent" class="mw-body-content">
					<div id="contentSub"><span class="subpages">&lt; <a href="../../en/VirtualBox.html" title="VirtualBox">VirtualBox</a></span></div>
										<div id="mw-content-text" lang="en" dir="ltr" class="mw-content-ltr">
<p>See <a href="../../en/VirtualBox.html" title="VirtualBox">VirtualBox</a> for the main article.
</p>
<div id="toc" class="toc">
<div id="toctitle"><h2>Contents</h2></div>
<ul>
<li class="toclevel-1 tocsection-1">
<a href="#Import.2Fexport_VirtualBox_virtual_machines_from.2Fto_other_hypervisors"><span class="tocnumber">1</span> <span class="toctext">Import/export VirtualBox virtual machines from/to other hypervisors</span></a>
<ul>
<li class="toclevel-2 tocsection-2"><a href="#Remove_additions"><span class="tocnumber">1.1</span> <span class="toctext">Remove additions</span></a></li>
<li class="toclevel-2 tocsection-3">
<a href="#Use_the_right_virtual_disk_format"><span class="tocnumber">1.2</span> <span class="toctext">Use the right virtual disk format</span></a>
<ul>
<li class="toclevel-3 tocsection-4"><a href="#Automatic_tools"><span class="tocnumber">1.2.1</span> <span class="toctext">Automatic tools</span></a></li>
<li class="toclevel-3 tocsection-5"><a href="#Manual_conversion"><span class="tocnumber">1.2.2</span> <span class="toctext">Manual conversion</span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-6"><a href="#Create_the_VM_configuration_for_your_hypervisor"><span class="tocnumber">1.3</span> <span class="toctext">Create the VM configuration for your hypervisor</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-7">
<a href="#Virtual_machine_launch_management"><span class="tocnumber">2</span> <span class="toctext">Virtual machine launch management</span></a>
<ul>
<li class="toclevel-2 tocsection-8"><a href="#Starting_virtual_machines_with_a_service"><span class="tocnumber">2.1</span> <span class="toctext">Starting virtual machines with a service</span></a></li>
<li class="toclevel-2 tocsection-9"><a href="#Starting_virtual_machines_with_a_keyboard_shortcut"><span class="tocnumber">2.2</span> <span class="toctext">Starting virtual machines with a keyboard shortcut</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-10">
<a href="#Use_specific_device_in_the_virtual_machine"><span class="tocnumber">3</span> <span class="toctext">Use specific device in the virtual machine</span></a>
<ul>
<li class="toclevel-2 tocsection-11"><a href="#Using_USB_webcam_.2F_microphone"><span class="tocnumber">3.1</span> <span class="toctext">Using USB webcam / microphone</span></a></li>
<li class="toclevel-2 tocsection-12"><a href="#Detecting_web-cams_and_other_USB_devices"><span class="tocnumber">3.2</span> <span class="toctext">Detecting web-cams and other USB devices</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-13"><a href="#Access_a_guest_server"><span class="tocnumber">4</span> <span class="toctext">Access a guest server</span></a></li>
<li class="toclevel-1 tocsection-14"><a href="#D3D_acceleration_in_Windows_guests"><span class="tocnumber">5</span> <span class="toctext">D3D acceleration in Windows guests</span></a></li>
<li class="toclevel-1 tocsection-15"><a href="#VirtualBox_on_a_USB_key"><span class="tocnumber">6</span> <span class="toctext">VirtualBox on a USB key</span></a></li>
<li class="toclevel-1 tocsection-16">
<a href="#Run_a_native_Arch_Linux_installation_inside_VirtualBox"><span class="tocnumber">7</span> <span class="toctext">Run a native Arch Linux installation inside VirtualBox</span></a>
<ul>
<li class="toclevel-2 tocsection-17"><a href="#Make_sure_you_have_a_persistent_naming_scheme"><span class="tocnumber">7.1</span> <span class="toctext">Make sure you have a persistent naming scheme</span></a></li>
<li class="toclevel-2 tocsection-18"><a href="#Make_sure_your_mkinitcpio_image_is_correct"><span class="tocnumber">7.2</span> <span class="toctext">Make sure your mkinitcpio image is correct</span></a></li>
<li class="toclevel-2 tocsection-19">
<a href="#Create_a_VM_configuration_to_boot_from_the_physical_drive"><span class="tocnumber">7.3</span> <span class="toctext">Create a VM configuration to boot from the physical drive</span></a>
<ul>
<li class="toclevel-3 tocsection-20"><a href="#Create_a_raw_disk_.vmdk_image"><span class="tocnumber">7.3.1</span> <span class="toctext">Create a raw disk .vmdk image</span></a></li>
<li class="toclevel-3 tocsection-21"><a href="#Create_the_VM_configuration_file"><span class="tocnumber">7.3.2</span> <span class="toctext">Create the VM configuration file</span></a></li>
</ul>
</li>
</ul>
</li>
<li class="toclevel-1 tocsection-22"><a href="#Install_a_native_Arch_Linux_system_from_VirtualBox"><span class="tocnumber">8</span> <span class="toctext">Install a native Arch Linux system from VirtualBox</span></a></li>
<li class="toclevel-1 tocsection-23">
<a href="#Move_a_native_Windows_installation_to_a_virtual_machine"><span class="tocnumber">9</span> <span class="toctext">Move a native Windows installation to a virtual machine</span></a>
<ul>
<li class="toclevel-2 tocsection-24"><a href="#Tasks_on_Windows"><span class="tocnumber">9.1</span> <span class="toctext">Tasks on Windows</span></a></li>
<li class="toclevel-2 tocsection-25"><a href="#Using_Disk2vhd_to_clone_Windows_partition"><span class="tocnumber">9.2</span> <span class="toctext">Using Disk2vhd to clone Windows partition</span></a></li>
<li class="toclevel-2 tocsection-26"><a href="#Tasks_on_GNU.2FLinux"><span class="tocnumber">9.3</span> <span class="toctext">Tasks on GNU/Linux</span></a></li>
<li class="toclevel-2 tocsection-27"><a href="#Fix_MBR_and_Microsoft_bootloader"><span class="tocnumber">9.4</span> <span class="toctext">Fix MBR and Microsoft bootloader</span></a></li>
<li class="toclevel-2 tocsection-28"><a href="#Known_limitations"><span class="tocnumber">9.5</span> <span class="toctext">Known limitations</span></a></li>
</ul>
</li>
</ul>
</div>

<h2><span class="mw-headline" id="Import.2Fexport_VirtualBox_virtual_machines_from.2Fto_other_hypervisors">Import/export VirtualBox virtual machines from/to other hypervisors</span></h2>
<p>If you plan to use your virtual machine on another hypervisor or want to import in VirtualBox a virtual machine created with another hypervisor, you might be interested in reading the following steps.
</p>
<h3><span class="mw-headline" id="Remove_additions">Remove additions</span></h3>
<p>Guest additions are available in most hypervisor solutions: VirtualBox comes with the Guest Additions, VMware with the VMware Tools, Parallels with the Parallels Tools, etc. These additional components are designed to be installed inside a virtual machine after the guest operating system has been installed. They consist of device drivers and system applications that optimize the guest operating system for better performance and usability <a rel="nofollow" class="external text" href="https://www.virtualbox.org/manual/ch04.html">by providing these features</a>.
</p>
<p>If you have installed the additions to your virtual machine, please uninstall them first. Your guest, especially if it is using an OS from the Windows family, might behave weirdly, crash or even might not boot at all if you are still using the specific drivers in another hypervisor.
</p>
<h3><span class="mw-headline" id="Use_the_right_virtual_disk_format">Use the right virtual disk format</span></h3>
<p>This step will depend on the ability to convert the virtual disk image directly or not.
</p>
<h4><span class="mw-headline" id="Automatic_tools">Automatic tools</span></h4>
<p>Some companies provide tools which offer the ability to create virtual machines from a Windows or GNU/Linux operating system located either in a virtual machine or even in a native installation. With such a product, you do not need to apply this and the following steps and can stop reading here.
</p>
<ul>
<li> <i><a rel="nofollow" class="external text" href="http://www.parallels.com/products/transporter">Parallels Transporter</a></i> which is non free, is a product from Parallels Inc. This solution basically consists in an piece of software called <i>agent</i> that will be installed in the guest you want to import/convert. Then, Parallels Transporter, <u>which only works on OS X</u>, will create a virtual machine from that <i>agent</i> which is contacted either by USB or Ethernet network.</li>
<li> <i><a rel="nofollow" class="external text" href="https://www.vmware.com/products/converter/">VMware vCenter Converter</a></i> which is free upon registration on the VMware webiste, works nearly the same way as Parallels Transporter, but the piece of software that will gather the data to create the virtual machine only works on a Windows platform.</li>
</ul>
<h4><span class="mw-headline" id="Manual_conversion">Manual conversion</span></h4>
<p>First, familiarize yourself with the <a href="../../en/VirtualBox.html#Formats_supported_by_VirtualBox" title="VirtualBox">formats supported by VirtualBox</a> and <a href="https://en.wikipedia.org/wiki/Comparison_of_platform_virtual_machines#Image_type_compatibility" class="extiw" title="wikipedia:Comparison of platform virtual machines">those supported by third-party hypervisors</a>.
</p>
<ul><li> Importing or exporting a virtual machine from/to a VMware solution is not a problem at all if you use the VMDK or OVF disk format, otherwise converting <a href="../../en/VirtualBox.html#VMDK_to_VDI_and_VDI_to_VMDK" title="VirtualBox">VMDK to VDI and VDI to VMDK</a> is possible and the aforementioned VMware vCenter Converter tool is available.</li></ul>
<ul><li> Importing or exporting from/to QEMU is not a problem neither: some QEMU formats are supported directly by VirtualBox and conversion between <a href="../../en/VirtualBox.html#QCOW2_to_VDI_and_VDI_to_QCOW2" title="VirtualBox">QCOW2 to VDI and VDI to QCOW2</a> is still available if needed.</li></ul>
<ul><li> Importing or exporting from/to Parallels hypervisor is the hardest way: Parallels does only support its own HDD format (even the standard and portable OVF format is not supported!).</li></ul>
<dl><dd><ul>
<li> To export your virtual machine to Parallels, you will need to use the Parallels Transporter tool described above.</li>
<li> To import your virtual machine to VirtualBox, you will need to use the VMware vCenter Converter described above to convert the VM to the VMware format first. Then, apply the solution to migrate from VMware.</li>
</ul></dd></dl>
<h3><span class="mw-headline" id="Create_the_VM_configuration_for_your_hypervisor">Create the VM configuration for your hypervisor</span></h3>
<p>Each hypervisor have their own virtual machine configuration file: <code>.vbox</code> for VirtualBox, <code>.vmx</code> for VMware, a <code>config.pvs</code> file located in the virtual machine bundle (<code>.pvm</code> file), etc. You will have thus to recreate a new virtual machine in your new destination hypervisor and specify its hardware configuration as close as possible as your initial virtual machine.
</p>
<p>Pay a close attention to the firmware interface (BIOS or UEFI) used to install the guest operating system. While an option is available to choose between these 2 interfaces on VirtualBox and on Parallels solutions, on VMware, you will have to add manually the following line to your <i>.vmx</i> file.
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">ArchLinux_vm.vmx</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">firmware = "efi"</pre>
<p>Finally, ask your hypervisor to use the existing virtual disk you have converted and launch the virtual machine.
</p>
<div style="padding: 5px; margin: 0.50em 0; background-color: #DDFFDD; border: thin solid #BBDDBB; overflow: hidden;">
<strong> Tip: </strong>
<ul>
<li> On VirtualBox, if you do not want to browse the whole GUI to find the right location to add your new virtual drive device, you can <a href="#Replace_a_virtual_disk_manually_from_the_.vbox_file">#Replace a virtual disk manually from the .vbox file</a><sup>[<a href="../../en/ArchWiki:Requests.html#Broken_section_links" title="ArchWiki:Requests">broken link</a>: invalid section]</sup>, or use the <code>VBoxManage storageattach</code> described in <a href="#Increase_virtual_disks">#Increase virtual disks</a><sup>[<a href="../../en/ArchWiki:Requests.html#Broken_section_links" title="ArchWiki:Requests">broken link</a>: invalid section]</sup> or in the <a rel="nofollow" class="external text" href="https://www.virtualbox.org/manual/ch08.html#vboxmanage-storageattach">VirtualBox manual page</a>.</li>
<li> Similarly, in VMware products, you can replace the location of the current virtual disk location by adapting the <i>.vmdk</i> file location in your <i>.vmx</i> configuration file.</li>
</ul>
</div>
<h2><span class="mw-headline" id="Virtual_machine_launch_management">Virtual machine launch management</span></h2>
<h3><span class="mw-headline" id="Starting_virtual_machines_with_a_service">Starting virtual machines with a service</span></h3>
<p>Find hereafter the implementation details of a systemd service that will be used to consider a virtual machine as a service.
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/systemd/system/vboxvmservice@.service</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[Unit]
Description=VBox Virtual Machine %i Service
Requires=systemd-modules-load.service
After=systemd-modules-load.service

[Service]
User=<i>username</i>
Group=vboxusers
ExecStart=/usr/bin/VBoxHeadless -s %i
ExecStop=/usr/bin/VBoxManage controlvm %i savestate

[Install]
WantedBy=multi-user.target</pre>
<div style="padding: 5px; margin: 0.50em 0; background-color: #DDDDFF; border: thin solid #BBBBDD; overflow: hidden;">
<strong> Note: </strong>Replace <code><i>username</i></code> with a user that is a member of the <code>vboxusers</code> group. Make sure the user chosen is the same user that will create/import virtual machines, otherwise the user will not see the VM appliances.</div>
<div style="padding: 5px; margin: 0.50em 0; background-color: #DDDDFF; border: thin solid #BBBBDD; overflow: hidden;">
<strong> Note: </strong>If you have multiple virtual machines managed by Systemd and they are not stopping properly, try to add <code>RemainAfterExit=true</code> and <code>KillMode=none</code> at the end of <code>[Service]</code> section.</div>
<p><a href="../../en/Systemd.html#Using_units" title="Enable" class="mw-redirect">Enable</a> the <code>vboxvmservice@<i>your_virtual_machine_name</i></code> systemd unit in order to launch the virtual machine at next boot. To launch it directly, simply <a href="../../en/Systemd.html#Using_units" title="Start" class="mw-redirect">start</a> the systemd unit.
</p>
<p>VirtualBox 4.2 introduces <a rel="nofollow" class="external text" href="http://lifeofageekadmin.com/how-to-set-your-virtualbox-vm-to-automatically-startup/">a new way</a> for UNIX-like systems to have virtual machines started automatically, other than using a systemd service.
</p>
<h3><span class="mw-headline" id="Starting_virtual_machines_with_a_keyboard_shortcut">Starting virtual machines with a keyboard shortcut</span></h3>
<p>It can be useful to start virtual machines directly with a keyboard shortcut instead of using the VirtualBox interface (GUI or CLI). For that, you can simply define key bindings in <code>.xbindkeysrc</code>. Please refer  to <a href="../../en/Xbindkeys.html" title="Xbindkeys">Xbindkeys</a> for more details.
</p>
<p>Example, using the <code>Fn</code> key of a laptop with an unused battery key (<code>F3</code> on the computer used in this example):
</p>
<pre>"VBoxManage startvm 'Windows 7'"
m:0x0 + c:244
XF86Battery
</pre>
<div style="padding: 5px; margin: 0.50em 0; background-color: #DDDDFF; border: thin solid #BBBBDD; overflow: hidden;">
<strong> Note: </strong>If you have a space in the name of your virtual machine, then enclose it with single apostrophes like made in the example just above.</div>
<h2><span class="mw-headline" id="Use_specific_device_in_the_virtual_machine">Use specific device in the virtual machine</span></h2>
<h3><span class="mw-headline" id="Using_USB_webcam_.2F_microphone">Using USB webcam / microphone</span></h3>
<div style="padding: 5px; margin: 0.50em 0; background-color: #DDDDFF; border: thin solid #BBBBDD; overflow: hidden;">
<strong> Note: </strong>You will need to have VirtualBox extension pack installed before following the steps below. See <a href="#Extension_pack">#Extension pack</a><sup>[<a href="../../en/ArchWiki:Requests.html#Broken_section_links" title="ArchWiki:Requests">broken link</a>: invalid section]</sup> for details.</div>
<ol>
<li> Make sure the virtual machine is not running and your webcam / microphone is not being used.</li>
<li> Bring up the main VirtualBox window and go to settings for Arch machine. Go to USB section.</li>
<li> Make sure "Enable USB Controller" is selected. Also make sure that "Enable USB 2.0 (EHCI) Controller" is selected too.</li>
<li> Click the "Add filter from device" button (the cable with the '+' icon).</li>
<li> Select your USB webcam/microphone device from the list.</li>
<li> Now click OK and start your VM.</li>
</ol>
<div style="padding: 5px; margin: 0.50em 0; background-color: #DDDDFF; border: thin solid #BBBBDD; overflow: hidden;">
<strong> Note: </strong>If your Microphone does not show up in the "Add filter from device" menu, try the USB 3.0 and 1.1 options instead (In Step 3).</div>
<h3><span class="mw-headline" id="Detecting_web-cams_and_other_USB_devices">Detecting web-cams and other USB devices</span></h3>
<div style="padding: 5px; margin: 0.50em 0; background-color: #DDDDFF; border: thin solid #BBBBDD; overflow: hidden;">
<strong> Note: </strong>This will not do much if you are running a *NIX OS inside of your VM, as most do not have autodetection features.</div>
<p>If the device that you are looking for does not show up on any of the menus in the section above and you have tried all three USB controller options,
boot up your VM three seperate times.  Once using the USB 1.1 controller, another using the USB 2.0 controller, etc.  Leave the VM running for at least 5 minutes after startup.  Sometimes Windows will autodetect the device for you.  Be sure you filter any devices that are not a keyboard or a mouse so they do not start up at boot.  This ensures that Windows will detect the device at start-up.
</p>
<h2><span class="mw-headline" id="Access_a_guest_server">Access a guest server</span></h2>
<p>To access <a href="https://en.wikipedia.org/wiki/Apache_HTTP_Server" class="extiw" title="wikipedia:Apache HTTP Server">Apache server</a> on a Virtual Machine from the host machine <b>only</b>, simply execute the following lines on the host:
</p>
<pre>$ VBoxManage setextradata GuestName "VBoxInternal/Devices/<i>pcnet</i>/0/LUN#0/Config/Apache/HostPort" <i>8888</i>
$ VBoxManage setextradata GuestName "VBoxInternal/Devices/<i>pcnet</i>/0/LUN#0/Config/Apache/GuestPort" <i>80</i>
$ VBoxManage setextradata GuestName "VBoxInternal/Devices/<i>pcnet</i>/0/LUN#0/Config/Apache/Protocol" TCP
</pre>
<p>Where 8888 is the port the host should listen on and 80 is the port the VM will send Apache's signal on.
</p>
<p>To use a port lower than 1024 on the host machine, changes need to be made to the firewall on that host machine. This can also be set up to work with SSH or any other services by changing "Apache" to the corresponding service and ports.
</p>
<div style="padding: 5px; margin: 0.50em 0; background-color: #DDDDFF; border: thin solid #BBBBDD; overflow: hidden;">
<strong> Note: </strong><code>pcnet</code> refers to the network card of the VM. If you use an Intel card in your VM settings, change <code>pcnet</code> to <code>e1000</code>.</div>
<p>To communicate between the VirtualBox guest and host using ssh, the server port must be forwarded under Settings &gt; Network. When connecting from the client/host, connect to the IP address of the client/host machine, as opposed to the connection of the other machine. This is because the connection will be made over a virtual adapter.
</p>
<h2><span class="mw-headline" id="D3D_acceleration_in_Windows_guests">D3D acceleration in Windows guests</span></h2>
<p>Recent versions of Virtualbox have support for accelerating OpenGL inside guests.  This can be enabled with a simple checkbox in the machine's settings, right below where video ram is set, and installing the Virtualbox guest additions.  However, most Windows games use Direct3D (part of DirectX), not OpenGL, and are thus not helped by this method.  However, it is possible to gain accelerated Direct3D in your Windows guests by borrowing the d3d libraries from Wine, which translate d3d calls into OpenGL, which is then accelerated. These libraries are now part of Virtualbox guest additions software.
</p>
<p>After enabling OpenGL acceleration as described above, reboot the guest into safe mode (press F8 before the Windows screen appears but after the Virtualbox screen disappears), and install Virtualbox guest additions, during install enable checkbox "Direct3D support". Reboot back to normal mode and you should have accelerated Direct3D.
</p>
<div style="padding: 5px; margin: 0.50em 0; background-color: #DDDDFF; border: thin solid #BBBBDD; overflow: hidden;">
<strong> Note: </strong> This hack may or may not work for some games depending on what hardware checks they make and what parts of D3D they use.</div>
<div style="padding: 5px; margin: 0.50em 0; background-color: #DDDDFF; border: thin solid #BBBBDD; overflow: hidden;">
<strong> Note: </strong> This was tested on Windows XP, 7 and 8.1. If method does not work on your Windows version please add data here.</div>
<h2><span class="mw-headline" id="VirtualBox_on_a_USB_key">VirtualBox on a USB key</span></h2>
<p>When using VirtualBox on a USB key, for example to start an installed machine with an ISO image, you will manually have to create VDMKs from the existing drives. However, once the new VMDKs are saved and you move on to another machine, you may experience problems launching an appropriate machine again. To get rid of this issue, you can use the following script to launch VirtualBox. This script will clean up and unregister old VMDK files and it will create new, proper VMDKs for you:
</p>
<pre>
#!/bin/bash

# Erase old VMDK entries
rm ~/.VirtualBox/*.vmdk

# Clean up VBox-Registry
sed -i '/sd/d' ~/.VirtualBox/VirtualBox.xml

# Remove old harddisks from existing machines
find ~/.VirtualBox/Machines -name \*.xml | while read file; do
  line=`grep -e "type\=\"HardDisk\"" -n $file | cut -d ':' -f 1`
  if [ -n "$line" ]; then
    sed -i ${line}d $file
    sed -i ${line}d $file
    sed -i ${line}d $file
  fi
  sed -i "/rg/d" $file
done

# Delete prev-files created by VirtualBox
find  ~/.VirtualBox/Machines -name \*-prev -exec rm '{}' \;

# Recreate VMDKs
ls -l /dev/disk/by-uuid | cut -d ' ' -f 9,11 | while read ln; do
  if [ -n "$ln" ]; then
    uuid=`echo "$ln" | cut -d ' ' -f 1`
    device=`echo "$ln" | cut -d ' ' -f 2 | cut -d '/' -f 3 | cut -b 1-3`

    # determine whether drive is mounted already
    checkstr1=`mount | grep $uuid`
    checkstr2=`mount | grep $device`
    checkstr3=`ls ~/.VirtualBox/*.vmdk | grep $device`
    if [[ -z "$checkstr1" &amp;&amp; -z "$checkstr2" &amp;&amp; -z "$checkstr3" ]]; then
      VBoxManage internalcommands createrawvmdk -filename ~/.VirtualBox/$device.vmdk -rawdisk /dev/$device -register
    fi
  fi
done

# Start VirtualBox
VirtualBox
</pre>
<p>Note that your user has to be added to the "disk" group to create VMDKs out of existing drives.
</p>
<h2><span class="mw-headline" id="Run_a_native_Arch_Linux_installation_inside_VirtualBox">Run a native Arch Linux installation inside VirtualBox</span></h2>
<p>If you have a dual boot system between Arch Linux and another operating system, it can become rapidly tedious to switch back and forth if you need to work in both. Also, by using virtual machines, you just have a tiny fragment of your computer power, which can cause issues when working on projects requiring performance.
</p>
<p>This guide will let you reuse, in a virtual machine, your native Arch Linux installation when you are running your second operating system. This way, you keep the ability to run each operating system natively, but have the option to run your Arch Linux installation inside a virtual machine.
</p>
<h3><span class="mw-headline" id="Make_sure_you_have_a_persistent_naming_scheme">Make sure you have a persistent naming scheme</span></h3>
<p>Depending on your hard drive setup, device files representing your hard drives may appear differently when you will run your Arch Linux installation natively or in virtual machine. This problem occurs when using <a href="../../en/RAID.html#Implementation" title="RAID">FakeRAID</a> for example. The fake RAID device will be mapped in <code>/dev/mapper/</code> when you run your GNU/Linux distribution natively, while the devices are still accessible separately. However, in your virtual machine, it can appear without any mapping in <code>/dev/sdaX</code> for example, because the drivers controlling the fake RAID in your host operating system (e.g. Windows) are abstracting the fake RAID device.
</p>
<p>To circumvent this problem, we will need to use an addressing scheme that is persistent to both systems. This can be achieved using <a href="../../en/Fstab.html#UUIDs" title="Fstab">UUIDs</a>. Make sure your <a href="../../en/Boot_loader.html" title="Boot loader" class="mw-redirect">boot loader</a> and <a href="../../en/Fstab.html" title="Fstab">fstab</a> file is using UUIDs, otherwise fix this issue. Read <a href="../../en/Fstab.html" title="Fstab">fstab</a> and <a href="../../en/Persistent_block_device_naming.html" title="Persistent block device naming">Persistent block device naming</a>.
</p>
<div style="padding: 5px; margin: 0.50em 0; background-color: #FFDDDD; border: thin solid #DDBBBB; overflow: hidden;">
<strong> Warning: </strong>
<ul>
<li> Make sure your host partition is only accessible in read only from your Arch Linux virtual machine, this will avoid risk of corruptions if you were to corrupt that host partition by writing on it due to lack of attention.</li>
<li> You should NEVER allow VirtualBox to boot from the entry of your second operating system, which, as a reminder, is used as the host for this virtual machine! Take thus a special care especially if your default boot loader/boot manager entry is your other operating system. Give a more important timeout or put it below in the order of preferences.</li>
</ul>
</div>
<h3><span class="mw-headline" id="Make_sure_your_mkinitcpio_image_is_correct">Make sure your mkinitcpio image is correct</span></h3>
<p>Make sure your <a href="../../en/Mkinitcpio.html" title="Mkinitcpio">mkinitcpio</a> configuration uses the <a href="../../en/Mkinitcpio.html#HOOKS" title="Mkinitcpio">HOOK</a> <code>block</code>:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/mkinitcpio.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[...]
HOOKS="base udev autodetect modconf <i>block</i> filesystems keyboard fsck"
[...]</pre>
<p>If it is not present, add it and <a href="../../en/Mkinitcpio.html#Image_creation_and_activation" title="Mkinitcpio">regenerate your initramfs</a>:
</p>
<pre># mkinitcpio -p linux
</pre>
<h3><span class="mw-headline" id="Create_a_VM_configuration_to_boot_from_the_physical_drive">Create a VM configuration to boot from the physical drive</span></h3>
<h4><span class="mw-headline" id="Create_a_raw_disk_.vmdk_image">Create a raw disk .vmdk image</span></h4>
<p>Now, we need to create a new virtual machine which will use a <a rel="nofollow" class="external text" href="https://www.virtualbox.org/manual/ch09.html#rawdisk">RAW disk</a> as virtual drive, for that we will use a ~ 1Kio VMDK file which will be mapped to a physical disk. Unfortunately, VirtualBox does not have this option in the GUI, so we will have to use the console and use an internal command of <code>VBoxManage</code>.
</p>
<p>Boot the host which will use the Arch Linux virtual machine. The command will need to be adapted according to the host you have.
</p>
<dl>
<dt> On a GNU/Linux host</dt>
<dd></dd>
</dl>
<p>There is 3 ways to achieve this: login as root, changing the access right of the device with <code>chmod</code>, adding your user to the <code>disk</code> group. The latter way is the more elegant, let us proceed that way:
</p>
<pre># gpasswd -a <i>your_user</i> disk
</pre>
<p>Apply the new group settings with:
</p>
<pre>$ newgrp
</pre>
<p>Now, you can use the command:
</p>
<pre>$ VBoxManage internalcommands createrawvmdk -filename <i>/path/to/file.vmdk</i> -rawdisk <i>/dev/sdb</i> -register
</pre>
<p>Adapt the above command to your need, especially the path and filename of the VMDK location and the raw disk location to map which contain your Arch Linux installation.
</p>
<dl>
<dt> On a Windows host</dt>
<dd></dd>
</dl>
Open a command prompt must be run as administrator. <div style="padding: 5px; margin: 0.50em 0; background-color: #DDFFDD; border: thin solid #BBDDBB; overflow: hidden;">
<strong> Tip: </strong>On Windows, open your start menu/start screen, type <code>cmd</code>, and type <code>Ctrl+Shift+Enter</code>, this is a shortcut to execute the selected program with admin rights.</div>
On Windows, as the disk filename convention is different from UNIX, use this command to determine what drives you have in your Windows system and their location:<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;"># wmic diskdrive get name,size,model</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">
Model                               Name                Size
WDC WD40EZRX-00SPEB0 ATA Device     \\.\PHYSICALDRIVE1  4000783933440
KINGSTON SVP100S296G ATA Device     \\.\PHYSICALDRIVE0  96024821760
Hitachi HDT721010SLA360 ATA Device  \\.\PHYSICALDRIVE2  1000202273280
Innostor Ext. HDD USB Device        \\.\PHYSICALDRIVE3  1000202273280</pre>
<p>In this example, as the Windows convention is <code>\\.\PhysicalDriveX</code> where X is a number from 0, <code>\\.\PHYSICALDRIVE1</code> could be analogous to <code>/dev/sdb</code> from the Linux disk terminology.
</p>
<p>To use the <code>VBoxManage</code> command on Windows, you can either, change the current directory to your VirtualBox installation folder first with <code>cd C:\Program Files\Oracle\VirtualBox\</code>
</p>
<pre># .\VBoxManage.exe internalcommands createrawvmdk -filename C:\file.vmdk -rawdisk \\.\PHYSICALDRIVE1
</pre>
<p>or use the absolute path name:
</p>
<pre># "C:\Program Files\Oracle\VirtualBox\VBoxManage.exe" internalcommands createrawvmdk -filename C:\file.vmdk -rawdisk \\.\PHYSICALDRIVE1
</pre>
<dl>
<dt> On another OS host</dt>
<dd></dd>
</dl>
<p>There are other limitations regarding the aforementioned command when used in other operating systems like OS X, please thus <a rel="nofollow" class="external text" href="https://www.virtualbox.org/manual/ch09.html#rawdisk">read carefully the manual page</a>, if you are concerned.
</p>
<h4><span class="mw-headline" id="Create_the_VM_configuration_file">Create the VM configuration file</span></h4>
<div style="padding: 5px; margin: 0.50em 0; background-color: #DDDDFF; border: thin solid #BBBBDD; overflow: hidden;">
<strong> Note: </strong>
<ul>
<li> To make use of the VBoxManage command on Windows, you need to change the current directory to your VirtualBox installation folder first: cd C:\Program Files\Oracle\VirtualBox\.</li>
<li> Windows makes use of backslashes instead of slashes, please replace all slashes / occurrences by backslashes \ in the commands that follow when you will use them.</li>
</ul>
</div>
<p>After, we need to create a new machine (replace the <i>VM_name</i> to your convenience) and register it with VirtualBox.
</p>
<pre>$ VBoxManage createvm -name <i>VM_name</i> -register
</pre>
<p>Then, the newly raw disk needs to be attached to the machine. This will depend if your computer or actually the root of your native Arch Linux installation is on an IDE or a SATA controller.
</p>
<p>If you need an IDE controller:
</p>
<pre>$ VBoxManage storagectl <i>VM_name</i> --name "IDE Controller" --add ide
$ VBoxManage storageattach <i>VM_name</i> --storagectl "IDE Controller" --port 0 --device 0 --type hdd --medium /path/to/file.vmdk
</pre>
<p>otherwise:
</p>
<pre>$ VBoxManage storagectl <i>VM_name</i> --name "SATA Controller" --add sata
$ VBoxManage storageattach <i>VM_name</i> --storagectl "SATA Controller" --port 0 --device 0 --type hdd --medium /path/to/file.vmdk
</pre>
<p>While you continue using the CLI, it is recommended to use the VirtualBox GUI, to personalise the virtual machine configuration. Indeed, you must specify its hardware configuration as close as possible as your native machine: turning on the 3D acceleration, increasing video memory, setting the network interface, etc.
</p>
<p>Finally, you may want to seamlessly integrate your Arch Linux with your host operating system and allow copy pasting between both OSes. Please refer to <a href="#Install_the_Guest_Additions">#Install the Guest Additions</a><sup>[<a href="../../en/ArchWiki:Requests.html#Broken_section_links" title="ArchWiki:Requests">broken link</a>: invalid section]</sup> for that, since this Arch Linux virtual machine is basically an Arch Linux guest.
</p>
<div style="padding: 5px; margin: 0.50em 0; background-color: #FFDDDD; border: thin solid #DDBBBB; overflow: hidden;">
<strong> Warning: </strong>For <a href="../../en/Xorg.html" title="Xorg">Xorg</a> to work in natively and in the virtual machine, since obviously it will be using different drivers, it is best if there is no <code>/etc/X11/xorg.conf</code>, so Xorg will pick up everything it needs on the fly. However, if you really do need your own Xorg configuration, maybe is it worth to set your default systemd target to <code>multi-user.target</code> with <code>systemctl isolate graphical.target</code> as root (more details at <a href="../../en/Systemd.html#Targets_table" title="Systemd">Systemd#Targets table</a> and <a href="../../en/Systemd.html#Change_current_target" title="Systemd">Systemd#Change current target</a>). In that way, the graphical interface is disabled (i.e. Xorg is not launched) and after you logged in, you can <code>startx</code>} manually with a custom <code>xorg.conf</code>.</div>
<h2><span class="mw-headline" id="Install_a_native_Arch_Linux_system_from_VirtualBox">Install a native Arch Linux system from VirtualBox</span></h2>
<p>In some cases it may be useful to install a native Arch Linux system while running another operating system: one way to accomplish this is to perform the installation through VirtualBox on a <a rel="nofollow" class="external text" href="http://www.virtualbox.org/manual/ch09.html#rawdisk">raw disk</a>. If the existing operating system is Linux based, you may want to consider following <a href="../../en/Install_from_existing_Linux.html" title="Install from existing Linux">Install from existing Linux</a> instead.
</p>
<p>This scenario is very similar to <a href="#Run_a_native_Arch_Linux_installation_inside_VirtualBox">#Run a native Arch Linux installation inside VirtualBox</a>, but will follow those steps in a different order: start by <a href="#Create_a_raw_disk_.vmdk_image">#Create a raw disk .vmdk image</a>, then <a href="#Create_the_VM_configuration_file">#Create the VM configuration file</a>.
</p>
<p>Now, you should have a working VM configuration whose virtual VMDK disk is tied to a real disk. The installation process is exactly the same as the steps described in <a href="#Installation_steps_for_Arch_Linux_guests">#Installation steps for Arch Linux guests</a><sup>[<a href="../../en/ArchWiki:Requests.html#Broken_section_links" title="ArchWiki:Requests">broken link</a>: invalid section]</sup>, but <a href="#Make_sure_you_have_a_persistent_naming_scheme">#Make sure you have a persistent naming scheme</a> and <a href="#Make_sure_your_mkinitcpio_image_is_correct">#Make sure your mkinitcpio image is correct</a>.
</p>
<div style="padding: 5px; margin: 0.50em 0; background-color: #FFDDDD; border: thin solid #DDBBBB; overflow: hidden;">
<strong> Warning: </strong>
<ul>
<li>For BIOS systems and MBR disks, do not install a bootloader inside your virtual machine, this will not work since the MBR is not linked to the MBR of your real machine and your virtual disk is only mapped to a real partition without the MBR.</li>
<li>For UEFI systems without <a href="https://en.wikipedia.org/wiki/Compatibility_Support_Module#CSM" class="extiw" title="wikipedia:Compatibility Support Module">CSM</a> and GPT disks, the installation will not work at all since:</li>
</ul>
<dl><dd><ul>
<li>the <a href="https://en.wikipedia.org/wiki/EFI_System_partition" class="extiw" title="wikipedia:EFI System partition">ESP</a> partition is not mapped to your virtual disk and Arch Linux requires to have the Linux kernel on it to boot as an EFI application (see <a href="../../en/EFISTUB.html" title="EFISTUB">EFISTUB</a> for details);</li>
<li>and the efivars, if you are installing Arch Linux using the EFI mode brought by VirtualBox, are not the one of your real system: the bootmanager entries will hence not be registered.</li>
</ul></dd></dl>
<ul><li>This is why, it is recommended to create your partitions in a native installation first, otherwize the partitions will not be taken into consideration in your MBR/GPT partition table.</li></ul>
</div>
<p>After completing the installation, boot your computer natively with an GNU/Linux installation media (whether it be Arch Linux or not), <a href="../../en/Installation_guide.html#Chroot_and_configure_the_base_system" title="Beginner's Guide" class="mw-redirect">chroot</a><sup>[<a href="../../en/ArchWiki:Requests.html#Broken_section_links" title="ArchWiki:Requests">broken link</a>: invalid section]</sup> into your installed Arch Linux installation and <a href="../../en/Installation_guide.html#Install_and_configure_a_bootloader" title="Beginner's Guide" class="mw-redirect">#Install and configure a bootloader</a><sup>[<a href="../../en/ArchWiki:Requests.html#Broken_section_links" title="ArchWiki:Requests">broken link</a>: invalid section]</sup>.
</p>
<h2><span class="mw-headline" id="Move_a_native_Windows_installation_to_a_virtual_machine">Move a native Windows installation to a virtual machine</span></h2>
<p>If you want to migrate an existing native Windows installation to a virtual machine which will be used with VirtualBox on GNU/Linux, this use case is for you. This section only covers native Windows installation using the MSDOS/Intel partition scheme. Your Windows installation must reside on the first MBR partition for this operation to success. Operation for other partitions are available but have been untested (see <a href="#Known_limitations">#Known limitations</a> for details).
</p>
<div style="padding: 5px; margin: 0.50em 0; background-color: #FFDDDD; border: thin solid #DDBBBB; overflow: hidden;">
<strong> Warning: </strong>If you are using an OEM version of Windows, this process is unauthorized by the end user license license. Indeed, the OEM license typically states the Windows install is tied with the hardware together. Transferring a Windows install to a virtual machine removes this link. Make thus sure you have a full Windows install or a volume license model before continuing. If you have a full Windows license but the latter is not coming in volume, nor as a special license for several PCs, this means you will have to remove the native installation after the transfer operation has been achieved.</div>
<p>A couple of tasks are required to be done inside your native Windows installation first, then on your GNU/Linux host.
</p>
<h3><span class="mw-headline" id="Tasks_on_Windows">Tasks on Windows</span></h3>
<p>The first three following points comes from <a rel="nofollow" class="external text" href="https://www.virtualbox.org/wiki/Migrate_Windows#HAL">this outdated VirtualBox wiki page</a>, but are updated here.
</p>
<ul><li> Remove IDE/ATA controllers checks (Windows XP only): Windows memorize the IDE/ATA drive controllers it has been installed on and will not boot if it detects these have changed. The solution proposed by Microsoft is to reuse the same controller or use one of the same serial, which is impossible to achieve since we are using a Virtual Machine. <a rel="nofollow" class="external text" href="https://www.virtualbox.org/wiki/Migrate_Windows#HardDiskSupport">MergeIDE</a>, a German tool, developped upon another other solution proposed by Microsoft can be used. That solution basically consists in taking all IDE/ATA controller drivers supported by Windows XP from the initial driver archive (the location is hard coded, or specify it as the first argument to the <code>.bat</code> script), installing them and registering them with the regedit database.</li></ul>
<ul><li> Use the right type of Hardware Abstraction Layer (old 32 bits Windows versions): Microsoft ships 3 default versions: <code>Hal.dll</code> (Standard PC), <code>Halacpi.dll</code> (ACPI HAL) and <code>Halaacpi.dll</code> (ACPI HAL with IO APIC). Your Windows install could come installed with the first or the second version. In that way, please <a rel="nofollow" class="external text" href="https://www.virtualbox.org/manual/ch08.html#idp56927888">disable the <i>Enable IO/APIC</i> VirtualBox extended feature</a>.</li></ul>
<ul><li> Disable any AGP device driver (only outdated Windows versions): If you have the files <code>agp440.sys</code> or <code>intelppm.sys</code> inside the <code>C:\Windows\SYSTEM32\drivers\</code> directory, remove it. As VirtualBox uses a PCI virtual graphic card, this can cause problems when this AGP driver is used.</li></ul>
<ul><li> Create a Windows recovery disk: In the following steps, if things turn bad, you will need to repair your Windows installation. Make sure you have an install media at hand, or create one with <i>Create a recovery disk</i> from Vista SP1, <i>Create a system repair disc</i> on Windows 7 or <i>Create a recovery drive</i> on Windows 8.x).</li></ul>
<h3><span class="mw-headline" id="Using_Disk2vhd_to_clone_Windows_partition">Using Disk2vhd to clone Windows partition</span></h3>
<p>Boot into Windows, clean up the installation (with <a rel="nofollow" class="external text" href="http://www.piriform.com/ccleaner">CCleaner</a> for example), use <a rel="nofollow" class="external text" href="https://technet.microsoft.com/en-us/library/ee656415.aspx">disk2vhd</a> tool to create a VHD image. Include a reserved system partition (if present) and the actual Windows partition (usually disk C:). The size of Disk2vhd-created image will be the sum of the actual files on the partition (used space), not the size of a whole partition. If all goes well, the image should just boot in a VM and you won't have to go through the hassle with MBR and Windows bootloader, as in the case of cloning an entire partition.
</p>
<h3><span class="mw-headline" id="Tasks_on_GNU.2FLinux">Tasks on GNU/Linux</span></h3>
<div style="padding: 5px; margin: 0.50em 0; background-color: #DDFFDD; border: thin solid #BBDDBB; overflow: hidden;">
<strong> Tip: </strong>Skip the partition-related parts if you created VHD image with <a href="#Using_Disk2vhd_to_clone_Windows_partition">Disk2vhd</a>.</div>
<ul><li> Reduce the native Windows partition size to the size Windows actually needs with <code>ntfsresize</code> available from <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://www.archlinux.org/packages/?name=ntfs-3g">ntfs-3g</a></span>. The size you will specify will be the same size of the VDI that will be created in the next step. If this size is too low, you may break your Windows install and the latter might not boot at all.</li></ul>
<dl>
<dd>Use the <code>--no-action</code> option first to run a test:</dd>
<dd><pre># ntfsresize --no-action --size <i>52Gi</i> <i>/dev/sda1</i></pre></dd>
</dl>
<dl><dd>If only the previous test succeeded, execute this command again, but this time without the aforementioned test flag.</dd></dl>
<ul><li> Install VirtualBox on your GNU/Linux host (see <a href="#Installation_steps_for_Arch_Linux_hosts">#Installation steps for Arch Linux hosts</a><sup>[<a href="../../en/ArchWiki:Requests.html#Broken_section_links" title="ArchWiki:Requests">broken link</a>: invalid section]</sup> if your host is Arch Linux).</li></ul>
<ul><li> Create the Windows disk image from the beginning of the drive to the end of the first partition where is located your Windows installation. Copying from the beginning of the disk is necessary because the MBR space at the beginning of the drive needs to be on the virtual drive along with the Windows partition. In this example two following partitions <code>sda2</code> and <code>sda3</code>will be later removed from the partition table and the MBR bootloader  will be updated.</li></ul>
<dl>
<dd><pre># sectnum=$(( $(cat /sys/block/''sda/sda1''/start) + $(cat /sys/block/''sda/sda1''/size) ))</pre></dd>
<dd>Using <code>cat /sys/block/<i>sda/sda1</i>/size</code> will output the number of total sectors of the first partition of the disk <code>sda</code>. Adapt where necessary.</dd>
</dl>
<dl>
<dd><pre># dd if=''/dev/sda'' bs=512 count=$sectnum | VBoxManage convertfromraw stdin ''windows.vdi'' $(( $sectnum * 512 ))</pre></dd>
<dd>We need to display the size in byte, <code>$(( $sectnum * 512 ))</code> will convert the sector numbers to bytes.</dd>
</dl>
<ul><li> Since you created your disk image as root, set the right ownership to the virtual disk image: <pre># chown <i>your_user</i>:<i>your_group</i> windows.vdi</pre>
</li></ul>
<ul><li> Create your virtual machine configuration file and use the virtual disk created previously as the main virtual hard disk.</li></ul>
<ul><li> Try to boot your Windows VM, it may just work.  First though remove and repair disks from the boot process as it may interfere (and likely will) booting into safe-mode.</li></ul>
<ul><li> Attempt to boot your Windows virtual machine in safe mode (press the F8 key before the Windows logo shows up)... if running into boot issues, read <a href="#Fix_MBR_and_Microsoft_bootloader">#Fix MBR and Microsoft bootloader</a>.  In safe-mode, drivers will be installed likely by the Windows plug-and-play detection mechanism <a rel="nofollow" class="external text" href="http://i.imgur.com/hh1RrSp.png">view</a>.  Additionally, install the VirtualBox Guest Additions via the menu <i>Devices</i> &gt; <i>Insert Guest Additions CD image...</i>. If a new disk dialog does not appear, navigate to the CD drive and start the installer manually.</li></ul>
<ul><li> You should finally have a working Windows virtual machine. Do not forget to read the <a href="#Known_limitations">#Known limitations</a>.</li></ul>
<ul><li> Performance tip: according to <a rel="nofollow" class="external text" href="http://www.virtualbox.org/manual/ch05.html#harddiskcontrollers">VirtualBox manual</a>, SATA controller has a better performance than IDE. If you can't boot Windows off virtual SATA controller right away, it is probably due to the lack of SATA drivers. Attach virtual disk to IDE controller, create an empty SATA controller and boot the VM - Windows should automatically install SATA drivers for the controller. You can then shutdown VM, detach virtual disk from IDE controller and attach it to SATA controller instead.</li></ul>
<h3><span class="mw-headline" id="Fix_MBR_and_Microsoft_bootloader">Fix MBR and Microsoft bootloader</span></h3>
<p>If your Windows virtual machine refuses to boot, you may need to apply the following modifications to your virtual machine.
</p>
<ul><li>Boot a GNU/Live live distribution inside your virtual machine before Windows starts up.</li></ul>
<ul><li>Remove other partitions entries from the virtual disk MBR. Indeed, since we copied the MBR and only the Windows partition, the entries of the other partitions are still present in the MBR, but the partitions are not available anymore. Use <code>fdisk</code> to achieve this for example.</li></ul>
<dl><dd><pre>fdisk ''/dev/sda''
Command (m for help): a
Partition number (''1-3'', default ''3''): ''1''</pre></dd></dl>
<ul><li>Write the updated partition table to the disk (this will recreate the MBR) using the <code>m</code> command inside <code>fdisk</code>.</li></ul>
<ul><li>Use <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://www.archlinux.org/packages/?name=testdisk">testdisk</a></span> (see <a rel="nofollow" class="external text" href="http://www.cgsecurity.org/index.html?testdisk.html">here</a> for details) to add a generic MBR:</li></ul>
<dl><dd><pre># testdisk &gt; <i>Disk /dev/sda...'</i> &gt; [Proceed] &gt;  [Intel] Intel/PC partition &gt; [MBR Code] Write TestDisk MBR to first sector &gt; Write a new copy of MBR code to first sector? (Y/n) &gt; Y &gt; Write a new copy of MBR code, confirm? (Y/N) &gt; A new copy of MBR code has been written. You have to reboot for the change to take effect. &gt; [OK]</pre></dd></dl>
<ul><li>With the new MBR and updated partition table, your Windows virtual machine should be able to boot. If you are still encountering issues, boot your Windows recovery disk from on of the previous step, and inside your Windows RE environment, execute the commands <a rel="nofollow" class="external text" href="http://support.microsoft.com/kb/927392">described here</a>.</li></ul>
<h3><span class="mw-headline" id="Known_limitations">Known limitations</span></h3>
<ul>
<li>Your virtual machine can sometimes hang and overrun your RAM, this can be caused by conflicting drivers still installed inside your Windows virtual machine. Good luck to find them!</li>
<li>Additional software expecting a given driver beneath may either not be disabled/uninstalled or needs to be uninstalled first as the drivers that are no longer available.</li>
<li>Your Windows installation must reside on the first partition for the above process to work. If this requirement is not met, the process might be achieved too, but this had not been tested. This will require either copying the MBR and editing in hexadecimal see <a rel="nofollow" class="external text" href="http://superuser.com/questions/237782/virtualbox-booting-cloned-disk/253417#253417">VirtualBox: booting cloned disk</a> or will require to fix the partition table <a rel="nofollow" class="external text" href="http://gparted.org/h2-fix-msdos-pt.php">manually</a> or by repairing Windows with the recovery disk you created in a previous step. Let us consider our Windows installation on the second partition; we will copy the MBR, then the second partition where to the disk image. <code>VBoxManage convertfromraw</code> needs the total number of bytes that will be written: calculated thanks to the size of the MBR (the start of the first partition) plus the size of the second (Windows) partition. <code>{ dd if=/dev/sda bs=512 count=$(cat /sys/block/sda/sda1/start) ; dd if=/dev/sda2 bs=512 count=$(cat /sys/block/sda/sda2/size) ; } | VBoxManage convertfromraw stdin windows.vdi $(( ($(cat /sys/block/sda/sda1/start) + $(cat /sys/block/sda/sda2/size)) * 512 ))</code>.</li>
</ul>

</div>
<div id="catlinks" class="catlinks">
<div id="mw-normal-catlinks" class="mw-normal-catlinks">
<a href="../../Special:Categories.html" title="Special:Categories">Categories</a>: <ul>
<li><a href="../../en/Category:Emulators.html" title="Category:Emulators">Emulators</a></li>
<li><a href="../../en/Category:Hypervisors.html" title="Category:Hypervisors">Hypervisors</a></li>
</ul>
</div>
<div id="mw-hidden-catlinks" class="mw-hidden-catlinks mw-hidden-cats-hidden">Hidden category: <ul><li><a href="../../en/Category:Pages_with_broken_section_links.html" title="Category:Pages with broken section links">Pages with broken section links</a></li></ul>
</div>
</div>					<div class="visualClear"></div>
				</div>
			</div>
		</div>
		<div class="visualClear"></div>
					<div id="footer" role="contentinfo">
						<ul id="f-list" style="margin: 0 2em">
									<li>
Retrieved from "<a dir="ltr" href="https://wiki.archlinux.org/index.php?title=VirtualBox/Tips_and_tricks&amp;oldid=446499">https://wiki.archlinux.org/index.php?title=VirtualBox/Tips_and_tricks&amp;oldid=446499</a>"</li>
					<li id="lastmod"> This page was last modified on 13 August 2016, at 07:47.</li>
									<li id="copyright">Content is available under <a class="external" rel="nofollow" href="http://www.gnu.org/copyleft/fdl.html">GNU Free Documentation License 1.3 or later</a> unless otherwise noted.</li>
									<br><li id="privacy"><a href="../../en/ArchWiki:General_disclaimer.html" title="ArchWiki:Privacy policy">Privacy policy</a></li>
									<li id="about"><a href="../../en/ArchWiki:About.html" title="ArchWiki:About">About ArchWiki</a></li>
									<li id="disclaimer"><a href="../../en/ArchWiki:General_disclaimer.html" title="ArchWiki:General disclaimer">Disclaimers</a></li>
							</ul>
		</div>
		</div>
		</body>
</html>
