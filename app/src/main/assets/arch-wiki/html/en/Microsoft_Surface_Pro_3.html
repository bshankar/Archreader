<!DOCTYPE html>
<html lang="en" dir="ltr" class="client-nojs">
<head>
<meta charset="UTF-8">
<title>Microsoft Surface Pro 3 - ArchWiki</title>
<link rel="stylesheet" href="../ArchWikiOffline.css">
<meta name="ResourceLoaderDynamicStyles" content="">
<style></style>
<meta name="generator" content="MediaWiki 1.26.4">
<meta name="robots" content="noindex,follow">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="search" type="application/opensearchdescription+xml" href="/opensearch_desc.php" title="ArchWiki (en)">
<link rel="EditURI" type="application/rsd+xml" href="https://wiki.archlinux.org/api.php?action=rsd">
<link rel="copyright" href="http://www.gnu.org/copyleft/fdl.html">
<link rel="alternate" type="application/atom+xml" title="ArchWiki Atom feed" href="/index.php?title=Special:RecentChanges&amp;feed=atom">
</head>
<body class="mediawiki ltr sitedir-ltr ns-0 ns-subject page-Microsoft_Surface_Pro_3 skin-archlinux action-view">

		<div id="globalWrapper" style="width: 100%">
		<div id="column-content">
			<div id="content" class="mw-body" role="main" style="margin: 0.5em; margin-bottom:0; margin-top:0">
				<a id="top"></a>
				
				<div class="mw-indicators">
</div>
				<h1 id="firstHeading" class="firstHeading" lang="en">Microsoft Surface Pro 3</h1>
				
				<div id="bodyContent" class="mw-body-content">
					<div id="contentSub"></div>
										<div id="mw-content-text" lang="en" dir="ltr" class="mw-content-ltr">
<div class="noprint archwiki-template-message">
<p><a href="../File:Tango-edit-clear.png" class="image"><img alt="Tango-edit-clear.png" src="../File:Tango-edit-clear.png" width="48" height="48"></a><b>This article or section needs language, wiki syntax or style improvements.</b><a href="../File:Tango-edit-clear.png" class="image"><img alt="Tango-edit-clear.png" src="../File:Tango-edit-clear.png" width="48" height="48"></a></p>
<div>
<b>Reason:</b> <a href="../en/Help:Style.html#Language_register" title="Help:Style">Help:Style#Language register</a> (Discuss in <a rel="nofollow" class="external text" href="https://wiki.archlinux.org/index.php/Talk:Microsoft_Surface_Pro_3">Talk:Microsoft Surface Pro 3#</a>)</div>
</div>
<div style="padding: 5px; margin: 0.50em 0; background-color: #FFDDDD; border: thin solid #DDBBBB; overflow: hidden;">
<strong> Warning: </strong>
The warranty of the device is only valid if the OEM image of Windows is still present. A dual boot, however, will not invalidate the warranty as explained <a rel="nofollow" class="external text" href="http://answers.microsoft.com/en-us/surface/forum/surfpro-surfusingpro/would-dual-booting-the-surface-pro-void-its/da549e24-f986-4984-b081-25c029882163">here</a>.</div>
<p>This page aims to document all relevant information on getting Arch Linux working on the Microsoft Surface Pro 3 tablet. 
</p>
<div id="toc" class="toc">
<div id="toctitle"><h2>Contents</h2></div>
<ul>
<li class="toclevel-1 tocsection-1">
<a href="#Booting_into_the_installer"><span class="tocnumber">1</span> <span class="toctext">Booting into the installer</span></a>
<ul>
<li class="toclevel-2 tocsection-2"><a href="#Disable_Secure_Boot"><span class="tocnumber">1.1</span> <span class="toctext">Disable Secure Boot</span></a></li>
<li class="toclevel-2 tocsection-3"><a href="#Boot_with_Secure_Boot"><span class="tocnumber">1.2</span> <span class="toctext">Boot with Secure Boot</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-4"><a href="#Installation"><span class="tocnumber">2</span> <span class="toctext">Installation</span></a></li>
<li class="toclevel-1 tocsection-5">
<a href="#Extra_steps"><span class="tocnumber">3</span> <span class="toctext">Extra steps</span></a>
<ul>
<li class="toclevel-2 tocsection-6">
<a href="#Compile_Kernel_with_Patches"><span class="tocnumber">3.1</span> <span class="toctext">Compile Kernel with Patches</span></a>
<ul>
<li class="toclevel-3 tocsection-7"><a href="#Surface_Pro_3_Linux_Kernel_Hardware_Patches"><span class="tocnumber">3.1.1</span> <span class="toctext">Surface Pro 3 Linux Kernel Hardware Patches</span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-8"><a href="#Enabling_Touchpad"><span class="tocnumber">3.2</span> <span class="toctext">Enabling Touchpad</span></a></li>
<li class="toclevel-2 tocsection-9"><a href="#Tuning_the_Pen"><span class="tocnumber">3.3</span> <span class="toctext">Tuning the Pen</span></a></li>
<li class="toclevel-2 tocsection-10"><a href="#Virtual_Keyboard"><span class="tocnumber">3.4</span> <span class="toctext">Virtual Keyboard</span></a></li>
<li class="toclevel-2 tocsection-11"><a href="#Booting_with_Secure_Boot_Enabled"><span class="tocnumber">3.5</span> <span class="toctext">Booting with Secure Boot Enabled</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-12">
<a href="#Troubleshooting"><span class="tocnumber">4</span> <span class="toctext">Troubleshooting</span></a>
<ul>
<li class="toclevel-2 tocsection-13"><a href="#Invalid_signature_detected_check_secure_boot_policy_in_setup"><span class="tocnumber">4.1</span> <span class="toctext">Invalid signature detected check secure boot policy in setup</span></a></li>
<li class="toclevel-2 tocsection-14"><a href="#Keyboard_Cover_not_working"><span class="tocnumber">4.2</span> <span class="toctext">Keyboard Cover not working</span></a></li>
</ul>
</li>
</ul>
</div>

<h2><span class="mw-headline" id="Booting_into_the_installer">Booting into the installer</span></h2>
<p>To boot from USB, you will need to instruct the tablet to boot from USB or SD Card. Also, you may want to avoid disabling <a href="../en/Unified_Extensible_Firmware_Interface.html#Secure_Boot" title="UEFI" class="mw-redirect">Secure Boot</a><sup>[<a href="../en/ArchWiki:Requests.html#Broken_section_links" title="ArchWiki:Requests">broken link</a>: invalid section]</sup> as this will cause each boot to display an ugly bright red background intentionally clashing with the "Surface" splash logo.
</p>
<p>There are three types of boots in the Surface Pro 3 <a rel="nofollow" class="external text" href="http://www.microsoft.com/surface/en-us/support/storage-files-and-folders/boot-surface-pro-from-usb-recovery-device">explained here</a>:
</p>
<ol>
<li> Normal mode
<ol><li> Just leave the computer go. You can change it from "Alternate Boot order" in the UEFI Setup</li></ol>
</li>
<li> Boot into the UEFI Setup
<ol>
<li> With the device powered off (or rebooting, but better play safe)</li>
<li> Press &amp; hold Volume up</li>
<li> Press power button</li>
<li> Wait until the surface logo appears</li>
<li> Release Volume up</li>
<li> You will be presented with the UEFI Setup Menu</li>
</ol>
</li>
<li> Boot into the USB/SD card
<ol>
<li> Power off the device</li>
<li> Press &amp; hold Volume down</li>
<li> Press power button</li>
<li> Wait until the surface logo appears</li>
<li> Release Volume down</li>
</ol>
</li>
</ol>
<h3><span class="mw-headline" id="Disable_Secure_Boot">Disable Secure Boot</span></h3>
<div style="padding: 5px; margin: 0.50em 0; background-color: #DDDDFF; border: thin solid #BBBBDD; overflow: hidden;">
<strong> Note: </strong>This will cause a red background before the logo when booting.</div>
<p>Boot into the UEFI setup, and select <i>Secure Boot Control &gt; Disable</i>. Now continue with the installation. See the <a rel="nofollow" class="external text" href="http://www.microsoft.com/surface/en-sg/support/warranty-service-and-recovery/how-to-use-the-bios-uefi">Microsoft steps</a> for more information.
</p>
<h3><span class="mw-headline" id="Boot_with_Secure_Boot">Boot with Secure Boot</span></h3>
<p>See <a href="../en/Secure_Boot.html" title="Secure Boot">Secure Boot</a>.
</p>
<h2><span class="mw-headline" id="Installation">Installation</span></h2>
<div class="noprint archwiki-template-message">
<p><a href="../File:Merge-arrows-2.png" class="image"><img alt="Merge-arrows-2.png" src="../File:Merge-arrows-2.png" width="48" height="48"></a><b>This article or section is a candidate for merging with <a href="../en/Unified_Extensible_Firmware_Interface.html#Secure_Boot" title="UEFI" class="mw-redirect">UEFI#Secure Boot</a>.</b><a href="../File:Merge-arrows-2.png" class="image"><img alt="Merge-arrows-2.png" src="../File:Merge-arrows-2.png" width="48" height="48"></a></p>
<div>
<b>Notes:</b> These steps are on how to support Secure Boot for Arch Linux, need to try it in a regular computer. (Discuss in <a rel="nofollow" class="external text" href="https://wiki.archlinux.org/index.php/Talk:Microsoft_Surface_Pro_3">Talk:Microsoft Surface Pro 3#</a>)</div>
</div>
<p>I have done the installation with systemd's bootctl <a href="../en/Systemd-boot.html" title="Systemd-boot">Systemd-boot</a> (old <a href="../en/Systemd-boot.html" title="Gummiboot" class="mw-redirect">Gummiboot</a>). After doing all the steps of <a href="../en/Installation_guide.html" title="Installation" class="mw-redirect">installation</a>, you should do two more things. Booting in Secure Boot won't work for the new installation, as the vmlinuz hasn't been registered within its loader.
</p>
<p>The easiest way is to do all the setup is the following, just before rebooting:
</p>
<ol>
<li> Exit from the chroot but don't umount anything</li>
<li> Move /mnt/boot/EFI/boot/bootx64.efi to /mnt/boot/EFI/boot/loader.efi</li>
<li> Copy /boot/EFI/boot/bootx64.efi and HashTool.efi to /mnt/boot/EFI/boot/</li>
</ol>
<p>(If you are unable to find HashTool in /boot, try in /usr/run)
</p>
<p>Here, we have enabled Preloader to boot our gummiboot loader, and if it detects that something hasn't been signed, it will boot the HashTool.efi to sign the vmlinuz-image binary.
</p>
<p>The idea is, we take the systemd bootloader and make it the one that PreLoader will boot (the one in its same folder, named loader.efi). Then, we copy both the PreLoader (which is the archiso's bootx64.efi) and the HashTool (already with that name).
</p>
<p>This way, with Secure Boot enabled, you will be able to boot your kernel whenever you wish to, signed or not, repeating the hash storing procedure on the next boot.
</p>
<h2><span class="mw-headline" id="Extra_steps">Extra steps</span></h2>
<p>Although in latest kernel you have basic support for the touchpad, the screen, etc. the cameras are not yet supported by the kernel. A github repo to track the support of the Surface Pro 3 in Archlinux was created: <a rel="nofollow" class="external autonumber" href="https://github.com/nuclearsandwich/surface3-archlinux">[1]</a>, where you can check for the status.
</p>
<p>The easiest way for Arch Linux users is to use a Surface Pro 3 specific package available in the AUR <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/linux-surfacepro3/">linux-surfacepro3</a></span><sup><small>AUR</small></sup>. You can check there the support for the different modules available, or take the patch from upstream<a rel="nofollow" class="external text" href="https://github.com/matthewwardrop/linux-surfacepro3">GitHub</a>.
</p>
<h3><span class="mw-headline" id="Compile_Kernel_with_Patches">Compile Kernel with Patches</span></h3>
<p>Ref: <a href="../en/Kernels/Traditional_compilation.html#Configuration" title="Kernels/Traditional compilation">Kernels/Traditional compilation#Configuration</a>
</p>
<div style="padding: 5px; margin: 0.50em 0; background-color: #DDDDFF; border: thin solid #BBBBDD; overflow: hidden;">
<strong> Note: </strong>The most up-to-date source at the time of writing for the kernel patches is <a rel="nofollow" class="external text" href="https://github.com/shvr/fedora-surface-pro-3-kernel/">shvr's github repository</a>.
<ul>
<li>Latest stable kernel release: <a rel="nofollow" class="external text" href="https://github.com/shvr/fedora-surface-pro-3-kernel/commits/f23">f23 branch</a>
</li>
<li>Latest RC: <a rel="nofollow" class="external text" href="https://github.com/shvr/fedora-surface-pro-3-kernel/commits/master">master branch</a>
</li>
</ul>
</div>
<h4><span class="mw-headline" id="Surface_Pro_3_Linux_Kernel_Hardware_Patches">Surface Pro 3 Linux Kernel Hardware Patches</span></h4>
<p>Since kernel 4.3, only the multitouch and camera patches are required.
</p>
<ul>
<li><a rel="nofollow" class="external text" href="https://github.com/shvr/fedora-surface-pro-3-kernel/blob/f23/surface-pro-3-Add-support-driver-for-Surface-Pro-3-b.patch">Camera patch</a></li>
<li><a rel="nofollow" class="external text" href="https://github.com/shvr/fedora-surface-pro-3-kernel/blob/f23/Add-Microsoft-Surface-Pro-3-camera-support.patch">Hardware Buttons patch</a></li>
<li><a rel="nofollow" class="external text" href="https://github.com/shvr/fedora-surface-pro-3-kernel/blob/f23/Add-multitouch-support-for-Microsoft-Type-Cover-3.patch">Type Cover patch</a></li>
</ul>
<div style="padding: 5px; margin: 0.50em 0; background-color: #DDDDFF; border: thin solid #BBBBDD; overflow: hidden;">
<strong> Note: </strong>These patches can be automatically applied using <code>git-apply</code> from the <a href="../en/Git.html" title="Git">Git</a> package.</div>
<h3><span class="mw-headline" id="Enabling_Touchpad">Enabling Touchpad</span></h3>
<p>Ref: <a rel="nofollow" class="external text" href="https://github.com/matthewwardrop/linux-surfacepro3/issues/1">GitHub</a>
In order to enable full functionality of the touchpad (e.g. two-finger scrolling, right click), you need to 
<a href="../en/Help:Reading.html#Installation_of_packages" title="Install" class="mw-redirect">Install</a> the <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://www.archlinux.org/packages/?name=xf86-input-synaptics">xf86-input-synaptics</a></span> package, have the kernel patch applied as well as add the following to <code>/etc/X11/xorg.conf.d/10-multitouch.conf</code>:
</p>
<pre>Section "InputClass"
  Identifier "Default clickpad buttons"
  MatchDriver "synaptics"
  Option "ClickPad" "true"
  Option "SoftButtonAreas" "50% 0 82% 0 0 0 0 0"
  Option "SecondarySoftButtonAreas" "58% 0 0 15% 42% 58% 0 15%"
EndSection
</pre>
<h3><span class="mw-headline" id="Tuning_the_Pen">Tuning the Pen</span></h3>
<p>The pen buttons might not work out of the box. <a href="../en/Help:Reading.html#Installation_of_packages" title="Install" class="mw-redirect">Install</a> the <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://www.archlinux.org/packages/?name=xf86-input-wacom">xf86-input-wacom</a></span> package and comment the <code>MatchIsTablet</code> section in <code>/usr/share/X11/xorg.conf.d/10-evdev.conf</code>. Furthermore add <code>1B96:1B05 Pen</code> in the <code>MatchProduct</code> line of N-Trig in <code>/usr/share/X11/xorg.conf.d/50-wacom.conf</code>. Note that the purple bluetooth button is recognized but able to be bound to an action.
Ref:<a rel="nofollow" class="external text" href="https://www.reddit.com/r/SurfaceLinux/comments/3mu28a/sp3_pen_tip_button_working/">Reddit</a>
</p>
<h3><span class="mw-headline" id="Virtual_Keyboard">Virtual Keyboard</span></h3>
<p>Depending on the desktop environment you are using, you might want to use different virtual keyboard. <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://www.archlinux.org/packages/?name=onboard">onboard</a></span> provides a reliable and comfortable experience. 
A guide for optical tweaking is provided <a rel="nofollow" class="external text" href="https://github.com/Vistaus/surface3-arch-antergoslinux/issues/5">here</a>. If you are using <a href="../en/GNOME.html" title="GNOME">GNOME</a>, these two extension (<a rel="nofollow" class="external text" href="https://extensions.gnome.org/extension/992/onboard-integration/">1</a>, <a rel="nofollow" class="external text" href="https://extensions.gnome.org/extension/993/slide-for-keyboard/">2</a>) provide a better integration.
</p>
<h3><span class="mw-headline" id="Booting_with_Secure_Boot_Enabled">Booting with Secure Boot Enabled</span></h3>
<div class="noprint archwiki-template-message">
<p><a href="../File:Merge-arrows-2.png" class="image"><img alt="Merge-arrows-2.png" src="../File:Merge-arrows-2.png" width="48" height="48"></a><b>This article or section is a candidate for merging with <a href="../en/Unified_Extensible_Firmware_Interface.html#Secure_boot" title="UEFI" class="mw-redirect">UEFI#Secure boot</a>.</b><a href="../File:Merge-arrows-2.png" class="image"><img alt="Merge-arrows-2.png" src="../File:Merge-arrows-2.png" width="48" height="48"></a></p>
<div>
<b>Notes:</b> Generic instructions (Discuss in <a rel="nofollow" class="external text" href="https://wiki.archlinux.org/index.php/Talk:Microsoft_Surface_Pro_3">Talk:Microsoft Surface Pro 3#</a>)</div>
</div>
<p>The recommended bootloader for UEFI with Secure Boot enabled is <a href="../en/Systemd-boot.html" title="Systemd-boot">systemd-boot</a>
</p>
<p>To boot with Secure Boot, you will need the following packages: <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://www.archlinux.org/packages/?name=efibootmgr">efibootmgr</a></span> <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://www.archlinux.org/packages/?name=prebootloader">prebootloader</a></span><sup>[<a href="../en/ArchWiki:Requests.html#Broken_package_links" title="ArchWiki:Requests">broken link</a>: replaced by <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://www.archlinux.org/packages/?name=efitools">efitools</a></span>]</sup>
</p>
<p>Ref: <a rel="nofollow" class="external text" href="https://bbs.archlinux.org/viewtopic.php?pid=1570523#p1570523">Surface Pro 3 and Secure Boot post-install</a>
</p>
<p>Copy <code>/boot/EFI/systemd/systemd-bootx64.efi</code> to <code>/boot/EFI/systemd/loader.EFI</code>.
Copy <code>/usr/lib/prebootloader/HashTool.efi</code> and <code>/usr/lib/prebootloader/PreLoader.efi</code> to <code>/boot/EFI/systemd/</code>.
Create an NVRAM entry for PreLoader.efi:
</p>
<pre> efibootmgr -d /dev/sd<b>X</b> -p <b>Y</b> -c -L Preloader -l /EFI/systemd/PreLoader.efi
</pre>
<div style="padding: 5px; margin: 0.50em 0; background-color: #DDDDFF; border: thin solid #BBBBDD; overflow: hidden;">
<strong> Note: </strong><b>Y</b> is the partition number of the /boot partition.</div>
<p>Verify the entry was made and that it is first in the boot order:
</p>
<pre>efibootmgr
</pre>
<p>Enrolling your kernel in the bootloader: <a href="../en/Unified_Extensible_Firmware_Interface.html#Secure_Boot" title="Unified Extensible Firmware Interface">Unified Extensible Firmware Interface#Secure Boot</a><sup>[<a href="../en/ArchWiki:Requests.html#Broken_section_links" title="ArchWiki:Requests">broken link</a>: invalid section]</sup>
Enroll HashTool.efi and vmlinuz-linux, and then reboot to system.
You should now be able to boot with Secure Boot enabled.
</p>
<div style="padding: 5px; margin: 0.50em 0; background-color: #DDDDFF; border: thin solid #BBBBDD; overflow: hidden;">
<strong> Note: </strong>Since PreLoader.efi is the default boot option per <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://www.archlinux.org/packages/?name=efibootmgr">efibootmgr</a></span>, if you change the kernel you will be presented with PreLoader to enroll the new kernel with HashTool again</div>
<div style="padding: 5px; margin: 0.50em 0; background-color: #DDDDFF; border: thin solid #BBBBDD; overflow: hidden;">
<strong> Note: </strong>Ensure that you add the entry in <code>/boot/loader/entries/</code> so that you are presented the option to boot with the new kernel</div>
<h2><span class="mw-headline" id="Troubleshooting">Troubleshooting</span></h2>
<h3><span class="mw-headline" id="Invalid_signature_detected_check_secure_boot_policy_in_setup">Invalid signature detected check secure boot policy in setup</span></h3>
<p>This happened to me after deleting the Secure Boot database and initializing it with Microsoft &amp; CAs. I also had to do the recovery of the bitlocker partition, but I would follow these steps:
</p>
<ol>
<li> After the reset, switch off and try to boot from the sd/usb. If you don't succeed and get the message many times:
<ol>
<li> Leaving all TPM &amp; SecureBoot enabled and SSD Only alternate system order</li>
<li> Do another database reset</li>
<li> Enroll the Microsoft and CAs again</li>
<li> reboot into sd/usb with volume down</li>
<li> It should work now</li>
</ol>
</li>
<li> Follow steps in the Secure Boot installation</li>
<li> After the full installation of archlinux, when you have it working, do the BitLocker recovery</li>
</ol>
<p>If after doing these steps doesn't still work. Flash the archiso image once more and try again,
</p>
<h3><span class="mw-headline" id="Keyboard_Cover_not_working">Keyboard Cover not working</span></h3>
<p>This can happen sometimes when you restart. The solution was to shutdown and reboot. (not restart)
</p>
</div>
<div id="catlinks" class="catlinks">
<div id="mw-normal-catlinks" class="mw-normal-catlinks">
<a href="../Special:Categories.html" title="Special:Categories">Category</a>: <ul><li><a href="../en/Category:Laptops.html" title="Category:Laptops">Laptops</a></li></ul>
</div>
<div id="mw-hidden-catlinks" class="mw-hidden-catlinks mw-hidden-cats-hidden">Hidden categories: <ul>
<li><a href="../en/Category:Pages_or_sections_flagged_with_Template:Style.html" title="Category:Pages or sections flagged with Template:Style">Pages or sections flagged with Template:Style</a></li>
<li><a href="../en/Category:Pages_with_broken_section_links.html" title="Category:Pages with broken section links">Pages with broken section links</a></li>
<li><a href="../en/Category:Pages_or_sections_flagged_with_Template:Merge.html" title="Category:Pages or sections flagged with Template:Merge">Pages or sections flagged with Template:Merge</a></li>
<li><a href="../en/Category:Pages_with_broken_package_links.html" title="Category:Pages with broken package links">Pages with broken package links</a></li>
</ul>
</div>
</div>					<div class="visualClear"></div>
				</div>
			</div>
		</div>
		<div class="visualClear"></div>
					<div id="footer" role="contentinfo">
Extracted from <a href="https://wiki.archlinux.org"> ArchWiki </a> and licensed under <a href="http://www.gnu.org/copyleft/fdl.html"> GDL >= 1.3</a>
		</div>
		</div>
		</body>
</html>
