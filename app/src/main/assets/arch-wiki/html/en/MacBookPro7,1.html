<!DOCTYPE html>
<html lang="en" dir="ltr" class="client-nojs">
<head>
<meta charset="UTF-8">
<title>MacBookPro7,1 - ArchWiki</title>
<link rel="stylesheet" href="../ArchWikiOffline.css">
<meta name="ResourceLoaderDynamicStyles" content="">
<style></style>
<meta name="generator" content="MediaWiki 1.26.4">
<meta name="robots" content="noindex,follow">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="search" type="application/opensearchdescription+xml" href="/opensearch_desc.php" title="ArchWiki (en)">
<link rel="EditURI" type="application/rsd+xml" href="https://wiki.archlinux.org/api.php?action=rsd">
<link rel="copyright" href="http://www.gnu.org/copyleft/fdl.html">
<link rel="alternate" type="application/atom+xml" title="ArchWiki Atom feed" href="/index.php?title=Special:RecentChanges&amp;feed=atom">
</head>
<body class="mediawiki ltr sitedir-ltr ns-0 ns-subject page-MacBookPro7_1 skin-archlinux action-view">

		<div id="globalWrapper" style="width: 100%">
		<div id="column-content">
			<div id="content" class="mw-body" role="main" style="margin: 0.5em; margin-bottom:0; margin-top:0">
				<a id="top"></a>
				
				<div class="mw-indicators">
</div>
				<h1 id="firstHeading" class="firstHeading" lang="en">MacBookPro7,1</h1>
				
				<div id="bodyContent" class="mw-body-content">
					<div id="contentSub"></div>
										<div id="mw-content-text" lang="en" dir="ltr" class="mw-content-ltr">
<div style="width:45%; margin: 0 0 0.5em 0.5em;">
<p style="background:#333; color:white; padding:0.2em; border-bottom:5px #08c solid; margin:0; text-align:center; font-weight:bold;">Related articles</p>
<ul style="list-style-type:none; margin:0; padding:0.3em;">
<li style="padding:0.4em 0; line-height:1;"><a href="../en/MacBook.html" title="MacBook">MacBook</a></li>
<li style="padding:0.4em 0; line-height:1;"><strong class="selflink">MacBookPro7,1</strong></li>
<li style="padding:0.4em 0; line-height:1;"><a href="../en/MacBookPro8,1/8,2/8,3_(2011).html" title="MacBookPro8,1/8,2/8,3 (2011)">MacBookPro8,1/8,2/8,3 (2011)</a></li>
<li style="padding:0.4em 0; line-height:1;"><a href="../en/MacBookPro9,2_(Mid-2012).html" title="MacBookPro9,2 (Mid-2012)">MacBookPro9,2 (Mid-2012)</a></li>
</ul>
</div>
<div class="noprint archwiki-template-message">
<p><a href="../File:Tango-edit-clear.png" class="image"><img alt="Tango-edit-clear.png" src="../File:Tango-edit-clear.png" width="48" height="48"></a><b>This article or section needs language, wiki syntax or style improvements.</b><a href="../File:Tango-edit-clear.png" class="image"><img alt="Tango-edit-clear.png" src="../File:Tango-edit-clear.png" width="48" height="48"></a></p>
<div>
<b>Reason:</b> <span style="color:red;">please use the first argument of the template to provide a brief explanation.</span> (Discuss in <a rel="nofollow" class="external text" href="https://wiki.archlinux.org/index.php/Talk:MacBookPro7,1">Talk:MacBookPro7,1#</a>)</div>
</div>
<p>This page contains tips on installing Arch Linux on a Mid 2010 13" MacBook Pro.
</p>
<div id="toc" class="toc">
<div id="toctitle"><h2>Contents</h2></div>
<ul>
<li class="toclevel-1 tocsection-1">
<a href="#Installation"><span class="tocnumber">1</span> <span class="toctext">Installation</span></a>
<ul>
<li class="toclevel-2 tocsection-2">
<a href="#Dual_Boot"><span class="tocnumber">1.1</span> <span class="toctext">Dual Boot</span></a>
<ul>
<li class="toclevel-3 tocsection-3"><a href="#EFI-Mode"><span class="tocnumber">1.1.1</span> <span class="toctext">EFI-Mode</span></a></li>
<li class="toclevel-3 tocsection-4"><a href="#CSM-Mode"><span class="tocnumber">1.1.2</span> <span class="toctext">CSM-Mode</span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-5">
<a href="#Bootloader"><span class="tocnumber">1.2</span> <span class="toctext">Bootloader</span></a>
<ul>
<li class="toclevel-3 tocsection-6"><a href="#EFI-Mode_2"><span class="tocnumber">1.2.1</span> <span class="toctext">EFI-Mode</span></a></li>
<li class="toclevel-3 tocsection-7">
<a href="#CSM-Mode_or_BIOS-compatibility"><span class="tocnumber">1.2.2</span> <span class="toctext">CSM-Mode or BIOS-compatibility</span></a>
<ul>
<li class="toclevel-4 tocsection-8"><a href="#Can.27t_find_root_device"><span class="tocnumber">1.2.2.1</span> <span class="toctext">Can't find root device</span></a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toclevel-1 tocsection-9"><a href="#Network"><span class="tocnumber">2</span> <span class="toctext">Network</span></a></li>
<li class="toclevel-1 tocsection-10">
<a href="#Video"><span class="tocnumber">3</span> <span class="toctext">Video</span></a>
<ul>
<li class="toclevel-2 tocsection-11"><a href="#Nouveau"><span class="tocnumber">3.1</span> <span class="toctext">Nouveau</span></a></li>
<li class="toclevel-2 tocsection-12"><a href="#Nvidia"><span class="tocnumber">3.2</span> <span class="toctext">Nvidia</span></a></li>
</ul>
</li>
</ul>
</div>

<h2><span class="mw-headline" id="Installation">Installation</span></h2>
<p>To install an x86_64 system, follow the <a href="../en/MacBook.html" title="MacBook">MacBook</a> EFI installation instructions.
It is recommended to read the <a href="../en/Unified_Extensible_Firmware_Interface.html" title="UEFI" class="mw-redirect">UEFI</a>, <a href="../en/Partitioning.html#GUID_Partition_Table" title="GPT" class="mw-redirect">GPT</a> and <a href="../en/UEFI_Bootloaders.html" title="UEFI Bootloaders" class="mw-redirect">UEFI Bootloaders</a> pages before trying any of this on your machine.
Also of note, <a rel="nofollow" class="external text" href="https://gist.github.com/Apsu/4108795">GIST</a>.
</p>
<p>See notes on <b>video support</b> before attempting installation!
</p>
<p><i>The following assumes that you have somehow managed to install archlinux to a single partition on your drive, and that you still have your osx installation on a different partition.</i>
</p>
<h3><span class="mw-headline" id="Dual_Boot">Dual Boot</span></h3>
<p>If you want to dualboot osx and linux, the easiest way to do so is to use <a href="../en/REFInd.html" title="REFInd">rEFInd</a>.
rEFInd is a updated and maintained fork of <a rel="nofollow" class="external text" href="http://refit.sourceforge.net/">rEFIt</a> and should be used in its place.
</p>
<p>I've found it easiest to install rEFInd from osx. Depending on your setup, you'll either install it to your osx partition, or to the ESP partition (install.sh --esp). See <a rel="nofollow" class="external text" href="http://www.rodsbooks.com/refind/installing.html#installsh">here</a> for instructions.
Installing to the ESP partition can cause some <b>startup delay</b>, which can be overcome by simply renaming rEFInd's installation folder to "BOOT" and the executable to "bootx64.efi"<a rel="nofollow" class="external autonumber" href="http://www.rodsbooks.com/refind/installing.html#sluggish">[1]</a>
</p>
<p>Assuming that rEFInd was installed to the ESP, I've found it convenient to later mount the ESP as my "/boot" directory.
That way, by setting
</p>
<pre>scan_all_linux_kernels
</pre>
<p>in your refind.conf, rEFInd will automatically pickup the kernel. All you need to add is a "refind_linux.conf" file to the root of the ESP, containing your boot args. I use:
</p>
<pre>"Boot with defaults"    "root=/dev/sda3 rootfstype=xfs ro add_efi_memmap"
</pre>
<p>Note that my root partion is sda3 and that I use the xfs filesystem on it, yours may differ!
So my ESP partition looks like this when mounted under "/boot":
</p>
<pre>EFI/
 APPLE/
 BOOT/
  bootx64.efi
  drivers/
  icons/
  keys/
  refind.conf
initramfs-linux-fallback.img
initramfs-linux.img
refind_linux.conf
syslinux/ *** My bootloader of choice, see below ***
vmlinuz-linux
</pre>
<p>Note that the EFI/BOOT directory is normally named EFI/REFIND and that the bootx64.efi is normally named refind_x64.efi.
</p>
<h4><span class="mw-headline" id="EFI-Mode">EFI-Mode</span></h4>
<p>You should now be able to boot your mac in efi-mode via the kernel's efistub feature. rEFInd should present you with an option to do so.
See <a rel="nofollow" class="external text" href="http://www.rodsbooks.com/refind/linux.html">here</a> for more general information on the topic.
This however has some drawbacks, as mentioned in the <b>Video</b> section below. 
</p>
<h4><span class="mw-headline" id="CSM-Mode">CSM-Mode</span></h4>
<p>Booting your mac in csm- or legacy-mode provides a solution. To do so, we need a <b>hybrid mbr</b>, with at least one 'active/bootable' partition. See <a rel="nofollow" class="external text" href="http://www.rodsbooks.com/gdisk/hybrid.html">here</a> for more general information on how to setup a hybrid mbr.
Simply boot in <b>efi-mode</b>, then assuming you have three partitions, the ESP partition, an osx and a linux partition you'll need to use gdisk to set things up.
</p>
<pre>gdisk /dev/sda
</pre>
<p>Press 'p' to print your partition table, which should look somewhat like mine:
</p>
<pre>Number  Start (sector)    End (sector)  Size       Code  Name
  1              40          409639   200.0 MiB   0700  EFI System Partition
  2          409640       393186215   187.3 GiB   AF00  OSX
  3       393186216       625142414   110.6 GiB   8300  Linux filesystem
</pre>
<p>Press 'r' to enter recovery and transformation mode.
</p>
<p>Now press 'o' to print your mbr. It should only list a single partition covering the entire disk. Or depending on with which tools you used to partition your disk maybe some other entries.
</p>
<p>Press 'h' to create a new hybrid mbr. You'll be prompted for some input:
</p>
<pre>Type from one to three GPT partition numbers, separated by spaces, to be
added to the hybrid MBR, in sequence:
</pre>
<p>I chose to mirror my gpt, so I entered '1 2 3', but it should be enough to just use one partition here. In my example, this would need to be the ESP partition, so '1', but in case you don't want to use the ESP to store your kernels, this could also be the linux partition, so '3'. You decide :) 
</p>
<p>Another and maybe more secure way to mirror the gpt is only to enter '1' for the first and only partition, the EFI or boot partition. This prevents the strange behaviour of MacOS. It can happen that MacOS or its bootsystem can't find his partition and will end up in a rather long loop. Then proceed as written below.
</p>
<p>Make sure to say 'Yes' to the next promt:
</p>
<pre>Place EFI GPT (0xEE) partition first in MBR (good for GRUB)? (Y/N): y
</pre>
<p>Then set at least one partition as active/bootable:
</p>
<pre>Creating entry for GPT partition #1 (MBR partition #2)
Enter an MBR hex code (default 07): 
Set the bootable flag? (Y/N): y
</pre>
<p>Note the MBR hex code depends on the partition type, press 'l' in gdisk's main menu to list them.
</p>
<p>Press 'o' (<b>make sure you're still in the recovery menu!!!</b>) again to see your new hybrid mbr, in my case:
</p>
<pre>Number  Boot  Start Sector   End Sector   Status      Code
  1                     1           39   primary     0xEE
  2      *             40       409639   primary     0x07
  3                409640    393186215   primary     0xAF
  4             393186216    625142414   primary     0x83
</pre>
<p>Or if you choose to only mirror the first one, it can also look like this:
</p>
<pre>Number  Boot  Start Sector   End Sector   Status      Code
  1                     1           39   primary     0xEE
  2      *             40       409639   primary     0xEF
</pre>
<p>Even if the mbr table looks like this (<i>note that in the second table only the last two lines are missing</i>), the bootloader will know what to boot.
You can compare start and end sectors between the two tables if you wish.
</p>
<p>Press 'w' to write the table to disk and reboot.
</p>
<h3><span class="mw-headline" id="Bootloader">Bootloader</span></h3>
<p>The next important thing is the bootloader, which acts as the bridge from refind to your kernel.
Based on the Mode you use to install arch, either <b>EFI</b> or <b>CSM</b>, you can choose a bootloader of your choice.
But for now, We provide you with information about <b>Syslinux</b> and <b>Gummiboot</b>, because these are the two we tested successfully for now.
</p>
<p>In both cases I assume that you managed to mount the EFI partition mentioned above to <i>/boot/</i> already.
</p>
<p>Grub is the one bootloader, which can handle both the EFI and the CSM mode. But because it's mighty, it also can be complex and the configuration are far-reaching. I recommending you, unless you want to configure the smallest detail in the bootloader for an <b>un</b>forgetting adventure during a booting, to use gummiboot (EFI-only) or syslinux (CSM-only), because both are really easy to setup.
</p>
<h4><span class="mw-headline" id="EFI-Mode_2">EFI-Mode</span></h4>
<p>If you do not need the power and its powersaving feature of the nvidia driver, then you should install <a href="../en/Systemd-boot.html" title="Gummiboot" class="mw-redirect">gummiboot</a> or <a href="../en/GRUB.html" title="GRUB">GRUB</a>, because these bootloaders are the one which actually works fine with EFI.
</p>
<p>Here, let's do it with gummiboot:
</p>
<pre># pacman -S gummiboot
</pre>
<p>After installing the package, it needs to be configured, so run the installer of gummiboot:
</p>
<pre># gummiboot install
</pre>
<p>Then you need to create a config file for gummiboot and add an entry for the arch booting. The <b>sdaX</b> means that you have to replace it with your root partition, in this case it may be <b>/dev/sda3</b>.
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;"># nano /boot/loader/entries/arch.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">title          Arch Linux
linux          /vmlinuz-linux
initrd         /initramfs-linux.img
options        root=<b>/dev/sdaX</b> rw</pre>
<p>As usual, for more information on configuring and using gummiboot, see <a href="../en/Systemd-boot.html" title="Gummiboot" class="mw-redirect">gummiboot</a>.
</p>
<h4><span class="mw-headline" id="CSM-Mode_or_BIOS-compatibility">CSM-Mode or BIOS-compatibility</span></h4>
<p>Otherwise, if you don't want to miss out the advantages of the nvidia driver, I suggest you to install <a href="../en/Syslinux.html" title="Syslinux">syslinux</a> or also <a href="../en/GRUB.html" title="GRUB">GRUB</a> for the CSM-Mode.
We'll use syslinux because it's the simplest to setup, but others should also work. Install it via pacman, and then just execute
</p>
<pre>syslinux-install_update -i -a -m
</pre>
<p>It should detect your hybrid mbr and install itself automatically. Refer to <a href="../en/Syslinux.html" title="Syslinux">Syslinux</a> for more details.
</p>
<p>Make sure to configure the bootloader's menu entries correctly: (syslinux)
</p>
<pre>LABEL arch
MENU LABEL Arch Linux
LINUX ../vmlinuz-linux
APPEND root=/dev/sda3 ro vga=865
INITRD ../initramfs-linux.img
</pre>
<p>Note that 'sda3' refers to the <b>gpt mapping</b>, 'vga=865' means 1280x800 framebuffer resolution, nicer when using the nvidia driver.
</p>
<h5><span class="mw-headline" id="Can.27t_find_root_device">Can't find root device</span></h5>
<p>If booting fails, first try to use the initramfs-linux-fallback.img, as it includes more modules than your 'auto-detected' initramfs, and should allow the kernel to actually find your root partition.
You'll then need to rebuild your regular initramfs. Rebuild it with
</p>
<pre>mkinitcpio -p linux
</pre>
<p>If you're lucky, the whole booting process with the regular initramfs-linux will end up successfully, if not, then try to add the following configuration and rebuild the initramfs again.
I needed to include modules in the initramfs file. In /etc/mkinitcpio.conf:
</p>
<pre>MODULES="ata_generic libata xfs"
</pre>
<p>Note, that you'll only need xfs if your root partition is actually formatted with it, exchange it with the appropriate module for the file-system you use.
</p>
<p><br>
Once you reboot, rEFInd should now present you with three options, two linux entries and one for osx. One linux entry will boot the kernel via efistub in <b>efi-mode</b>, the other will call syslinux(or your chosen bootloader) which then should boot the system in <b>csm-mode</b>. Do the latter from now on!
</p>
<p>The easiest way to see if you were successful, is to install the <a href="../en/NVIDIA.html" title="NVIDIA">NVIDIA</a> driver and start X.
</p>
<h2><span class="mw-headline" id="Network">Network</span></h2>
<p><a href="../en/Wireless_network_configuration.html" title="Wireless Setup" class="mw-redirect">Wireless Setup</a> provides instructions on how to identify your card, but if your MacBook Pro 7,1 is like mine then you'll head to <a href="../en/Broadcom_wireless.html" title="Broadcom wireless">Broadcom Wireless</a> and use this command.
</p>
<pre>$ lspci -vnn -d 14e4:
</pre>
<p>If from this you discover that your full PCI-ID is <code>[14e4:432b]</code>, then the following advice applies to you: Don't waste time on the <code>b43</code> driver. I've been fiddling with it for weeks, and switching to <code>broadcom-wl</code> made all the problems go away. <code>broadcom-wl</code> might make your device names funky, but that's easily fixed with the udev rule documented on <a href="../en/Broadcom_wireless.html" title="Broadcom wireless">Broadcom Wireless</a>.
</p>
<p>I also recommend <code>netctl</code>.
</p>
<p><br>
</p>
<div style="padding: 5px; margin: 0.50em 0; background-color: #DDDDFF; border: thin solid #BBBBDD; overflow: hidden;">
<strong> Note: </strong> Alternative solution for using b43:
<p>As of kernel version 3.17.1-2, Broadcom Wireless driver most likely won't work (ERROR @wl_cfg80211_scan :WLC_SCAN error (-22)). The only option seems to be loading the b43 driver in <a href="https://en.wikipedia.org/wiki/Programmed_input/output" class="extiw" title="wikipedia:Programmed input/output">PIO</a> mode. To enable PIO mode, install driver by following the guide at <a rel="nofollow" class="external text" href="http://wireless.kernel.org/en/users/Drivers/b43">wireless.kernel.org</a>, then load the b43 kernel module with pio=1 and qos=0 parameters. To make this happen at boot, create <code>b43-firmware.conf</code> file in <code>/etc/modprobe.d/</code> and add the following lines:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">b43-firmware.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">
options b43 pio=1 qos=0

blacklist wl
blacklist brcmsmac
blacklist brcmfmac
blacklist b43legacy
blacklist bcm43xx
blacklist brcm80211
</pre> 
<p><del>Although using PIO should be much slower than using <a href="https://en.wikipedia.org/wiki/Direct_memory_access" class="extiw" title="wikipedia:Direct memory access">DMA</a>, I haven't noticed any performance drop.</del> Further testing showed repetitive occurrences of noticable performance drops. Mostly expressed as rapid decrease of transfer speed, sometimes even dropped connections. It also seems that b43 driver has issues operating at 5Ghz.
</p>
<p>Some later kernels are giving me more success (without PIO), but still some wifi drops have occurred.
</p>
</div>
<h2><span class="mw-headline" id="Video">Video</span></h2>
<p>According to the <a rel="nofollow" class="external text" href="http://wiki.debian.org/MacBookPro">Debian Wiki</a> the MacBook Pro 7,1 has an <a rel="nofollow" class="external text" href="http://www.geforce.com/hardware/desktop-gpus/geforce-GT-320-OEM">NVIDIA GeForce GT 320M</a> in it.
</p>
<h3><span class="mw-headline" id="Nouveau">Nouveau</span></h3>
<p>Works out of the box, performance however is not that great and your system will get quite <i>hot</i> when running nouveau.
</p>
<h3><span class="mw-headline" id="Nvidia">Nvidia</span></h3>
<p>The drivers work out of the box when booting the mac in csm- or legacy-mode.
See <a rel="nofollow" class="external text" href="https://bbs.archlinux.org/viewtopic.php?id=162289">here</a> for some discussion on the topic.
</p>
<p>Running the drivers in <b>efi-mode</b> requires setting some PCI registers before the kernel modules get loaded, preferably using a udev hook or GRUB script. Otherwise, the screen just remains black when X starts. Follow these <a rel="nofollow" class="external text" href="http://askubuntu.com/questions/264247/proprietary-nvidia-drivers-with-efi-on-mac-to-prevent-overheating/613573#613573">instructions</a> in order to find the appropriate PCI device IDs for which to set the registers. This approach has been confirmed to work and is still being actively discussed inside the above mentioned <a rel="nofollow" class="external text" href="https://bbs.archlinux.org/viewtopic.php?pid=1522950#p1522950">thread</a>.
</p>
<p><b>To be continued..</b>
</p>
</div>
<div id="catlinks" class="catlinks">
<div id="mw-normal-catlinks" class="mw-normal-catlinks">
<a href="../Special:Categories.html" title="Special:Categories">Category</a>: <ul><li><a href="../en/Category:Apple.html" title="Category:Apple">Apple</a></li></ul>
</div>
<div id="mw-hidden-catlinks" class="mw-hidden-catlinks mw-hidden-cats-hidden">Hidden category: <ul><li><a href="../en/Category:Pages_or_sections_flagged_with_Template:Style.html" title="Category:Pages or sections flagged with Template:Style">Pages or sections flagged with Template:Style</a></li></ul>
</div>
</div>					<div class="visualClear"></div>
				</div>
			</div>
		</div>
		<div class="visualClear"></div>
					<div id="footer" role="contentinfo">
Extracted from <a href="https://wiki.archlinux.org"> ArchWiki </a> and licensed under <a href="http://www.gnu.org/copyleft/fdl.html"> GDL >= 1.3</a>
		</div>
		</div>
		</body>
</html>
